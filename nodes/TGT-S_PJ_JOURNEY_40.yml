fileVersion: 1
id: 3a8ae152-e098-4a59-a2af-4c3d88a06592
name: S_PJ_JOURNEY_40
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Find any relevant Acute Booking Form data."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d00c32db-a480-460f-b252-cb13871ef4c3
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique ID for a patient journey
        name: JOURNEY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 15dbefba-904b-4b84-a2a2-ed523a968a08
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0b753a9-d7b6-41c4-be06-5443530f882f
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 70753ad4-7f17-4546-b6bd-6a75dc7dd862
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f79e3518-54be-4a50-b978-0732524f5f74
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Journey number for the patient.
        name: JOURNEY_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 934ad6d9-4efb-465b-8d76-42bd4c3a3d72
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb9290db-2a37-4fb5-b570-ec66e1244a9d
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time for the first event in the journey.
        name: FIRST_EVENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 30c2b167-bb00-4039-98bf-8ca41192b5a9
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2eaa094c-a373-49e7-9035-21e0e8edc77c
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: First theatre Encounter unique identifier
        name: FIRST_THEATRE_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54b94b27-d205-47c7-a5f3-12d289185159
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c09194e-5bfc-4eeb-8817-b0cb55929105
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time for the first theatre event in the journey.
        name: FIRST_THEATRE_EVENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6ced4c02-5159-4a85-9080-63374c827762
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88ed1ada-8379-49ba-8c05-d6c334216674
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Numbers rows for each journey so that a single row for each journey can be easily selected.
        name: JOURNEY_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 15dbefba-904b-4b84-a2a2-ed523a968a08
                stepCounter: 8190dcc6-8301-47ab-9fd9-68b29ee91fde
            transform: ROW_NUMBER() OVER(PARTITION BY journey_id ORDER BY booking_outcome DESC, booking_sent_date DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a8bad93-3e7d-45fe-a8f6-de5fed97f09a
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: BOOKING_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 69a93598-b5c1-45f7-a7cb-d44bd521a0cc
                stepCounter: 255a8bc5-5383-4153-a4c1-d791d6c02c10
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ce24974-5bfc-4ca2-a717-5a2354a1036b
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: BOOKING_SENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc307d76-c605-44f2-9551-81b81ae235d0
                stepCounter: 255a8bc5-5383-4153-a4c1-d791d6c02c10
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60cacb39-771c-4d6d-88f6-e592f2b51e63
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_theatre_booking.booking_id=dim_theatre_booking.booking_id
        name: DIM_THEATRE_BOOKING_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a304a2e-cf06-4fcc-99ad-fbd6f6f710f2
                stepCounter: 255a8bc5-5383-4153-a4c1-d791d6c02c10
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1bda0e2a-2ef1-4da7-bc97-859607b2e8d4
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_theatre_booking.booking_specialty=dim_theatre_booking_procedure.booking_specialty  s_theatre_booking.booking_procedure=dim_theatre_booking_procedure.booking_procedure
        name: DIM_THEATRE_BOOKING_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1a591118-652a-4989-a418-f745a4035598
                stepCounter: 255a8bc5-5383-4153-a4c1-d791d6c02c10
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f9f82a6-8397-49c9-a51a-3d650a1ec5a3
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_OUTCOME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e382e4f-bead-4924-aac2-e9a524719c2f
                stepCounter: 8a0f4770-2531-4823-a314-1f7db24f325c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99e0f97b-d40d-4872-85f4-21ec3c4512b6
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: BOOKING_STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37f1d04d-c5e5-4e3a-ab07-85d2c3aae871
                stepCounter: 009a1d58-bbf3-4029-85a6-f9254e5e29a8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09cd3231-6767-4778-b32f-96ce93286e1a
          stepCounter: 3a8ae152-e098-4a59-a2af-4c3d88a06592
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_PJ_JOURNEY_10
        join:
          joinCondition: |-
            FROM s_PJ_journey_10
              JOIN fact.fact_theatre_booking
                ON fact_theatre_booking.patient_nhi = s_PJ_journey_10.patient_nhi
               AND fact_theatre_booking.booking_sent_date BETWEEN s_PJ_journey_10.first_event_start_date AND s_PJ_journey_10.first_theatre_event_start_date
              JOIN dim.dim_theatre_booking
                ON fact_theatre_booking.dim_theatre_booking_key = dim_theatre_booking.dim_theatre_booking_key
              JOIN dim.dim_theatre_booking_status
                ON fact_theatre_booking.dim_theatre_booking_status_key = dim_theatre_booking_status.dim_theatre_booking_status_key
             WHERE dim_theatre_booking_status.booking_status_code <> 8 -- Cancelled
        name: S_PJ_JOURNEY_40
        noLinkRefs: []
  name: S_PJ_JOURNEY_40
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
