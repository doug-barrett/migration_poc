fileVersion: 1
id: 24c1397b-e965-4715-b630-21a0e509b04c
name: S_IPM_STAFF_TEAMS_2
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f974ed3a-cb78-4c39-81f1-5ccb954233bc
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: RNSCHDL
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_pims_prof_carer_map.schdl_refno, dim_staff_team.dim_staff_team_key ORDER BY ds_pims_prof_carer_map.modif_dttm DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe22b4c2-b922-45cf-a6f7-cda839be3111
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_ENCOUNTER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: "'T'+cast(ds_pims_prof_carer_map.schdl_refno AS varchar)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4a27434-9b62-468e-af8f-04695ddb7ec3
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: SCHDL_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea2589f9-8f57-4bfd-9189-381706b5e5cf
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4142ad83-0a44-486c-855a-781a985ee493
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 455d7269-34d2-440e-b123-0e7ff8fe8978
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64eb5919-f263-467a-8390-2e57cccba036
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: STEAM_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85274185-e476-4809-a5b5-f3eb0acf45d3
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb233506-0a4c-4d5f-aab6-6799dd41aeb4
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_iPM_staff_teams.proca_refno=dim_healthcare_professional.healthcare_professional_reference_no
        name: DIM_HEALTHCARE_PROFESSIONAL_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3b22451-95b4-47f3-b7c1-48136447e09b
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: IFNULL(dim_healthcare_professional.dim_healthcare_professional_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 316bd085-5ed5-4f17-986d-45d1fa51b518
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_iPM_staff_teams.steam_refno=dim_staff_team.staff_team_reference_no
        name: DIM_STAFF_TEAM_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2030fa3c-65c8-49cd-8e31-7d93c4d3069f
                stepCounter: c2c00be3-5ba0-4886-830e-19251a8bd04b
            transform: IFNULL(dim_staff_team.dim_staff_team_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e5130159-8774-4d9a-bf2c-3723b0f7c7c1
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: SCHEDULE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 232cb164-41b5-421f-8189-6db893efe5be
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 31165ba4-09cb-4877-8ba5-c6c8428e166d
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: healthcare_professional_fullname
        name: HEALTHCARE_PROFESSIONAL_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eadd978e-5aa2-4c28-8eea-a75d5bfd108b
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: dim_healthcare_professional.healthcare_professional_fullname +' ('+ dim_healthcare_professional.healthcare_professional_type_desc + ')'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab71171a-4087-4ab1-91e2-0d07ff0aaf57
          stepCounter: 24c1397b-e965-4715-b630-21a0e509b04c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_PIMS_PROF_CARER_MAP: 3f7e4431-5c07-47a3-b850-49b3af652a4b
          DS_SHARED_SCHEDULE: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
          DS_PIMS_REFERENCE_VALUES: 06fa4241-360c-43d0-8e4a-8b860f92fc09
          DIM_HEALTHCARE_PROFESSIONAL: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PROF_CARER_MAP
          - locationName: TGT
            nodeName: DS_SHARED_SCHEDULE
          - locationName: TGT
            nodeName: DS_PIMS_REFERENCE_VALUES
          - locationName: TGT
            nodeName: DIM_HEALTHCARE_PROFESSIONAL
        join:
          joinCondition: |-
            FROM {{ ref('TGT','DS_PIMS_PROF_CARER_MAP') }}
              JOIN {{ ref('TGT','DS_SHARED_SCHEDULE') }}
                ON ds_pims_prof_carer_map.schdl_refno = ds_shared_schedule.schedule_reference_no
               AND ds_shared_schedule.schedule_type_code = 'THEAT'
              JOIN s_shared_schedule_theatre_05
                ON s_shared_schedule_theatre_05.patient_reference_no = ds_shared_schedule.patient_reference_no
              JOIN {{ ref('TGT','DS_PIMS_REFERENCE_VALUES') }} PCRTP
                ON PCRTP.rfval_refno = ds_pims_prof_carer_map.pcrtp_refno
               AND ds_pims_prof_carer_map.role_order = 1
              JOIN {{ ref('TGT','DIM_HEALTHCARE_PROFESSIONAL') }}
                ON ds_pims_prof_carer_map.proca_refno = dim_healthcare_professional.healthcare_professional_reference_no
              JOIN dim.[dim_staff_team]
                ON PCRTP.main_code = dim_staff_team.staff_team_code
               AND dim_staff_team.dss_current_flag = 'Y'
        name: S_IPM_STAFF_TEAMS_2
        noLinkRefs: []
  name: S_IPM_STAFF_TEAMS_2
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
