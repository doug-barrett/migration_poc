fileVersion: 1
id: 1281590f-8e04-4459-acf1-d85252f8f482
name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b90fba19-efcf-4e76-bfcd-1f2129fe7b37
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(13)
        defaultValue: ""
        description: ""
        name: COUNTRY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9da8457-3606-404d-b56a-0f4521df8ff6
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60b80310-406a-46f8-bd14-4558d336fc7c
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0cbf9f57-0ac2-4b67-86ad-7c7debd91bb5
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(14)
        defaultValue: ""
        description: ""
        name: LANGUAGE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4cf6c72c-8a52-4f3d-89eb-b36f732860d6
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CURRENCY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 290506b2-3b5c-43c9-adec-0c26685119a4
                stepCounter: 1219194f-2e69-4511-8c03-744d7776c476
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 936390aa-c6d8-49d4-924c-01e6eede9be6
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: UTILITY_PROVIDER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea40fefd-9081-42f0-809a-2205e0305927
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: INVOICE_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59ab4e80-a109-4d1a-9c48-da0a7ddc1729
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ACCOUNT_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28ebc48b-954a-49b2-9d14-a35e120f72e4
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DELIVERY_POINT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7bb7cd8a-4f42-4add-bcb9-3923581c9f26
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: CONSUMPTION_MONTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cd35a73-097a-47d8-a94b-9d64fbf0a421
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: METER_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9c5c6f9-fea8-4309-81f6-62064c51a0fb
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75b72117-fb9d-401c-b877-87b94b2fb1f4
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6a09342-5498-486d-891f-5dc820665885
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a3827fd-d199-41d7-8316-068ccb642548
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CC_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfadd292-dc36-420a-a575-daddfcd37767
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d28f963b-bfe1-490e-a8a8-8b9c73778296
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2bab4f35-924b-464a-b110-553b6e6c16e2
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ccf61b66-167e-4023-878f-a1b131641bf2
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d0a970a-f14f-4b42-8740-507631f3ade6
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c99f9ef-3477-414f-a581-1b60fe675fa7
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bd34013-52c1-466b-a5dc-df3862a3fd1c
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6223345e-cd6c-4285-822d-04249618781c
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REGISTERED_DEMAND_KVA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac50aa7c-68af-4f13-8a3e-68a41b28af5d
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILLED_DEMAND_KVA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc68ff96-9cb3-4c08-8f22-68240fbb0690
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a9cbb63-725d-4ca3-8e85-aa5a3429b7d0
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4dfccb3-fa23-4fac-833f-aaf8e88845be
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b503c078-6f58-4dab-af1a-112be047c801
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcbd1fe3-bd3e-4aad-b866-8740d7bebe81
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_AMOUNT_DUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe6d0140-97a2-433f-a7fc-affe6326684a
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SUBTOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2186802-ff40-4631-a2e6-c973677ff52e
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1542f4e7-31e7-493f-9901-2d75ba13a126
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d74db4f-f19f-4aae-a665-4915240e256b
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57bf67cf-2ef4-4041-975c-746941cf6599
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BASIC_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d153882-78e3-44af-a7e0-cae33f0b5701
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DEMAND_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1beb4a45-7b28-4f31-8bf5-fd6200619615
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REACTIVE_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b2325df-1290-4a58-ba5f-e62687716a7e
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TRANSMISSION_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d603760-1824-42b5-a519-b5de3929a496
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OTHER_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4f0ab5f-41a7-467f-bc07-fb1a3d294de0
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SERVICE_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13de3c93-411a-4dd4-98e1-0b6955bc153b
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cdc56c00-6740-48d3-805e-25ad0ed4a170
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX_GST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 574a61a6-39a5-4fa2-b872-f4d4a3d2fa17
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEDERAL_TAX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6799fb16-15ad-4459-9ac3-a45edd1bbb56
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a449b775-ff50-49a8-baa7-49b55dc0cd26
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: MST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9572d22-e833-4ad0-a550-dc03446c3401
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VAT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6611118f-2e7a-41b5-b064-06ae2c981313
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: METER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7dc50d32-cff0-471a-b5f6-4355d8986fb8
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_MULTIPLIER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e5c542d-f90d-4c0b-9cf4-c4fc53ceee5b
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33dd395d-13c0-43cf-9054-cf371cb7597d
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: POWER_FACTOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: effdf9df-6218-4a34-81ab-556ec5a0e91a
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_DEMAND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b6caf22-60ff-422a-ba0d-9e04b4e1aec2
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90589863-0db9-4bc4-bcd2-32cc0a037e63
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CC_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90b3db79-f41f-4e52-9bcc-ea416301c1c3
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_YEARMONTH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6900151-98df-46b1-90a5-743ccb40a878
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a060a9a0-cf43-4f68-bf6b-6bfc46186b31
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FOREMAN
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 49cc2d8d-e399-4e6a-8900-b6a9a70054a1
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 31cdbdc1-f6e2-4d61-8233-cb23f174680b
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BATTERY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 688c7dc1-d982-4e9f-825a-1f57056d84c9
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9ca59937-7db1-4502-94ec-4542d8c92fc0
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: WELL_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1dde540-7bb7-4c5a-8c82-2b2fd5509197
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RUN_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 143af986-5eb4-463f-803c-c35e3bb47792
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LOCATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d9c8807-082f-420e-bf49-dbf497abfdb6
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LATITUDE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3bb6358-a0d2-4d36-896d-e34608ca5129
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LONGITUDE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45d559a6-58ce-4c97-9ca5-7190f7857d1f
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OPERATING_HOURS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aaefc8fa-5c86-479a-89a7-4ad918226daa
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DOWNTIME_HOURS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a47fc01-d232-4540-b94c-1c3553566c0e
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL_M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 65c06e85-9dff-497b-a150-901d3c2cb047
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WATER_M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 52e461c1-5542-48ad-b942-e42c5419d863
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS_E3M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6de34087-9761-49df-89b1-859dfd6f5b80
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL_BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5ca52f2-7300-4d57-bd3d-8a7603cddb26
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS_BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdbfa0e7-850f-40c5-b397-2ddd8d0e6745
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da9bd001-b18a-4624-94c8-d3a1ae91d040
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5cef0ca-5f97-4d3a-9318-cf8eabcf4b5e
                stepCounter: b4b146a8-9ccd-4a77-a003-15b8b1b1d14b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0d3645d-089c-4eb9-9c0e-fa82626a559a
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WORKING_INTEREST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcdabb54-0442-4ec7-b8ed-8794d210b8e8
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PUMP_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa6b7fd6-5e0a-471d-b8ca-1cb170bfc3b6
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: SOURCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1655b881-e97a-4872-9826-603fb7ea660e
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e7be7ea-e19f-4267-98f8-19a35b05c5bd
          stepCounter: 1281590f-8e04-4459-acf1-d85252f8f482
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: NORM_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH: 1281590f-8e04-4459-acf1-d85252f8f482
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH') }} AS WITH MJ AS (
                    SELECT *
                      FROM (
                            SELECT DISTINCT("UNIT_NAME") AS WELL_NAME ,
                                   Try_Cast("CHILD_ACCOUNT" AS float) AS CHILD_ACCOUNT_NUMBER ---pls keep this as float!!----
            ,
                                   Try_Cast("METER_NUMBER" AS float) AS METER_NUMBER ,
                                   "COST_CENTER" AS CC_NUM ,
                                   '' AS CC_NAME ,
                                   "AREA" AS AREA ,
                                   "CORE_AREA" AS CORE_AREA ,
                                   Province ,
                                   Facility ,
                                   Foreman ,
                                   '' AS RUN_NAME ,
                                   '' AS Battery ,
                                   TYPE AS TYPE ,
                                   'Non PV' AS SOURCE
                              FROM DS_POWER.NONPV_ENTITIES NPV
                             WHERE "CHILD_ACCOUNT" IS NOT NULL
                               AND Country='CANADA'
                         UNION ALL SELECT DISTINCT(WELL_NAME),
                                   CHILD_ACCOUNT_NUMBER AS CHILD_ACCOUNT_NUMBER,
                                   METER_NUMBER AS METER_NUMBER ,
                                   CC_NUM,
                                   CC_NAME,
                                   AREA,
                                   CORE_AREA,
                                   PROVINCE,
                                   FACILITY,
                                   FOREMAN,
                                   RUN_NAME,
                                   BATTERY,
                                   WELL_TYPE AS TYPE,
                                   'ProdView' AS SOURCE
                              FROM ML_POWER.VW_FDC_PWRANALYTICS PV
                             WHERE CHILD_ACCOUNT_NUMBER IS NOT NULL
                               AND PROVINCE IN ('ALBERTA', 'SASKATCHEWAN','MANITOBA')
                               AND WELL_NAME not like '%Battery%'
                           ) MJ3
                     CROSS JOIN DS_POWER.VET_DIMDATE M
                     WHERE Year(Date) > 2016
                       AND Year(Date) <= Year(GetDate())
                   ) ,
                   PV_AGG_A AS (
                    SELECT MJ.CHILD_ACCOUNT_NUMBER,
                           Max(PV.Facility) AS Facility ,
                           MJ.Date,
                           Sum(IFNULL(PV.WATER_M3,'0')) AS WATER_M3 ,
                           Sum(IFNULL(PV.OIL_M3,'0')) AS OIL_M3,
                           Sum(IFNULL(PV.GAS_E3M3,'0')) AS GAS_E3M3 ,
                           Sum(IFNULL(PV.BOE,'0')) AS BOE,
                           count(*) AS Well_Count ,
                           1.00/Count(*) AS "WellCount Proration",
                           (DATEFROMPARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM,
                           Max(MJ.Source) AS SOURCE
                      FROM MJ
                      LEFT OUTER JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON MJ.Well_Name = PV.WELL_NAME
                       AND MJ.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY MJ.CHILD_ACCOUNT_NUMBER,
                              MJ.Date
                   ) ,
                   T AS (
                    SELECT *,
                           (DATEFROMPARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM
                      FROM MJ
                     WHERE SOURCE='Non PV'
                       AND Facility IS NOT NULL
                       AND (TYPE='PVFAC' OR TYPE='FAC')
                   ) ,
                   T1 AS (
                    SELECT max(T.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER ,
                           T.Date,
                           count(*) AS Well_Count ,
                           1.00/Count(*) AS "WellCount Proration"
                      FROM T
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON T.Facility = PV.FACILITY
                       AND T.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY T.Facility,
                              T.Date
                   ) ,
                   PV_AGG_NONPV AS (
                    SELECT MAX (T.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER ,
                           Max(IFNULL(PV.Facility,T.Facility))AS FACILITY ,
                           max(T.Date) AS Date ,
                           Sum(IFNULL(PV.WATER_M3,'0')) AS WATER_M3 ,
                           Sum(IFNULL(PV.OIL_M3,'0')) AS OIL_M3 ,
                           Sum(IFNULL(PV.GAS_E3M3,'0')) AS GAS_E3M3 ,
                           Sum(IFNULL(PV.BOE,'0')) AS BOE ,
                           Max(T1.Well_Count)AS Well_Count ,
                           Max(T1."WellCount Proration") AS "WellCount Proration" ,
                           Max(FOM) AS FOM,
                           Max(T.Source) AS SOURCE
                      FROM T
                      LEFT JOIN T1
                        ON T1.CHILD_ACCOUNT_NUMBER = T.CHILD_ACCOUNT_NUMBER
                       AND T1.Date = T.Date
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON T.Facility = PV.FACILITY
                       AND T.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY PV.Facility,
                              Prod_YEARMONTH
                   ) ,
                   AGG AS (
                    SELECT *
                      FROM PV_AGG_A
                 UNION ALL SELECT *
                      FROM PV_AGG_NONPV
                   ) ,
                   AGG_Final AS (
                    SELECT CHILD_ACCOUNT_NUMBER,Date,Max(Facility) AS Facility,
                           Sum(WATER_M3)AS WATER_M3,
                           Sum(OIL_M3)AS OIL_M3,
                           Sum(GAS_E3M3) AS GAS_E3M3,
                           Sum(BOE)AS BOE,
                           Sum(Well_Count) AS Well_Count
                      FROM AGG
                     GROUP BY AGG.CHILD_ACCOUNT_NUMBER,
                              AGG.Date
                   ) ,
                   PV AS (
                    SELECT MJ.WELL_NAME,
                           PV_W.UWI,
                           IFNULL(PV_W.CC_NUM,MJ.CC_NUM) AS CC_NUM ,
                           PV_W.CC_NAME,
                           IFNULL(MJ.Province,PV_W.PROVINCE) AS Province ,
                           IFNULL(MJ."CORE_AREA",PV_W.CORE_AREA) AS CORE_AREA,
                           IFNULL(MJ."AREA",PV_W.AREA) AS Area ,
                           IFNULL(MJ.Foreman,PV_W.FOREMAN) AS FOREMAN,
                           IFNULL(PV_W.RUN_NAME,MJ.RUN_NAME) AS RUN_NAME ,
                           IFNULL(MJ.Facility,PV_W.FACILITY) AS FACILITY,
                           IFNULL(PV_W.BATTERY,MJ.Battery) AS BATTERY ,
                           IFNULL(PV_W.WELL_TYPE,MJ.TYPE) AS WELL_TYPE,
                           PV_W.Surface_Location ,
                           PV_W.SURFACE_LATITUDE,
                           PV_W.SURFACE_LONGITUDE,
                           PV_W.OPERATING_HOURS,
                           PV_W.DOWNTIME_HOURS ,
                           PV_W.ON_PROD_DATE,
                           PV_W.LAST_PROD_DATE,
                           PV_W.PROD_YEAR,
                           PV_W.PROD_MONTH,
                           PV_W.PROD_YEARMONTH ,
                           PV_W.WORKING_INTEREST,
                           PV_W.PUMP_TYPE,
                           TO_VARCHAR(PV_W.METER_NUMBER) AS METER_NUMBER ,
                           TO_VARCHAR(MJ.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER,
                           MJ.Date AS EoProdMonth ,
                           (DATE_FROM_PARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.WATER_M3
                                ELSE IFNULL(PV_W.WATER_M3,'0')
                                 END AS WATER_M3 ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.OIL_M3
                                ELSE IFNULL(PV_W.OIL_M3,'0')
                                 END AS OIL_M3 ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.GAS_E3M3
                                ELSE IFNULL(PV_W.GAS_E3M3,'0')
                                 END AS GAS_E3M3 ,
                           IFNULL(PV_W.OIL_BOE,'0') AS OIL_BOE,
                           IFNULL(PV_W.GAS_BOE,'0') AS GAS_BOE ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.BOE
                                ELSE IFNULL(PV_W.BOE,'0')
                                 END AS BOE ,
                           IFNULL(AGG_Final.BOE,'0') AS TotalBOE,
                           AGG_Final.WELL_COUNT AS PV_Well_Count ,
                           MJ.Source ,
                           CASE WHEN AGG_Final.BOE = 0                                           THEN 1.00/AGG_Final.WELL_COUNT
                                WHEN AGG_Final.BOE IS NULL AND 1.00/AGG_Final.WELL_COUNT IS NULL THEN 1.00
                                ELSE (PV_W.WATER_M3+PV_W.OIL_M3)/AGG_Final.BOE
                                 END AS Proration_BOE ,
                           1.00/AGG_Final.WELL_COUNT AS Well_Proration
                      FROM MJ
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV_W
                        ON MJ.Well_Name = PV_W.WELL_NAME
                       AND MJ.Date = LAST_DAY(TO_DATE(CAST(PV_W.PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                      LEFT JOIN AGG_Final
                        ON MJ.CHILD_ACCOUNT_NUMBER = AGG_Final.CHILD_ACCOUNT_NUMBER
                       AND MJ.Date = AGG_Final.Date
                   ) ,
                   PV1 AS (
                    SELECT PV.*,
                           CASE WHEN BOE = 0    THEN 0
                                WHEN TotalBOE=0 THEN 0
                                ELSE BOE/TotalBOE
                                 END AS PR_BOE
                      FROM PV
                   ) ,
                   Fin AS (
                    SELECT PB.Country ,
                           CASE WHEN PB.PROVINCE='Manitoba' THEN 'SASKATCHEWAN'
                                ELSE PB.PROVINCE
                                 END AS PROVINCE ,
                           PB.Language,
                           PB.Currency,
                           Utility_Provider,
                           Invoice_Number,
                           Account_Number ,
                           PB.Delivery_Point ,
                           Consumption_Month,
                           IFNULL(PB.Meter_Number,PV1.METER_NUMBER) AS Meter_Number ,
                           try_cast(PB.Cost_Center AS nvarchar(255))AS Cost_Center,
                           PV1.CC_NAME AS CC_NAME ,
                           PV1.CORE_AREA AS CORE_AREA,
                           PV1.Area ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Total_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Total_Consumption_kWh
                                ELSE Total_Consumption_kWh
                                 END AS Total_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Consumption_kWh
                                ELSE Peak_Consumption_kWh
                                 END AS Peak_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Off_Peak_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Off_Peak_Consumption_kWh
                                ELSE Off_Peak_Consumption_kWh
                                 END AS Off_Peak_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Registered_Demand_kVA
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Registered_Demand_kVA
                                ELSE Registered_Demand_kVA
                                 END AS Registered_Demand_kVA ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Billed_Demand_kVA
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Billed_Demand_kVA
                                ELSE Billed_Demand_kVA
                                 END AS Billed_Demand_kVA ,
                           Current_Meter_Read_Date,
                           Current_Meter_Read,
                           Previous_Meter_Read_Date,
                           Previous_Meter_Read ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Total_Amount_Due
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Total_Amount_Due
                                ELSE Total_Amount_Due
                                 END AS Total_Amount_Due ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Subtotal
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Subtotal
                                ELSE Subtotal
                                 END AS Subtotal ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Energy_Cost
                                ELSE Energy_Cost
                                 END AS Energy_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Energy_Cost
                                ELSE Peak_Energy_Cost
                                 END AS Peak_Energy_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Off_Peak_Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Off_Peak_Energy_Cost
                                ELSE Peak_Energy_Cost
                                 END AS Off_Peak_Energy_Cost ,
                           Basic_Cost/PV_Well_Count AS Basic_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Demand_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Demand_Cost
                                ELSE Demand_Cost
                                 END AS Demand_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Reactive_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,0) * Reactive_Cost
                                ELSE Reactive_Cost
                                 END AS Reactive_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Transmission_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Transmission_Cost
                                ELSE Transmission_Cost
                                 END AS Transmission_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Other_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Other_Cost
                                ELSE Other_Cost
                                 END AS Other_Cost ,
                           Service_Address ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Carbon_Tax
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Carbon_Tax
                                ELSE Carbon_Tax
                                 END AS Carbon_Tax ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Carbon_Tax_GST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Carbon_Tax_GST
                                ELSE Carbon_Tax_GST
                                 END AS Carbon_Tax_GST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Federal_Tax_GST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Federal_Tax_GST
                                ELSE Federal_Tax_GST
                                 END AS Federal_Tax ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * PST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * PST
                                ELSE PST
                                 END AS PST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * MST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * MST
                                ELSE MST
                                 END AS MST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * VAT
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * VAT
                                ELSE VAT
                                 END AS VAT ,
                           Cast(Meter_Type AS varchar) AS Meter_Type ,
                           Bill_Multiplier ,
                           Rate,
                           Power_Factor ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Demand
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Demand
                                ELSE Peak_Demand
                                 END AS Peak_Demand,
                           Bill_Days ,
                           PV1.CC_NUM AS CC_NUM,
                           PV1.PROD_YEARMONTH,
                           PV1.Well_Name AS WELL_NAME ,
                           CASE WHEN PV1.FOREMAN IS NULL THEN PV1.FOREMAN
                                ELSE PV1.FOREMAN
                                 END AS FOREMAN ,
                           PV1.RUN_NAME,
                           BATTERY,
                           UWI,
                           WELL_TYPE,
                           PV1.SURFACE_LOCATION,
                           PV1.SURFACE_LATITUDE ,
                           PV1.SURFACE_LONGITUDE,
                           PV1.OPERATING_HOURS,
                           PV1.DOWNTIME_HOURS,
                           PV1.OIL_M3 ,
                           PV1.WATER_M3,
                           PV1.GAS_E3M3,
                           PV1.OIL_BOE,
                           PV1.GAS_BOE,
                           PV1.BOE,
                           PV1.TotalBOE ,
                           PV1.FACILITY,
                           WORKING_INTEREST,
                           PUMP_TYPE,
                           PV1.Source ,
                           CASE WHEN PV1.CORE_AREA = 'QUEENSDALE' AND PV1.AREA IN ('ARCOLA', 'ARLINGTON', 'BROWNING', 'CANTAL', 'CRYSTAL HILLS', 'EDENVALE/WAUCHOPE', 'FLINTON/MOOSE VALLEY', 'HAZELWOOD', 'QUEENSDALE FIELD', 'WINMORE/WORKMAN', 'WORDSWORTH FIELD') THEN 'Woodlands Sold'
                                ELSE ''
                                 END AS SK_Flag ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Subtotal
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Subtotal
                                ELSE Subtotal
                                 END AS Total_Cost ,
                           CASE WHEN BATTERY IS NULL                              THEN 'FAC'
                                WHEN WELL_TYPE LIKE 'Inj%'                        THEN 'FAC'
                                WHEN WELL_TYPE = 'facility'                       THEN 'FAC'
                                WHEN PB.PROVINCE<>'ALBERTA' AND WELL_TYPE IS NULL THEN 'FAC'
                                ELSE 'WELL'
                                 END AS Norm_Type
                      FROM WS_EDW.VIEW_PWRANALYTICS_VET_POWER_MTH_UNION PB
                      LEFT JOIN PV1
                        ON PB.Account_Number=PV1.CHILD_ACCOUNT_NUMBER
                       AND PV1.FOM = (PB.Consumption_Month)
                     WHERE Country = 'Canada'
                   ) SELECT Country,
                   PROVINCE,
                   LANGUAGE,
                   Currency,
                   Utility_Provider,
                   Invoice_Number ,
                   CASE WHEN Account_Number = '510003313101' THEN '510002563490'
                        ELSE Account_Number
                         END AS Account_Number ,
                   Delivery_Point,
                   Consumption_Month,
                   Meter_Number,
                   Cost_Center,
                   CC_NAME,
                   CORE_AREA,
                   Area,
                   Total_Consumption_kWh,
                   Peak_Consumption_kWh,
                   Off_Peak_Consumption_kWh,
                   Registered_Demand_kVA,
                   Billed_Demand_kVA ,
                   Current_Meter_Read_Date,
                   Current_Meter_Read,
                   Previous_Meter_Read_Date,
                   Previous_Meter_Read,
                   Total_Amount_Due,
                   Subtotal,
                   Energy_Cost,
                   Peak_Energy_Cost,
                   Off_Peak_Energy_Cost,
                   Basic_Cost,
                   Demand_Cost ,
                   Reactive_Cost,
                   Transmission_Cost,
                   Other_Cost,
                   Service_Address,
                   Carbon_Tax,
                   Carbon_Tax_GST,
                   Federal_Tax,
                   PST,
                   MST,
                   VAT,
                   Meter_Type,
                   Bill_Multiplier,
                   Rate,
                   (Total_Consumption_kWh / (NULLIF(Registered_Demand_kVA,'0') * NULLIF((Bill_Days * 24),'0'))) AS Power_Factor ,
                   Peak_Demand,
                   Bill_Days,
                   CC_NUM,
                   PROD_YEARMONTH,
                   WELL_NAME,
                   FOREMAN,
                   BATTERY,
                   UWI,
                   WELL_TYPE,
                   RUN_NAME,
                   SURFACE_LOCATION,
                   SURFACE_LATITUDE,
                   SURFACE_LONGITUDE,
                   OPERATING_HOURS,
                   DOWNTIME_HOURS,
                   OIL_M3,
                   WATER_M3,
                   GAS_E3M3,
                   OIL_BOE,
                   GAS_BOE ,
                   BOE,
                   FACILITY,
                   WORKING_INTEREST,
                   PUMP_TYPE,
                   SOURCE,
                   Total_Cost,
                   Norm_Type
              FROM Fin
             WHERE SK_Flag <>'Woodlands Sold'
               AND ACCOUNT_NUMBER NOT IN (
                    SELECT TO_VARCHAR(ACCOUNT_NUMBER)
                      FROM DS_POWER.ACCOUNT_EXCLUSIONS
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PWRANALYTICS_NONPV_ENTITIES
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PWRANALYTICS_NONPV_ENTITIES') }}
        name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
        noLinkRefs: []
  name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
