fileVersion: 1
id: a4f59e09-d837-4a23-afaf-ae8ee1c36250
name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4f68909-ff8f-4213-b5f8-79e636eec7ae
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(13)
        defaultValue: ""
        description: ""
        name: COUNTRY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b7cbf737-4512-490d-bde6-c80a49b6111e
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4060ce21-33f9-4e59-b8f7-fa0e6935daa8
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a021ad5c-2ce0-451a-8437-997a7620428d
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(14)
        defaultValue: ""
        description: ""
        name: LANGUAGE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3632e84e-10ed-421e-ae97-e05695b4b137
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CURRENCY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 43c724ed-fff6-48c7-ae2c-3b5ddee88deb
                stepCounter: e3c8419f-8dde-4fec-b0f5-9b6a2323e8a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b5ac217-7f4b-45bc-9b55-7738106bd970
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: UTILITY_PROVIDER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d6c8df5-7ca7-46af-bf1a-28ed64a1379d
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: INVOICE_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc3ec193-0e5a-4cac-924e-7e5c62cfee84
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ACCOUNT_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d7f6abf-7f2b-4c35-bfd6-a4042b72474f
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DELIVERY_POINT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d406e127-1e66-40f3-a135-5f2a6fa920f8
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: CONSUMPTION_MONTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 648fab8e-e819-4a9a-a4ed-92a68e8a4e44
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: METER_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cceb507e-fb89-4616-944b-88d5a35df70b
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5521cd1c-3c06-4885-9271-a8c5a731473a
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 86dc9e1c-6cae-4f79-b2ab-6fd4970f2d52
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a77849c-8c1d-4ee0-a583-039449f4ad05
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CC_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e761b2c-bbb1-4a1b-aa3b-117ae089d392
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fdb7b9c0-1bd9-4bc0-854e-16db7c79266d
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1605a2e7-f0a5-44ed-bb9b-add25103a255
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5ac7ee3-af5a-4a18-9677-c488314f38e8
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de9a4f6b-8626-4ed4-b343-2df199b832aa
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1803ec2-5277-43fd-921c-22d7d08ac57c
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a726253-7d7a-4efd-a7bc-979216cb2e45
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_CONSUMPTION_KWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b9cea50-076b-4709-9f80-c599c7e839f0
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REGISTERED_DEMAND_KVA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23866eb4-a837-4cfe-8e54-27ae78c2ddbf
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILLED_DEMAND_KVA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90845a57-15c5-4e7c-a05d-c529e26ca807
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91e63ec5-ec3f-4c75-a420-9155a617d356
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9748e06-e96a-4d22-b79f-f1d86b7e4f95
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 244f216f-3d93-47a2-9a5c-c501da416883
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90b4521d-ef69-4c41-b06d-bc23c1f129ec
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_AMOUNT_DUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a4e56ed-a455-422b-a4dd-ece9bd2434cb
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SUBTOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d11883ac-ec50-4cc2-8d8b-cb3c2758f2b4
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22bd713b-cb37-4d25-ad77-9d6689bb6ae5
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7708ad18-0230-4a88-b88c-8d2a45b3955b
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_ENERGY_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdb7c0ce-19c6-4028-942a-eb31f1d1c346
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BASIC_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c78eac53-b284-4352-890f-2cb3bf257916
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DEMAND_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6b31c9f-6aa2-428d-ad39-12074ed87812
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REACTIVE_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 348a01ac-a452-45e6-bea9-dd58a55d384d
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TRANSMISSION_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b534287-a9aa-41a5-803f-bc1194be3bd0
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OTHER_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3d4ff455-c393-4686-b730-1ea55af3f0c7
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SERVICE_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7507552a-1f32-485e-a710-3eb17b87e5b4
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1cc0d460-cb62-4726-8224-d83df44107e7
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX_GST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 037dbde2-da57-4b17-8fa7-89fb563d71a5
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEDERAL_TAX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 562fc300-acb1-4fe5-9859-6b27a5b7cad8
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d36790c3-ed86-4b66-9d03-26495f20e05e
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: MST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b0186f3-6109-4e9c-b51b-eafb23575484
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VAT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c8418e3-3f3c-4618-b21a-35c6e6abe52b
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: METER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a414297d-c1ca-4d8b-bd13-1a9486229d96
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_MULTIPLIER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a4aa214-e119-4528-97b8-eee40713439f
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7daaef11-8bba-4e6c-a55d-66e0ed7d102d
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: POWER_FACTOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc0f212a-db80-4c80-ad43-1c715e61ec93
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_DEMAND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99866ff7-bc5b-408a-b10e-5ec732885e77
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e99a512-7873-4372-a6ca-0192a1e18793
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CC_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2896436-f819-4c06-a9c0-ed680ae7c948
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_YEARMONTH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d04934c4-2458-4f5c-9814-39982b57d0bd
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efba8368-d21b-4118-84ee-7009095deccc
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FOREMAN
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 713da6d9-c9c1-46c9-badc-01d72476309a
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e4d313d-6d1e-4a02-b57c-a8782ce7dfc1
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BATTERY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93337837-9ef2-4162-b37a-53dc9836ddf8
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a73f489c-8b5c-471f-8d8a-361c7e2aa97b
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: WELL_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e17da63d-a92f-4324-ab70-c3ca05cdbb1f
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RUN_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf921c52-c9d8-4b07-b2d3-633166c904a4
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LOCATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a01b2203-05d2-4323-8a4b-426eca8f41f2
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LATITUDE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dee2beb5-44da-4a29-83b7-45e5ecfc5d25
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SURFACE_LONGITUDE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc7de4de-f362-4022-bb0f-3bc7f9db60a9
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OPERATING_HOURS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e8f334f-4349-4885-8347-007e96ec7510
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DOWNTIME_HOURS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51a7f79b-476c-44d5-945d-eea17a016db0
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL_M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32ccfd54-b154-42e0-945a-1594d921a9b6
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WATER_M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2dac171f-1460-48ec-90fe-b12b9cde10c9
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS_E3M3
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 17b36873-cddb-4196-832a-16bb4d1a239b
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL_BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bde35729-496f-4595-8ffa-ce72e5b88712
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS_BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3163fa52-4e37-4c95-bbd8-10977a1e1443
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BOE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 987583d5-f5f9-4c05-abc3-a9f521747645
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66b9033c-a45b-40d4-b98d-f0e073561a4d
                stepCounter: c4369233-8f92-429e-a1a2-81ddcb17438e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 89ed0c37-8ffb-4a93-8142-4b1f81acda18
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WORKING_INTEREST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfd9ccd3-1536-4be7-bb5f-358d4b558639
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PUMP_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8ec6035-5dd8-4f83-81b1-b6c4fed5ee50
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: SOURCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0cfc0f0-c6da-45ff-a1be-52e305e5c233
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a6f24f1-2e60-4e4c-8605-5c18e692aea3
          stepCounter: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: NORM_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH: a4f59e09-d837-4a23-afaf-ae8ee1c36250
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH') }} AS WITH MJ AS (
                    SELECT *
                      FROM (
                            SELECT DISTINCT("UNIT_NAME") AS WELL_NAME ,
                                   Try_Cast("CHILD_ACCOUNT" AS float) AS CHILD_ACCOUNT_NUMBER ---pls keep this as float!!----
            ,
                                   Try_Cast("METER_NUMBER" AS float) AS METER_NUMBER ,
                                   "COST_CENTER" AS CC_NUM ,
                                   '' AS CC_NAME ,
                                   "AREA" AS AREA ,
                                   "CORE_AREA" AS CORE_AREA ,
                                   Province ,
                                   Facility ,
                                   Foreman ,
                                   '' AS RUN_NAME ,
                                   '' AS Battery ,
                                   TYPE AS TYPE ,
                                   'Non PV' AS SOURCE
                              FROM DS_POWER.NONPV_ENTITIES NPV
                             WHERE "CHILD_ACCOUNT" IS NOT NULL
                               AND Country='CANADA'
                         UNION ALL SELECT DISTINCT(WELL_NAME),
                                   CHILD_ACCOUNT_NUMBER AS CHILD_ACCOUNT_NUMBER,
                                   METER_NUMBER AS METER_NUMBER ,
                                   CC_NUM,
                                   CC_NAME,
                                   AREA,
                                   CORE_AREA,
                                   PROVINCE,
                                   FACILITY,
                                   FOREMAN,
                                   RUN_NAME,
                                   BATTERY,
                                   WELL_TYPE AS TYPE,
                                   'ProdView' AS SOURCE
                              FROM ML_POWER.VW_FDC_PWRANALYTICS PV
                             WHERE CHILD_ACCOUNT_NUMBER IS NOT NULL
                               AND PROVINCE IN ('ALBERTA', 'SASKATCHEWAN','MANITOBA')
                               AND WELL_NAME not like '%Battery%'
                           ) MJ3
                     CROSS JOIN DS_POWER.VET_DIMDATE M
                     WHERE Year(Date) > 2016
                       AND Year(Date) <= Year(GetDate())
                   ) ,
                   PV_AGG_A AS (
                    SELECT MJ.CHILD_ACCOUNT_NUMBER,
                           Max(PV.Facility) AS Facility ,
                           MJ.Date,
                           Sum(IFNULL(PV.WATER_M3,'0')) AS WATER_M3 ,
                           Sum(IFNULL(PV.OIL_M3,'0')) AS OIL_M3,
                           Sum(IFNULL(PV.GAS_E3M3,'0')) AS GAS_E3M3 ,
                           Sum(IFNULL(PV.BOE,'0')) AS BOE,
                           count(*) AS Well_Count ,
                           1.00/Count(*) AS "WellCount Proration",
                           (DATEFROMPARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM,
                           Max(MJ.Source) AS SOURCE
                      FROM MJ
                      LEFT OUTER JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON MJ.Well_Name = PV.WELL_NAME
                       AND MJ.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY MJ.CHILD_ACCOUNT_NUMBER,
                              MJ.Date
                   ) ,
                   T AS (
                    SELECT *,
                           (DATEFROMPARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM
                      FROM MJ
                     WHERE SOURCE='Non PV'
                       AND Facility IS NOT NULL
                       AND (TYPE='PVFAC' OR TYPE='FAC')
                   ) ,
                   T1 AS (
                    SELECT max(T.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER ,
                           T.Date,
                           count(*) AS Well_Count ,
                           1.00/Count(*) AS "WellCount Proration"
                      FROM T
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON T.Facility = PV.FACILITY
                       AND T.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY T.Facility,
                              T.Date
                   ) ,
                   PV_AGG_NONPV AS (
                    SELECT MAX (T.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER ,
                           Max(IFNULL(PV.Facility,T.Facility))AS FACILITY ,
                           max(T.Date) AS Date ,
                           Sum(IFNULL(PV.WATER_M3,'0')) AS WATER_M3 ,
                           Sum(IFNULL(PV.OIL_M3,'0')) AS OIL_M3 ,
                           Sum(IFNULL(PV.GAS_E3M3,'0')) AS GAS_E3M3 ,
                           Sum(IFNULL(PV.BOE,'0')) AS BOE ,
                           Max(T1.Well_Count)AS Well_Count ,
                           Max(T1."WellCount Proration") AS "WellCount Proration" ,
                           Max(FOM) AS FOM,
                           Max(T.Source) AS SOURCE
                      FROM T
                      LEFT JOIN T1
                        ON T1.CHILD_ACCOUNT_NUMBER = T.CHILD_ACCOUNT_NUMBER
                       AND T1.Date = T.Date
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV
                        ON T.Facility = PV.FACILITY
                       AND T.Date = LAST_DAY(TO_DATE(CAST(PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                     GROUP BY PV.Facility,
                              Prod_YEARMONTH
                   ) ,
                   AGG AS (
                    SELECT *
                      FROM PV_AGG_A
                 UNION ALL SELECT *
                      FROM PV_AGG_NONPV
                   ) ,
                   AGG_Final AS (
                    SELECT CHILD_ACCOUNT_NUMBER,Date,Max(Facility) AS Facility,
                           Sum(WATER_M3)AS WATER_M3,
                           Sum(OIL_M3)AS OIL_M3,
                           Sum(GAS_E3M3) AS GAS_E3M3,
                           Sum(BOE)AS BOE,
                           Sum(Well_Count) AS Well_Count
                      FROM AGG
                     GROUP BY AGG.CHILD_ACCOUNT_NUMBER,
                              AGG.Date
                   ) ,
                   PV AS (
                    SELECT MJ.WELL_NAME,
                           PV_W.UWI,
                           IFNULL(PV_W.CC_NUM,MJ.CC_NUM) AS CC_NUM ,
                           PV_W.CC_NAME,
                           IFNULL(MJ.Province,PV_W.PROVINCE) AS Province ,
                           IFNULL(MJ."CORE_AREA",PV_W.CORE_AREA) AS CORE_AREA,
                           IFNULL(MJ."AREA",PV_W.AREA) AS Area ,
                           IFNULL(MJ.Foreman,PV_W.FOREMAN) AS FOREMAN,
                           IFNULL(PV_W.RUN_NAME,MJ.RUN_NAME) AS RUN_NAME ,
                           IFNULL(MJ.Facility,PV_W.FACILITY) AS FACILITY,
                           IFNULL(PV_W.BATTERY,MJ.Battery) AS BATTERY ,
                           IFNULL(PV_W.WELL_TYPE,MJ.TYPE) AS WELL_TYPE,
                           PV_W.Surface_Location ,
                           PV_W.SURFACE_LATITUDE,
                           PV_W.SURFACE_LONGITUDE,
                           PV_W.OPERATING_HOURS,
                           PV_W.DOWNTIME_HOURS ,
                           PV_W.ON_PROD_DATE,
                           PV_W.LAST_PROD_DATE,
                           PV_W.PROD_YEAR,
                           PV_W.PROD_MONTH,
                           PV_W.PROD_YEARMONTH ,
                           PV_W.WORKING_INTEREST,
                           PV_W.PUMP_TYPE,
                           TO_VARCHAR(PV_W.METER_NUMBER) AS METER_NUMBER ,
                           TO_VARCHAR(MJ.CHILD_ACCOUNT_NUMBER) AS CHILD_ACCOUNT_NUMBER,
                           MJ.Date AS EoProdMonth ,
                           (DATE_FROM_PARTS(year(MJ.Date), MONTH (MJ.Date), 01)) AS FOM ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.WATER_M3
                                ELSE IFNULL(PV_W.WATER_M3,'0')
                                 END AS WATER_M3 ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.OIL_M3
                                ELSE IFNULL(PV_W.OIL_M3,'0')
                                 END AS OIL_M3 ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.GAS_E3M3
                                ELSE IFNULL(PV_W.GAS_E3M3,'0')
                                 END AS GAS_E3M3 ,
                           IFNULL(PV_W.OIL_BOE,'0') AS OIL_BOE,
                           IFNULL(PV_W.GAS_BOE,'0') AS GAS_BOE ,
                           CASE WHEN MJ.Source = 'Non PV' THEN AGG_Final.BOE
                                ELSE IFNULL(PV_W.BOE,'0')
                                 END AS BOE ,
                           IFNULL(AGG_Final.BOE,'0') AS TotalBOE,
                           AGG_Final.WELL_COUNT AS PV_Well_Count ,
                           MJ.Source ,
                           CASE WHEN AGG_Final.BOE = 0                                           THEN 1.00/AGG_Final.WELL_COUNT
                                WHEN AGG_Final.BOE IS NULL AND 1.00/AGG_Final.WELL_COUNT IS NULL THEN 1.00
                                ELSE (PV_W.WATER_M3+PV_W.OIL_M3)/AGG_Final.BOE
                                 END AS Proration_BOE ,
                           1.00/AGG_Final.WELL_COUNT AS Well_Proration
                      FROM MJ
                      LEFT JOIN ML_POWER.VW_FDC_PWRANALYTICS PV_W
                        ON MJ.Well_Name = PV_W.WELL_NAME
                       AND MJ.Date = LAST_DAY(TO_DATE(CAST(PV_W.PROD_YEARMONTH AS VARCHAR), 'YYYYMM'))
                      LEFT JOIN AGG_Final
                        ON MJ.CHILD_ACCOUNT_NUMBER = AGG_Final.CHILD_ACCOUNT_NUMBER
                       AND MJ.Date = AGG_Final.Date
                   ) ,
                   PV1 AS (
                    SELECT PV.*,
                           CASE WHEN BOE = 0    THEN 0
                                WHEN TotalBOE=0 THEN 0
                                ELSE BOE/TotalBOE
                                 END AS PR_BOE
                      FROM PV
                   ) ,
                   Fin AS (
                    SELECT PB.Country ,
                           CASE WHEN PB.PROVINCE='Manitoba' THEN 'SASKATCHEWAN'
                                ELSE PB.PROVINCE
                                 END AS PROVINCE ,
                           PB.Language,
                           PB.Currency,
                           Utility_Provider,
                           Invoice_Number,
                           Account_Number ,
                           PB.Delivery_Point ,
                           Consumption_Month,
                           IFNULL(PB.Meter_Number,PV1.METER_NUMBER) AS Meter_Number ,
                           try_cast(PB.Cost_Center AS nvarchar(255))AS Cost_Center,
                           PV1.CC_NAME AS CC_NAME ,
                           PV1.CORE_AREA AS CORE_AREA,
                           PV1.Area ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Total_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Total_Consumption_kWh
                                ELSE Total_Consumption_kWh
                                 END AS Total_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Consumption_kWh
                                ELSE Peak_Consumption_kWh
                                 END AS Peak_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Off_Peak_Consumption_kWh
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Off_Peak_Consumption_kWh
                                ELSE Off_Peak_Consumption_kWh
                                 END AS Off_Peak_Consumption_kWh ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Registered_Demand_kVA
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Registered_Demand_kVA
                                ELSE Registered_Demand_kVA
                                 END AS Registered_Demand_kVA ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Billed_Demand_kVA
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Billed_Demand_kVA
                                ELSE Billed_Demand_kVA
                                 END AS Billed_Demand_kVA ,
                           Current_Meter_Read_Date,
                           Current_Meter_Read,
                           Previous_Meter_Read_Date,
                           Previous_Meter_Read ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Total_Amount_Due
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Total_Amount_Due
                                ELSE Total_Amount_Due
                                 END AS Total_Amount_Due ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Subtotal
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Subtotal
                                ELSE Subtotal
                                 END AS Subtotal ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Energy_Cost
                                ELSE Energy_Cost
                                 END AS Energy_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Energy_Cost
                                ELSE Peak_Energy_Cost
                                 END AS Peak_Energy_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Off_Peak_Energy_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Off_Peak_Energy_Cost
                                ELSE Peak_Energy_Cost
                                 END AS Off_Peak_Energy_Cost ,
                           Basic_Cost/PV_Well_Count AS Basic_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Demand_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Demand_Cost
                                ELSE Demand_Cost
                                 END AS Demand_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Reactive_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,0) * Reactive_Cost
                                ELSE Reactive_Cost
                                 END AS Reactive_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Transmission_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Transmission_Cost
                                ELSE Transmission_Cost
                                 END AS Transmission_Cost ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Other_Cost
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Other_Cost
                                ELSE Other_Cost
                                 END AS Other_Cost ,
                           Service_Address ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Carbon_Tax
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Carbon_Tax
                                ELSE Carbon_Tax
                                 END AS Carbon_Tax ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Carbon_Tax_GST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Carbon_Tax_GST
                                ELSE Carbon_Tax_GST
                                 END AS Carbon_Tax_GST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Federal_Tax_GST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Federal_Tax_GST
                                ELSE Federal_Tax_GST
                                 END AS Federal_Tax ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * PST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * PST
                                ELSE PST
                                 END AS PST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * MST
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * MST
                                ELSE MST
                                 END AS MST ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * VAT
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * VAT
                                ELSE VAT
                                 END AS VAT ,
                           Cast(Meter_Type AS varchar) AS Meter_Type ,
                           Bill_Multiplier ,
                           Rate,
                           Power_Factor ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Peak_Demand
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Peak_Demand
                                ELSE Peak_Demand
                                 END AS Peak_Demand,
                           Bill_Days ,
                           PV1.CC_NUM AS CC_NUM,
                           PV1.PROD_YEARMONTH,
                           PV1.Well_Name AS WELL_NAME ,
                           CASE WHEN PV1.FOREMAN IS NULL THEN PV1.FOREMAN
                                ELSE PV1.FOREMAN
                                 END AS FOREMAN ,
                           PV1.RUN_NAME,
                           BATTERY,
                           UWI,
                           WELL_TYPE,
                           PV1.SURFACE_LOCATION,
                           PV1.SURFACE_LATITUDE ,
                           PV1.SURFACE_LONGITUDE,
                           PV1.OPERATING_HOURS,
                           PV1.DOWNTIME_HOURS,
                           PV1.OIL_M3 ,
                           PV1.WATER_M3,
                           PV1.GAS_E3M3,
                           PV1.OIL_BOE,
                           PV1.GAS_BOE,
                           PV1.BOE,
                           PV1.TotalBOE ,
                           PV1.FACILITY,
                           WORKING_INTEREST,
                           PUMP_TYPE,
                           PV1.Source ,
                           CASE WHEN PV1.CORE_AREA = 'QUEENSDALE' AND PV1.AREA IN ('ARCOLA', 'ARLINGTON', 'BROWNING', 'CANTAL', 'CRYSTAL HILLS', 'EDENVALE/WAUCHOPE', 'FLINTON/MOOSE VALLEY', 'HAZELWOOD', 'QUEENSDALE FIELD', 'WINMORE/WORKMAN', 'WORDSWORTH FIELD') THEN 'Woodlands Sold'
                                ELSE ''
                                 END AS SK_Flag ,
                           CASE WHEN PV1.TotalBOE = 0  THEN IFNULL(Well_Proration,'0') * Subtotal
                                WHEN PV1.TotalBOE <> 0 THEN IFNULL(PR_BOE,'0') * Subtotal
                                ELSE Subtotal
                                 END AS Total_Cost ,
                           CASE WHEN BATTERY IS NULL                              THEN 'FAC'
                                WHEN WELL_TYPE LIKE 'Inj%'                        THEN 'FAC'
                                WHEN WELL_TYPE = 'facility'                       THEN 'FAC'
                                WHEN PB.PROVINCE<>'ALBERTA' AND WELL_TYPE IS NULL THEN 'FAC'
                                ELSE 'WELL'
                                 END AS Norm_Type
                      FROM WS_EDW.VIEW_PWRANALYTICS_VET_POWER_MTH_UNION PB
                      LEFT JOIN PV1
                        ON PB.Account_Number=PV1.CHILD_ACCOUNT_NUMBER
                       AND PV1.FOM = (PB.Consumption_Month)
                     WHERE Country = 'Canada'
                   ) SELECT Country,
                   PROVINCE,
                   LANGUAGE,
                   Currency,
                   Utility_Provider,
                   Invoice_Number ,
                   CASE WHEN Account_Number = '510003313101' THEN '510002563490'
                        ELSE Account_Number
                         END AS Account_Number ,
                   Delivery_Point,
                   Consumption_Month,
                   Meter_Number,
                   Cost_Center,
                   CC_NAME,
                   CORE_AREA,
                   Area,
                   Total_Consumption_kWh,
                   Peak_Consumption_kWh,
                   Off_Peak_Consumption_kWh,
                   Registered_Demand_kVA,
                   Billed_Demand_kVA ,
                   Current_Meter_Read_Date,
                   Current_Meter_Read,
                   Previous_Meter_Read_Date,
                   Previous_Meter_Read,
                   Total_Amount_Due,
                   Subtotal,
                   Energy_Cost,
                   Peak_Energy_Cost,
                   Off_Peak_Energy_Cost,
                   Basic_Cost,
                   Demand_Cost ,
                   Reactive_Cost,
                   Transmission_Cost,
                   Other_Cost,
                   Service_Address,
                   Carbon_Tax,
                   Carbon_Tax_GST,
                   Federal_Tax,
                   PST,
                   MST,
                   VAT,
                   Meter_Type,
                   Bill_Multiplier,
                   Rate,
                   (Total_Consumption_kWh / (NULLIF(Registered_Demand_kVA,'0') * NULLIF((Bill_Days * 24),'0'))) AS Power_Factor ,
                   Peak_Demand,
                   Bill_Days,
                   CC_NUM,
                   PROD_YEARMONTH,
                   WELL_NAME,
                   FOREMAN,
                   BATTERY,
                   UWI,
                   WELL_TYPE,
                   RUN_NAME,
                   SURFACE_LOCATION,
                   SURFACE_LATITUDE,
                   SURFACE_LONGITUDE,
                   OPERATING_HOURS,
                   DOWNTIME_HOURS,
                   OIL_M3,
                   WATER_M3,
                   GAS_E3M3,
                   OIL_BOE,
                   GAS_BOE ,
                   BOE,
                   FACILITY,
                   WORKING_INTEREST,
                   PUMP_TYPE,
                   SOURCE,
                   Total_Cost,
                   Norm_Type
              FROM Fin
             WHERE SK_Flag <>'Woodlands Sold'
               AND ACCOUNT_NUMBER NOT IN (
                    SELECT TO_VARCHAR(ACCOUNT_NUMBER)
                      FROM DS_POWER.ACCOUNT_EXCLUSIONS
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PWRANALYTICS_NONPV_ENTITIES
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PWRANALYTICS_NONPV_ENTITIES') }}
        name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
        noLinkRefs: []
  name: VIEW_PWRANALYTICS_CBU_POWERALLOCATION_MTH
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
