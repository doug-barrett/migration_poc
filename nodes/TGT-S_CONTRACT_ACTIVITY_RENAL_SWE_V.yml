fileVersion: 1
id: f15e9d9e-6551-4f24-8c05-6662768d3196
name: S_CONTRACT_ACTIVITY_RENAL_SWE_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2af93037-7c1b-48b2-a693-8d012c9da809
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PROVIDER_FUNDER_SPLIT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'provider'"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9b90228-2337-40ba-ad12-e396c181000d
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: the mapping rule applied for purchase unit allocation
        name: PUC_MAP_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f2a54ca-2f45-4b6b-bcf0-73e1b19d1058
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: RESPONSIBILITY_CENTRE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79b8d2ea-7795-48de-b56e-0fc624437478
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: health_specialty_code
        name: HEALTH_SPECIALTY_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9ca3fcbd-fe3d-4fb8-bfd0-74588c668cea
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: facility_code
        name: FACILITY_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b01587c9-f39f-461d-8512-0acecc1826bc
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: REPORTING_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a95f87f-b694-4c1f-b5ce-498c3cdddda1
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SOURCE_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5270093-fe4a-408d-8565-3ecd50a560a7
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FUNDED_EVENT_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c72dc05-eb60-41c3-ae61-f8d2a8003c07
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 58191aff-216d-40ff-ad7e-d12d16596708
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1feade3-404b-4769-84b8-953e6b9c8412
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_contact_20.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36c78886-acfb-4341-841b-722ce3a093b0
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e124d874-7452-41e6-a47a-b6a2bc5d6503
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: CONTRACT_ADMIT_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f508b3b-e033-4c16-b030-1e2ed2a0e5c2
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADMISSION_TYPE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: deb15c6c-6a01-44c4-8659-651304463793
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IDF_CLASS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87e8b9d6-7bc9-4656-9ffa-3803ce007e32
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9678423b-863e-4bec-b917-f93fc1c0e563
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0aefd157-a60f-44a7-96b8-db64d04cfc66
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b94c028-7535-49a3-8c53-6b17f08531d9
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b3d5299-aebf-4909-94e1-a0065c0f3f2c
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7157d2a8-b0ab-464d-9dd9-d727dd43b337
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1413d554-058e-411e-a24e-b4607ef554d6
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ESTIMATED_PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dabb7e6f-de96-4239-9699-2a462365bcf9
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_AGE_GROUP_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e5dcf75-cc78-441a-8c13-e27d01b670b6
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_PLANNED_CARE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: '0'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72307c03-8005-4f04-a1e2-136559efd892
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79b14f35-c318-4eff-87e3-d4bd62a339ab
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: contact clinician reference no from iPM
        name: CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 852f57bf-b17a-4a33-8cb7-a0e0ae62d10e
          stepCounter: f15e9d9e-6551-4f24-8c05-6662768d3196
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: source_system
        name: SOURCE_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE VIEW dbo.s_contract_activity_renal_SWE_v(provider_funder_split, PUC_map_id, responsibility_centre_code, health_specialty_code, facility_code, reporting_date, source_encounter, funded_event_encounter, event_encounter_type_code, NHI, dim_patient_key, admin_category_reference_no, contract_admit_type, admission_type_code, IDF_class, domicile_code, purchase_unit_code, purchase_unit_volume, estimated_purchase_unit_volume, dim_age_group_key, dim_planned_care_key, DRG_code, clinician_reference_no, source_system) AS SELECT 'provider' [provider_funder_split] ,
                   NULL PUC_map_id ,
                   responsibility_centre_code [responsibility_centre_code] ,
                   'M60' [health_specialty_code] ,
                   1021 [facility_code] ,
                   EOMONTH(contract_month_date) reporting_date ,
                   active_careplan_month_id [source_encounter] ,
                   active_careplan_month_id [funded_event_encounter] ,
                   'REN_MONTH' [event_encounter_type_code] ,
                   s_careplan_contract_volumes.patient_NHI [NHI] ,
                   dim_patient.dim_patient_key [dim_patient_key] ,
                   1000008180 [admin_category_reference_no] /*force to DHB Funded*/ ,
                   'OTHER' [contract_admit_type] ,
                   NULL admission_type_code ,
                   dim_domicile.IDF_class [IDF_class] ,
                   dim_domicile.domicile_code [domicile_code] ,
                   purchase_unit_code [purchase_unit_code] ,
                   1 [purchase_unit_volume] ,
                   0 [estimated_purchase_unit_volume] ,
                   dim_age_group_key [dim_age_group_key] ,
                   0 dim_planned_care_key ,
                   NULL DRG_code ,
                   0 [clinician_reference_no] ,
                   'Ren_SWE_Monthly' [source_system]
              FROM dbo.s_careplan_contract_volumes
             INNER JOIN dim.dim_contract_reporting_date
                ON calendar_date = EOMONTH(contract_month_date)
             INNER JOIN dim.dim_patient
                ON dim_patient.patient_NHI = s_careplan_contract_volumes.patient_NHI
             INNER JOIN dim.dim_age_group
                ON dim_age_group.age_years = floor(datediff(DAY,dim_patient.patient_date_of_birth,EOMONTH(contract_month_date))/365)
             INNER JOIN dim.dim_domicile
                ON s_careplan_contract_volumes.dim_domicile_key =dim_domicile.dim_domicile_key
        dependencies:
          - locationName: TGT
            nodeName: S_CAREPLAN_CONTRACT_VOLUMES_V
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','S_CAREPLAN_CONTRACT_VOLUMES_V') }}
        name: S_CONTRACT_ACTIVITY_RENAL_SWE_V
        noLinkRefs: []
  name: S_CONTRACT_ACTIVITY_RENAL_SWE_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
