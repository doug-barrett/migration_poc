fileVersion: 1
id: 31880730-3200-47a1-9c4b-85139fb5438c
name: S_DIAGNOSIS_PROCEDURES_1
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Stage table for diagnosis & procedures definitions"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60119e10-af24-4efe-a5ef-123808388cee
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Diagnosis_Procedure_Reference_Number
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52236722-6d5f-49c3-b9a8-0b3e9a7b583f
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5285e0da-2746-4aeb-acc2-b16c90e2b169
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Diagnosis_Procedure_Parent_Reference_Number
        name: DIAGNOSIS_PROCEDURE_PARENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5781db68-ee02-4a8b-8a94-d595d1e0157b
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.parnt_refno,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33dce19c-b567-43b3-b353-b46239fa7718
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Diagnosis_Procedure_Code
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce926fd2-6430-4eb3-b6ba-fb347c954088
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f5d888a-e3c0-41dc-83cf-eed480685d23
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Diagnosis_Procedure_Description
        name: DIAGNOSIS_PROCEDURE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b78537e-2603-4547-936d-1413eb60d381
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32b8c4c1-a386-45fd-b896-4d375e817ab4
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Diagnosis_Procedure_Supplementary_Code
        name: DIAGNOSIS_PROCEDURE_SUPPLEMENTARY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f1737da7-a7c3-4537-9daa-94858c943997
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.supl_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bc4a917-ae24-49ae-9cd7-77d7b5d0428c
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Diagnosis_Procedure_Supplementary_Description
        name: DIAGNOSIS_PROCEDURE_SUPPLEMENTARY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ca65ac6-c5a0-406d-a5f5-5c1b7b50276d
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.supl_description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 251cce32-0edf-4ff1-a767-dbd9b28552e6
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: Diagnosis_Procedure_Supplementary_Type_Code
        name: DIAGNOSIS_PROCEDURE_SUPPLEMENTARY_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22ade0ba-e395-47d2-8364-fb7eed71526c
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.supl_ccsxt_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2ef1a91-6c69-4b88-8dd1-a5d42894c059
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Diagnosis_Procedure_Type1_Reference_Number
        name: DIAGNOSIS_PROCEDURE_TYPE1_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee21e0ae-4f85-42f4-9ac2-c5c38e33fd4d
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1aca545b-97dc-4e1e-a271-967fcc0b2b23
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Diagnosis_Procedure_Type1_Code
        name: DIAGNOSIS_PROCEDURE_TYPE1_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values1.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfd683e4-4de1-4e40-b2de-a4c93342f557
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Diagnosis_Procedure_Type1_Description
        name: DIAGNOSIS_PROCEDURE_TYPE1_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values1.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ac9a17b-7b37-4801-85a8-4f7bb04fa78d
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Diagnosis_Procedure_Type2_Code
        name: DIAGNOSIS_PROCEDURE_TYPE2_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc2f5486-2ed2-49c9-81e6-0c2bb9bd27bf
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.ccsxt_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37a38149-d093-491b-aa4a-cf145b6b0e9c
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Diagnosis_Procedure_Type2_Description
        name: DIAGNOSIS_PROCEDURE_TYPE2_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values2.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1581870a-fc29-4ca1-af56-cb791b4f8ece
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: ICD_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf6bf6a4-d11c-4352-a794-4c4eba3f1557
                stepCounter: db5ba25c-e027-48bb-a231-26590189c636
            transform: -- REPLACE(l_reference_ICD_codes.version,'_','.')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34708c9f-8956-4dac-9256-87f800301ae2
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ICD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f411d784-104d-484c-8e66-c376e328008a
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ICD_FULL_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b54a41d-05f0-417b-9d48-58769c0659f9
                stepCounter: db5ba25c-e027-48bb-a231-26590189c636
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97d4f04d-9bd0-48ac-8255-98f6785eaabf
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Diagnosis_Procedure_Validity_Start_Date
        name: DIAGNOSIS_PROCEDURE_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95fec902-bf75-4951-a538-7d078b01c21e
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ff1f500-5b6d-412a-919b-ec3d0d7f060e
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Diagnosis_Procedure_Validity_End_Date
        name: DIAGNOSIS_PROCEDURE_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 76a34cde-ff7a-4ebf-b604-42de969a6592
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.end_dttm,CONVERT(datetime,'20440630'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3bd7f0bb-b2e9-4479-b6be-9773f6ea84b0
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: HIPS_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f74d1cd0-a097-4da2-8325-1b3f3f28ce89
                stepCounter: 7dc187a5-fb13-4837-9524-153348c47931
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a570641-ba61-446e-87ea-37a80800062d
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: KNEES_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9e52ea2-c76d-4b1a-a038-c912280d366a
                stepCounter: 7dc187a5-fb13-4837-9524-153348c47931
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9baf3e6c-8f15-4c76-bbfa-fae4cdb99701
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: BARIATRIC_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6d14b8e-3a6c-48c8-80d4-a5c89c2abeae
                stepCounter: 7dc187a5-fb13-4837-9524-153348c47931
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5c0b187-c9f0-4289-9de9-f5aa32ef4843
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: BARIATRIC_DIAGNOSIS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: feb70ee3-c429-4274-b634-71ccfcf79f26
                stepCounter: 7dc187a5-fb13-4837-9524-153348c47931
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b014a3a7-90b7-4f03-b0da-b924ca5068b9
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PELVIC_EXENTERATION_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 69345ad2-7362-4c7c-ac9c-ebc03a054bc7
                stepCounter: 7dc187a5-fb13-4837-9524-153348c47931
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86179331-9653-4614-ae30-3e4b005945cb
          stepCounter: 31880730-3200-47a1-9c4b-85139fb5438c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_MAPPINGS_IPM_PROCEDURECODES: 7dc187a5-fb13-4837-9524-153348c47931
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_ODPCD_CODES
          - locationName: TGT
            nodeName: L_MAPPINGS_IPM_PROCEDURECODES
        join:
          joinCondition: |-
            FROM ds_pims_odpcd_codes
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_odpcd_codes.cdtyp_refno = ds_pims_reference_values1.rfval_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_odpcd_codes.ccsxt_code = ds_pims_reference_values2.main_code
               AND ds_pims_reference_values2.rfvdm_code = 'CCSXT'
              LEFT OUTER JOIN (
                    SELECT z.aref,
                           z.localcode,
                           z.code,
                           z.description,
                           z.version
                      FROM (
                            SELECT ROW_NUMBER() over(PARTITION BY a.odpcd_refno ORDER BY c.modif_dttm DESC) rn,
                                   a.odpcd_refno aref,
                                   a.code localcode,
                                   c.code,
                                   c.odpcd_refno cref,
                                   c.description,
                                   c.ccsxt_code
                           VERSION
                              FROM dbo.ds_pims_odpcd_codes a
                              JOIN dbo.ds_pims_odpcd_code_links b
                                ON a.odpcd_refno = b.FROM_ODPCD_REFNO
                               AND b.end_dttm IS NULL
                              JOIN dbo.ds_pims_odpcd_codes c
                                ON b.TO_ODPCD_REFNO = c.odpcd_refno
                             WHERE a.ccsxt_code = 'SAHPC'
                               AND c.ccsxt_code IN('I10P12','I10EB','I10P6','I10P8','I10P3')
                               AND a.archv_flag = 'N'
                               AND b.ARCHV_FLAG = 'N'
                               AND c.archv_flag = 'N'
                           ) z
                     WHERE z.rn = 1
                   ) l_reference_ICD_Codes
                ON l_reference_ICD_Codes.localcode = ds_pims_odpcd_codes.code --AND ds_pims_odpcd_codes.ccsxt_code = 'I'+replace(l_reference_icd_codes.[version],'_','P')        LEFT OUTER JOIN {{ ref('TGT','L_MAPPINGS_IPM_PROCEDURECODES') }}  ON ds_pims_odpcd_codes.odpcd_refno = l_mappings_iPM_ProcedureCodes.odpcd_refno
        name: S_DIAGNOSIS_PROCEDURES_1
        noLinkRefs: []
  name: S_DIAGNOSIS_PROCEDURES_1
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
