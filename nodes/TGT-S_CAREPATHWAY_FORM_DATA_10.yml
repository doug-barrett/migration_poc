fileVersion: 1
id: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
name: S_CAREPATHWAY_FORM_DATA_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9b437ef-788c-4a50-bdf9-f16f214a8f24
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: TABLE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 412eec73-7cea-44aa-9fb9-1941a3212207
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6526457-5cd6-43a8-bb92-be4da35cf9e9
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(MAX)
        defaultValue: ""
        description: ""
        name: FORM_ITEM_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              MAX(CASE WHEN ds_column IN ('adminProcessed') THEN varchar_value WHEN ds_column IN ('Specialty') THEN varchar_value WHEN ds_column IN ('schdl_refno') THEN varchar_value WHEN ds_column IN ('spect_refno') THEN varchar_value WHEN ds_column IN ('ClinicCode') THEN varchar_value WHEN ds_column IN ('Clinician') THEN varchar_value WHEN ds_column IN ('eOutcomeDescription') THEN varchar_value WHEN ds_column IN ('Specialty') THEN varchar_value WHEN ds_column IN ('eOutcomeDescription') THEN varchar_value WHEN ds_column IN ('WaitlistPeriod') THEN varchar_value WHEN ds_column IN ('WaitlistLocation') THEN varchar_value WHEN ds_column IN ('cancerflags') THEN varchar_value WHEN ds_column IN ('snomedCode') THEN varchar_value WHEN ds_column IN ('status_TDES0') THEN varchar_value WHEN ds_column IN ('EnteredBy') THEN varchar_value --WHEN ds_column IN ( 'AppDate')  THEN convert(varchar(55),datetime_value,120)
               WHEN ds_column IN ('EnteredOn') THEN convert(varchar(55),datetime_value,120) --WHEN ds_column IN ( 'documentId')  THEN convert(varchar(55),integer_value)
               WHEN ds_column IN('assessment_date') THEN convert(varchar(55),datetime_value,120) WHEN ds_column IN('background_investigations') THEN varchar_max_value WHEN ds_column IN('correct_PPE_worn')THEN varchar_value WHEN ds_column IN('droplet_isolation')THEN varchar_value WHEN ds_column IN('encounter_admission_date') THEN IFNULL(convert(varchar(55),datetime_value,120),varchar_value) WHEN ds_column IN('encounter_DHB')THEN varchar_value WHEN ds_column IN('encounter_discharge_date') THEN IFNULL(convert(varchar(55),datetime_value,120),varchar_value) WHEN ds_column IN('encounter_facility')THEN varchar_value WHEN ds_column IN('encounter_id')THEN varchar_value WHEN ds_column IN('encounter_responsible_clin')THEN varchar_value WHEN ds_column IN('encounter_service')THEN varchar_value WHEN ds_column IN('encounter_type')THEN varchar_value WHEN ds_column IN('episode_end_date')THEN varchar_value WHEN ds_column IN('episode_end_reason')THEN varchar_value WHEN ds_column IN('final_update')THEN varchar_value WHEN ds_column IN('lab_tests_requested')THEN varchar_value WHEN ds_column IN('last_exposure_date') THEN convert(varchar(55),datetime_value,120) WHEN ds_column IN('notes') THEN varchar_max_value WHEN ds_column IN('notified_date')THEN varchar_value WHEN ds_column IN('pathway_id')THEN varchar_value WHEN ds_column IN('patient_DHB')THEN varchar_value WHEN ds_column IN('patient_disposition')THEN varchar_value WHEN ds_column IN('patient_facility')THEN varchar_value WHEN ds_column IN('patient_is_healthcare_worker') THEN varchar_value WHEN ds_column IN('post_test_probability') THEN varchar_value WHEN ds_column IN('pre_test_probability') THEN varchar_max_value WHEN ds_column IN('previous_notes') THEN varchar_max_value WHEN ds_column IN('previous_notes_date') THEN varchar_value WHEN ds_column IN('staff_in_contact') THEN varchar_max_value WHEN ds_column IN('status') THEN varchar_value WHEN ds_column IN('un iqueid') THEN varchar_value WHEN ds_column IN('user_fullname') THEN varchar_value WHEN ds_column IN('user_role') THEN varchar_value ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: faf473bb-78f6-4dbc-973c-4fbbd7da8832
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: FORM_DATA_SEQ
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY nhi,encounter_id,carepathway_id ORDER BY carepathway_id)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81458e17-1def-4991-bbe3-cf394a76c6a8
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: FORM_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN l_datastore_carepathway_FormData.table_id=1 THEN 'COVIDMonitoring'
                          WHEN l_datastore_carepathway_FormData.table_id=2 THEN 'eOutcomeReconciliation'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ecc35bc-95ed-4c13-96fd-8cd2a0f980db
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FORM_ITEM_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2d6cf5a-6a02-47b3-a523-e7e82bfa51f5
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: FORM_ITEM_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f1216f9-f4cb-420a-911e-cf0614a74068
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CAREPATHWAY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a38919a2-d14c-48ad-b72d-a8fbab49e81a
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0749387e-e7e0-4671-ba25-25cdf471207d
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6f159e0c-5d8a-4c5b-85e4-5695680d8aa1
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 021e7b35-bbac-4004-a71f-cd3a90a5d643
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d7d86379-464d-4c1a-88d1-588bbd826bb1
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: |-
              CASE WHEN l_datastore_carepathway_FormData.encounter_id='T' THEN NULL
                          ELSE encounter_id
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ebd41a9-3e90-4ddc-b884-1a42a4344158
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: COLUMN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8d789366-0c93-4d25-a41b-cfdf946624ce
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc083b66-e071-4fc1-8496-2e747bae008a
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PROCESS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf461ef-d925-4eb7-9abd-ba2eb46ecd2d
                stepCounter: 0e7ce5f3-dccc-4257-9632-d3664ef7f8ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 647f4257-cf8c-4e96-af6a-112924ec4190
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DS_COLUMN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 15c10994-f4cf-40cc-8ba3-dfcf6bd0cd57
                stepCounter: 5286b2ab-bc9c-4717-a07b-e67ac79ed738
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03ca1bb9-a131-4245-b849-145fca338445
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DS_DATA_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 125e7811-ccb0-422f-a60c-ab842e43673e
                stepCounter: 5286b2ab-bc9c-4717-a07b-e67ac79ed738
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c4cda59-29dc-4c53-9b43-2b7d1124c371
          stepCounter: dc9c0c33-f91d-4c49-b988-2b2ad1a4bbc9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_DATASTORE_CAREPATHWAY_FORMDATA
        join:
          joinCondition: |-
            FROM l_datastore_carepathway_FormData
              JOIN l_mappings_tMap_CarePathway_Column
                ON l_mappings_tMap_CarePathway_Column.column_id = l_datastore_carepathway_FormData.column_id --and  l_mappings_tMap_CarePathway_Column.table_id = l_datastore_carepathway_FormData.table_id    where 1=1    --and l_mappings_tMap_CarePathway_Column.table_id=2          group by l_datastore_carepathway_FormData.column_id,      ds_column,      varchar_value,l_datastore_carepathway_FormData.nhi,      l_datastore_carepathway_FormData.encounter_id,      l_datastore_carepathway_FormData.datetime_value,      l_datastore_carepathway_FormData.decimal_value,l_datastore_carepathway_FormData.integer_value,      carepathway_id,     l_datastore_carepathway_FormData.table_id,      l_datastore_carepathway_FormData.process_date,      l_mappings_tMap_CarePathway_Column.ds_data_type
        name: S_CAREPATHWAY_FORM_DATA_10
        noLinkRefs: []
  name: S_CAREPATHWAY_FORM_DATA_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
