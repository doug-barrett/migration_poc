fileVersion: 1
id: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
name: S_OUTPATIENT_SLOT_30
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Get the number of patients booked, by visit type (e.g. FSA, FUP etc), in each time slot."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34cdf8fd-4e1b-4823-a11a-1f55a44ae432
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the outpatient session.
        name: OUTPATIENT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f0bc5a5-dc9d-4ca5-87f5-78d1803e84f5
                stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f16f1ebe-968b-4e76-aa72-a1532d8f69db
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the slot within an outpatient session.
        name: OUTPATIENT_SLOT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ec0396d-4c27-44eb-afa4-9a92acf9a769
                stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6c5d171-9476-478e-b439-93b3982b744d
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time of the session slot.
        name: SLOT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5a98d4b1-61c0-4a82-9ed4-8e43aa028acb
                stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f8ed64f-9f4a-45d6-806c-dbdc7f4152d2
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: End date and time of the session slot.
        name: SLOT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c991cb4c-bcb1-4344-9584-19b913ef4ce0
                stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5afe029-0691-4efa-b692-f4e423439aea
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FSA appointments booked in the slot.
        name: BOOKED_FSA_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d1d8cbf-b4ee-4f30-aca9-8af8827fd54c
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'N' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15b39f6b-ff01-48be-b294-673401ef34ae
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FUP appointments booked in the slot.
        name: BOOKED_FUP_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d1d8cbf-b4ee-4f30-aca9-8af8827fd54c
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'O' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d71ee9a-737c-41e0-bf60-081fe1ce6a56
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of Inpatient appointments booked in the slot.
        name: BOOKED_INPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d1d8cbf-b4ee-4f30-aca9-8af8827fd54c
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'INPAT' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 553dbd3b-b80f-447b-989d-747ca33ab15e
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of PAC appointments booked in the slot.
        name: BOOKED_PAC_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d1d8cbf-b4ee-4f30-aca9-8af8827fd54c
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'PAC' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb7db0ed-f78e-41d9-b9b5-f7ba2a9d2087
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of SOSFU appointments booked in the slot.
        name: BOOKED_SOSFU_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d1d8cbf-b4ee-4f30-aca9-8af8827fd54c
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'SOSFU' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5fdf74b-2427-4f84-8b36-2b6fe69811da
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments booked in the slot that are not FSA, FUP, Inpatient, PAC or SOSFU.
        name: BOOKED_OTHER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code NOT IN ('N','O','INPAT','PAC','SOSFU') THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54f74654-e3cf-4e16-b2b6-52655006521b
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0455e557-e935-485a-a5bb-d848ee249cfd
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: MAX(ds_shared_schedule.patient_reference_no)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aafdd5ce-9a96-480b-84ff-88d945937078
          stepCounter: 0184e95e-3fbc-47aa-b551-1fec036f6ed7
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_OUTPATIENT_SLOT_20
        join:
          joinCondition: |-
            FROM s_outpatient_slot_20
              JOIN ds_shared_schedule
                ON ds_shared_schedule.service_point_session_reference_no = s_outpatient_slot_20.outpatient_session_reference_no
               AND ds_shared_schedule.start_date <= s_outpatient_slot_20.slot_start_date
               AND ds_shared_schedule.end_date >= s_outpatient_slot_20.slot_end_date
               AND ds_shared_schedule.cancellation_reason_date IS NULL
               AND ds_shared_schedule.schedule_status_code IN ('BOOKD','PLAND')
               AND ds_shared_schedule.schedule_type_code = 'OTPAT'
               AND ds_shared_schedule.attendance_status_code NOT IN ('CANCL','0')
              JOIN ds_pims_reference_values
                ON ds_shared_schedule.visit_type_reference_no = ds_pims_reference_values.rfval_refno
             GROUP BY s_outpatient_slot_20.outpatient_session_reference_no,
                      s_outpatient_slot_20.outpatient_slot_reference_no,
                      s_outpatient_slot_20.slot_start_date,
                      s_outpatient_slot_20.slot_end_date
        name: S_OUTPATIENT_SLOT_30
        noLinkRefs: []
  name: S_OUTPATIENT_SLOT_30
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
