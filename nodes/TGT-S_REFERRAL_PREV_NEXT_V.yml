fileVersion: 1
id: c62cac46-e64f-4cc6-9811-15cc9cb786fd
name: S_REFERRAL_PREV_NEXT_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0413278b-4c20-469e-8f2c-7f38342cb10c
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01568488-c9c7-4129-991f-c4b5dc886de6
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9f9c4f3-8f3d-47f5-ae8c-752ba0e3cf40
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed233439-23d1-4dbd-9a67-b10969fabf62
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3687f55e-e48b-4713-b65b-be8756b3a889
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: REFERRAL_RECEIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3cc8d360-c57c-41f4-9119-af0a40c41d34
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a90c516-36c6-4023-9698-75490abd3397
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_BY_HEALTH_ORG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dfa62f0d-96c4-45ab-8fb0-371424f3f636
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de49c1a9-7253-4469-a285-16ad05868a03
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01568488-c9c7-4129-991f-c4b5dc886de6
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b01778bc-7a9f-46cf-b2fd-f2596f7055d9
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_BY_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09560968-7cca-4e64-9550-200449bfa54f
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b13a15d-2889-4111-84a0-3bbe4abace51
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_BY_CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19f18be2-f1ef-4e6d-bc77-f8e6d49aaa81
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e4e74db-fecc-4e03-9c2a-f49f93cad12d
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_TO_HEALTH_ORG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e04d1ee9-3f41-483e-b780-3540550804bf
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9bbb1df9-dbd8-4ef1-9854-fc4a7826a352
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_TO_WARD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4bf4b031-917e-436d-a2cd-efe0211330b7
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3d7a851-c06d-46cc-bba4-02b641dc2380
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_TO_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295ae3d6-ddda-4729-ac1b-c39a15307255
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 198db7a4-b8d0-46a8-a9ad-e4577a88b34f
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRED_TO_CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8e4cc9a-ead8-449f-9465-920b9265a04e
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 280b9049-9a39-49af-aab4-ec83fcecfd29
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01568488-c9c7-4129-991f-c4b5dc886de6
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e467675c-3e3d-49a7-b303-c5b4c984b763
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_BY_HEALTH_ORG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dfa62f0d-96c4-45ab-8fb0-371424f3f636
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 368d2d58-5494-4b27-97af-d44cf64da9e9
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_BY_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09560968-7cca-4e64-9550-200449bfa54f
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5dc9a71-1213-4f5e-9d9e-e9c95f307248
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_BY_CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19f18be2-f1ef-4e6d-bc77-f8e6d49aaa81
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b40cd43e-27ef-4ee0-9834-c87986ae7b12
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_TO_HEALTH_ORG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e04d1ee9-3f41-483e-b780-3540550804bf
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 17e5f7d8-b6e7-46c3-8d21-83f7701792a8
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_TO_WARD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4bf4b031-917e-436d-a2cd-efe0211330b7
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 508ef3f4-3be0-4e8b-822a-4faa57bd59ac
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_TO_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295ae3d6-ddda-4729-ac1b-c39a15307255
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88e7f9b7-a80b-4d62-a4b4-99e124d10b69
          stepCounter: c62cac46-e64f-4cc6-9811-15cc9cb786fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRED_TO_CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8e4cc9a-ead8-449f-9465-920b9265a04e
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT curr.refrl_refno referral_reference_no ,
                   curr.patnt_refno patient_reference_no ,
                   curr.recvd_date referral_received_date ,
                   prev.refrl_refno prev_referral_reference_no ,
                   prev.refby_heorg_refno prev_referred_by_health_org ,
                   prev.refby_spect_refno prev_referred_by_specialty ,
                   prev.refby_proca_refno prev_referred_by_clinician ,
                   prev.refto_heorg_refno prev_referred_to_health_org ,
                   prev.refto_ward_spont_refno prev_referred_to_service_point ,
                   prev.refto_spect_refno prev_referred_to_specialty ,
                   prev.refto_proca_refno prev_referred_to_clinician ,
                   next.refrl_refno next_referral_reference_no ,
                   next.refby_heorg_refno next_referred_by_health_org ,
                   next.refby_spect_refno next_referred_by_specialty ,
                   next.refby_proca_refno next_referred_by_clinician ,
                   next.refto_heorg_refno next_referred_to_health_org ,
                   next.refto_ward_spont_refno next_referred_to_service_point ,
                   next.refto_spect_refno next_referred_to_specialty ,
                   next.refto_proca_refno next_referred_to_clinician
              FROM ds_shared_referral curr
              LEFT OUTER JOIN ds_shared_referral prev
                ON curr.patnt_refno = prev.patnt_refno
               AND curr.patient_referral_seq_num = prev.patient_referral_seq_num - 1
              LEFT OUTER JOIN ds_shared_referral NEXT
                ON curr.patnt_refno = next.patnt_refno
               AND curr.patient_referral_seq_num = next.patient_referral_seq_num + 1;
        dependencies:
          - locationName: TGT
            nodeName: DS_SHARED_REFERRAL
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_SHARED_REFERRAL') }}
        name: S_REFERRAL_PREV_NEXT_V
        noLinkRefs: []
  name: S_REFERRAL_PREV_NEXT_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
