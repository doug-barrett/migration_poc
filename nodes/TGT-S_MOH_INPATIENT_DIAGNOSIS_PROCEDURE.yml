fileVersion: 1
id: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
name: S_MOH_INPATIENT_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3266f8df-5016-44c2-a991-d33852493c84
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BATCH_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa289f50-3792-42fc-bb08-e145ce4babd4
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c7fbfb2-6380-4770-a080-d9270f467093
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f74e3408-df21-43ce-b354-09dc4c71fd01
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2aebb0b-8b21-466c-aa7b-ec4186925323
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_CODE_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b7fa7bf-a801-488d-9855-ad0cd518f2fb
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25655513-f544-4d08-992e-acef5c4ec7a1
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_CODE_SYSTEM_SEQ_REVERSE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b7e67f42-4523-4297-a0ae-3e3f4a2a0bb5
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_CODE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e15beb35-bbd6-4b45-ad64-6e151f8d4488
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc77f158-d06a-4ab3-a1b6-6095f08a9318
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONDITION_ONSET_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1522c05-f9b2-4aa3-9a58-6c549a14e336
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bc442c1-01be-405b-946d-4ee5c49f171a
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(150)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 275b0633-7b6c-427d-b7ef-a780bbc65442
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8448597b-a57e-46dd-9bf8-acf11295d56d
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 69b2e625-20aa-4c1f-893c-fb9cedfa926c
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9ea3645-e3ee-4962-b973-d4ce1ed7ec60
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_SEQUENCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 21dd0fd2-6b6e-4722-a029-e7b6157dc4a0
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7237e596-a0df-4e7a-b661-063404a593fb
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ad0ffe4-9755-48af-aeff-99112498a617
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffb5f424-629a-47e9-81dc-c3868fdfb641
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_TYPE_SEQUENCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6e37d348-1da0-428f-b98a-f1107abc83f8
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1dfb69b0-7a03-4d4d-bedf-72899c870e87
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_MOH_inpatient_diagnosis_procedure.CONDITION_ONSET_CODE=dim_MOH_condition_onset_code.CONDITION_ONSET_CODE
        name: DIM_MOH_CONDITION_ONSET_CODE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a53c981-8d3f-4b21-9111-f434040d2129
                stepCounter: 031ced3e-df50-4c78-993b-dfd2e0609063
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e65a875-d59d-4434-b11d-c4478f262bd8
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_MOH_inpatient_diagnosis_procedure.DIAGNOSIS_TYPE=dim_MOH_diagnosis_type.DIAGNOSIS_TYPE
        name: DIM_MOH_DIAGNOSIS_TYPE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0625aeeb-38fd-43bd-804c-f7dcf453000b
                stepCounter: 8e14125f-819d-4b78-9fe0-c64ff5dd6c05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc2144db-470e-49cf-a234-00cfa83e63f9
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_MOH_inpatient_diagnosis_procedure.CLINICAL_CODE_SYSTEM=dim_MOH_submitted_coding_system.CLINICAL_CODE_SYSTEM
        name: DIM_MOH_SUBMITTED_CODING_SYSTEM_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51b150c6-2987-414c-b25f-96b920b0b35e
                stepCounter: ae197d1c-2564-4805-9663-f35a7b64d698
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 43f84749-fe10-482c-9c24-18268c337161
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: DIM_EVENT_END_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f875debc-4d4f-43e1-99d6-62340ef6b379
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(bigint,DIM_EVENT_END_DATE_KEY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a6ba135-2997-45a0-91c8-0e78a6a6a67d
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: DIM_EVENT_START_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9321ecd5-cca1-4b2d-b5b6-6fb822ad564c
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(bigint,DIM_EVENT_START_DATE_KEY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9865a9be-c5e4-4350-b4e9-fa9fc5653f55
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: DIM_PROCEDURE_ACC_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9cb9fd5-ce3e-41e5-b4fd-b0d374f9884a
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(bigint,DIM_PROCEDURE_ACC_DATE_KEY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc94f2de-2b9f-4229-9fc5-af4c1503e311
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DSS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8a2076c7-bd4b-4bf4-ae76-2b8533290c47
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(integer,ds_MOH_diagnosis_procedure_all.DSS_COUNT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f67e015a-9d90-44bb-9fdc-490786c8ada0
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: EVENT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98189c5f-7e6c-4aca-a4ff-daafdcd6b19c
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert (datetime2,ds_MOH_diagnosis_procedure_all.EVENT_END_DATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2bb1d84-5da4-4cce-9456-b6fec93e11f9
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EVENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bbfb529f-866f-45cb-9505-c0bf3a293b53
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5464d76b-6110-48b8-8f68-678491315584
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: EVENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 467c86ed-1f84-49a0-85a5-a6704e95a3e5
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(datetime2,ds_MOH_diagnosis_procedure_all.EVENT_START_DATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 103971e2-c656-4858-8018-2c23573a1b6c
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PRIVATE_HOSPITAL_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8c47be10-136a-4ff6-8acf-f7d8632b0341
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 656a41cb-7637-4e3d-9f63-e93f92dfb1ee
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: PROCEDURE_ACC_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0a07bc4e-d3be-4da1-a8cd-c4241d4cbaf7
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: try_convert(datetime2,ds_MOH_diagnosis_procedure_all.PROCEDURE_ACC_DATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8dc7ec26-f0fc-4ec5-b526-2fed7633ca9d
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PROCEDURE_ACC_DATE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: efe7f609-2535-485a-9229-3c68df3f208c
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd0682da-fb79-4d83-a43b-486026b3ea49
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SUBMITTED_SYSTEM_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19ea0e05-ccde-45f6-baff-acc1b6cf799c
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c69e4836-6218-4480-aa11-b3a203232f06
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: SUBMITTED_CLINICAL_CODE_SYSTEM_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN dim_MOH_submitted_coding_system.CLINICAL_CODE_SYSTEM = ds_MOH_diagnosis_procedure_all.CLINICAL_CODE_SYSTEM THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35c1e5cd-88c3-4583-ad02-41b0a8676d96
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSACTION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0e044ec4-e71c-4981-ae7d-5da26d79a13b
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14f75c4e-3870-46e5-b514-3e2a948d383c
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebe30b2f-44e6-4272-b600-98f9b1750ded
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1b8b331-851d-4b0a-aa66-91d4a7fd55bb
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 449dabe3-68a3-4b10-80b4-cb01d711b301
                stepCounter: c44a4080-c44b-48a8-920f-79272b3b9420
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba4f0088-b4db-45a5-ba3b-85444c22cf0a
          stepCounter: 2dd3fb6d-3c2a-4055-8f59-28c16764c4f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_MOH_DIAGNOSIS_PROCEDURE_ALL: c44a4080-c44b-48a8-920f-79272b3b9420
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_MOH_DIAGNOSIS_PROCEDURE_ALL
        join:
          joinCondition: |-
            FROM {{ ref('TGT','DS_MOH_DIAGNOSIS_PROCEDURE_ALL') }} ds_MOH_diagnosis_procedure_all
              LEFT OUTER JOIN (
                    SELECT t.clinical_code_system,
                           Row_number() OVER (ORDER BY clinical_code_system DESC) clinical_code_system_seq_reverse_no
                      FROM (
                            SELECT DISTINCT clinical_code_system
                              FROM [s_moh_inpatient_diagnosis_procedure]
                           ) t
                   ) g
                ON g.clinical_code_system = ds_MOH_diagnosis_procedure_all.clinical_code_system
             WHERE ds_MOH_diagnosis_procedure_all.dss_load_date >= convert(datetime2,@v_pa_main_incremental)
        name: S_MOH_INPATIENT_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_MOH_INPATIENT_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
