fileVersion: 1
id: bc5b0478-cd00-41fa-9693-f0726b8767fd
name: S_CAREPLAN_COMMUNITY_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b2ca720-fe9a-4749-8fe3-7aad934737a0
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 883a9f45-bde3-4da0-b152-355babc96627
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: PURCHASER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 137570e4-f99a-4a04-a652-170ea2ad2fcb
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0168d16-87c6-485f-ba39-b69a00064655
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: '  '
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b91ef87-beb6-45b7-8ae3-d8d41ee24fae
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0941606-c9b6-49f2-b292-6b65ee7d7751
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 655896fa-da0c-434c-ab4c-ecade80644b2
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16991d8f-e34e-4125-9391-9a476bbca229
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7070a59-931d-40a5-99aa-bd96f66b402c
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0e98f0c-5498-43ea-af4e-80d6a3392132
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff4cb6f6-5304-46e6-a3f0-f048febcc7c9
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8df9dfe2-4398-4b95-a6b7-9dab99598097
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: SEEN_BY_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 201256a9-b26d-4016-8675-9e9035228ea3
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b209dd61-d99a-45b5-90e6-1369a4c6e299
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_FIRST_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6dbfa34-4f2b-45e0-ace5-6fb47a23f0db
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a130833a-62bc-4230-a883-cebe873c5d04
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9d586530-cdc0-4822-a3f6-b938307a2829
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PHASE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fad037cd-42d5-41e2-8a97-c8f6427d938d
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PHASE_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9081dcc-71d2-4d90-9316-9a7410044de0
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCHARGE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6294edbd-2971-40a2-b58f-ea3daf61abd1
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REVIEW_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a236c0b-4201-422a-b0cc-4d19865c8197
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLIENT_STATED_GOAL_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 794a36fa-c7ee-4fc7-9818-61e65ffc1264
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLIENT_CATEGORY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f61b323-e69b-427e-8207-df054de9e00b
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PRESENTING_ISSUE_CATEGORY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4384e8b-6f06-47c1-b863-8b7be5451b56
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PRESENTING_ISSUE_CATEGORY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc4bf488-c591-41c9-9059-35501c1024c1
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23734f75-76a4-41c7-9d02-9f500491a77b
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: USUAL_LOCATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42d3eece-c8a3-4807-997f-c632f5038a16
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PHASE_OBJECTIVE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d426f4a4-a922-4201-840b-766966b35056
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PHASE_OUTCOME_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 20e7e8ea-664a-415e-8aa6-ee07f9365c2c
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_RISK_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7770bfd-db38-4c41-a174-fe2682124f49
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CASE_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38631d60-b9db-4324-8528-43fb3097fdfd
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CASE_COMPLEXITY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e54aa508-041f-42b7-82a2-647c6fdbfece
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CARE_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b842b802-2ed9-4b5e-802f-65d609ebc56f
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CARE_PHASE_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4777c284-7615-49c6-a055-936ad1da22eb
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLOSE_PHASE_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32440c23-af64-46d9-ac54-17763c92813e
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLOSURE_REASON_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 054739e8-e15c-4388-ad9c-3619f0ad3eb3
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: INTENSITY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94b00dd7-938c-4415-a1dc-85a52b488902
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19e98f27-6915-4429-b1f5-a45e28b0a819
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FUNDER_CONTRACT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2227bb0-5cc3-4b88-b458-3744fac34401
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f9865798-2899-4b17-af73-397f8bcf20ff
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff706938-fe9c-472d-9a41-66778275fa39
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c807269-cec7-490c-ab81-46563ff77418
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2c0bddf-41ae-4fea-991b-f491bf78ec37
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8542e680-c13f-46b4-b432-6fc5fa8bd001
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c41a872-2a00-44f6-a472-c1301c28e59e
          stepCounter: bc5b0478-cd00-41fa-9693-f0726b8767fd
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ACTUAL_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 30986d67-3fb1-431c-84d3-50c64f5a4b73
                stepCounter: 58ab27c2-671f-4e40-9223-82bce81cb2c0
            transform: MAX(s_observation_report.date_completed_detail)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT ds_cdsswe_task_request.taskrequest_id,
                   '35' purchaser,
                   'CDS'+SUBSTRING(CONVERT(varchar,10000000000+ds_cdsswe_task_request.taskrequest_id),2,10) contact_encounter_id,
                   ds_cdsswe_patient_programme.patient_programme_id programme_id,
                   l_cdsswe_patient.nhi_number,
                   MAX(CASE WHEN LEFT (ds_cdsswe_task_request.stream_id,1) = '1' THEN 'R' + ds_cdsswe_task_request.stream_id ELSE ds_cdsswe_task_request.stream_id END) referral_encounter_id,
                   LEFT(MAX(l_cdsswe_programme_role.name),50) role_code,
                   LEFT(MAX(l_cdsswe_programme_dept.name),50) department_desc,
                   LEFT(MAX(l_cdsswe_programme_serv.name),50) service_desc,
                   MAX(s_observation_report.provider_nzmc) seen_by_clinician_reference_no,
                   MAX(ds_cdsswe_Task_Request.due_date) task_request_first_due_date,
                   MAX(ds_cdsswe_Task_Request.request_date) task_request_date,
                   MAX(CASE WHEN s_observation_report.datatype_id = 1066260156049 THEN CONVERT(datetime,s_observation_report.value,103) ELSE NULL END) phase_start_date,
                   MAX(CASE WHEN s_observation_report.datatype_id = 1066260171552 THEN CONVERT(datetime,s_observation_report.value,103) ELSE NULL END) phase_end_date,
                   MAX(CASE WHEN s_observation_report.datatype_id = 1066679881980 THEN CONVERT(datetime,s_observation_report.value,103) ELSE NULL END) discharge_date,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066178896207 THEN s_observation_report.value ELSE NULL END),50) review_date,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 4434068136984 THEN IFNULL(s_observation_report.description,s_observation_report.value) ELSE NULL END),50) client_stated_goal_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 5019075990348 THEN s_observation_report.value ELSE NULL END),50) client_category_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1069355313342 THEN SUBSTRING(s_observation_report.value,1,50) ELSE NULL END),50) presenting_issue_category_code,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1069355313342 THEN SUBSTRING(s_observation_report.description,1,50) ELSE NULL END),50) presenting_issue_category_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 5602889878468 THEN s_observation_report.value ELSE NULL END),50) usual_location_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 5646412476328 THEN s_observation_report.value ELSE NULL END),50) phase_objective_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066091244906 THEN s_observation_report.value ELSE NULL END),50) phase_outcome_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 4532923546748 THEN s_observation_report.value ELSE NULL END),50) clinical_risk_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 4840465960312 THEN SUBSTRING(s_observation_report.value,1,50) ELSE NULL END),50) case_type_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 5019082000596 THEN SUBSTRING(s_observation_report.value,1,50) ELSE NULL END),50) case_complexity_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 5638810358328 THEN s_observation_report.value ELSE NULL END),50) care_type_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066087922222 THEN s_observation_report.value ELSE NULL END),50) care_phase_type_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066089908388 THEN s_observation_report.value ELSE NULL END),50) close_phase_type_desc,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066629113165 THEN SUBSTRING(s_observation_report.description,1,50) ELSE NULL END),50) closure_reason_code,
                   LEFT(MAX(CASE WHEN s_observation_report.datatype_id = 1066089603062 THEN s_observation_report.value ELSE NULL END),50) intensity_desc,
                   '' funder_contract_desc,
                   MAX(CASE WHEN s_observation_report.observation_report_status ='A' THEN 'Finalised' WHEN s_observation_report.observation_report_status ='F' THEN 'Completed' WHEN s_observation_report.observation_report_status ='S' THEN 'In Progress' WHEN s_observation_report.observation_report_status ='X' THEN 'Declined' ELSE 'Current' END) observation_report_status,
                   MAX(s_observation_report.created_date) create_date,
                   REPLACE(MAX(s_observation_report.created_by),' null','') create_user_login_name,
                   MAX(s_observation_report.date_completed_detail) actual_date
              FROM ds_cdsswe_Task_Request
             INNER JOIN l_cdsswe_Task_Type
                ON l_cdsswe_task_type.tasktype_id = ds_cdsswe_task_request.tasktype_id
               AND l_cdsswe_task_type.task_type_class = 'Careplan'
             INNER JOIN ds_cdsswe_Patient_Programme
                ON ds_cdsswe_patient_programme.patient_programme_id = ds_cdsswe_Task_Request.patient_programme_id
             INNER JOIN l_cdsswe_patient
                ON l_cdsswe_patient.patient_id = ds_cdsswe_Task_Request.patient_id
             INNER JOIN s_observation_report
                ON s_observation_report.taskrequest_id = ds_cdsswe_task_request.taskrequest_id
              LEFT OUTER JOIN l_cdsswe_programme l_cdsswe_programme_role
                ON l_cdsswe_programme_role.programme_id = ds_cdsswe_patient_programme.programme_id
              LEFT OUTER JOIN l_cdsswe_programme l_cdsswe_programme_dept
                ON l_cdsswe_programme_dept.programme_id = l_cdsswe_programme_role.parent_programme_id
              LEFT OUTER JOIN l_cdsswe_programme l_cdsswe_programme_serv
                ON l_cdsswe_programme_serv.programme_id = l_cdsswe_programme_dept.parent_programme_id
             WHERE ds_cdsswe_Task_Request.record_status = 'A'
             GROUP BY ds_cdsswe_Task_Request.taskrequest_id,
                      'CDS' + CONVERT(varchar,ds_cdsswe_task_request.taskrequest_id),
                      ds_cdsswe_patient_programme.patient_programme_id,
                      l_cdsswe_patient.NHI_number ;
        dependencies:
          - locationName: TGT
            nodeName: DS_CDSSWE_TASK_REQUEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_CDSSWE_TASK_REQUEST') }}
        name: S_CAREPLAN_COMMUNITY_V
        noLinkRefs: []
  name: S_CAREPLAN_COMMUNITY_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
