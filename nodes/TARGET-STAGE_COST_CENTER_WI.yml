fileVersion: 1
id: 1ddff20e-45cf-4b7a-91d2-b801b9dfb995
name: STAGE_COST_CENTER_WI
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a91a4ad-41ed-454d-87c9-eb3e84789d11
          stepCounter: 1ddff20e-45cf-4b7a-91d2-b801b9dfb995
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: CC_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 707bf5b1-c257-4739-aeda-6f5f08612236
                stepCounter: d6e0bfcb-aaab-4573-875d-e65fb8405fbb
            transform: TARGET.CC_NUM
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c810ebb7-0731-443a-9e4c-fbac4af45c59
          stepCounter: 1ddff20e-45cf-4b7a-91d2-b801b9dfb995
        config: {}
        dataType: NUMBER(14,11)
        defaultValue: ""
        description: The Land Percent.
        name: QBYTE_WORKING_INTEREST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ef12d1cb-c3c7-4a63-844f-70b7d315a545
                stepCounter: 57f89623-4caa-4539-8cff-e24d22e9e494
            transform: TARGET.QBYTE_WORKING_INTEREST
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          ODS_QBYTE_OWNERSHIP_AGREEMENT_LINKS: 222b6dde-0f95-40a0-919e-46feceb2c2b3
          ODS_QBYTE_COST_CENTRES: d6e0bfcb-aaab-4573-875d-e65fb8405fbb
          ODS_QBYTE_DOI_DECK_PARTNERS: 57f89623-4caa-4539-8cff-e24d22e9e494
          ODS_QBYTE_BUSINESS_ASSOCIATES: 75ed207d-974e-44d5-b35f-7e2f54e8cb07
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: ODS_QBYTE_COST_CENTRES
          - locationName: TARGET
            nodeName: ODS_QBYTE_OWNERSHIP_AGREEMENT_LINKS
          - locationName: TARGET
            nodeName: ODS_QBYTE_DOI_DECK_PARTNERS
          - locationName: TARGET
            nodeName: ODS_QBYTE_BUSINESS_ASSOCIATES
        join:
          joinCondition: |-
            FROM (
                    SELECT c.cc_num,
                           sum(ddp.la_partner_pct) qbyte_working_interest
                      FROM (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_QBYTE_OWNERSHIP_AGREEMENT_LINKS') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           ) oal,
                           (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_QBYTE_COST_CENTRES') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           ) c,
                           (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_QBYTE_DOI_DECK_PARTNERS') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           ) ddp,
                           (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_QBYTE_BUSINESS_ASSOCIATES') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           ) ba
                     WHERE c.cc_num = oal.cc_num
                       AND c.jib_flag = 'Y'
                       AND oal.agreement_id = ddp.doi_deck_id
                       AND ddp.partner_ba_id = ba.id
                       AND oal.afe_num IS NULL
                       AND oal.major_acct IS NULL
                       AND oal.expiry_date IS NULL
                       AND oal.terminate_flag = 'N'
                       AND nvl(oal.acct_group_code,'x') IN ('x', 'NPLAND')
                       AND ba.ref_org_id IS NOT NULL
                       AND oal.cc_num || oal.effective_date || oal.ownership_link_id IN (
                            SELECT l.cc_num || max(l.effective_date) || max(l.ownership_link_id)
                              FROM (
                                    SELECT *
                                      FROM {{ ref('TARGET','ODS_QBYTE_OWNERSHIP_AGREEMENT_LINKS') }}
                                     WHERE DSS_CURRENT_FLAG = 'Y'
                                       AND DSS_DELETE_FLAG != 'Y'
                                   ) l
                             WHERE l.terminate_flag = 'N'
                               AND l.expiry_date IS NULL
                               AND l.afe_num IS NULL
                               AND l.major_acct IS NULL
                               AND l.effective_date IN (
                                    SELECT max(l2.effective_date)
                                      FROM (
                                            SELECT *
                                              FROM {{ ref('TARGET','ODS_QBYTE_OWNERSHIP_AGREEMENT_LINKS') }}
                                             WHERE DSS_CURRENT_FLAG = 'Y'
                                               AND DSS_DELETE_FLAG != 'Y'
                                           ) l2
                                     WHERE l2.terminate_flag = 'N'
                                       AND l2.expiry_date IS NULL
                                       AND l2.afe_num IS NULL
                                       AND l2.major_acct IS NULL
                                       AND l2.cc_num = l.cc_num
                                   )
                               AND nvl(l.acct_group_code,'x') IN ('x', 'NPLAND')
                             GROUP BY l.cc_num
                           )
                     GROUP BY c.cc_num
                 UNION ALL SELECT c.cc_num,
                           100.00 qbyte_working_interest
                      FROM (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_QBYTE_COST_CENTRES') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           ) c
                     WHERE c.jib_flag = 'N'
                   ) AS TARGET
        name: STAGE_COST_CENTER_WI
        noLinkRefs: []
  name: STAGE_COST_CENTER_WI
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
