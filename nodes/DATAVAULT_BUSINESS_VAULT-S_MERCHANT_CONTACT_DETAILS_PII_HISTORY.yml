fileVersion: 1
id: 696c2422-3756-44ad-b240-a7fa807fd3a2
name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "This entity holds the contact details for a given institution. The entity is effective dated so the contact details can be different for different time periods."
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5b58c7f-ca69-44f4-9400-3a0eec1537dd
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_MERCHANT_CONTACT_DETAILS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a71d0d4-7df6-442e-936e-c8824612c009
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0892ba2f-8037-4dc2-9840-1bf5735841d6
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: contact identificaton number
        isBusinessKey: true
        name: CONTACT_IDENTIFICATION_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebae3d65-e331-4d90-901b-b2c29ac8efac
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30d5c3a3-238c-4912-8552-6ec4f5ab74b5
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        isBusinessKey: true
        name: SEQUENCE_NUMBER_BK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c545cbfe-0705-4ddf-88a3-d4e46d331409
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9331eed1-2db7-4240-9b7a-0f27008ed527
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the forenames of the Contact for the Institution.
        name: CONTACT_NAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e24676b-7c67-4b81-98bf-83e82666f59f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da0e840b-32d5-459b-9b6f-b2a386c8a1b1
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the surname of the Contact for the Institution.
        name: CONTACT_SURNAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a53dca6a-b653-41f4-a7d4-4e9a2c0d835d
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a04814c-f7d5-44a9-a6e5-41376d7afd98
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 70b77f60-bea3-4998-be03-7b2e31e08100
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a7d70d10-f22b-4e52-98a8-649d94722e20
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5e450e7-5cbf-4bd5-ae3f-6080114e1e29
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8f189ec-9724-4d7b-a318-7ee59d0b3a91
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 689bf4f2-2d64-42e4-b342-452f95a198f1
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ba8ddbc-b425-42d4-9f45-d2b86dc23ff3
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Identifies the postal code of the Institution.
        name: ADDRESS_POSTAL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d0e6546-3c41-441a-8c87-96d8480d44bc
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45fea88e-e2ad-410c-88b1-b401c88331d2
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the city in which the Institution is in.
        name: ADDRESS_CITY_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 616ab3dc-344e-4994-b944-7173d3416696
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68e64e0a-e46c-4a28-ab57-0c184f1b8709
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the state in which the Institution is in.
        name: ADDRESS_STATE_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f722cf5-b0ea-403c-af30-f19b6ebf37b2
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9863a72d-1906-4119-b5c7-d3cfaba27c05
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: Identifies the country in which the Institution is in.
        name: ADDRESS_COUNTRY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 716d1ad3-7646-4c86-b367-eed074a5f067
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7dec1bd-a404-4096-9b92-d78de0fff9f9
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Email address by which the Institution can be contacted.
        name: CONTACT_EMAIL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d4e084f-d882-4885-94aa-df80952d5ad9
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea68f75d-b38d-423d-ab6b-9b63c07d3377
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Internet address by which the Institution can be contacted.
        name: CONTACT_INTERNET_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 292c88e8-7630-47e3-a2f2-5efaeb871b1e
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 520828f3-ac82-4fc7-bdbe-2663d414f6a8
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the first phone number by which an Institution can be contacted.
        name: PRINCIPAL_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 96b922c8-8756-4f94-a95e-36b8590ce277
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98017e60-07e2-49b6-a5da-0dbb61e66768
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies an alternative phone number by which the Institution can be contacted.
        name: ALTERNATIVE_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd849366-3424-49ca-b32e-6dc3ee353a60
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4a4ac08-05bb-4a51-85a5-fe18339162d9
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the fax number by which the institution can be contacted.
        name: CONTACT_FAX_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29f1c1b4-f581-4350-a307-9ceb11fde476
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 142fc165-6dd5-425a-829b-fbf84445ed5c
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_AREA_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50c5685a-ee90-4769-be73-dbea3f4601e3
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5541610a-b378-4637-add4-e73492f6b198
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_USER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78f9ea8c-40a0-43ef-9ec1-a48123e419af
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6c01497-5b09-4b81-8b56-69ce55057ac4
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48d371e4-fb60-4d70-9fb8-499a62627f7f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 414adcb0-e0dc-491c-99eb-089c6dd93d1f
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_STATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3838c08d-630f-4d0b-956e-255365cc038f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0c031ee-416e-421b-a68b-36504ec12b09
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Holds the Tax ID or Social Security Number for the contact.
        name: CONTACT_SOCIAL_INSURANCE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1266c521-dc38-4ac9-b75c-d6d72fde8e94
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60bddb02-bede-4853-9609-609ac2c4472d
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 27c28dde-3b2a-42d5-b5be-6247e231ff58
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b633724-28b6-4ce4-a054-660e6569cb1d
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        name: SEQUENCE_NUMBER_PII
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aacc58e9-9689-4979-a730-60b886c060b6
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f297f142-47ff-47dd-8fc9-2097abc5d5d1
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c672be7-48ef-4611-8dca-e2ee94c1dc37
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3ac5ab4-65cb-44c7-80c1-d1bb9fa5cbb6
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: be65e074-83ee-4f48-8951-f11963f90085
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80e3eefe-11cb-4096-b1c5-6324cd865608
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d69ffba8-b7dc-4b31-9e61-d235bb32824d
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 125f2e7e-4866-4c25-a83c-e9b67d43dd83
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0cd71af4-9668-4bff-91f4-f4a1f05663e0
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 287acb76-b5b6-4448-b9a8-c34ff01f9393
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8ff41bee-2a09-4ec9-8b7c-dda2c41f95ce
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a451f050-7c7b-4a92-bd32-97a2d7a4d711
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d90747b-1cf4-4f54-ac99-f14e74c9e854
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4919fe1-aa9f-4508-b41f-4a74dc46e7e3
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: End date determined by the next Satellite change record dss_start_date
        isSystemEndDate: true
        name: DSS_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LEAD(dss_start_date, 1, '9999-12-31') OVER(PARTITION BY hk_h_merchant_contact_details ORDER BY dss_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcc8bd15-d4b0-40c9-9dc9-f0912af46d88
          stepCounter: 696c2422-3756-44ad-b240-a7fa807fd3a2
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: CurrentFlag 'N' unless next Satellite change record dss_start_date is null, indicating this is the most current record.
        isSurrogateKey: true
        isSystemCurrentFlag: true
        name: DSS_CURRENT_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN LEAD(dss_start_date, 1, NULL) OVER(PARTITION BY hk_h_merchant_contact_details ORDER BY dss_start_date) IS NULL THEN 'Y'
                          ELSE 'N'
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_MERCHANT_CONTACT_DETAILS_PII: d511a896-8d61-4b3f-9891-303506eda9cf
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_MERCHANT_CONTACT_DETAILS_PII
        join:
          joinCondition: FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_CONTACT_DETAILS_PII') }} s_merchant_contact_details_pii
        name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
        noLinkRefs: []
  name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
