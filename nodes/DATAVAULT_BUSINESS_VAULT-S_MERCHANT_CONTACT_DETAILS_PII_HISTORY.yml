fileVersion: 1
id: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "This entity holds the contact details for a given institution. The entity is effective dated so the contact details can be different for different time periods."
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ef71bb5-f791-4a6e-8d38-efc53e3a8aa6
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_MERCHANT_CONTACT_DETAILS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd7284aa-ced3-4157-9fb3-7295acf276fe
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a1188ef-7cad-46f9-8812-fbdc847c01f8
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: contact identificaton number
        isBusinessKey: true
        name: CONTACT_IDENTIFICATION_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02528ab9-2541-4a95-889c-32051065355d
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f76cb595-5a5a-4f4b-8c71-706cc4715a97
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        isBusinessKey: true
        name: SEQUENCE_NUMBER_BK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 12cb362e-3b76-400d-9ca4-befcea88dbf2
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a043937-cc69-4626-8bb0-f08c74b09132
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the forenames of the Contact for the Institution.
        name: CONTACT_NAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 70c7dbab-8f8d-49a5-be08-c5c8b9551ba9
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa372fe4-c1d9-4bab-8638-3a6837442ff4
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the surname of the Contact for the Institution.
        name: CONTACT_SURNAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8bb690e-f38c-45a7-8105-230829f0fc66
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b439f11-b8a9-438a-a1d8-136166c3a64c
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9a78946-ace1-45c7-bd15-e58435ea1fb9
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8cda54fc-aef2-45eb-b95d-24fdf3c815a4
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e51f5b8-57e8-4d93-a0b5-495c011d5a1d
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aaacd1f7-a272-4ea8-99af-2d302dc898fe
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95b2787c-e4d4-4d9c-909a-8f97c2e6dee1
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85cc6115-a1b7-413d-9c19-6e17a80ce852
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Identifies the postal code of the Institution.
        name: ADDRESS_POSTAL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5ab65f5-f551-4bbf-a9c7-0fe8733b7147
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9415fd0d-6b61-42b7-8f69-a6711dc0d98d
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the city in which the Institution is in.
        name: ADDRESS_CITY_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c2f3e53-c512-44fc-8d25-c0189bfb6c16
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3680c50c-80ca-4f15-a4bb-7a8331a1e4bf
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the state in which the Institution is in.
        name: ADDRESS_STATE_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e9ce993-f7fb-4911-ba35-63387df88ce0
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b71ce51-cf0a-4435-90c8-34747b91afa3
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: Identifies the country in which the Institution is in.
        name: ADDRESS_COUNTRY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e79521ab-cb2f-4ae8-a188-8089c74a611e
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c55ec9b-9d1c-47ae-9858-781801cbc48f
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Email address by which the Institution can be contacted.
        name: CONTACT_EMAIL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb70ebdf-daf6-4e03-812f-bcfb1e2cf421
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ea2112a-5720-4737-9bc5-72c28157e4b9
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Internet address by which the Institution can be contacted.
        name: CONTACT_INTERNET_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b383714a-e77a-4ee4-98a7-e00430047893
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 388bfed1-2bb0-430f-85d0-df42b4dfbb0c
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the first phone number by which an Institution can be contacted.
        name: PRINCIPAL_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed2fc2e3-fb79-481b-a548-938bbcfcbc2c
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac315115-ebe8-4605-83cb-9f9897bc8f3b
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies an alternative phone number by which the Institution can be contacted.
        name: ALTERNATIVE_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02f94a14-c334-4735-85bc-88534f7594a9
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c84a85d-7653-4509-ae59-66030f3bab4d
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the fax number by which the institution can be contacted.
        name: CONTACT_FAX_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 674c045b-5e03-4957-a0bf-d9836ec4a1e7
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24556c88-e121-4e29-bc65-7266d9794b60
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_AREA_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9da57900-5bca-4adb-ab90-3b12847bdae4
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93ba6393-4265-43f8-bfeb-a09f26e857ba
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_USER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d0f5ec8-e186-4331-a079-53cb89199829
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca20d0b7-0a38-40be-bccb-89cd2bf5439c
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8a3c6e61-5b38-44ec-9f15-4e414e157253
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1f72a9b-e7b5-4eb1-87d3-894c580f38ec
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_STATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87416903-9126-4245-bf97-23ac882cb68f
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d4e4c62-f259-4de1-8657-e5351de3ddc0
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Holds the Tax ID or Social Security Number for the contact.
        name: CONTACT_SOCIAL_INSURANCE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 080ef181-ddf3-4851-a4f7-359e46fbec59
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 499346d9-1724-4527-b24a-6610a5eb501b
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b02d07d2-b158-4fe5-84c3-f0a58348ef36
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39965b84-179b-4b08-a33a-a4bdf72bb28b
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        name: SEQUENCE_NUMBER_PII
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f02420b8-a039-4ed1-b4c8-2666d682eb47
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2eb111f-d6e3-4b45-a953-7733ae831e7c
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8c4b0622-992f-4833-8abd-5aea84e5de4b
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3927a00-dbe3-42cc-878a-c8978912a6e1
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1b56afd7-fdea-4bd0-95b3-3e36ea247478
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e36ef534-ca6f-4d6d-943a-642e62090eb4
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8190ef0-4919-4619-83df-b47dd59c607a
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 304f899e-2803-49db-bc04-928352ab5ac7
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d5f9ed0-0b83-46d6-8ea8-2317a37e33ca
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 183bd6cf-57ab-436e-ab9b-86509600dfd9
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c152a2b8-8a22-4685-ad5e-1fd36e74074f
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6cd5c9e3-d283-4539-9120-feb9fdbace76
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dbf98f4a-b804-4f6f-82e8-882b0e574afe
                stepCounter: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64de065b-05d7-4c7d-8736-08742059abd3
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: End date determined by the next Satellite change record dss_start_date
        isSystemEndDate: true
        name: DSS_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LEAD(dss_start_date, 1, '9999-12-31') OVER(PARTITION BY hk_h_merchant_contact_details ORDER BY dss_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b73fb359-5f01-4e46-af2f-63a9c379846c
          stepCounter: b4aefc72-aa3f-4155-bfc1-460a2458cf4b
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: CurrentFlag 'N' unless next Satellite change record dss_start_date is null, indicating this is the most current record.
        isSurrogateKey: true
        isSystemCurrentFlag: true
        name: DSS_CURRENT_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN LEAD(dss_start_date, 1, NULL) OVER(PARTITION BY hk_h_merchant_contact_details ORDER BY dss_start_date) IS NULL THEN 'Y'
                          ELSE 'N'
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_MERCHANT_CONTACT_DETAILS_PII: 5fe956d8-2852-4bdc-85a1-0af493c3c6d4
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_MERCHANT_CONTACT_DETAILS_PII
        join:
          joinCondition: FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_CONTACT_DETAILS_PII') }} s_merchant_contact_details_pii
        name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
        noLinkRefs: []
  name: S_MERCHANT_CONTACT_DETAILS_PII_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
