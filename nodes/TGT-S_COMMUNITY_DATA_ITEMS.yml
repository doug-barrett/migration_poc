fileVersion: 1
id: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
name: S_COMMUNITY_DATA_ITEMS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb797b48-df5a-4ddd-825a-5914e74605b9
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: DATATYPE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df26d7c0-b3f5-414c-8e8b-82ace707befe
                stepCounter: a0551e43-8b4a-47d3-98bb-4901d2751478
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70fb622c-6cfa-4676-987f-d896d2c1929f
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(200)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02901402-d68f-4aad-8cca-2c4f09ce8053
                stepCounter: a0551e43-8b4a-47d3-98bb-4901d2751478
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0a90f6c-c17b-41cf-9a04-8149d26a3247
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: VALUE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 35afbbea-1f7d-4d17-91fb-d675ace69af2
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74b164f5-2dc3-430a-8a55-4f09d9586cdf
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 580cb369-e976-463e-a67e-89b9955539ad
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: DATE_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: try_convert (datetime,ds_cdsswe_atomic_observation.value,103)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cc6c46c-2f56-44f1-b0d8-fcc46cdfe7e8
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(70)
        defaultValue: ""
        description: ""
        name: TEXT_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc4bf488-c591-41c9-9059-35501c1024c1
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: IFNULL(ds_cdsswe_atomic_observation.value,ds_cdsswe_atomic_observation.Description)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ece83606-a28f-4b09-b1dc-b17f8b0764d8
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2873ec7c-2c60-4c9b-8393-65dd1f9c1075
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e76061b-fd9b-436d-a8f0-be840224115d
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f2e33ef-8ae5-4e28-9dbc-6e3089022f15
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08de1fcd-6bb5-476e-8af9-c2ff2724a506
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: FORM_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2aa316c-f0a1-43d0-a1e8-075c7d5e6307
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e3082db-e3af-4704-a933-a1266b63814c
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINIC_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c29640b8-4cb3-4eab-b64f-c4519a15cc1d
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c656cc70-a394-4b7f-b106-30b6ca816f36
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: TASKREQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a80f80d1-a506-48c3-a1d9-a22b223cb55d
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(300)
        defaultValue: ""
        description: ""
        name: TASKREQUEST_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 799bb7e9-6c7c-49e7-83f2-11d6dca9b972
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3e9c02c-b746-4e38-b969-ed274e72c074
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: TASKTYPE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b815db37-bca6-45b6-b987-92372b9c1d7f
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b21b53e3-2b50-411c-b59f-d9e27ba0b3c4
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ORDERING_PROVIDER_FAMILY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2873fb27-e75c-4a97-882a-c05ea3bee31e
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d535370-d40f-4827-83a7-31a3674c3107
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: ORDERING_PROVIDER_GIVEN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 201bca42-3bea-41c2-afa3-19e9b5dd0121
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd140aaa-9f9a-4de3-9f42-ec5220113c7f
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: ORDERING_PROVIDER_NZMC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3ba23d2-9621-4356-9842-13b519db99b8
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46cef56e-2e60-4d51-8b90-031ad0aa21c0
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PARENT_PATIENT_PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8c35fc6-d9d7-403d-a8cb-af6293bf60c2
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ccb7f1cf-849d-4242-835a-8ca72ebd5cc9
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PATIENT_PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1dc01ac2-a10c-49ca-90eb-ed32df22cd74
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 832a8ab8-ab3d-4b52-bc25-b4e89c6dbfc4
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b91ef87-beb6-45b7-8ae3-d8d41ee24fae
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d67979f2-00d9-4930-8070-8f5c8fa1b067
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ATOMIC_OBSERVATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 039fc9c6-3aea-4530-9639-ddb396f8bbf0
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0eb6feca-7ab0-4e1d-b2d3-4c24473a3bd7
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec8fe297-464d-416f-9bc9-8c9e69b44b69
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9affd23-8cdf-4d35-94e1-1673ca78ac9f
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_community_data_items.datatype_id=dim_community_data_type.data_type_id  s_community_data_items.form_id=dim_community_data_type.form_id
        name: DIM_COMMUNITY_DATA_TYPE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28ac0fd4-fd85-40ad-842a-d23df47164e4
                stepCounter: a2fe2fc2-b5e5-4c50-9cb1-94b18b805fb1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: caa0696d-174d-45ab-8ee0-58adcf5fc0ea
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_community_data_items.programme_id=dim_community_programme.programme_id
        name: DIM_COMMUNITY_PROGRAMME_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1447701e-b431-47bc-9f74-ecc4d7d4fa85
                stepCounter: e51d8b6d-72a3-4062-ab25-a52c4b289aa5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1504b8ca-29e0-4b12-88b2-800fec6d152c
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_community_data_items.tasktype_id=dim_community_task_type.task_type_id
        name: DIM_COMMUNITY_TASK_TYPE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0cc6c52-e7bc-48a1-8b99-012274d955e6
                stepCounter: 98a41686-c1f0-4280-96a6-310e21b626e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b35d7e74-1886-4693-8c9c-376300bad5b4
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_community_data_items.observation_report_status=dim_community_report_status.observation_report_status
        name: DIM_COMMUNITY_REPORT_STATUS_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97a01c03-78ba-4c60-baac-e1ebda8e3e51
                stepCounter: fe9db425-e454-40c8-a154-2c67b372c639
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b23056f2-b4ca-4f18-bb3e-28a9f80adbc8
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16991d8f-e34e-4125-9391-9a476bbca229
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: |-
              CASE WHEN left(ds_cdsswe_patient_programme.stream_id,1) = 'H' THEN ds_cdsswe_patient_programme.stream_id
                          ELSE 'R' + ds_cdsswe_patient_programme.stream_id
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 621921bd-ee9e-4337-8beb-f9c1d89aec0c
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE_COMPLETED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0dbe6fae-c28a-4f65-ac78-f11e4f0a165f
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ffeef02-6b2b-430c-9a9d-c6b41bde6213
          stepCounter: 653a68d3-ebe3-40c8-bb82-a0f40cd3d22b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_MAPPINGS_CDSSWE_DATAITEMS: a0551e43-8b4a-47d3-98bb-4901d2751478
          DS_CDSSWE_ATOMIC_OBSERVATION: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
          DS_CDSSWE_OBSERVATION_REPORT: 118925c3-58c5-4511-b154-1b1a31b2082e
          DS_CDSSWE_TASK_REQUEST: 7b4c3eab-6eaf-440f-890b-2660daed8357
          DS_CDSSWE_PATIENT_PROGRAMME: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
          L_CDSSWE_PATIENT: 289da868-88f5-4e61-a975-de3b30517956
          DIM_PATIENT: d52dd438-7899-4242-9e38-539d2a1447df
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_MAPPINGS_CDSSWE_DATAITEMS
          - locationName: TGT
            nodeName: DS_CDSSWE_ATOMIC_OBSERVATION
          - locationName: TGT
            nodeName: DS_CDSSWE_OBSERVATION_REPORT
          - locationName: TGT
            nodeName: DS_CDSSWE_TASK_REQUEST
          - locationName: TGT
            nodeName: DS_CDSSWE_PATIENT_PROGRAMME
          - locationName: TGT
            nodeName: L_CDSSWE_PATIENT
          - locationName: TGT
            nodeName: DIM_PATIENT
        join:
          joinCondition: |-
            FROM {{ ref('TGT','L_MAPPINGS_CDSSWE_DATAITEMS') }}
              JOIN {{ ref('TGT','DS_CDSSWE_ATOMIC_OBSERVATION') }}
                ON l_mappings_CDSSWE_DataItems.datatype_id = ds_cdsswe_atomic_observation.datatype_id
               AND l_mappings_CDSSWE_DataItems.Build_as_DE_Fact = 1
              JOIN {{ ref('TGT','DS_CDSSWE_OBSERVATION_REPORT') }}
                ON ds_cdsswe_atomic_observation.observation_report_id = ds_cdsswe_observation_report.observation_report_id
              JOIN {{ ref('TGT','DS_CDSSWE_TASK_REQUEST') }}
                ON ds_cdsswe_observation_report.taskrequest_id = ds_cdsswe_task_request.taskrequest_id
              JOIN {{ ref('TGT','DS_CDSSWE_PATIENT_PROGRAMME') }}
                ON ds_cdsswe_task_request.patient_programme_id = ds_cdsswe_patient_programme.patient_programme_id
              JOIN {{ ref('TGT','L_CDSSWE_PATIENT') }}
                ON ds_cdsswe_patient_programme.patient_id = l_cdsswe_patient.patient_id
              LEFT OUTER JOIN {{ ref('TGT','DIM_PATIENT') }}
                ON l_cdsswe_patient.nhi_number = dim_patient.patient_NHI
               AND dim_patient.NHI_sequence = 1
        name: S_COMMUNITY_DATA_ITEMS
        noLinkRefs: []
  name: S_COMMUNITY_DATA_ITEMS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
