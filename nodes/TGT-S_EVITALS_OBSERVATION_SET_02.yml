fileVersion: 1
id: 7ce22382-e113-45ba-aa61-7288091a4d7b
name: S_EVITALS_OBSERVATION_SET_02
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Link each observation set to IP and ED events."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de508e9e-4b62-4fcc-b410-c0c54b46a727
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient NHI number.
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7bd77763-1ace-482a-8fca-2aa24b6229a1
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: facc8ab0-09c2-4b81-8a92-e56b592cc538
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'Internal unique identifier for a patient from the Patient Management System '
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5afc370-1985-444c-8869-4c6ee25d0d27
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8a6ce10-2f41-40dc-8d24-036eb011734b
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Inpatient or ED event associated with the observation set for the patient.
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 008d4082-ab2a-471d-90ae-dead8f8cfa50
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ee243ccb-be47-405e-83f5-c2ca3bc4aabe
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: INT
        defaultValue: ""
        description: Integer ID that uniquely identifies a patient admission in Patientrack. Sourced from admsn_pk.
        name: ADMISSION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4d57a0f8-8b05-4833-843c-53acf0a310ee
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21e4013c-8480-477f-9662-d3110f173b98
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: INT
        defaultValue: ""
        description: Integer ID that uniquely identifies an observation set in Patientrack. Sourced from obset_pk.
        name: OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8b9106e-ffb9-42b3-87c0-d00326b77646
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5617034c-6aa9-4c40-ba05-7b0ec0842dd8
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time when the observation measure started.
        name: OBSERVATION_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ed12009-8632-49c2-be2d-aa9b63c5edf4
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e65da6a3-9ab6-4853-b828-076fa82ebe12
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time when the patient was discharged from the ward.
        name: DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 27dfac36-0a11-4f6c-9426-d2dd35ec719e
                stepCounter: 637621f1-ebc9-4e62-b367-3187a03d45a5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b3b6d34-9997-4f73-9696-ee96c8b23497
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: IP_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d3088d-97f2-4c53-9ebc-ae021c7b49e2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 11025d35-6ee5-4bb4-a4dc-318b73cb1e10
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IP_ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1125cf7f-7027-45ac-acc8-b3a92505c4da
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3ada518-0eb7-4ec3-af63-e4f77fb84e6c
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IP_DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee3a67e8-1a53-44ab-aa64-cafc588de09c
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38ac74b6-8f64-47cd-ac06-e948b53a3b73
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ED_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3490906-6f48-4084-913d-5535ca85a478
                stepCounter: d1b2a933-ea11-4091-ae32-42bf938c7dca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1125414c-c71f-45e2-813d-33d6058a7eaa
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ED_ARRIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1d761e5-2a79-4e24-8644-333c311598eb
                stepCounter: d1b2a933-ea11-4091-ae32-42bf938c7dca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d840faf4-50b2-4774-a04e-57faca25fb64
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ED_DEPARTED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6cfdbc61-95a7-4bf6-b56e-cb882fd0daee
                stepCounter: d1b2a933-ea11-4091-ae32-42bf938c7dca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5fca8c15-49ca-4c1c-ab5c-244e33883c4c
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Look up to Patient Management System to match Inpatient or ED event associated with the observation set for the patient as PatienTrack version becomes unreliable under certain conditions
        name: MATCHED_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d3088d-97f2-4c53-9ebc-ae021c7b49e2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: IFNULL('H' + CAST(ds_pims_provider_spells.prvsp_refno AS varchar), ds_pims_ae_attendances.identifier)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b4d2ec1-7e2f-4c55-a8f9-9dca16ec0b0d
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Numbers rows for each observation set so that a single row can be selected for each set.
        name: ROW_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY observation_set_id ORDER BY IFNULL(disch_date, GETDATE()))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24ed2968-9e21-4c4f-8c2d-0bf6bc3a6136
          stepCounter: 7ce22382-e113-45ba-aa61-7288091a4d7b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_EVITALS_OBSERVATION_SET_01
        join:
          joinCondition: |-
            FROM s_eVItals_observation_set_01
              LEFT OUTER JOIN ds_pims_provider_spells
                ON s_eVitals_observation_set_01.patient_reference_no = ds_pims_provider_spells.patnt_refno
               AND s_eVitals_observation_set_01.observation_start_date BETWEEN ds_pims_provider_spells.admit_dttm AND IFNULL(ds_pims_provider_spells.disch_dttm, GETDATE())
              LEFT OUTER JOIN ds_pims_ae_attendances
                ON s_eVitals_observation_set_01.patient_reference_no = ds_pims_ae_attendances.patnt_refno
               AND s_eVitals_observation_set_01.observation_start_date BETWEEN ds_pims_ae_attendances.arrived_dttm AND IFNULL(ds_pims_ae_attendances.departed_dttm, GETDATE())
             WHERE s_eVItals_observation_set_01.row_num = 1
        name: S_EVITALS_OBSERVATION_SET_02
        noLinkRefs: []
  name: S_EVITALS_OBSERVATION_SET_02
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
