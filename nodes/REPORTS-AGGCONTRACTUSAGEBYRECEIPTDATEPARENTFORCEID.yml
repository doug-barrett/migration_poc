fileVersion: 1
id: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
name: AGGCONTRACTUSAGEBYRECEIPTDATEPARENTFORCEID
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48fa6520-f2b0-4761-a530-bd390c3281e6
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: INT
        defaultValue: ""
        description: Parent Id for an account. Will be the same as ForceId if there is no parent or if this is the top-most account in a hierarchy
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ff29182e-d8f0-4d8e-a2f8-742db9ddce39
                stepCounter: a594f58e-2240-453f-a570-12719830e3d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 519011dc-12ef-46b0-bd28-7db8606ec296
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: PPACONTRACTNUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bab96930-aec3-49c4-a9c1-9be83fc0e144
                stepCounter: c745f44c-5c71-4400-897b-ff90a502a9cb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 431256f6-c40e-49bd-8677-a8e4dadf0809
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: The receipt date calendar quarter representation. Format YYYYQQ. Example 200204.
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: RECEIPTDATECALQUARTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce5388f4-a6c1-4f68-b172-ee92e500fb8d
                stepCounter: 5b2d5c58-31de-4b87-b6c8-d601fc33ff03
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a40d135b-ea18-4b60-95d5-08693bd119e5
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: SALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4a71e14-54d2-4ee3-88da-c8c95b56c2c7
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e206c44-0674-4c64-b205-cc68dd7b1e75
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: REVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2098b7a3-a5c3-4180-b722-2fa84cd3e787
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98e880eb-b3df-4c4a-aaed-bd3d33157b5f
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ISFIRSTTIMEUSINGCONTRACT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f0957af-16aa-40fe-a225-3f515a7496a8
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: IIF(LAG(DimReceiptDate.ReceiptDate, 1) OVER (PARTITION BY ForceId, PPAContractNumber ORDER BY ForceId, PPAContractNumber, DimReceiptDate.ReceiptDate) IS NULL,1,0) AS IsFirstTimeUsingContract
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eeb7cdb2-04e6-40b0-9443-042695152d6c
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ISCONTRACTUSENEWORRECURRINGINTRAILING12MONTHS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f0957af-16aa-40fe-a225-3f515a7496a8
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: IIF(DATEDIFF(QUARTER, LAG(DimReceiptDate.ReceiptDate, 1) OVER (PARTITION BY ForceId, PPAContractNumber ORDER BY ForceId, PPAContractNumber, ReceiptDateCalQuarter), DimReceiptDate.ReceiptDate) BETWEEN 1 AND 4, 'Recurring', 'New')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7348af87-33e1-42df-a092-21876b9475ac
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: QUARTERSSINCECONTRACTUSE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f0957af-16aa-40fe-a225-3f515a7496a8
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: DATEDIFF(QUARTER, LAG(DimReceiptDate.ReceiptDate, 1) OVER (PARTITION BY ForceId, PPAContractNumber ORDER BY ForceId, PPAContractNumber, DimReceiptDate.ReceiptDateCalQuarter), DimReceiptDate.ReceiptDate)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 04fa79b1-4441-4271-85c7-7652866b15f1
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: DSSCREATETIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f4e2ac2-5663-4fa1-9e4f-9cd985958432
          stepCounter: e00d6ca8-4fa3-4fa1-8353-b6fb44702e21
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: DSSUPDATETIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          ACCOUNT: a594f58e-2240-453f-a570-12719830e3d0
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DIM
            nodeName: ACCOUNT
          - locationName: DIM
            nodeName: CONTRACT
          - locationName: DIM
            nodeName: DIMRECEIPTDATE
          - locationName: FACT
            nodeName: SALESANDREVENUE
        join:
          joinCondition: FROM {{ ref('DIM','ACCOUNT') }}
        name: AGGCONTRACTUSAGEBYRECEIPTDATEPARENTFORCEID
        noLinkRefs: []
  name: AGGCONTRACTUSAGEBYRECEIPTDATEPARENTFORCEID
  overrideSQL: false
  schema: ""
  sqlType: Fact
  type: sql
  version: 1
type: Node
