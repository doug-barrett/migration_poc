fileVersion: 1
id: c7559606-4277-4add-9c12-78c9aa5f7200
name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "YTD AGGREGATE USAGE STATISTICS FOR EACH LEVEL1FORCEID"
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c48af7b-fda9-4eb3-b27d-3b90d62274b5
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: LEVEL1FORCEID
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6c56414-d7ce-4041-ae22-a2d8f4c0c5b1
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3c289769-1ff0-4da8-bf3e-4ec47fdc3b21
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 41d21a24-5234-40a4-9d99-e9d443f284de
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab2ea50a-0afb-480d-bf7b-e30b3562d4b1
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: DATE
        defaultValue: ""
        description: DSSMAXTRANSACTIONDATE
        name: DSSMAXTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fb35b24f-c323-49ae-bcff-db15b470cfc8
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: MAX(OPSALESANDREVENUE.MAXRECEIPTDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b0ada70-5104-41e9-8059-68034de6cfc5
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: DATE
        defaultValue: ""
        description: PREVIOUSYTD_MOSTRECENTTRANSACTIONDATE
        name: PREVIOUSYTD_MOSTRECENTTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eabeb169-0d27-44b6-a3f2-e2ad8ace2359
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: MAX(OPSALESANDREVENUE.TRANSACTIONDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ebe8bd40-ec4b-43a1-9a4d-59338deca8f8
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_MONTHSSINCELASTTRANSACTION
        name: PREVIOUSYTD_MONTHSSINCELASTTRANSACTION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eabeb169-0d27-44b6-a3f2-e2ad8ace2359
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: DATEDIFF(MONTH,MAX(OPSALESANDREVENUE.TRANSACTIONDATE),MAX(OPSALESANDREVENUE.MAXRECEIPTDATE))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26d07383-2d84-4acf-a0d7-21d57c87629c
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFSUPPLIERSUSED
        name: PREVIOUSYTD_NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0435f915-9303-4a16-a952-0f6803794886
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: COUNT(DISTINCT OPSALESANDREVENUE.FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY OPSALESANDREVENUE.LEVEL1FORCEID) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 755d7bb6-77d7-48e0-976c-dc3437cc8759
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTRACTSUSED
        name: PREVIOUSYTD_NUMOFCONTRACTSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d19d0280-024d-479b-9288-6ee8028a9b41
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: COUNT(DISTINCT OPSALESANDREVENUE.INITIALCONTRACTID)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f1520b1-0b3d-43cc-9a84-003c06eda963
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTRACTCATEGORIESUSED
        name: PREVIOUSYTD_NUMOFCONTRACTCATEGORIESUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ee4e8ca-f8cb-411a-b9e7-1f74e9cb5b98
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: COUNT(DISTINCT OPSALESANDREVENUE.CONTRACTCATEGORY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2da9b3fb-84f3-4499-89a6-debc8a499a9e
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_SUMOFSALES
        name: PREVIOUSYTD_SUMOFSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8bcf3ef-13a2-4bb6-8383-57ff844fed54
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: SUM(OPSALESANDREVENUE.SALES)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9aac4d69-3fbf-43a6-a0ea-e70520ebdbcb
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_SUMOFREVENUE
        name: PREVIOUSYTD_SUMOFREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fea7350d-5156-43ff-952a-a70448a3c4a5
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: SUM(OPSALESANDREVENUE.REVENUE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af3ca55d-5879-45f4-b063-291f92a63a10
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_RANKBYSALES
        name: PREVIOUSYTD_RANKBYSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8bcf3ef-13a2-4bb6-8383-57ff844fed54
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.SALES) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87754678-908f-4c8f-9b79-1602d93abbe9
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_RANKBYREVENUE
        name: PREVIOUSYTD_RANKBYREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fea7350d-5156-43ff-952a-a70448a3c4a5
                stepCounter: b4bd2eae-094b-4b93-9c3d-f37cb40fb333
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.REVENUE) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6451219-7d29-4d26-a9f8-7b4885bb2871
          stepCounter: c7559606-4277-4add-9c12-78c9aa5f7200
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTACTS
        name: PREVIOUSYTD_NUMOFCONTACTS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dcf753c9-6ce6-4287-960d-d7a6b21b22fc
                stepCounter: d056aba3-a0b9-4509-9a27-e51f9da7fe1b
            transform: COUNT (DISTINCT CONTACT.DIMCONTACTKEY)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD -- (LEVEL1FORCEID, LEVEL1DISPLAYACCOUNTNAME, NUMOFSUPPLIERSUSED, NUMOFCONTRACTSUSED, NUMOFCONTRACTCATEGORIESUSED, ASOFMAXRECEIPTDATE, MONTHSSINCELASTTRANSACTION, MOSTRECENTRECEIPTDATE, SUMOFSALES, SUMOFREVENUE, SUMOFREVENUE, RANKBYREVENUE, RANKBYSALES, NUMOFCONTACTS, DSSCREATETIME, DSSUPDATETIME)
            \N \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) AS CURRENTYTD_NUMOFSUPPLIERSUSED \N , COUNT (DISTINCT INITIALCONTRACTID) AS CURRENTYTD_NUMOFCONTRACTSUSED \N , COUNT (DISTINCT CONTRACTCATEGORY) AS CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED \N , MAX(MAXRECEIPTDATE) AS DSSMAXTRANSACTIONDATE \N , DATEDIFF(MONTH, MAX(TRANSACTIONDATE), MAX(MAXRECEIPTDATE)) AS CURRENTYTD_MONTHSSINCELASTTRANSACTION \N , MAX(TRANSACTIONDATE) AS CURRENTYTD_MOSTRECENTTRANSACTIONDATE \N , SUM(SALES) AS CURRENTYTD_SUMOFSALES \N , SUM(REVENUE) AS CURRENTYTD_SUMOFREVENUE \N , RANK() OVER (ORDER BY SUM(REVENUE) DESC) AS CURRENTYTD_RANKBYREVENUE \N , RANK() OVER (ORDER BY SUM(SALES) DESC) AS CURRENTYTD_RANKBYSALES \N , COUNT (DISTINCT DIMCONTACTKEY) AS CURRENTYTD_NUMOFCONTACTS \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N
              LEFT OUTER JOIN DIM.CONTACT AS CONTACT
                ON \N CONTACT.LEVEL1FORCEID = SALESANDREVENUE.LEVEL1FORCEID \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(YEAR,TRANSACTIONDATE,MAXRECEIPTDATE) = 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   SUPPLIERID;\N
        dependencies:
          - locationName: DIM
            nodeName: CONTACT
          - locationName: OP
            nodeName: OPSALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTACT') }}
            {{ ref('OP','OPSALESANDREVENUE') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
        noLinkRefs: []
  name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
