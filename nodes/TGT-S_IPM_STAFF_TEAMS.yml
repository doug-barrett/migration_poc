fileVersion: 1
id: aff17e8f-7833-45d2-b396-b1c679ec9c78
name: S_IPM_STAFF_TEAMS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c848ef8-9b74-4a02-b709-833951ecac76
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: RNSCHDL
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_pims_prof_carer_map.schdl_refno, dim_staff_team.dim_staff_team_key ORDER BY ds_pims_prof_carer_map.modif_dttm DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5d1b095-8c7f-45cf-b3a4-2ba838e667f6
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_ENCOUNTER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: "'T'+cast(ds_pims_prof_carer_map.schdl_refno AS varchar)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8505f060-8216-430b-8679-8b432a422103
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: SCHDL_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea2589f9-8f57-4bfd-9189-381706b5e5cf
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 287a1df3-3ac8-428a-af6d-bbcabca18750
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 455d7269-34d2-440e-b123-0e7ff8fe8978
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54ce58fd-453a-4101-99a0-e65ad31e4626
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: STEAM_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 43228ccf-b586-430a-8b03-9b713aa37886
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb61ea4d-74c9-4ba5-b36a-f2f8571b6004
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_iPM_staff_teams.proca_refno=dim_healthcare_professional.healthcare_professional_reference_no
        name: DIM_HEALTHCARE_PROFESSIONAL_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3b22451-95b4-47f3-b7c1-48136447e09b
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: IFNULL(dim_healthcare_professional.dim_healthcare_professional_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4bf79be2-51e6-4de3-9d7c-dc3c69481bc5
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_iPM_staff_teams.steam_refno=dim_staff_team.staff_team_reference_no
        name: DIM_STAFF_TEAM_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2030fa3c-65c8-49cd-8e31-7d93c4d3069f
                stepCounter: c2c00be3-5ba0-4886-830e-19251a8bd04b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d743b32-b1ef-4731-866e-7f2502c5f640
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: SCHEDULE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 232cb164-41b5-421f-8189-6db893efe5be
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aacb4c50-c6e3-442b-a8b9-2bd5305a0d16
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: healthcare_professional_fullname
        name: HEALTHCARE_PROFESSIONAL_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eadd978e-5aa2-4c28-8eea-a75d5bfd108b
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: dim_healthcare_professional.healthcare_professional_fullname +' ('+ dim_healthcare_professional.healthcare_professional_type_desc + ')'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1076377d-d4e7-4874-a431-3b103de215dd
          stepCounter: aff17e8f-7833-45d2-b396-b1c679ec9c78
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_PIMS_PROF_CARER_MAP: 3f7e4431-5c07-47a3-b850-49b3af652a4b
          DS_SHARED_SCHEDULE: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
          DIM_HEALTHCARE_PROFESSIONAL: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PROF_CARER_MAP
          - locationName: TGT
            nodeName: DS_SHARED_SCHEDULE
          - locationName: TGT
            nodeName: DIM_HEALTHCARE_PROFESSIONAL
        join:
          joinCondition: |-
            FROM {{ ref('TGT','DS_PIMS_PROF_CARER_MAP') }}
              JOIN {{ ref('TGT','DS_SHARED_SCHEDULE') }}
                ON ds_pims_prof_carer_map.schdl_refno = ds_shared_schedule.schedule_reference_no
               AND ds_shared_schedule.schedule_type_code = 'THEAT'
              JOIN s_shared_schedule_theatre_05
                ON s_shared_schedule_theatre_05.patient_reference_no = ds_shared_schedule.patient_reference_no
              JOIN {{ ref('TGT','DIM_HEALTHCARE_PROFESSIONAL') }}
                ON ds_pims_prof_carer_map.proca_refno = dim_healthcare_professional.healthcare_professional_reference_no
             WHERE ds_pims_prof_carer_map.prrol_refno = 1000001900 --'OPLIST'
        name: S_IPM_STAFF_TEAMS
        noLinkRefs: []
  name: S_IPM_STAFF_TEAMS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
