fileVersion: 1
id: 19f97281-8cc4-4660-83be-6049689bc9c9
name: S_ED_STAY_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Join all Source/Load Tables required to build fact_ed_stay."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e08a28e-93fc-4605-85e2-0b787c491aed
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Encounter unique identifier
        name: ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2c1f3e7-e875-4f95-b6c6-c361f10b3844
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32dc32a8-527a-4d9f-b8e6-ec44f2b05158
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Attendance ref no.
        name: AEATT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: abec3889-f3f3-48a5-9350-64f3d0fb1e1f
                stepCounter: 80fc3e6b-f7c1-4b90-8177-1abc26dbb2b0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7113259e-4bae-4f9c-a4c1-8ed052dc0cad
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Patient ref no.
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b33f9195-428f-44f4-ad30-365c9bad125f
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02eb4fe2-4949-45a6-86c1-4de3140e4edb
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient arrived
        name: ARRIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47f1f3c3-0bde-4dc3-8add-8b0ba6091c5d
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51367620-44f1-4bf8-a7fc-6c0899ca03c5
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient departed
        name: DEPARTED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              --CASE WHEN s_ed_stay_05.departed_date < CONVERT(datetime, '19000101', 112)
               --     THEN NULL
               --     ELSE s_ed_stay_05.departed_date
               --END
               s_ed_stay_05.departed_date
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2722b90-f540-46bd-b666-4a3cb8529eb7
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS ward stay ref no
        name: AESTY_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99bddd6e-c39b-47a4-b453-07e7df44d837
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e87be8c-bd7a-45d5-96ab-c92e21e8899d
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS service point ref no
        name: SPONT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 785fb0ed-30c6-4c09-9c3d-25e3cfe950ce
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c86d158e-2ebe-4059-ab38-6f80129f2ae7
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Profession carer ref no.
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4fd25562-559b-483e-be77-c339470e6203
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb1d8428-1260-4e99-8e19-b0d1a17a5dbe
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS specialty ref no
        name: SPECT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3cf3f3cc-cf76-4d19-8e40-093189688c75
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80781b01-0b6c-4ea2-9f31-653db2cbe745
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Location stay start date and time
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed930fe6-e10e-4e2c-8f27-abd9c35f1291
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: |-
              --IFNULL(s_ed_stay_05.start_date, s_ed_stay_05.arrived_date)
               s_ed_stay_05.start_date
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7721f11-dc9c-496f-9636-7ce59845acbc
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Location stay end date and time
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 214703f5-38ec-4c14-a6b0-bcf2e4eef5cc
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c2d6e64-4cc1-42f4-bbbd-5755d8d12751
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time seen by professional carer
        name: SEEN_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b2a39a1-4c89-49a4-b875-3dccc8789a7f
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a7d93f9-8d71-4ad7-bad6-42b1dc7e8a10
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Ranks stays for an encounter by seen date.
        name: SEEN_DATE_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b2a39a1-4c89-49a4-b875-3dccc8789a7f
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: |-
              CASE WHEN s_ed_stay_05.seen_date IS NULL THEN NULL
                          ELSE ROW_NUMBER() OVER (PARTITION BY CASE WHEN s_ed_stay_05.seen_date IS NULL THEN NULL ELSE s_ed_stay_05.encounter END ORDER BY s_ed_stay_05.seen_date, s_ed_stay_05.start_date,s_ed_stay_05.end_date, s_ed_stay_05.spect_refno ,s_ed_stay_05.aesty_refno)
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 752f0aef-39da-4713-b83b-5837f70fabf5
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Ranks stays for an encounter in descending seen_date order.
        name: SEEN_DATE_RANK_DESCENDING
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b2a39a1-4c89-49a4-b875-3dccc8789a7f
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: |-
              CASE WHEN s_ed_stay_05.seen_date IS NULL THEN NULL
                          ELSE ROW_NUMBER() OVER (PARTITION BY CASE WHEN s_ed_stay_05.seen_date IS NULL THEN NULL ELSE s_ed_stay_05.encounter END ORDER BY s_ed_stay_05.seen_date DESC ,s_ed_stay_05.aesty_refno DESC)
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54dbb55c-20e5-41e3-abf2-20c15b7f49a4
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient transferred to a new specialty
        name: SPECT_XFER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed46f6c5-da79-4c04-a7a8-9bc79ccbbb1b
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3925589-33a6-4b42-82d0-7f3098aab469
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Clinician associated with the stay
        name: CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e393c87d-2bfd-47b3-a557-82745248467a
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: IFNULL(dim_healthcare_professional.healthcare_professional_code, 'UNKNW')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4b2ad75-4e84-459f-9b29-ccfa952f14a6
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95b9c79d-b802-48f2-afa0-003b971ec1e1
                stepCounter: 2b7fcd6a-6a5f-4454-9d5e-f87e946f60fa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99b3ffe5-93d9-4d27-8c6e-2e1248abbee1
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Specialty of the ward.
        name: SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acf7c8b3-5813-4be7-a8ca-91b0073451b4
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: IFNULL(dim_specialty.specialty_code, 'EMMED')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c7f873c-4f38-45bc-abe0-c8ba4d533963
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Health Specialty Code
        name: HEALTH_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ab525339-3f36-4625-ba0c-d207897f094b
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf4e43a9-922c-4b70-9535-9f3884242732
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS Speciality Reference Number
        name: SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 638ee1e9-b3f6-4e25-82a9-85dc713e4698
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13749428-a63d-4770-951c-c1b6ac9251f4
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Inappropriate_Location_Flag
        name: INAPPROPRIATE_LOCATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ff90a67-a9e6-4b31-b8a9-c1cb54411aa2
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: IFNULL(dim_service_point.inappropriate_location_flag,'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10b0d178-6bf2-4027-ba8a-f3f8fe911c29
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Stop_Clock_Location_Flag
        name: STOP_CLOCK_LOCATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ca2cacb2-b511-4db6-9b1c-af21bc487465
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: IFNULL(dim_service_point.stop_clock_location_flag,'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f592126-3739-4b76-bc79-103f53ad4ae0
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Observation_Location_Flag
        name: OBSERVATION_LOCATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8bc60ca-86ab-4336-84ac-2fec440ff392
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: IFNULL(dim_service_point.observation_location_flag,'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 525d2952-2e2f-40aa-a1de-4d42c1439d19
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Acute_Diagnosis_Unit_Location_Flag
        name: ACUTE_DIAGNOSIS_UNIT_LOCATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9f9926a-5e21-49b9-8f81-ae03cc334576
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: IFNULL(dim_service_point.acute_diagnosis_unit_location_flag,'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c337b33-eb31-4493-8b03-e417931b3a2f
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Y/N flag indicating whether location is ED
        name: ED_LOCATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb1c246c-210e-4a56-b67c-27174c489679
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: IFNULL(dim_service_point.emergency_department_location_flag,'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca8d71f4-865e-45f6-9768-f9c48ae9e76f
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Location of stay.
        name: LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8b5dc7-5f8d-48f1-96e5-e9f85b2dc97c
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f9723e6-279c-4c64-9171-33aa3b804e88
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Service_Point_Reference_Number
        name: SERVICE_POINT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3794ebb-7bf7-43d4-b0f1-dda63ee4844a
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db9e8b24-680f-4c49-8faa-751f2347c189
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Ranks of ED stay in ED Locations by descending end date.
        name: LAST_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN IFNULL(dim_service_point.emergency_department_location_flag, 'N') = 'Y' THEN ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter, dim_service_point.emergency_department_location_flag ORDER BY COALESCE(s_ed_stay_05.end_date, s_ed_stay_05.seen_date, s_ed_stay_05.start_date) DESC ,s_ed_stay_05.aesty_refno DESC)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a250a98-08e7-44a0-b766-7a42ab951c57
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Flag indicating the last stay for an encounter
        name: LAST_STAY_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN s_ed_stay_05.departed_date = s_ed_stay_05.end_date THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba26c3e5-75b3-40a9-8eb6-408a4f90f0ba
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of non ED stays by start date,  based on Non-ED Locations
        name: NON_ED_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb1c246c-210e-4a56-b67c-27174c489679
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: |-
              CASE WHEN IFNULL(dim_service_point.emergency_department_location_flag, 'N') = 'N' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN IFNULL(dim_service_point.emergency_department_location_flag, 'N') = 'N' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date , s_ed_stay_05.aesty_refno --added on 19.09.2023 SR
              )
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 617abcf0-040e-4cec-a782-ba882e225eed
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of non EMMED Specialty stays by start date
        name: NON_EMMED_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ab525339-3f36-4625-ba0c-d207897f094b
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: |-
              CASE WHEN dim_specialty.health_specialty_code <> 'M05' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN dim_specialty.health_specialty_code <> 'M05' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date , s_ed_stay_05.aesty_refno --added on 19.09.2023 SR
              )
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ace819a9-0954-4eb6-a969-c8a6c3a41af6
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of non ED stays by start date, based on Stop_Clock Locations
        name: STOP_CLOCK_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ca2cacb2-b511-4db6-9b1c-af21bc487465
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: |-
              CASE WHEN IFNULL(dim_service_point.stop_clock_location_flag,'N') = 'Y' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN IFNULL(dim_service_point.stop_clock_location_flag, 'N') = 'Y' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date,s_ed_stay_05.end_date,s_ed_stay_05.aesty_refno)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d09394e-8cb2-4192-93d6-86529e8b81c8
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of non ED stays by start date,  based on Observation Locations
        name: OBSERVATION_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8bc60ca-86ab-4336-84ac-2fec440ff392
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: |-
              CASE WHEN IFNULL(dim_service_point.observation_location_flag, 'N') = 'Y' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN IFNULL(dim_service_point.observation_location_flag, 'N') = 'Y' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date, s_ed_stay_05.aesty_refno)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 58afc2b9-d6fb-485c-8a82-e4b15b76d70e
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of stays by start date,  based on ADU Locations
        name: ADU_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8bc60ca-86ab-4336-84ac-2fec440ff392
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: |-
              CASE WHEN IFNULL(dim_service_point.acute_diagnosis_unit_location_flag, 'N') = 'Y' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN IFNULL(dim_service_point.acute_diagnosis_unit_location_flag, 'N') = 'Y' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date, s_ed_stay_05.aesty_refno)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22ca5773-0d1c-47bf-8653-ea8360008886
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Rank of stays by start date,  based on Inappropriate Locations
        name: INAPPROPRIATE_LOCATION_STAY_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8bc60ca-86ab-4336-84ac-2fec440ff392
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: |-
              CASE WHEN IFNULL(dim_service_point.inappropriate_location_flag, 'N') = 'Y' THEN ROW_NUMBER() OVER (PARTITION BY CASE WHEN IFNULL(dim_service_point.inappropriate_location_flag, 'N') = 'Y' THEN s_ed_stay_05.encounter ELSE NULL END ORDER BY s_ed_stay_05.start_date, s_ed_stay_05.aesty_refno)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6aa02f9b-4d1a-465d-9e60-d34435da3b62
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number of Stays in an Encounter/Attendance
        name: ROW_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5d4b6bf-701a-477d-8eb7-49d441331de4
                stepCounter: 98f05ebc-0bbd-408a-93d3-9ee096f24d3e
            transform: s_ed_stay_05.attendance_stay_count
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d3c2bf5-eebb-4404-b1b2-2f99214f2824
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Updated by custom_update_s_ed_stay_20 and varies with sort run number
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79ee5087-00eb-4d77-9132-5d1885716404
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: First row sequence used by custom_update_s_ed_stay_20.  By Asc StartDate/StayRefno for an Encounter.
        name: ROW_NUM1
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY IFNULL(s_ed_stay_05.start_date, s_ed_stay_05.arrived_date), IFNULL(s_ed_stay_05.aesty_refno, s_ed_stay_05.aeatt_refno))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b2a4eb1-6dc8-4732-8ed1-09c8068aecaf
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Second row sequence used by custom_update_s_ed_stay_20.  By Asc StartDate/EndDate for an Encounter.
        name: ROW_NUM2
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.start_date, s_ed_stay_05.end_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f73a4c2-59ee-4699-9f1d-b0956ea11ce3
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Third row sequence used by custom_update_s_ed_stay_20.  By Asc StayRefno for an Encounter.
        name: ROW_NUM3
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.aesty_refno)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 846f8adb-9b52-4476-aab3-4928938469a0
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Fourth row sequence used by custom_update_s_ed_stay_20.  By Asc StartDate/StayRefno for an Encounter.
        name: ROW_NUM4
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.start_date, s_ed_stay_05.aesty_refno)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 797fb18a-5a74-422c-893d-c2763b506062
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Fifth row sequence used by custom_update_s_ed_stay_20.  By Asc EndDate/StartDate/StayRefno for an Encounter.
        name: ROW_NUM5
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.end_date, s_ed_stay_05.start_date, s_ed_stay_05.aesty_refno)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9453c459-b4dc-4fb0-9eb6-1b83efce7e51
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Sixth row sequence used by custom_update_s_ed_stay_20.  By Asc EndDate/StayRefno/StartDate for an Encounter.
        name: ROW_NUM6
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.end_date, s_ed_stay_05.aesty_refno, s_ed_stay_05.start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05527b09-f440-4986-a318-54287d8f2e01
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Seventh row sequence used by custom_update_s_ed_stay_20.  By Asc SeenDate/StayRefno/StartDate for an Encounter.
        name: ROW_NUM7
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY s_ed_stay_05.encounter ORDER BY s_ed_stay_05.seen_date, s_ed_stay_05.aesty_refno, s_ed_stay_05.start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e5f4cdbe-4e8e-4720-85c5-9de1d543e138
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Indicates which row_num sort sequence was used for each encounter   e.g. 1 indicates row_num1 was used.   Updated by custom_update_s_ed_stay_20.
        name: SORT_REF
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6dee5f5e-1bdb-4778-8fd6-b37d32f64d09
          stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_ED_STAY_05
        join:
          joinCondition: FROM s_ED_changes --join  ds_shared_ed_stay s_ed_stay_05  ON s_ed_patient_changes.patnt_refno = s_ed_stay_05.patnt_refno  join  ds_shared_ed_stay s_ed_stay_05  ON s_ed_changes.aeatt_refno = s_ed_stay_05.aeatt_refno          LEFT OUTER JOIN dim.dim_healthcare_professional dim_healthcare_professional      ON s_ed_stay_05.proca_refno = dim_healthcare_professional.healthcare_professional_reference_no      AND s_ed_stay_05.start_date BETWEEN dim_healthcare_professional.dss_start_date AND dim_healthcare_professional.dss_end_date              LEFT OUTER JOIN dim.dim_specialty dim_specialty      ON s_ed_stay_05.spect_refno = dim_specialty.specialty_reference_no      AND s_ed_stay_05.start_date BETWEEN dim_specialty.dss_start_date AND dim_specialty.dss_end_date          LEFT OUTER JOIN dim.dim_service_point dim_service_point      ON s_ed_stay_05.spont_refno = dim_service_point.service_point_reference_no      AND s_ed_stay_05.start_date BETWEEN dim_service_point.dss_start_date AND dim_service_point.dss_end_date           --WHERE IFNULL(s_ed_stay_05.start_date, s_ed_stay_05.arrived_date) <= IFNULL(s_ed_stay_05.end_date, GETDATE())
        name: S_ED_STAY_10
        noLinkRefs: []
  name: S_ED_STAY_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
