fileVersion: 1
id: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
name: S_PIMS_PATIENT_ASSESSMENTS_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ee290507-8565-4cf5-951b-aca547610b52
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd5de20d-94b7-467f-b559-5a823bea4e8f
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab5f6cca-6790-4a30-92e6-66528697d865
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 057fc47f-c224-4a2a-beab-c54ad2203561
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da8b5cab-bb38-4379-a5df-b0290e3698c8
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a4401e9c-0ffe-4141-b6ab-157b31e47507
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a106aeb2-27b2-4bf3-9158-59640ec73f90
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e4ae95c3-b003-4175-9b6c-49c91f5895c1
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0079333f-886b-4648-833a-ef78fec6ebb4
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_CATEGORY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dace3504-b72c-48f8-9323-7c33d0da8349
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66675f06-512b-4d94-afac-cab8c0d45e57
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_CATEGORY_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 336d8d17-5b75-4afc-8ac1-b6a740d10e27
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c746042c-cf0d-4f0e-978b-a487009577a9
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ASSESSMENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a7b19a6-99b1-449d-982e-ab5302c94050
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51a84aa9-80ea-4a0d-bb36-a1947371cb59
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ASSESSMENT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6795b02d-28c0-4a61-b0bb-f89cfe31e5e2
                stepCounter: 34f97967-6c19-40ae-b67b-49e7a2a747dc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be138f4c-4a1a-470e-9ba5-6734f4cd18bd
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_DETAILS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e536910-b431-43a4-813c-48b9f2b1e35d
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f50cf494-e2a6-435c-8f57-27e9eb9df419
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_DETAILS_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f69c966c-4eae-418c-ad1c-0dd69cb544c0
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 777b4cc7-f0ff-4849-a98a-7d95f8611f78
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROPERTY_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8c5b537-51c4-486f-8079-9b0f0426c72d
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ecfb175-d664-4d1a-ab54-907cc4d9d30a
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: PROPERTY_TYPE_MAIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31d8c4df-571d-4e8b-87d1-13302ebe1a15
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 63cbffa7-acff-49cb-b8de-ae7dddaf69e7
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PROPERTY_TYPE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a83bf053-58a4-48cd-9eac-45fd01764a38
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e5a3c84-4c7d-40c2-9195-4e0ebea115a0
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_DETAILS_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6851ab4-d4da-4409-821a-3a3b8b0774a4
                stepCounter: 7a3b607c-6de6-4709-a724-718f5a7e3007
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 439c6dca-b740-401d-a97a-ee29c93cb37c
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0ba7b96-635a-46ba-936e-4b8fe72c97c4
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b7487d0-7932-4045-bdb6-0ca62a92b76f
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 57a56273-3346-498d-8393-9a3e3488be2f
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dca7de7f-73ec-4787-aed1-b87deba7dfe5
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f800dbc-3d4d-489b-ad9d-c57bb1eba643
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a0dfed3-7686-4f54-a98d-91f2ddfe0179
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ASSESSMENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bbbf24b6-3300-4d9a-aa28-0b34612aab99
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a17d8ad8-5974-4ff0-99f0-3c94a8f49899
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PATIENT_ASSESSMENT_DETAILS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cbf64b0b-eb49-49dc-859a-15595ac4593c
                stepCounter: 85ec8a34-509f-4cda-b5ce-893e7d1e1484
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8d9a6d7-4eb6-482f-a1f4-6a4f3395c9bc
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PATIENT_ASSESSMENTS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4687552f-c1bb-4543-8dc3-d5581080dfef
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5fae4c42-c3ab-40da-92c3-9c58e708a1aa
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SCORE_DISPLAY_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc4f5434-ad36-4c50-a5a4-875b4948bcc5
                stepCounter: 85ec8a34-509f-4cda-b5ce-893e7d1e1484
            transform: |-
              CASE WHEN s_pims_assessment_details.property_type_main_code ='RFVAL' THEN IFNULL(s_pims_patient_assessment_details.score_reference_value_description,s_pims_patient_assessment_details.score_reference_value_main_code)
                          ELSE score
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8a4bdc6-85b0-43d9-8972-42dadde9b0f8
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SCORE_DATE_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb327086-d471-4674-9e80-0c101f42dac0
                stepCounter: 85ec8a34-509f-4cda-b5ce-893e7d1e1484
            transform: |-
              CASE WHEN isdate(score) =1 -- THEN convert(datetime,score,113)
              THEN cast(score AS datetime)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b3ac094-687e-4bcc-9441-5217d4af9452
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: SCORE_REFERENCE_VALUE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c53fd783-42bd-400e-bbfa-82274fabd2bd
                stepCounter: 85ec8a34-509f-4cda-b5ce-893e7d1e1484
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec5a38fd-c0dc-47c1-8d74-34c276ebdf11
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_pims_patient_assessments_10.assessment_details_reference_no=dim_pims_assessments.assessment_details_reference_no  s_pims_patient_assessments_10.assessment_reference_no=dim_pims_assessments.assessment_reference_no
        name: DIM_PIMS_ASSESSMENTS_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 57dbe588-3969-484f-9a92-64b7ef538893
                stepCounter: 62354d4f-5638-4ce8-b8b1-a9a3dd7f1529
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5150cc17-3d48-4676-901b-5d873fa49572
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_pims_patient_assessments.LOTYP_REFNO=dim_location_type.location_type_reference_no
        name: DIM_LOCATION_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66a1e707-7975-4c1b-84fb-25e0e5c7b388
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: IFNULL(s_pims_patient_assessments.dim_location_type_key,1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56749440-80ad-4bb5-8839-3ff837d9d4f2
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_pims_patient_assessments.profesional_carer_reference_no=dim_healthcare_professional.healthcare_professional_reference_no
        name: DIM_HEALTHCARE_PROFESSIONAL_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d52623cb-8fc3-43df-bd2a-6a16cabaaa5d
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: IFNULL(s_pims_patient_assessments.dim_healthcare_professional_key,1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d987c1e2-9d12-4c8c-8bf2-223e7fba4aee
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_pims_patient_assessments.location_health_organisation_reference_no=dim_health_organisation.health_org_reference_no
        name: DIM_HEALTH_ORG_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa1c7f08-3fa0-4969-a013-b2e0fd68b3ff
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: IFNULL(s_pims_patient_assessments.dim_health_org_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8561610-0f76-4721-952f-1068765bd468
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_pims_patient_assessments.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 683638a8-209b-4878-9602-b16024de083e
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: IFNULL(s_pims_patient_assessments.dim_patient_key,1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61f3cf97-0524-47e8-97af-62c094db6df3
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_ASSESSMENT_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0251b674-8b4a-4ce2-9f0b-8c4c6b91d6c8
                stepCounter: 701ce1eb-1c7b-4458-8400-6b7a48465109
            transform: IFNULL(s_pims_patient_assessments.dim_assessment_date_key,1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55e26b17-691a-4def-81b2-a1fae8a80e0b
          stepCounter: 7cc4907c-b3df-4ae6-8e12-699b34b7974d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_PIMS_ASSESSMENTS: 34f97967-6c19-40ae-b67b-49e7a2a747dc
          S_PIMS_ASSESSMENT_DETAILS: 7a3b607c-6de6-4709-a724-718f5a7e3007
          S_PIMS_PATIENT_ASSESSMENTS: 701ce1eb-1c7b-4458-8400-6b7a48465109
          S_PIMS_PATIENT_ASSESSMENT_DETAILS: 85ec8a34-509f-4cda-b5ce-893e7d1e1484
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_PIMS_ASSESSMENTS
          - locationName: TGT
            nodeName: S_PIMS_ASSESSMENT_DETAILS
          - locationName: TGT
            nodeName: S_PIMS_PATIENT_ASSESSMENTS
          - locationName: TGT
            nodeName: S_PIMS_PATIENT_ASSESSMENT_DETAILS
        join:
          joinCondition: |-
            FROM {{ ref('TGT','S_PIMS_ASSESSMENTS') }}
              LEFT OUTER JOIN {{ ref('TGT','S_PIMS_ASSESSMENT_DETAILS') }}
                ON s_pims_assessments.assessment_reference_no = s_pims_assessment_details.assessment_reference_no
              LEFT OUTER JOIN {{ ref('TGT','S_PIMS_PATIENT_ASSESSMENTS') }}
                ON s_pims_assessment_details.assessment_reference_no = s_pims_patient_assessments.assessment_reference_no
              LEFT OUTER JOIN {{ ref('TGT','S_PIMS_PATIENT_ASSESSMENT_DETAILS') }}
                ON s_pims_patient_assessments.patient_assessments_reference_no = s_pims_patient_assessment_details.patient_assessment_reference_no
               AND s_pims_assessment_details.assessment_details_reference_no = s_pims_patient_assessment_details.assessment_details_reference_no
        name: S_PIMS_PATIENT_ASSESSMENTS_10
        noLinkRefs: []
  name: S_PIMS_PATIENT_ASSESSMENTS_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
