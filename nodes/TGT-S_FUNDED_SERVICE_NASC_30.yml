fileVersion: 1
id: 223207b9-1b49-4110-984f-6ff8183217c2
name: S_FUNDED_SERVICE_NASC_30
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: deca1bc9-4cdc-4835-a6ba-dda3432f27b4
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PATIENT_PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc9254ef-dd22-4e8f-ab8f-e6ba7fae0341
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8eab862-2615-4584-a151-38d11c08e9c7
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0fd87695-bb18-4a09-9d5e-f58d37012799
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 672e21f4-b64f-4502-ab79-f301063a097e
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebe86be2-e175-4ff1-8260-2b143d6a3ba8
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a5bb00f-a924-4ae1-805a-c2e7a36fd2cc
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: STREAM_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 235ee677-71c8-4fbc-b9fe-6160c5d6013d
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9272275f-eb1a-418d-b693-3a3a1182cd5b
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 235ee677-71c8-4fbc-b9fe-6160c5d6013d
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: LEFT('R' + s_funded_service_NASC_10.stream_id, 20)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3db20db7-532e-4eaf-860f-f54ff3137aea
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: patient_programme_status
        name: PROGRAMME_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cc764ca-0893-4a6e-b25f-db15b868e5c7
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e9c96e-c892-48af-b976-5f3b1a7a72fd
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7eee5676-2a26-4199-b0b5-f681d2e6ac78
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f37a67ef-b003-4360-b8b8-0504c13ec8f1
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85aae632-8618-496c-a11b-6e615e5052af
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37a68fd2-e6ec-40cd-8147-a8db4e50c054
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: ""
        name: TASK_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a81b63e4-1e82-407b-ac40-5aaf4e7dce59
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ROW_NUMBER() OVER(PARTITION BY s_funded_service_NASC_10.stream_id ORDER BY s_funded_service_NASC_10.task_request_id DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f61e0041-b123-4519-bc5a-c9e604c8607d
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: TASK_TYPE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d7d250aa-4221-40d7-bcf1-2f694d81f6e3
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb694edf-ae9f-41cd-83b2-bb9314cb333d
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b0ad346-bc85-4389-8c23-57f482639ce2
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef8e7166-2913-483e-8f2e-ca173efa1be5
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 546042f4-b9e6-4590-9067-f3c3a735e3c2
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e1668fbe-521c-463e-a34c-2d6450d26bb5
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: PLACEMENT_SOURCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 957a2d42-7d43-435c-9d8f-e5d2a6ea1d3f
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8183c5f5-9aea-41f6-a6d3-8087af8049d6
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: PLACEMENT_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6e94e594-20c1-4270-9a35-60d80309e7c3
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14544080-35ef-47b6-94df-19dafe2b49c8
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IS_RESIDENT_PLACEMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e920ccd-fcd6-4066-a0df-5a7cd289a9ca
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4af4941f-9f5c-4e77-9438-9fa22aa9cdb6
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: EXIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b4eb2c2-3f0c-4a63-ae01-456ad625996e
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 619a4920-cb6f-41c7-9894-b9213a69120d
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: EXIT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 845a5595-6818-4bae-ad95-8246ae597f78
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3cd1f2bc-93b1-446c-b735-6e102124e661
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers resident placements by service start date.
        name: RESIDENT_PLACEMENT_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e920ccd-fcd6-4066-a0df-5a7cd289a9ca
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: |-
              CASE WHEN s_funded_service_NASC_10.is_resident_placement = 'Yes' THEN ROW_NUMBER() OVER(PARTITION BY s_funded_service_NASC_10.patient_nhi, s_funded_service_NASC_10.is_resident_placement ORDER BY s_funded_service_NASC_20.service_start_date)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d50c6cc7-310b-40d2-a2d7-893f270d3ff2
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ATOMIC_OBSERVATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa70920b-24b1-47a0-bd8e-bc43a62df707
                stepCounter: e5d02d7d-f72b-45b5-9660-f8a248b65317
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d69eceeb-f797-4756-9618-cf138c55faf8
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Uniquely identifies each funded service row. Set to the MIN child_atomic_observation_id for each child row within the atomic_observation_id.
        name: FUNDED_SERVICE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0213e990-5fab-42d6-b6a0-d1666526e280
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e32bab4-daf1-41c9-857a-44446fa0de64
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: ROW_INDEX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e54bfbbf-4cde-48f8-afca-c6437c1f428a
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ede174d1-7c33-4cac-8cab-01a7e83cdc30
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: SERVICE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c19e419f-f308-41c1-bc8c-ad814e701ded
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea47e224-ce76-456c-b463-f9e32c797df6
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c55bed29-05ad-427f-9e09-42ad04c8f673
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b2c9406-012b-43f3-adea-43cbb79de0e6
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_PROVIDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b584b5a6-8e77-4cf9-9b57-a85b845044eb
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cff3022d-9e10-4c1e-a9c8-2ddce56668b3
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_FUNDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5d9c5d67-1377-4edc-82a2-01103c54c09e
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4eefd439-a4dd-499e-b29c-65e57ae5e9c3
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SERVICE_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5762d350-cbd6-4ead-803e-bbf3c78ed506
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f83c5a2-e1aa-44c8-bea0-9d3ae236360e
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: SERVICE_FREQUENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 863de25a-0cc4-445f-84ef-1165dec1dc9b
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8f62ed2-89a9-41d1-ac08-056840450251
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SERVICE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa068385-a5af-4c20-8538-c84f03dc97d5
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfa2ce1f-c03e-499d-a6b2-29f9525e3aab
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SERVICE_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5dbc81a5-24f3-421e-a926-07f8facfaaf5
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: COALESCE(s_funded_service_NASC_20.service_end_date, try_CONVERT(date, t2.exit_date, 103))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a348b461-3bb6-48fe-a054-d8deeb74b375
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(9,3)
        defaultValue: ""
        description: ""
        name: SERVICE_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97c5d972-36b9-471f-a581-10c1847b885c
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b7d5572-5ffe-4353-a0c7-972478a01672
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(6,2)
        defaultValue: ""
        description: ""
        name: SERVICE_UNIT_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 582b3fb9-6e6b-4c40-bb2f-cd4872a16409
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cb16d92-1251-4df9-bf17-dc04b3d38ebb
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: NUMERIC(10,2)
        defaultValue: ""
        description: ""
        name: SERVICE_WEEK_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cfcebfb2-d782-43e7-be7f-548cefa27a05
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d52fecc0-c6aa-4211-baff-e67417d89e2e
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SERVICE_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9e7e95b6-e721-4267-a3ba-8ac114b9168e
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: COALESCE(NULLIF(s_funded_service_NASC_20.service_reason, ''), t2.exit_reason)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f73ec7b-74bd-4ea4-9e29-7e36c696075d
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: RESIDENTIAL_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c62c0a2-7f53-44f2-b0d2-86749b62130a
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c586d343-6910-4889-9970-d06da071a9de
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Dummy column added so that join to l_cdsswe_table_child_data is visible in Red meta data.
        name: COLUMN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 094a7bf0-faa0-40b9-bcff-73738e4126f3
                stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c097ed6-dcc8-4b99-93f8-4338b041cf98
          stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_FUNDED_SERVICE_NASC_10
        join:
          joinCondition: |-
            FROM s_funded_service_NASC_10
              JOIN s_funded_service_NASC_20
                ON s_funded_service_NASC_10.services_observation_id = s_funded_service_NASC_20.atomic_observation_id
              JOIN l_cdsswe_patient
                ON s_funded_service_NASC_10.patient_id = l_cdsswe_patient.patient_id
              LEFT OUTER JOIN s_funded_service_NASC_10 t2
                ON t2.stream_id = s_funded_service_NASC_10.stream_id
               AND t2.task_row_num = 1 -- The most recent non Support Plan task    WHERE s_funded_service_NASC_10.support_plan_flag = 1
        name: S_FUNDED_SERVICE_NASC_30
        noLinkRefs: []
  name: S_FUNDED_SERVICE_NASC_30
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
