fileVersion: 1
id: 519b7b54-37f3-47cb-b8ab-346649c612e9
name: S_ED_STAY_30
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Calculates minutes and change types for each location stay."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4fad752-1852-49d6-b044-80a53e733657
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Attendance ref no.
        name: AEATT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 884d28b9-9c1d-4884-b97e-f0e00bcbcd39
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6578fd3-56e0-4b15-aa39-e88944f844b3
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS ward stay ref no
        name: AESTY_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 07f8095a-a5c6-428b-bda4-858cb6247b96
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99397cef-6b9c-459d-92ed-182c555daf8c
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient arrived
        name: ARRIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6d84896-6cc0-4c47-a071-a6134741cc89
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 747bc376-dbf6-44af-a6f3-4eef05b5c801
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Clinician associated with the stay
        name: CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3bcda0c5-aef1-42eb-8f6b-0e5e46584ee2
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8220012f-d57d-4145-814f-7ced54087272
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: current_to_next_stay_duration
        name: CURRENT_TO_NEXT_STAY_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IFNULL(DATEDIFF(mi, s_ed_stay_20.end_date, s_ed_stay_20.next_start_date),0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6758097f-a092-413d-8959-0a3f894a61e4
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient departed
        name: DEPARTED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9870b4c5-cb77-426a-aa84-1c7470fc96e4
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72a6b67c-c8ad-43c1-8e43-5ec5e23a2e40
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9d2c2f2-433e-4fb6-b338-dba23999170e
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Encounter unique identifier
        name: ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a530d86b-7133-472c-8824-74f36e136076
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50b22db6-c72f-49c3-8eae-1d787b78f9d1
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Location stay end date and time
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f0c72be-0645-4637-8dac-34d2f9269d14
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 199b1b3a-b91c-410b-bcc7-1d8ea8b2ab34
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6745e5d-5099-4257-a9d2-56c7d914f989
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 939691da-8d1c-4dd9-82e2-865e66e1c10b
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Location of ward stay.
        name: LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6684a9f-1721-4492-b080-4eb60e885cd2
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6dd8d5ef-1e42-47f8-8163-3381fdaf5610
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: NEXT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1758951-4874-4257-9478-89686a41cb11
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82771d42-215a-4a78-abc2-3e63d4999fd7
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NEXT_HEALTHCARE_PROFESSIONAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5044df7d-213b-47b5-8536-91fa952908a9
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eab0af2b-cf49-456c-bf01-85741fd02946
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: NEXT_HEALTHCARE_PROFESSIONAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af63bf0c-d932-4f6c-9d06-ed519385ebe6
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9863cd7-8f63-4add-ae00-7a94974114e6
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NEXT_SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48e4ead6-8bfc-4ac1-9227-eec9ad61d60c
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab288e2a-cd2d-4136-be03-deefadb1ab11
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: NEXT_SERVICE_POINT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a88aa48b-c97a-46f6-a20c-eb5f9595e894
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b52674f8-76fd-4722-82d6-a75bf235d2ee
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NEXT_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3a530e3-7fcb-4685-b6fb-32fed17f51fb
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 099b0426-772e-41a4-95bc-88eae51afb80
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: NEXT_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2e22e1f-f007-4b10-bbc3-a59759f54887
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dff47744-c81d-4c0b-b178-f4c1998b8b5d
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: NEXT_SPECT_XFER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 039fc753-9e46-410c-ac84-6f838524807c
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb1f7721-cf74-43a9-ba28-d05a401685b7
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: NEXT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 250bd168-fa76-42da-bee0-432a59577751
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 214946a6-37bb-41f9-98a4-c13c4d9259b2
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: NEXT_STAY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0e7aaba7-5b17-441c-9fbb-e487693d2cd0
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da60fbaa-99a9-4d8a-9ac9-58c8176adaa7
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Patient ref no.
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 795bfe50-fd95-4488-b93d-ba4f62ef63df
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d11e8574-bc7d-4aa3-a0e7-4fbcfe4d5d97
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PREV_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 070b9e1e-902a-40e4-befc-24ca99c519bd
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05abc510-d1a7-46e7-8d3b-baca77185895
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PREV_HEALTHCARE_PROFESSIONAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: abf8169c-7f86-4be3-882b-618464b00683
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 033d3754-da26-4119-af0c-a733c9710470
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PREV_HEALTHCARE_PROFESSIONAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2012bb24-c400-4dcb-86c4-b84aad7ddc71
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c63e574-f894-4951-bb8d-834483e56b8c
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PREV_SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 46d67b12-3817-47cc-aab2-6e35d2e49e19
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ee33b8f-1233-4796-ae13-1f3d35d7ed8a
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PREV_SERVICE_POINT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af0c99ee-fb4c-459c-9c97-6d6a4c1e58d8
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 279022f4-d685-4a1f-8d1d-3786b41d2c22
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PREV_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e405ea80-a9a4-4009-9167-47df8ba39e92
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fd5d04b-7ea9-4d0c-9a59-e6c9528627dc
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PREV_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: efff9758-07ef-4261-9ac3-dfc8885717fd
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32e79ca2-5325-491d-9187-a80d79b09c9a
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PREV_SPECT_XFER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c2799fbe-8310-4739-af2c-9363f9b9bb10
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 455a5ec9-afaa-464c-840b-00818ad7c856
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PREV_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: de40805b-0a24-474e-85c8-9289ccb0ae21
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfb31a26-7b0c-4b8a-bb85-727a85080fae
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: NUMERIC(10)
        defaultValue: ""
        description: ""
        name: PREV_STAY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09b4901e-fd45-4645-9fca-3e2d2abdf854
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10019b4b-5f85-479c-a592-64326011be55
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: previous_to_current_stay_duration
        name: PREVIOUS_TO_CURRENT_STAY_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IFNULL(DATEDIFF(mi, s_ed_stay_20.prev_end_date, s_ed_stay_20.start_date),0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec29ba05-4e6f-4675-a9bf-eea18dea299d
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number of events for the encounter
        name: ROW_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e71c5b52-a84f-4120-b4e2-01259010f6c1
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c01aad0-efda-43f2-a6b9-3c8e3d701c0e
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Event number for the encounter in chronological order
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d88dc94-35fc-4403-840c-061a0cd57ea6
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2717ae2c-28f6-42ce-8f9a-f3af28588d97
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Event number for the encounter in descending chronological order
        name: ROW_NUM_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY encounter ORDER BY row_num DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5e3b998-1c58-42d7-b512-0e5bd20a33ec
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time seen by professional carer
        name: SEEN_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50804a4c-bec9-4303-90ef-a06594e7edc1
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa3ab217-97e1-4650-8eac-8c32ab8f458a
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Service_Point_Reference_Number
        name: SERVICE_POINT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0510d3c9-b443-4d9d-8b56-34dc2fe04aa7
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1a75265-91fe-43f9-8e20-9b5d287a300d
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'Which sort sequence (1-7) used when calculating stay start/end dates for the encounter. '
        name: SORT_REF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f825be9d-cbbd-454d-87f5-a13432979a92
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87c94a46-a9a8-4165-9efc-98688b04019f
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Stay specialty.
        name: SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93b9a39b-7091-48da-b824-696158196cca
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61e9e182-e33a-4278-a41a-40afd3fd8f67
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS Speciality Reference Number
        name: SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9f0df19-a1c6-4000-8bc7-e8698f83e51c
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed7d560b-b12c-41e4-aa53-5551e561742c
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient transferred to a new specialty
        name: SPECT_XFER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295b1855-b20f-41e0-8420-f8f9818f3a0f
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acad4283-1cfd-49dc-9c89-a4b74d8b3866
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Location stay start date and time
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 687b4789-2688-4d4f-8d64-e9fc2a1f1c62
                stepCounter: dca41c40-3730-4c25-8145-448d9ba4f3e3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4022aaf3-5154-4173-a77d-3ae2dbc809bb
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: min_seen_date_wb from WB
        name: MIN_SEEN_DATE_WB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13dc3275-07f0-4368-b94b-49273df37b37
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INT
        defaultValue: ""
        description: min_attendance_stay_seq_num from stay
        name: MIN_ATTENDANCE_STAY_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a902e3d-7605-4a00-a6c2-9ba677f04b25
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number of minutes between the encounter start and end date
        name: STAY_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IFNULL(DATEDIFF(mi, s_ed_stay_20.start_date, s_ed_stay_20.end_date),0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a69331c2-de89-4e6e-9841-757477c7a746
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Flag used for costing feeders. Y if stay is greater than 10 minutes in duration, N if not
        name: ED_STAY_OVER_10_MIN_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN IFNULL(DATEDIFF(mi, s_ed_stay_20.start_date, s_ed_stay_20.end_date),0) > 10 AND s_ed_stay_20.acute_diagnosis_unit_location_flag ='N' THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99ae0f89-0d8b-4294-b09f-37725ad30cde
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Flag used for costing feeders. Y if stay is greater than 10 minutes in duration in ADU, N if not
        name: ADU_STAY_OVER_10_MIN_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN IFNULL(DATEDIFF(mi, s_ed_stay_20.start_date, s_ed_stay_20.end_date),0) > 10 AND s_ed_stay_20.acute_diagnosis_unit_location_flag ='Y' THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c219d06-09ea-445f-9ae7-d770e73df737
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Code indicating reason why stay record ended; D=discharge, S=specialty change, P=prof carer change, T=transfer
        name: STAY_END_REASON_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN row_num = ROW_COUNT                                                                                                      THEN 'D'
                          WHEN LOCATION = next_service_point_code AND clinician = next_healthcare_professional_code AND specialty = next_specialty_code THEN 'T'
                          ELSE CASE WHEN LOCATION = next_service_point_code THEN '' ELSE 'T' END + CASE WHEN clinician = next_healthcare_professional_code THEN '' ELSE 'P' END + CASE WHEN specialty = next_specialty_code THEN '' ELSE 'S' END
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9f5990b-171a-4bf6-bb6e-60c1a5e53ce7
          stepCounter: 519b7b54-37f3-47cb-b8ab-346649c612e9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Code indicating reason why new stay record started; A=arrival, S=specialty change, P=prof carer change, T=transfer
        name: STAY_START_REASON_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN row_num = 1                                                                                                              THEN 'A'
                          WHEN LOCATION = prev_service_point_code AND clinician = prev_healthcare_professional_code AND specialty = prev_specialty_code THEN 'T'
                          ELSE CASE WHEN LOCATION = prev_service_point_code THEN '' ELSE 'T' END + CASE WHEN clinician = prev_healthcare_professional_code THEN '' ELSE 'P' END + CASE WHEN specialty = prev_specialty_code THEN '' ELSE 'S' END
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_ED_STAY_20
        join:
          joinCondition: |-
            FROM s_ed_stay_20
              LEFT JOIN (
                    SELECT wb.attendance_encounter_id,
                           WB_action_specialty_code,
                           Min(WB_action_date) AS min_seen_date_wb ,
                           MIN(row_num) AS min_attendance_stay_seq_num
                      FROM ds_consolidate_whiteboard_action_10 wb with(nolock)
                      JOIN s_ed_stay_20 ed
                        ON wb.attendance_encounter_id=ed.encounter
                       AND wb.WB_action_specialty_code = ed.specialty
                     WHERE 1=1
                       AND seen_by_action_dr = 1
                     GROUP BY wb.attendance_encounter_id,
                              WB_action_specialty_code
                   ) ds_consolidate_whiteboard_action_10
                ON ds_consolidate_whiteboard_action_10.attendance_encounter_id = s_ed_stay_20.encounter
               AND ds_consolidate_whiteboard_action_10.WB_action_specialty_code = s_ed_stay_20.specialty
               AND ds_consolidate_whiteboard_action_10.min_attendance_stay_seq_num = s_ed_stay_20.row_num
        name: S_ED_STAY_30
        noLinkRefs: []
  name: S_ED_STAY_30
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
