fileVersion: 1
id: 025cc51b-16d6-4445-83f7-5229e679b705
name: S_PJ_EVENT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Bring together information about all ED, IP, Radiology, Theatre and OP events for a journey. There will be a row for each event so one journey can have many rows. Source table for fact_patient_journey_event."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f7dd4ca-4b72-4471-8e15-dd1ec0a54c3c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique ID for a patient journey
        name: JOURNEY_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c77377e-0bfd-44f2-b361-7036b8d5d80f
                stepCounter: 5d0113df-88c1-4dd8-81d0-28d2b8d9bf04
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7f60003-b7a5-4f17-92d1-b8cb3e8fce89
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 15cf30a7-2718-4fd9-a6dd-2c0f02940643
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8017333-8bf1-48d8-ae28-60f8be1ba8fd
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Journey number for the patient.
        name: JOURNEY_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 418e0dcc-bc60-4a10-b7c2-f487103bee25
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0775c8c-9cc2-40f1-8a6c-8be2c5647a1d
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Journey number for the patient.
        name: JOURNEY_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f1ff203-32f8-4a25-97f0-a612dfbbc9e6
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5940244a-9550-42c3-8908-6f660639a08a
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Total number of events for each journey.
        name: JOURNEY_EVENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38b592e8-dc2d-4a03-8761-eaecb1c6ab95
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9671d233-5762-4116-a6bb-c7f160377e16
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers events for each journey in event_start_date order.
        name: JOURNEY_EVENT_SEQ_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3dda04ce-8a50-4f6e-a2a0-a6b48353e199
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 324c2ba3-ce1f-45c3-8896-4534d1b9573a
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Source for this event e.g. ED, Inpatient.
        name: EVENT_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e36814ac-f11e-4a07-8328-56fd88026fb4
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb9bf62e-9efd-415f-8d43-58d64f107f83
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Total number of events for each journey/source combination.
        name: JOURNEY_SOURCE_EVENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d75c09-5aa6-46ed-8455-a7f35fde324c
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e76d25e-9ed0-49a7-a714-d9f2e9e91808
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers events within each journey/source combination.
        name: JOURNEY_SOURCE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e4c4682-aded-4d14-8ed5-b88b6afade81
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 574b9ff8-3604-4f73-b718-1ec758c0ff18
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: encounter unique identifier
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26f6d2f3-ac0f-4c1d-b20e-76bf882830d0
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE event_source
                          WHEN 'ED'        THEN s_PJ_event_40.ed_encounter_id
                          WHEN 'Theatre'   THEN s_PJ_event_40.theatre_encounter_id
                          WHEN 'OP'        THEN s_PJ_event_40.op_encounter_id
                          WHEN 'Radiology' THEN s_PJ_event_40.radiology_accession_number
                          ELSE s_PJ_event_40.ip_encounter_id
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67c2e441-869a-4f18-b1fc-b53ee90f0ab6
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first ED event for the journey.
        name: FIRST_ED_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e4c4682-aded-4d14-8ed5-b88b6afade81
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE WHEN event_source = 'ED' AND journey_source_seq_num = 1 THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 07df19f2-f45b-4b9a-89ac-a99ab0ad1e6f
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first inpatient event for the journey.
        name: FIRST_IP_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e4c4682-aded-4d14-8ed5-b88b6afade81
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE WHEN event_source = 'IP' AND journey_source_seq_num = 1 THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01c7a96e-cda4-4849-80cf-dc44e6fd98f3
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the ED event related to the index IP event.
        name: INDEX_ED_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 08a48ad5-ae29-4627-bf04-84588890bc9f
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1b06fc9-97c9-4b0a-97eb-dde5664d4c53
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: 'If set to 1 indicates the IP event classified as the Index event. Will be the first IP event which does end in ED i.e. discharge ward is ECC or ECCW.  '
        name: INDEX_IP_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b0035111-f895-4047-8636-8f5019f8787a
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE WHEN s_PJ_event_40.ip_index_event_seq_num = 1 THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7d2ae5d-175b-4e77-a370-a998d0d6531e
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first theatre event for the journey.
        name: FIRST_THEATRE_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e4c4682-aded-4d14-8ed5-b88b6afade81
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE WHEN event_source = 'Theatre' AND journey_source_seq_num = 1 THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b8795e9-486d-4794-a196-0df0b4209ef7
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first unplanned theatre return event for the journey.
        name: UNPLANNED_THEATRE_RETURN_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 657e2c14-9e45-4999-961f-e1e3d9e3272b
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: |-
              CASE WHEN s_PJ_event_40.return_theatre_seq_num = 1 THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff723c5c-ee49-4448-8a7d-0e6371756083
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: THEATRE_CANCELLED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d182df-5d6a-43d1-b611-a5c8481cdf32
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: IFNULL(s_PJ_event_40.theatre_cancelled_flag, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3d474be8-e3a9-48d3-83c8-478e2cc27aff
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Flag indicating whether this is a rehab event i.e. discharge specialty = AT&R.
        name: REHAB_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f49f35ab-0e8d-4eca-b27e-694ecb3dfa13
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d37cafeb-c7c3-49fa-8631-76458e42124c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: IP encounter unique identifier
        name: IP_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26f6d2f3-ac0f-4c1d-b20e-76bf882830d0
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92bb904c-7ff9-46a5-8541-9524d8c9df2d
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ED Encounter unique identifier
        name: ED_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6829e819-4aa7-4710-a0e8-cd11a149ba87
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35fb20d6-42c4-4c6a-8019-6c87bdac4ac3
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Theatre Encounter unique identifier
        name: THEATRE_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e0b66e6-575b-442b-86df-d42ee96f3997
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd44a807-4f52-4f71-b703-4d4b5a460214
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: RADIOLOGY_ACCESSION_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ade9d72-4b0b-4a12-a4bf-bf655ab0d720
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7faf4b43-3c55-43f1-a6f0-d37ba5c86bc8
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(22)
        defaultValue: ""
        description: eOrder_id
        name: RADIOLOGY_EORDER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e07dac52-8917-48a3-a3bf-ae5515b36bf4
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96ce7c30-2ea5-478b-8413-43b2c86ff7c8
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: OP encounter unique identifier
        name: OP_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2beb7cc8-3c7a-4725-804a-d38c09f66282
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 180974f7-73b4-4c52-b77a-8f1fe58cd81d
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers acute theatre events following the first planned (elective) theatre event.
        name: RETURN_THEATRE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 657e2c14-9e45-4999-961f-e1e3d9e3272b
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2621ef5d-f448-424a-98e0-cef8cd8fba05
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Event start date and time e.g. admit time.
        name: EVENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b7330a42-cdf0-4458-862d-4cd84b916f35
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4deb8dd-0a39-4fae-ab24-ca122be93cbf
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time when the event ended e.g. discharge time.
        name: EVENT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4488eb9c-9354-4652-a08f-caac219ba8c3
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 053feab2-6ff8-4e7d-bc49-86300bfd3b41
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'ip event_length_of_stay '
        name: IP_EVENT_LENGTH_OF_STAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 32d07cb8-f9eb-4214-b1d7-0d55bd6e4e61
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 346c7389-1a2a-4a86-b7c2-5a2fb40a0e3e
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Service_Point_Code
        name: IP_ADMIT_WARD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bce66d02-1c8b-4c52-af1b-ce2425514cca
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05f5aeb6-f23a-48eb-a8e7-ee8cc4fad3c7
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Service_Point_Code
        name: IP_DISCHARGE_WARD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d16ab6b-facd-4f4d-8d3c-9418f47eefa7
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba149d8d-1e99-4286-b060-7c0dca23f2f4
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers events for each Rehab event for a journey in event_start_date order.
        name: REHAB_EVENT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 047929a4-c2d3-4b3e-b6ba-14112c86fc05
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ebf709df-8dbe-4714-b4ea-1afeb6c5c97c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Number of rehab events for the journey.
        name: REHAB_EVENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a1f8781-3e02-4fad-9901-470450e826f3
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c6ecfe5-ee8a-4a39-aa18-5ff640254c12
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DRG_FAMILY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc7e1faa-0153-42c0-bb17-2d12a31a0360
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e0f05a1-613b-4e6f-ae79-aa6cf063c7aa
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the event has been clinically coded to a DRG.
        name: CODED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54d58416-b7d9-4dd3-a232-96e6b705d270
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e965435-1583-4de8-a2f1-8cd73fc5631f
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IP_ADMIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 577f5e3a-d0fe-408c-9f49-e57a47dbbf05
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1eddd0d7-2055-495f-a567-8cabfdd20c1d
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DISCHARGE_DESTINATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c40f446-a188-40a4-bf55-32280b2d95ae
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f579a964-23f4-4d23-8853-234a55574e81
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DISCHARGE_METHOD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551b55ac-8205-44e5-a8b5-3e1763700a51
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 63b6ac85-a6cf-44f4-890a-5d8b5dc4899e
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NEXT_EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14a6d4a6-0e3d-478a-afc1-0b315c78ee35
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c52644c4-b5cb-4c8c-b81d-3faf2f7298ef
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NEXT_EVENT_ADMIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e0739267-8093-49e0-aa81-8e65d2d40b9a
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa6c205a-faf3-4b2e-a292-64e6008c7a79
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DAYS_TO_NEXT_EVENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84a515c8-a022-476b-8bab-cd7d82c8128e
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 272ab363-2d6f-4dfb-96c2-1b430c00e7c9
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the last IP event for a journey and there is an acute readmission within 28 days.
        name: ACUTE_READMIT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b4f601a-1d4e-4954-af85-b1c17ce3fdb2
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: |-
              CASE WHEN s_PJ_event_40.event_source = 'IP' AND s_PJ_event_40.journey_source_seq_num = s_PJ_event_40.journey_source_event_count -- Following logic moved to s_in_patient_event_30
              --AND  s_PJ_ip_event.discharge_destination_code NOT IN ('WTH','NSH','MASON','TEATA')
              --AND  s_PJ_ip_event.discharge_method_code      NOT IN ('DT','TAR')
              --AND  s_PJ_ip_event.next_event_admit_type = 'AC' -- Acute
              --AND  s_PJ_ip_event.days_to_next_event   <= 28
              THEN s_PJ_ip_event.acute_readmit_flag
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41bb7655-5165-40d7-b00d-a94846fecd75
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 757a6e1a-6198-4ca1-ad5b-895079eb8c45
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09d79d66-20e0-4f51-944d-58799f820f74
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers referral IDs within a journey so that a distinct list of IDs can be easily selected
        name: REFERRAL_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 757a6e1a-6198-4ca1-ad5b-895079eb8c45
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ROW_NUMBER() OVER(PARTITION BY s_PJ_event_40.patient_NHI, s_PJ_event_40.journey_num, s_PJ_ip_event.referral_encounter_id ORDER BY event_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 353d012d-ecf9-43a1-b6f5-a21bca15aa25
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: WAITLIST_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 876a8c0e-d848-4768-b23e-69b685d65f10
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8ec4ac0-d119-4282-a9fb-40c55a2c73c0
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: NUMERIC(38,4)
        defaultValue: ""
        description: ""
        name: IP_ACTUAL_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 744fc24d-fd72-4bcf-b04a-70101f507a40
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 510b888f-4cb9-4e85-972f-27b93dc6bd03
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: Planned price x purchase unit volume
        name: IP_REVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94675c8e-232b-47be-ab5d-07c201b4d16f
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab8ba93d-594b-4783-9315-7591160e1e8c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_30.admission_specialty_reference_no=dim_admission_specialty.admission_specialty_reference_no
        name: DIM_ADMISSION_SPECIALTY_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87708f20-9aba-454a-924c-ba1b86f0eda5
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56566a98-b35b-422f-a660-2e17f2239285
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_30.admission_ward_reference_no=dim_admission_ward.admission_ward_reference_no
        name: DIM_ADMISSION_WARD_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8650d4d6-eb4f-4e60-8670-341f8e4fd778
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7e8c2df-ff25-44f0-8eb7-7ecbaded5dc6
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_30.discharge_specialty_reference_no=dim_discharge_specialty.discharge_specialty_reference_no
        name: DIM_DISCHARGE_SPECIALTY_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: be40bbce-8ed4-4560-946b-6359d397d7ca
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ad71b81c-2003-49ca-b41b-89455a7b0de5
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_30.discharge_ward_reference_no=dim_discharge_ward.discharge_ward_reference_no
        name: DIM_DISCHARGE_WARD_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19bc67d5-2b80-48e1-ab59-c4323f325782
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe8c5a0a-6d82-4902-88e2-9496e31c1202
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_30.DRG_code=dim_DRG_code.DRG_code  s_in_patient_event_30.CONVERT(varchar(4),dim_discharge_date.discharge_fin_year)=dim_DRG_code.financial_year
        name: DIM_DRG_CODE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c5ffd8b-737e-4dad-a215-a0f072b7e360
                stepCounter: 04791d95-8803-45a7-84f5-7fe19c6545ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7789e72f-214b-47c4-b97c-a163413d8d88
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the event includes a ward stay at a ward flagged as Interim Care.
        name: INTERIM_CARE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b48e503f-17d5-4d5e-9c11-7356245e4644
                stepCounter: e692f39d-3a0e-4d79-8718-4ccc245c7570
            transform: IFNULL(s_PJ_ward_stay.interim_care_flag, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6298ddf6-2d64-4bd7-a39e-620ad621a724
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_attendance_30.treatmentprotocolid=dim_ED_treatment_protocol.treatment_protocol_no
        name: DIM_ED_TREATMENT_PROTOCOL_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5c2c9e0b-2e50-4f6c-85e5-f9f686e9733d
                stepCounter: 1f888c0c-c0bc-4225-aebf-0a0cae18c7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a754c11e-ca70-4be8-bf65-b1bb60e640f0
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TREATMENT_PROTOCOL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8c290fb-1c6a-4190-a5bd-d02440cb88a3
                stepCounter: 1f888c0c-c0bc-4225-aebf-0a0cae18c7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb88282b-27c6-4121-ae5e-b720943dc919
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: NUMERIC(38,4)
        defaultValue: ""
        description: 'Actual cost of the ED event  '
        name: ED_ACTUAL_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1362f5d1-da69-4b4d-b749-c7fb883d3805
                stepCounter: 1f888c0c-c0bc-4225-aebf-0a0cae18c7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d31858c0-a41f-4736-bb18-5af438ebee5c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Flag indicating whether this is an IP rehab event i.e. admission_specialty_level2_code = 'MHSSE'
        name: MH_EVENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f17e4976-01bc-415e-b22b-77e101ac53f9
                stepCounter: cae1b514-79bd-4f7b-b509-f6443b95de8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c54d4a33-eba1-4b30-8377-bf4ab154e828
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: Planned price x purchase unit volume
        name: ED_REVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5a53d09e-2cd6-4f17-a486-c28c945e9530
                stepCounter: 1f888c0c-c0bc-4225-aebf-0a0cae18c7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1be732b-6ee8-4d4d-a509-5cd3a1752a3b
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first specialist outpatient appointment for the journey.
        name: FSA_OUTPATIENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: da129fda-c03e-437b-8a6a-34e2019e0451
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: IFNULL(op1.FSA_flag, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f398439-49fb-4fa8-a840-5fcba63d8431
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: NUMERIC(15,2)
        defaultValue: ""
        description: Cost of FSA (First Specialist Appointment).
        name: COST_FSA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df7cb31f-a6b1-407a-894f-741a714cc753
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: op1.op_actual_cost
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ded7e860-25dc-42e6-b824-7b0bd5a6b39c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: Revenue from the OP FSA event.
        name: REVENUE_FSA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce86cc9d-db45-4e31-a4e7-4cfd68a68db2
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: op1.op_revenue
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c1317de-eb28-4bcb-b81c-d9916ccabfd0
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if this is the first outpatient follow up appointment for the journey.
        name: FIRST_FUP_OUTPATIENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f6aa1d29-060e-42f1-a3df-f2843e2e8306
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: IFNULL(op2.FUP_row_num, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d249868-9e1c-46f5-862c-eacc94b6a352
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: NUMERIC(15,2)
        defaultValue: ""
        description: Cost of outpatient Follow Up appointment.
        name: COST_OP_FUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df7cb31f-a6b1-407a-894f-741a714cc753
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: op2.op_actual_cost
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8e0fe22-4e95-4bac-aae2-73f07ec1af5c
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: Revenue from the outpatient Follow Up appointment.
        name: REVENUE_OP_FUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce86cc9d-db45-4e31-a4e7-4cfd68a68db2
                stepCounter: 94bd545f-efb2-49b0-ae84-d4fe3718383c
            transform: op2.op_revenue
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a233c4e9-bd46-4589-a696-ecb02fd2027e
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: General counter always set to 1.
        name: EVENT_COUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 959b915b-94ab-4559-9222-e5d007bba7ea
          stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PJ_JOURNEY_ID
        join:
          joinCondition: |-
            FROM s_PJ_event_40
              JOIN ds_PJ_journey_id
                ON s_PJ_event_40.patient_NHI = ds_PJ_journey_id.patient_NHI
               AND s_PJ_event_40.journey_num = ds_PJ_journey_id.journey_num
              LEFT OUTER JOIN s_PJ_ip_event
                ON s_PJ_event_40.ip_encounter_id = s_PJ_ip_event.ip_encounter_id
              LEFT OUTER JOIN s_PJ_ward_stay
                ON s_PJ_ip_event.ip_encounter_id = s_PJ_ward_stay.event_encounter_id
              LEFT OUTER JOIN s_PJ_ed_event
                ON s_PJ_event_40.ed_encounter_id = s_PJ_ed_event.ed_encounter_id
              LEFT OUTER JOIN s_PJ_op_event op1
                ON op1.op_encounter_id = s_PJ_event_40.op_encounter_id
               AND op1.FSA_flag = 1
              LEFT OUTER JOIN s_PJ_op_event op2
                ON op2.op_encounter_id = s_PJ_event_40.op_encounter_id
               AND op2.FUP_row_num = 1
        name: S_PJ_EVENT
        noLinkRefs: []
  name: S_PJ_EVENT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
