fileVersion: 1
id: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
name: S_PATIENT_ADDRESSES
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e8cc7b-a56e-4314-a6a8-e2296a638e5c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: iPM patient reference no
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9c788108-3d99-4015-ab62-0cb40ef32ec2
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d2e7694-0e0c-4393-a9bd-02163471cb59
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: iPM address role reference no
        name: ADDRESS_ROLES_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c72425a3-f4f1-4780-9716-1d2f52bdd44e
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d548a88-6198-4ac6-bde4-b61eb9590d0f
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: iPM Address reference no
        name: ADDRESS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35a32990-5a57-46ae-b709-10741415f11f
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_addresses.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 123d4189-946c-476c-a1c6-54d376a54125
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Identifier
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8e25c9-7a3c-446d-b6ba-d91333ebfb6e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd490a6d-72c9-470c-8ef2-b8c4c4043c44
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADDRESS_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3e7428b-08e3-44ee-9500-6eef3740caad
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39d3c6eb-7d08-47f9-92f3-ab5fce433c99
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADDRESS_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 696b3004-a4c2-419e-8aac-1d2f8686f0b3
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e97bbdbc-ae5f-426e-b20f-bf4f0e603c6a
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Y/N for home postal address from IPM.  This is the main address used
        name: HOME_POSTAL_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN ds_pims_addresses.adtyp_code = 'POSTL' AND ds_pims_address_roles.rotyp_code ='HOME' THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2bad901-e567-4a1b-928b-c0ec742e323c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Y/N for if the address is used for correpondence or not. Correspondence address can be different from physical
        name: CORRESPONDENCE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d461515d-938d-40f2-bf33-30d03113082c
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b60d7ba9-6287-4662-98f4-f850d7c66273
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8bb6989f-3b3d-4572-8586-6ead81d9288a
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fcee091e-2c42-45d7-ba1f-f31a778977fb
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 453cfd50-ee1a-410a-b247-84813f63a6b1
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32b01177-e5d3-430d-beda-a8dd5521127b
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0c5a757-c86b-4961-95bd-b1ab201333f4
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e7ea5ef-1ada-478c-8e2b-556ded6efa90
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE4
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 330bb5ea-63e8-475b-9d2d-8bdc890dd3da
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d08909a2-e679-401b-b05b-40c36a017d5d
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: NZ post codes
        name: POST_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3b477d4-aac2-422d-b2b8-7da82c60a880
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: |-
              CASE WHEN IFNULL(ds_pims_addresses.pcode,'') = '' THEN CASE WHEN isnumeric(RIGHT(line4,4))=1 THEN RIGHT(line4,4) END
                          ELSE pcode
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10204b65-147a-4f39-84a6-b3033e2237cb
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: full concatenated address
        name: FULL_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN ds_pims_addresses.line1= 'Unknown'                                                   THEN ds_pims_addresses.line1
                          WHEN ds_pims_addresses.adtyp_code IN('EMAIL', 'PHONE','MOB','NSP','WKTEL','FAX','Other') THEN ds_pims_addresses.line1
                          ELSE reverse(substring(reverse(CASE WHEN LEN(ds_pims_addresses.line1) >1 THEN ds_pims_addresses.line1 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line2) >1 THEN char(13)+char(10)+ ds_pims_addresses.line2 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line3) >1 THEN char(13)+char(10)+ ds_pims_addresses.line3 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line4) >1 THEN char(13)+char(10)+ ds_pims_addresses.line4 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_reference_values.description) >1 THEN char(13)+char(10)+ ds_pims_reference_values.description +', ' ELSE '' END),3,255))
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb1ed9d6-3850-41e4-a795-bc40699e6b8a
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: has the email been validated by intelectia
        name: EMAIL_VALIDATED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbab881d-00cc-4689-a24d-dc4eac20ed5b
                stepCounter: 8132e10c-cb6f-416f-97aa-7dec7177518c
            transform: |-
              CASE WHEN ds_pims_notes.note IS NULL THEN 'N'
                          ELSE 'Y'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45cbe6e2-af5c-4150-a964-b1c2fedad6a5
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_addresses.health_district_code=dim_domicile.domicile_code
        name: DIM_DOMICILE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e049fc8-a2a3-4bad-9b91-11b9d158b35e
                stepCounter: 330ad0aa-b8b1-4da9-ab37-b4fe8f889452
            transform: IFNULL(dim_domicile_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41adf594-930c-473a-9c70-a28e2387af24
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_addresses.address_role_code=dim_patient_address_types.address_role_code  s_patient_addresses.address_type_code=dim_patient_address_types.address_type_code
        name: DIM_PATIENT_ADDRESS_TYPES_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 345b847c-60ac-489e-80a3-559ed166352c
                stepCounter: 253c135f-3cdd-4312-a8be-5004338d594b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d96e931e-f176-408f-8707-826b792517c4
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: HEALTH_DISTRICT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c7022e5-02ee-45d2-a929-8c579c8ba8b0
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: IFNULL(ds_pims_addresses.hdist_code,ds_pims_addresses.domicile_code)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b4636a1-227b-4326-ac32-c6fab1898a9c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: iPM Address start date
        name: ADDRESS_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e5123bc-df23-4587-99aa-3350cd4a14ee
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ba3489c-b83e-4aa5-942c-f95e95181e79
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: iPM Address end date
        name: ADDRESS_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c84861f9-0b38-43e2-9e10-4b7423aed705
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: IFNULL(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f7d7e4ed-3764-4fb7-8bd6-f8a0a59a0c4f
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'row number identifying superseded addresses for a patient '
        name: ADDRESS_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ROW_NUMBER() OVER (PARTITION BY ds_pims_addresses.addss_refno , ds_pims_address_roles.roles_refno ORDER BY coalesce(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm,convert(Datetime,'2044-12-31',120)) DESC, ds_pims_address_roles.Start_Dttm DESC, ds_pims_addresses.addss_refno DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9c9e88e-fe45-421b-b1f6-ef98d87f602d
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: A non 0 value represents as address reference which is another address of the same type valid for part of this addresses date range
        name: ADDRESS_DUPLICATE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1feba94c-f186-4e70-8a3a-de127a83a4df
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(7)
        defaultValue: ""
        description: ""
        name: MESHBLOCK_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ee8f85e-0153-46ad-a54e-065efc45a845
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 701b4bf3-9e9b-487e-96aa-5b6929da964c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,6)
        defaultValue: ""
        description: ""
        name: NZ_GD2K_XCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb35e832-4db4-48f5-a6ce-4a10dac8e938
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 155aed83-852a-4c5f-9a77-24c2527fb78a
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,6)
        defaultValue: ""
        description: ""
        name: NZ_GD2K_YCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d18dc87c-e073-46d6-8bed-6d04d7fae6e6
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcc9210d-0d46-4e3d-a7c1-3a80a7a2e5f9
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,3)
        defaultValue: ""
        description: ""
        name: NZ_MG_XCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c63b6e8b-2c7a-4570-bf4a-ead8f190d383
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e13e43a-30df-49b2-a012-f620dd91c739
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,3)
        defaultValue: ""
        description: ""
        name: NZ_MG_YCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80deead7-e51b-4887-9dd3-664b299fa1b1
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 183246a3-de68-4716-b404-7de1be21f62c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,3)
        defaultValue: ""
        description: ""
        name: NZ_TM_XCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: adf26085-a38f-4c37-98fc-bc4dda9453f9
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02e4623c-b62c-4d6e-8b67-19acdcd8716c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(12,3)
        defaultValue: ""
        description: ""
        name: NZ_TM_YCOORD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0f4fb10-3213-46cf-ac93-dabed340df17
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33844d28-3594-4561-8971-725d0f2d02b9
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c970b4a-beaa-492a-84e2-3ddb3324510a
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a92a8522-1095-4d47-94d5-129f3347ed27
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(2)
        defaultValue: ""
        description: ""
        name: DEPRVN_DECILE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94e0ee34-ff4d-4a10-9e9a-12493b6484b4
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bdaf7867-f244-4d8e-ac51-00fa3a73ae8a
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(1)
        defaultValue: ""
        description: ""
        name: DEPRVN_QUINTILE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e683bfe0-21bd-42ee-9417-d5fc7db77e79
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4da2252d-fc38-4f1a-82ee-e45cb7c9937d
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: NZ_ADDRS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df382dba-2dcf-4b65-ab36-4e5ee5e7a17a
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 766444e9-e266-40bd-beca-c6f940be1c15
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: USER_CREATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 957dfd0f-ef7c-4ef2-9c76-fbe3c6afeec1
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5b57dad-4134-48ea-b80b-54c9fe769f98
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: USER_MODIF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e02397b2-bf5e-49f1-bb46-cccad16bfd96
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a91c6fc5-ee6a-40bb-ba56-177d82e37bed
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_MESH_BLOCKS_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fdd240c-d807-48d9-9238-8c77bb1f9977
                stepCounter: b4916c1c-22ab-49f9-84b3-f35bdd65bb51
            transform: IFNULL(dim_mesh_blocks.dim_mesh_blocks_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59bfb1a9-a78d-4ec0-bbf1-d2cccb95e264
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_addresses.user_modif=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ceaa34a6-dd0b-40fb-bc61-9df93cc05e7b
                stepCounter: bef0768d-dddb-4d02-af8d-03160de42b62
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2553c9a8-7c4b-4e9c-9d25-85468995d2c6
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_addresses.user_create=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dfe5e14-cc2f-4748-8352-a6d1621289af
                stepCounter: 70bd6ed5-e21b-440f-9079-7fe305bc4f30
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fd8e393d-469c-4a5b-a72c-1d5bb7dbf63c
          stepCounter: 71247b66-335b-4dc5-9eb0-5fe1c61c2a26
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_ADDRESS_ROLES
        join:
          joinCondition: |-
            FROM ds_pims_patients
             INNER JOIN ds_pims_address_roles
                ON ds_pims_address_roles.patnt_refno = ds_pims_patients.patnt_refno
               AND ds_pims_address_roles.patnt_refno IS NOT NULL
             INNER JOIN ds_pims_addresses
                ON ds_pims_addresses.addss_refno = ds_pims_address_roles.addss_refno
              LEFT OUTER JOIN l_reference_MOH_Domicile
                ON IFNULL(ds_pims_addresses.hdist_code,ds_pims_addresses.domicile_code) = l_reference_MOH_Domicile.dom
              LEFT OUTER JOIN ds_pims_reference_values
                ON ds_pims_addresses.cntry_refno = ds_pims_reference_values.rfval_refno
              LEFT OUTER JOIN l_reference_MOH_DHB
                ON l_reference_MOH_Domicile.dhb_area = l_reference_MOH_DHB.DHB
              LEFT JOIN ds_pims_note_roles
                ON ds_pims_note_roles.sorce_refno = ds_pims_address_roles.roles_refno
              LEFT JOIN ds_pims_notes
                ON ds_pims_note_roles.notes_refno = ds_pims_notes.notes_refno
               AND note like '%* Verified email Intilecta *%'
               AND sorce_code = 'CNROL'
              LEFT JOIN dim.dim_domicile
                ON IFNULL(ds_pims_addresses.hdist_code,ds_pims_addresses.domicile_code) = dim_domicile.domicile_code
              LEFT JOIN dim.dim_mesh_blocks
                ON ds_pims_addresses.meshblock_id = dim_mesh_blocks.mb_code
               AND dim_mesh_blocks.dss_current_flag ='Y'
        name: S_PATIENT_ADDRESSES
        noLinkRefs: []
  name: S_PATIENT_ADDRESSES
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
