fileVersion: 1
id: 757ba9c1-72e2-418e-97b7-bda73b901e9d
name: S_SHARED_PATIENT_ADDRESS_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 928d2572-9b48-43c4-bd97-2df1d86f7a99
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8793cc07-eb0a-44cb-a83a-439f3d348bed
                stepCounter: 7872d04b-3d80-4b03-b6eb-330a43d36fb7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be7963fa-c36a-49d6-9aee-af357a3f0469
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADDRESS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 476f9790-914b-4b3b-b2f8-4fe1e997179c
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8e25c9-7a3c-446d-b6ba-d91333ebfb6e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b983a27-059c-4de2-8dda-1ae61424da4f
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADDRESS_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3e7428b-08e3-44ee-9500-6eef3740caad
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 544ef152-e340-43de-837c-4c704d764f4c
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADDRESS_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 696b3004-a4c2-419e-8aac-1d2f8686f0b3
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06b48613-d081-4e92-b842-79f19f228bc5
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8bb6989f-3b3d-4572-8586-6ead81d9288a
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b6bd527-0308-41dc-8f7f-aaf5f0f24a3e
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 453cfd50-ee1a-410a-b247-84813f63a6b1
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae2f4c79-d541-4e7b-a624-c607e8c668a0
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0c5a757-c86b-4961-95bd-b1ab201333f4
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9bc0c06e-4794-4099-b65d-21729f477254
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE4
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 330bb5ea-63e8-475b-9d2d-8bdc890dd3da
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a522e07f-6008-4254-8ad8-fcac8cbda864
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: full concatenated address
        name: FULL_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN ds_pims_addresses.line1= 'Unknown' THEN ds_pims_addresses.line1
                          ELSE reverse(substring(reverse(CASE WHEN LEN(ds_pims_addresses.line1) >1 THEN ds_pims_addresses.line1 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line2) >1 THEN char(13)+char(10)+ ds_pims_addresses.line2 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line3) >1 THEN char(13)+char(10)+ ds_pims_addresses.line3 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line4) >1 THEN char(13)+char(10)+ ds_pims_addresses.line4 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_reference_values.description) >1 THEN char(13)+char(10)+ ds_pims_reference_values.description +', ' ELSE '' END),3,255))
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f1cfb48-35c8-499e-a76a-c99b1bf4edf3
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PHONE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9940779c-443a-426d-a965-0028c0484de7
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MOBILE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fabde74e-1750-49fe-b359-76238ed7b895
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: ""
        name: SUBURB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8229d9e-09d3-4574-a4f5-3dd205a77035
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d729505c-86bb-4e77-b45c-7e87ed1001a9
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: STATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5726d95e-e2ec-4dea-936f-3e36a44bce6e
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b5d3ade-3098-4de3-841f-0e2b3050a867
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: POSTAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3b477d4-aac2-422d-b2b8-7da82c60a880
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a977901-2a9f-46b8-917f-79524e64d585
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: HEALTH_DISTRICT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c7022e5-02ee-45d2-a929-8c579c8ba8b0
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: IFNULL(ds_pims_addresses.hdist_code,ds_pims_addresses.domicile_code)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57a0e626-aa91-4ead-ba01-26b93bc0635a
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: COUNTRY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7560b322-aaae-4c98-8562-27d49e74be8a
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: COUNTRY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a96d9187-b723-41f4-ac50-7bdb567c605b
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PLACE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2adc772a-c730-46de-81c3-c8113dfd734e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b21f7040-aa4a-4bca-8298-5c77213f8a9a
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 228515a1-a04c-4089-8463-ad2aea6791b9
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2aade7e-82e3-4d84-b8a2-0ae7dcd820f9
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: DOMICILE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5526f9a-56b1-4fe2-98c8-4cdb04552ef7
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 728a5be2-998a-4a6c-82c6-16f787e013da
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: AREA_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cce74d16-f8f6-4643-9e24-29f3606fce08
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88fae115-4907-4f10-96fd-22cfe3409b63
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DHB_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa344fa3-6f40-447f-ab93-2a6ee7acb706
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44ad1769-4729-4bec-a1a2-89d4358bc837
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DHB_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16f045c7-434a-46c8-a665-3fc0a2548bdb
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5f33260-ed6e-4dd1-98cb-667f43f6e0cb
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IDF_CLASS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a79a624-9887-413a-8dca-b782f6327b11
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a704abb-5413-46c3-bf99-0d789b98b8f6
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 82be67f2-583e-4594-8b88-a0e1dbdd779b
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc40a098-f7c3-4c84-b1ae-e6fb6d06b0b2
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NORTHERN_REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1181fb2-83bc-476d-976d-34ce55cc7a2c
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 714491bb-f8fc-471c-b9be-31057f990ded
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADDRESS_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e5123bc-df23-4587-99aa-3350cd4a14ee
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 543ad42b-f29b-4cee-86ad-6bf759f2108a
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADDRESS_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c84861f9-0b38-43e2-9e10-4b7423aed705
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: IFNULL(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 63ab4a90-f91a-4b8f-b425-84485360a3da
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'row number identifying superseded addresses for a patient '
        name: ADDRESS_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ROW_NUMBER() OVER (PARTITION BY ds_pims_address_roles.patnt_refno ,ds_pims_address_roles.rotyp_code ORDER BY coalesce(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm,convert(datetime,'2044-12-31',120)) DESC, ds_pims_address_roles.Start_Dttm DESC, ds_pims_addresses.addss_refno DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ecd7891-ba8f-41e5-9cb4-ddb1c69f0bc0
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'row number identifying duplicated addresses (multiple address-roles) for a patient '
        name: ADDRESS_DUP_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ROW_NUMBER() OVER (PARTITION BY ds_pims_address_roles.patnt_refno, ds_pims_address_roles.addss_refno ORDER BY ds_pims_address_roles.addss_refno DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe0b9664-fb49-454e-bc7f-3c36a8952101
          stepCounter: 757ba9c1-72e2-418e-97b7-bda73b901e9d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_SHARED_PATIENT_ADDRESS_10
        join:
          joinCondition: |-
            FROM s_shared_patient_address_10
              JOIN ds_pims_patients
                ON s_shared_patient_address_10.patnt_refno = ds_pims_patients.patnt_refno
             INNER JOIN ds_pims_address_roles
                ON ds_pims_address_roles.patnt_refno = ds_pims_patients.patnt_refno
               AND ds_pims_address_roles.patnt_refno IS NOT NULL
             INNER JOIN ds_pims_addresses
                ON ds_pims_addresses.addss_refno = ds_pims_address_roles.addss_refno
               AND ds_pims_addresses.adtyp_code = 'POSTL'
              LEFT OUTER JOIN l_reference_MOH_Domicile
                ON ds_pims_addresses.hdist_code = l_reference_MOH_Domicile.dom
              LEFT OUTER JOIN ds_pims_reference_values
                ON ds_pims_addresses.cntry_refno = ds_pims_reference_values.rfval_refno
              LEFT OUTER JOIN l_reference_MOH_DHB
                ON l_reference_MOH_Domicile.dhb_area = l_reference_MOH_DHB.DHB
        name: S_SHARED_PATIENT_ADDRESS_20
        noLinkRefs: []
  name: S_SHARED_PATIENT_ADDRESS_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
