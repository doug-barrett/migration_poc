fileVersion: 1
id: 81be095d-925b-4c84-a8af-f849ace73472
name: S_PIMS_PATIENT_GP_CARERS_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b505b3c-0aa5-46d7-b36a-686525ed8755
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a5633fb-77de-4296-9c31-ce6c99b07d32
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96028361-e141-4ede-8f15-c5fce9998d6b
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0457991-2802-4bfd-9606-d0c5a5ff3cd4
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8daf146-159d-4ec2-bcc0-16664a5cefd8
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: HEORG_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7713534a-306b-488f-b14a-c4c33c1f6b64
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a55ca2c-e8d3-4268-bf6a-db7d88d04246
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: START_DTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64fa1410-2820-487a-ac19-3750ce9ddecd
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca85574b-2e47-47db-a473-a029cb1fe318
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: END_DTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1b8fe02-99cb-4bcd-9288-5a87a8921870
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c641136-4b91-4497-8c58-bc9d152e6952
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: PRTYP_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 133ae46d-cb86-40a7-bb03-62683342a697
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SURNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a82855bb-aaf9-4f64-b3dd-7bd7905c1405
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f65f709-fdf9-4c02-9694-144ca82c8dd1
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: FORENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc6c938c-a71b-499a-9c59-c8a0d4f294b6
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b68728a-bb04-4a24-af0d-2615f8a30fc0
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PROF_CARER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a31e93e5-0e58-40b1-ab6f-655612c6ddc6
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: MAIN_IDENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02370e0f-eb58-45d0-a9a5-c2b7ac3886a1
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f91d9502-9ee0-48fe-84b2-a9f7a7ab20f6
          stepCounter: 81be095d-925b-4c84-a8af-f849ace73472
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_PIMS_PROF_CARERS: d42ee6db-29e1-4d7b-88a3-e45c058528e1
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PATIENT_PROF_CARERS
          - locationName: TGT
            nodeName: DS_PIMS_PROF_CARERS
        join:
          joinCondition: |-
            FROM (
                    SELECT row_number() over(PARTITION BY proca_refno,patnt_refno,Start_Dttm ORDER BY IFNULL(end_dttm,getdate()) DESC) rncnt ,
                           proca_refno,
                           patnt_refno,
                           prtyp_refno,
                           heorg_refno,
                           start_dttm,
                           end_dttm
                      FROM ds_pims_patient_prof_carers
                     WHERE prtyp_refno = 4054
                       AND ds_pims_patient_prof_carers.archv_flag = 'N'
                   ) ds_pims_patient_prof_carers
              JOIN [dbo].[ds_pims_reference_values]
                ON ds_pims_patient_prof_carers.PRTYP_REFNO = ds_pims_reference_values.rfval_refno
              JOIN {{ ref('TGT','DS_PIMS_PROF_CARERS') }}
                ON ds_pims_patient_prof_carers.PROCA_REFNO = ds_pims_prof_carers.proca_refno /*and ds_pims_prof_carers.archv_flag = 'N'*/
             WHERE 1 = 1
               AND ds_pims_patient_prof_carers.rncnt = 1
        name: S_PIMS_PATIENT_GP_CARERS_10
        noLinkRefs: []
  name: S_PIMS_PATIENT_GP_CARERS_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
