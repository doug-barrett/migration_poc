fileVersion: 1
id: 54d16b29-357f-44cb-add6-3fc9e48f1900
name: S_PATIENT_ADDRESS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3168b25-cb30-4c83-a789-50232c7bbc01
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9c788108-3d99-4015-ab62-0cb40ef32ec2
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06b3f0e1-03aa-4e62-b298-599c37aeaa4b
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADDRESS_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb16ef77-db88-4448-90ce-68d8f174301a
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8e25c9-7a3c-446d-b6ba-d91333ebfb6e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18cf83d3-716e-44ae-a901-d09aa44fd674
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADDRESS_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3e7428b-08e3-44ee-9500-6eef3740caad
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc5c19d6-40ac-4657-b87f-97b63495b556
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADDRESS_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 696b3004-a4c2-419e-8aac-1d2f8686f0b3
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 465f5e24-9c8b-4f23-8990-274bb1abc81d
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8bb6989f-3b3d-4572-8586-6ead81d9288a
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5630c13-698a-40cc-9d61-d435d8b65431
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 453cfd50-ee1a-410a-b247-84813f63a6b1
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f33342a7-29d4-42db-bd84-6d730ed276c1
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0c5a757-c86b-4961-95bd-b1ab201333f4
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd78a8a9-40e7-4876-8216-bc7dacf27ffe
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ADDRESS_LINE4
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 330bb5ea-63e8-475b-9d2d-8bdc890dd3da
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5f7166f-eade-4c70-82db-a1cdf3f220b7
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: full concatenated address
        name: FULL_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN ds_pims_addresses.line1= 'Unknown' THEN ds_pims_addresses.line1
                          ELSE reverse(substring(reverse(CASE WHEN LEN(ds_pims_addresses.line1) >1 THEN ds_pims_addresses.line1 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line2) >1 THEN char(13)+char(10)+ ds_pims_addresses.line2 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line3) >1 THEN char(13)+char(10)+ ds_pims_addresses.line3 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_addresses.line4) >1 THEN char(13)+char(10)+ ds_pims_addresses.line4 + ', ' ELSE '' END + CASE WHEN LEN(ds_pims_reference_values.description) >1 THEN char(13)+char(10)+ ds_pims_reference_values.description +', ' ELSE '' END),3,255))
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a8410a6-c869-4928-8a7a-01e960a535d5
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PHONE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72e6ce00-ccbe-4368-b00c-17e34f61ac74
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MOBILE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 71e3e7c4-5700-4257-bebb-8fb0056ba749
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: ""
        name: SUBURB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8229d9e-09d3-4574-a4f5-3dd205a77035
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c550e71-958d-4944-9444-532809d2ea98
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: STATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5726d95e-e2ec-4dea-936f-3e36a44bce6e
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f21a6ccb-109c-42db-83a5-cb29c3388f3e
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: POSTAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3b477d4-aac2-422d-b2b8-7da82c60a880
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aaf20f7f-ab20-4840-a12e-067947f91786
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: HEALTH_DISTRICT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c7022e5-02ee-45d2-a929-8c579c8ba8b0
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: IFNULL(ds_pims_addresses.hdist_code,ds_pims_addresses.domicile_code)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88ca8772-42bb-48fc-8b32-06d7d0ee3448
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: COUNTRY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ae6eed6-d3fa-4c1c-93a9-ab6005f24797
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: COUNTRY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 063d55f0-c4d9-49ac-b240-41d46837d765
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PLACE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2adc772a-c730-46de-81c3-c8113dfd734e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc546f83-e620-4c91-8f01-894316dcd366
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 228515a1-a04c-4089-8463-ad2aea6791b9
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0ed5061-c71b-448e-bb59-4facac42ed41
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: DOMICILE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5526f9a-56b1-4fe2-98c8-4cdb04552ef7
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a65e9ca-1c78-49d3-938d-02c86f1ac1b6
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: AREA_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cce74d16-f8f6-4643-9e24-29f3606fce08
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4091d7b-5e99-4d51-8dac-d4048c1d5426
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DHB_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa344fa3-6f40-447f-ab93-2a6ee7acb706
                stepCounter: 283949d0-53d0-4de1-a6c2-eb2852c50f7d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe975f65-f1b1-4b72-b5df-e34a1915e6b6
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DHB_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16f045c7-434a-46c8-a665-3fc0a2548bdb
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f31af318-cba7-47f7-95df-e0ad79d4cefd
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IDF_CLASS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a79a624-9887-413a-8dca-b782f6327b11
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3f06ced-0d3e-4a62-b258-bb91eb4d18a7
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 82be67f2-583e-4594-8b88-a0e1dbdd779b
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8a26ce2-caf8-4df5-b55a-d3cb71f3cd78
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NORTHERN_REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1181fb2-83bc-476d-976d-34ce55cc7a2c
                stepCounter: 8e1da246-e978-4769-84e6-56526d77064b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e06655e-595b-4f95-8da8-3d1d342563e2
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADDRESS_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e5123bc-df23-4587-99aa-3350cd4a14ee
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0891a387-0240-4fd5-810c-8c4558c73e4e
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADDRESS_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c84861f9-0b38-43e2-9e10-4b7423aed705
                stepCounter: 17a52a7d-2ccd-4765-b3e4-a487475f5348
            transform: IFNULL(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60e48ad0-2165-48a0-8bb3-a1cd7889009b
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'row number identifying superseded addresses for a patient '
        name: ADDRESS_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ROW_NUMBER() OVER (PARTITION BY ds_pims_address_roles.patnt_refno ,ds_pims_address_roles.rotyp_code ORDER BY coalesce(ds_pims_addresses.end_dttm,ds_pims_address_roles.end_dttm,convert(datetime,'2044-12-31',120)) DESC, ds_pims_address_roles.Start_Dttm DESC, ds_pims_addresses.addss_refno DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46dcc911-4d5c-489e-82d3-4227af28c7fa
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'row number identifying duplicated addresses (multiple address-roles) for a patient '
        name: ADDRESS_DUP_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7a3c3ea-3dd1-43cf-841d-061b10a163a5
                stepCounter: e952df2a-b46c-4e7e-a0d9-796e3d1da26d
            transform: ROW_NUMBER() OVER (PARTITION BY ds_pims_address_roles.patnt_refno, ds_pims_address_roles.addss_refno ORDER BY ds_pims_address_roles.addss_refno DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 62708bbd-fb96-457c-95ca-587456639347
          stepCounter: 54d16b29-357f-44cb-add6-3fc9e48f1900
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_ADDRESS_ROLES
        join:
          joinCondition: |-
            FROM ds_pims_patients
             INNER JOIN ds_pims_address_roles
                ON ds_pims_address_roles.patnt_refno = ds_pims_patients.patnt_refno
               AND ds_pims_address_roles.patnt_refno IS NOT NULL
             INNER JOIN ds_pims_addresses
                ON ds_pims_addresses.addss_refno = ds_pims_address_roles.addss_refno
               AND ds_pims_addresses.adtyp_code = 'POSTL'
              LEFT OUTER JOIN l_reference_MOH_Domicile
                ON ds_pims_addresses.hdist_code = l_reference_MOH_Domicile.dom
              LEFT OUTER JOIN ds_pims_reference_values
                ON ds_pims_addresses.cntry_refno = ds_pims_reference_values.rfval_refno
              LEFT OUTER JOIN l_reference_MOH_DHB
                ON l_reference_MOH_Domicile.dhb_area = l_reference_MOH_DHB.DHB
        name: S_PATIENT_ADDRESS
        noLinkRefs: []
  name: S_PATIENT_ADDRESS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
