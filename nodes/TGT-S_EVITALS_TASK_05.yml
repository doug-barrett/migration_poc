fileVersion: 1
id: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
name: S_EVITALS_TASK_05
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Link tasks to observation sets.  Uses parameter eVitals_task_observation_diff to find observation sets timed within a certain number of seconds of the task date."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00c9daf8-20b1-48a9-97a6-45119b20c7a3
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADMISSION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: db46d691-c958-40a8-91e1-8d07c2fa1fd4
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4eedfed6-5793-40c6-bf2d-0f6606025d09
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: TASK_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77816af4-aa7a-405c-aaee-cf1bf08ef86a
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02e11c2d-c960-42ab-8715-0388abdc5397
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99ed499f-5378-4068-9e29-644db0980ef3
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5697bdb8-fba9-4f67-994b-9cdfbc1aed0f
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77816af4-aa7a-405c-aaee-cf1bf08ef86a
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ROW_NUMBER() OVER(PARTITION BY task_pk ORDER BY ABS(DATEDIFF(SS, s_eVitals_observation_set_hist.observation_taken_date_utc, ds_Patientrack_TASK.due_dttm)))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6818ba55-b9e3-45e7-9f66-6384e67ed169
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3ffeeeb8-e1c5-497b-9c8d-52d923c93366
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6231fd8-8d73-43c4-b985-57ab9d256d19
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: UTC Date and time when the observation measure was taken.
        name: OBSERVATION_TAKEN_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 86610885-e796-47c6-9daf-d79445216b4b
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc72454a-fe7f-4261-9fd1-ff7e5ad50ac0
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: 'UTC Date and time when the observation measure was taken. '
        name: OBSERVATION_TAKEN_DATE_UTC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d334e5c-975d-402d-a41a-c381a456be15
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 83f82cbd-3bad-4407-8a03-3e02a95b4a83
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Number of seconds between task_completed_date and observation_taken_date.
        name: TASK_OBSERVATION_DIFF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 86610885-e796-47c6-9daf-d79445216b4b
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ABS(DATEDIFF(SS, s_eVitals_observation_set_hist.observation_taken_date_utc, ds_Patientrack_TASK.due_dttm))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c45c0b8-08db-40c6-94fa-cb41f7113de3
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers observation sets linked to each task so that only 1 row per task can be easily selected.
        name: OBSERVATION_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3ffeeeb8-e1c5-497b-9c8d-52d923c93366
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ROW_NUMBER() OVER(PARTITION BY ds_Patientrack_TASK.task_pk ORDER BY ABS(DATEDIFF(SS, s_eVitals_observation_set_hist.observation_taken_date_utc, ds_Patientrack_TASK.due_dttm)))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01786d57-b405-4ff1-9a6a-32aa58a0ce5c
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: INT
        defaultValue: ""
        description: ID of the latest version for this observation set.
        name: CURRENT_OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9d35e0fd-cc5b-4190-b75d-5c72069a2eb8
                stepCounter: 2e14848e-f345-46e7-a979-de9f31d41803
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1e9d3aa-e5fc-41db-ac89-200e3b6977a7
          stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PATIENTRACK_TASK
        join:
          joinCondition: |-
            FROM ds_Patientrack_TASK
              JOIN s_eVitals_observation_set_hist
                ON s_eVitals_observation_set_hist.admission_id = ds_Patientrack_TASK.ADMSN_PK
               AND ABS(DATEDIFF(MI, s_eVitals_observation_set_hist.observation_taken_date_utc, ds_Patientrack_TASK.due_dttm)) <= @v_eVitals_task_observation_diff
        name: S_EVITALS_TASK_05
        noLinkRefs: []
  name: S_EVITALS_TASK_05
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
