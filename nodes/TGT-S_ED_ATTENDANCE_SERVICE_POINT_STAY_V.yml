fileVersion: 1
id: 22b54c70-6db5-4104-adc6-3c0a960bb844
name: S_ED_ATTENDANCE_SERVICE_POINT_STAY_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2acec465-1e12-4d9a-a6b7-61a710ff7547
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ATTENDANCE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d33d871-7765-4386-a643-187e0f0f75d4
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: patient_reference_no
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ef214fd-7d8c-46f3-8baa-2a34d002ad6c
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: patient_NHI
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b15d240d-297e-45a4-837e-3073979c549f
                stepCounter: 02d90952-09d5-4a28-bbbc-fb2a26f5811d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a416daa-a804-4762-9502-1c8bb9ec8122
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCHARGE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57955302-cc68-4028-894f-303013717051
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: STAY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db6e2da4-94ad-488d-8189-d67a1577f5d9
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: stay_end_date
        name: STAY_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be485588-e0ba-40a8-a63a-ae13d389a0e0
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: attendance_duration
        name: ATTENDANCE_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f8b0b63-0e57-4f52-8282-cd96f7a54a71
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: stay_duration
        name: STAY_DURATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15e33c39-4588-45c9-bd1a-395f33762f8c
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ATTENDANCE_SERVICE_POINT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72bb150b-ec57-4bc0-ae9f-ad301a60d222
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ATTENDANCE_SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90ab12fb-be4e-4150-8c00-6c14c2e6bf86
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28d1ad26-d059-4c28-9344-de23fe14879c
          stepCounter: 22b54c70-6db5-4104-adc6-3c0a960bb844
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: row_count
        name: ROW_COUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT a.aeatt_refno attendance_reference_no,
                   a.patnt_refno patient_reference_no,
                   a.patient_nhi patient_nhi,
                   a.departed_date attendance_discharge_date,
                   s.start_dttm stay_start_date,
                   s.end_dttm stay_end_date,
                   DATEDIFF(mi, s.start_dttm, a.departed_date) attendance_duration,
                   DATEDIFF(mi, s.start_dttm, s.end_dttm) stay_duration,
                   s.spont_refno attendance_service_point_reference_no,
                   p.service_point_code attendance_service_point_code,
                   ROW_NUMBER() OVER(PARTITION BY a.aeatt_refno ORDER BY s.start_dttm) row_num,
                   COUNT(1) OVER (PARTITION BY a.aeatt_refno) ROW_COUNT
              FROM s_ed_attendance_10 a
              JOIN ds_pims_service_point_stays s
                ON a.patnt_refno = s.patnt_refno
              LEFT OUTER JOIN dim.dim_service_point p
                ON s.spont_refno = p.service_point_reference_no
               AND s.start_dttm BETWEEN p.dss_start_date AND p.dss_end_date
             WHERE ABS(DATEDIFF(mi, s.start_dttm, IFNULL(a.departed_date,GETDATE()))) <= 360
        dependencies:
          - locationName: TGT
            nodeName: S_ED_ATTENDANCE_10
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','S_ED_ATTENDANCE_10') }}
        name: S_ED_ATTENDANCE_SERVICE_POINT_STAY_V
        noLinkRefs: []
  name: S_ED_ATTENDANCE_SERVICE_POINT_STAY_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
