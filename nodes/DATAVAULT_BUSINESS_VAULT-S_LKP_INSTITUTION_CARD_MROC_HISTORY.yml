fileVersion: 1
id: 60cbd0a2-89f9-468b-ade5-0af82e226def
name: S_LKP_INSTITUTION_CARD_MROC_HISTORY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 902d34f0-c4be-4d55-aab9-346c2e4f68f9
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_LKP_INSTITUTION_CARD
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 91d2de4f-30a2-44b1-998d-3d5c92634663
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f047847d-cb86-4533-8c3e-eff0713bce31
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: CRD_TYP_CDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8af23fe-ca88-4429-8a15-a5bc4c213c81
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 919f4d15-313f-4567-8859-224b9d8badc7
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: FILLER_1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbce5c7d-847c-4f60-bbab-205190c9acfc
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1fffc2f2-2880-4c5a-a1d3-563c4bd0800b
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: ITN_IDN_CDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0483e15e-4813-43a5-a6b5-c8386f3bd1e6
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2535566-2724-4c2a-ad31-e927b6a371bd
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CRD_TYP_TXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: be84bf2a-bbde-46e9-93ef-df3fca0df8cd
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb5f4ab1-85f5-48ec-8929-a24d6b66d8a2
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: LST_UPD_DTE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f257f94-cb41-49c8-a0e7-818dd4235443
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae0ec504-2844-4081-9e23-e39940a0ed73
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LST_UPD_TME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b401719d-52e6-4811-9bec-c3396264d78c
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b57c241-5c8a-4da6-ab77-354279a8e8cf
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LST_UPD_UID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2fc991c8-08a1-4a7c-b468-a6210adab995
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0617006-0e56-459e-93bf-269332d91098
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        name: LST_UPD_NBR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93d9988b-c475-433a-8fad-f5b637db7a8b
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2bb11bbf-06b4-4075-8260-6fa7108f3efd
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: CREATED_BY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e8c07d6-d43b-48a6-9f81-1c1303277f4f
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e475c185-1cbf-4be5-a4e0-b54e2c0231fb
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: CREATED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bcd1b243-e539-4fc8-b230-157ab7486cd6
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 04cc29bb-ae7d-448b-b4fe-9db9fc118a09
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: UPDATED_BY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 91ce62f5-eccf-42b1-ad4a-da501c7746df
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffa84535-b346-4dc1-8a46-4f703662ae01
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: UPDATED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e4c271e3-6f90-4a64-a7d3-9a2dc74eec82
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35eea0bd-5fca-4182-835c-2b783a6d9166
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(500)
        defaultValue: ""
        description: ""
        name: RUN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1d49a49-fbdc-47f3-8909-8a72ef6e5e1f
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2ecd03f-f9a2-46a5-be11-341ec736dbf1
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP_NTZ(3)
        defaultValue: ""
        description: ""
        name: FILE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d754e461-a43f-46cf-ae3f-de42c3b96213
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87d80178-6d75-4ae9-b52c-a16608c91d41
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1960a31b-d0c4-40ca-85b3-0db296a62e36
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 909b292f-1c5b-4e28-838f-9bb66416e3b5
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 415e1a18-f378-4d4b-8561-8c7f07dacf8f
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d708d0ab-33b6-45a8-96ae-2d513de05733
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1d15ec9-d2d7-474b-bff6-0eed27ad4801
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1abd05f0-6e9f-4a63-b5a0-5b053e77adfa
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ddd37408-f02e-4a4e-ba2e-90b7a2132eb3
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9dd7824-418b-4042-80de-f5455d04c99a
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e41ea7a3-5069-4442-9ae4-688dc7fdaeff
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19049d9b-efde-4d4f-bd15-8d1a6bc8e796
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c04a4b2-0807-48d7-887b-1b5969a60705
                stepCounter: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b0848c4-06e2-4a79-a8d7-0c58d771672b
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: End date determined by the next Satellite change record dss_start_date
        isSystemEndDate: true
        name: DSS_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LEAD(dss_start_date, 1, '9999-12-31') OVER(PARTITION BY hk_h_lkp_institution_card ORDER BY dss_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27aaef98-22f6-4c71-b9ce-4c618f061ac0
          stepCounter: 60cbd0a2-89f9-468b-ade5-0af82e226def
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: CurrentFlag 'N' unless next Satellite change record dss_start_date is null, indicating this is the most current record.
        isSurrogateKey: true
        isSystemCurrentFlag: true
        name: DSS_CURRENT_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN LEAD(dss_start_date, 1, NULL) OVER(PARTITION BY hk_h_lkp_institution_card ORDER BY dss_start_date) IS NULL THEN 'Y'
                          ELSE 'N'
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_LKP_INSTITUTION_CARD_MROC: 787c8bc4-9d29-4142-bc7b-1902deee5fc9
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_LKP_INSTITUTION_CARD_MROC
        join:
          joinCondition: FROM {{ ref('DATAVAULT_RAW_VAULT','S_LKP_INSTITUTION_CARD_MROC') }} s_lkp_institution_card_mroc
        name: S_LKP_INSTITUTION_CARD_MROC_HISTORY
        noLinkRefs: []
  name: S_LKP_INSTITUTION_CARD_MROC_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
