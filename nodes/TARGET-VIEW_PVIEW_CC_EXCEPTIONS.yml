fileVersion: 1
id: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
name: VIEW_PVIEW_CC_EXCEPTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 217e88c8-ce88-4261-a239-983f91379695
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PV_IDREC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6b6e1d74-6828-42ae-b9d7-69ba4615f389
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a00e2d1-d403-481e-ae37-5158318e5b7a
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_UNIT_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9e45b75-8378-4fd7-9c3e-10eaca2bddf8
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25b88f94-7e72-4cc4-8c10-2e1eae725523
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_UNIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c782268-8df2-41ae-876c-11b3d971c218
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8077466-cd0b-4d7c-a7e7-f23a8821fa3a
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_UNIT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f75d0477-b788-4a89-9984-40d511064c9e
                stepCounter: 0402e5d5-a477-4a25-94e9-bfb8097c1816
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 683aecb0-255d-403d-bf1e-3f7a170db679
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_NETWORK_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 045a9301-baae-4abc-82d5-5c73167f2797
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e37058b2-faff-4e92-891e-81a684775ba6
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_CC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d37f47d0-ca23-4e9a-9442-6d4c7f467ae9
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b9bda3c-0388-49ce-ac82-cf2354e00aff
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_CC_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd3e1556-ef81-493c-9720-e488c74447ce
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b053e821-78e5-49c6-bdd9-b5dfd2102713
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_DIVISION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1779ea8-be06-43ed-a285-b7e2f5cf34bf
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 131ed03a-f7bf-47c9-bef5-e06beb5085c9
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_DISTRICT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c9cf7ea6-340c-4b7d-9dd9-6f55a9da5f4a
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c1d9ba5-7013-482c-9a82-fefd0ad946bd
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7fe1a76-e16c-4253-9cef-5607e7315e56
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6cd98534-f59e-467d-8f56-f486985e5058
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_FIELD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85500cd7-4fed-41cc-9f74-0057b082bae7
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd5b0f55-40b0-4bcf-8ef5-787b7dc89eb4
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: SAP_CC_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29722a03-29be-40ea-86d4-b02403f924a2
                stepCounter: 99b4a618-454e-46de-874d-ad30b4d42108
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cda19168-b2cd-4199-9219-4c565d858148
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: ""
        name: SAP_CC_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f423b95-97ef-4fa8-b931-4afdbec33830
                stepCounter: 99b4a618-454e-46de-874d-ad30b4d42108
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9f2b7a2-3267-4998-966f-8e68cbe50586
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(55)
        defaultValue: ""
        description: ""
        name: SAP_PV_CC_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f423b95-97ef-4fa8-b931-4afdbec33830
                stepCounter: 99b4a618-454e-46de-874d-ad30b4d42108
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2076cc7-b116-4232-bcde-8d61c5cafd07
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_COUNTRY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 056a7ce0-cfc1-48b9-a5fc-02a0fe107682
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32721dfc-8424-411f-9f37-e05badb8d3eb
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_PROV_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7c08b94-a01d-4313-a313-3f96d8c0798f
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8720dc11-3669-4852-a854-bbf8fd50679c
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_COREAREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 619126d9-0cd3-45df-bfbd-2f5dca6da0bd
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4859656-92de-4f95-95da-6f997139f408
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_AREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec8da7e4-2ee4-4296-8f0a-7c334356d71e
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c374900-81b9-474d-9a9e-40e2ea43abf6
          stepCounter: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: SAP_PV_UNIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d8a49a2-8399-4422-8f4d-adc0d3daa07c
                stepCounter: 99b4a618-454e-46de-874d-ad30b4d42108
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_CC_EXCEPTIONS: 64321b69-e4f4-4a43-bcd1-dfbb2d391fac
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_CC_EXCEPTIONS') }} (PV_IDREC, PV_UNIT_NAME, PV_UNIT_TYPE, PV_UNIT_STATUS, PV_NETWORK_NAME, PV_CC, PV_CC_NAME, PV_DIVISION, PV_DISTRICT, PV_AREA, PV_FIELD, SAP_CC, SAP_CC_NAME, SAP_PV_CC_NAME, SAP_COUNTRY, SAP_PROV, SAP_COREAREA, SAP_AREA, SAP_PV_UNIT_TYPE) AS SELECT PVU.IDREC AS PV_IDREC,
                   PVU.NAME AS PV_UNIT_NAME,
                   PVU.TYPPA AS PV_UNIT_TYPE,
                   PVUCS.STATUS AS PV_UNIT_STATUS,
                   PVF.NAME AS PV_NETWORK_NAME,
                   PVU.COSTCENTERIDA AS PV_CC,
                   PVU.UNITIDPA AS PV_CC_NAME,
                   PVU.division AS PV_COUNTRY,
                   PVU.district AS PV_PROV,
                   PVU.area AS PV_COREAREA,
                   PVU.FIELD AS PV_AREA,
                   DCC.CC_NUM AS SAP_CC_NUM,
                   DCC.CC_NAME AS SAP_CC_NAME,
                   DCC.CC_NAME || ' (' || DCC.CC_NUM || ')' AS SAP_PV_CC_NAME,
                   DCCH.COUNTRY_NAME AS SAP_COUNTRY,
                   DCCH.PROV_NAME AS SAP_PROV,
                   DCCH.COREAREA_NAME AS SAP_COREAREA,
                   DCCH.AREA_NAME AS SAP_AREA,
                   DECODE(SUBSTR(DCC.CC_TYPE_CODE,1,1),'C','Yes','No') SAP_PV_UNIT_TYPE
              FROM DS_PRODVIEW.PVT_PVUNIT PVU
              LEFT JOIN DS_PRODVIEW.PVT_PVFLOWNETHEADER PVF
                ON PVU.IDFLOWNET = PVF.IDFLOWNET
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMP PVUC
                ON PVU.IDFLOWNET = PVUC.IDFLOWNET
               AND PVU.IDREC = PVUC.IDRECPARENT
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPSTATUS PVUCS
                ON PVUC.IDFLOWNET = PVUCS.IDFLOWNET
               AND PVUC.IDREC = PVUCS.IDRECPARENT
              LEFT JOIN BI_LEASE_OPS.DIM_COST_CENTER_SAP DCC
                ON PVU.COSTCENTERIDA = DCC.CC_NUM
              LEFT JOIN BI_LEASE_OPS.DIM_CC_CORP_HIER_CURRENT_SAP DCCH
                ON DCC.DIM_CC_CORP_HIER_CURRENT_KEY = DCCH.DIM_CC_CORP_HIER_CURRENT_KEY
             WHERE PVU.DTTMEND IS NULL
               AND (PVU.COSTCENTERIDA IS NOT NULL AND DCC.CC_NUM IS NULL)
                OR PVU.DIVISION <> DCCH.COUNTRY_NAME
                OR PVU.DISTRICT <> DCCH.PROV_NAME
                OR PVU.AREA <> DCCH.COREAREA_NAME
                OR PVU.FIELD <> DCCH.AREA_NAME
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
        name: VIEW_PVIEW_CC_EXCEPTIONS
        noLinkRefs: []
  name: VIEW_PVIEW_CC_EXCEPTIONS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
