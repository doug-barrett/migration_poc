fileVersion: 1
id: ce137e84-7405-4c59-b606-0414af9c4ea6
name: VIEW_PVIEW_CC_EXCEPTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2aed7bd3-5599-4fb0-9a75-a36aa017d525
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PV_IDREC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dfe22de8-f6e2-429b-90aa-91f793353b62
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b44934e-321c-4d93-9c4f-bc9a83b526da
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_UNIT_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50ee8568-df75-439d-b90f-a59a0ac2027c
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7cbf2ffb-5cf2-4407-96f7-58db5ee4d67b
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_UNIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ad0c5f5-2da8-4533-8881-4f385f37a700
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 699a864b-d32f-48f1-98c1-88f3fa1b89aa
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_UNIT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 502a2a4e-8c0b-4924-83d7-6025dd3b027e
                stepCounter: b794b297-4c0b-4bca-914d-2044e8e1f94e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28274772-eacf-4b17-bb2f-25a747306105
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_NETWORK_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38d1ccfc-acd0-4965-af6a-d6dcf7be7f39
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aaafff31-8b49-469b-bfed-6613d2172f0c
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_CC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d509337f-2ce6-4703-b898-0d9f424534b9
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5fa7a799-1d8e-4089-a872-81664003fe41
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_CC_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bcb82200-733b-4189-8b27-530dec17123c
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2abc480a-36dd-4f55-9660-3759281ab57b
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_DIVISION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 68e50ebb-cd59-49f5-b939-e1bf6e72579b
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5205544-cfad-4579-8153-0ce193727687
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PV_DISTRICT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d96f944-44ce-49f9-ba99-ef4510b5d01c
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 489fd385-4823-4743-bb60-dbf964759916
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66c5b120-bd07-45ad-b22a-e20b747ac5d7
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47410dfd-e6ce-49bd-853d-8c6fe3944ba2
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PV_FIELD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c01c879e-07ba-4916-b139-744483f793b2
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 482654aa-0531-41a6-8f7d-9ca72f105da5
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: SAP_CC_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d28aa41c-a9a8-4fe7-be64-2f4058706ecd
                stepCounter: f601baef-839f-49ab-b102-ee3fad93f21c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb6da0a5-e83b-47fa-82c3-10de36c65dfb
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: ""
        name: SAP_CC_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c15405c6-ad65-4525-9a28-c675167e0664
                stepCounter: f601baef-839f-49ab-b102-ee3fad93f21c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c4ac3a5-e373-4968-9082-8e5f7abc369b
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(55)
        defaultValue: ""
        description: ""
        name: SAP_PV_CC_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c15405c6-ad65-4525-9a28-c675167e0664
                stepCounter: f601baef-839f-49ab-b102-ee3fad93f21c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1f34eec1-e0dd-4815-ae12-77d5027fb61a
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_COUNTRY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34f21eb2-2aac-4baf-8b65-fbfb11a87c41
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0cc2836-29ed-4c7b-9e72-c52a8516393f
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_PROV_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 569e12e0-57e2-4ab0-b1e9-fada992660c6
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 247021a7-6ea6-4b51-aaa6-7fe6faef2c17
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_COREAREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8d8af15-264c-40af-8b0b-4dce3b18ed31
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87f77f50-ade6-425f-94d5-58d8d4c1f227
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: The name or description of the entity.
        name: SAP_AREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a489a103-50e2-4347-8d34-6965b140eea8
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00433c00-03ef-41bc-adb8-5fe433f428aa
          stepCounter: ce137e84-7405-4c59-b606-0414af9c4ea6
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: SAP_PV_UNIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a24d5f1c-3376-4a4e-81d5-0f0aa6b868ad
                stepCounter: f601baef-839f-49ab-b102-ee3fad93f21c
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_CC_EXCEPTIONS: ce137e84-7405-4c59-b606-0414af9c4ea6
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_CC_EXCEPTIONS') }} (PV_IDREC, PV_UNIT_NAME, PV_UNIT_TYPE, PV_UNIT_STATUS, PV_NETWORK_NAME, PV_CC, PV_CC_NAME, PV_DIVISION, PV_DISTRICT, PV_AREA, PV_FIELD, SAP_CC, SAP_CC_NAME, SAP_PV_CC_NAME, SAP_COUNTRY, SAP_PROV, SAP_COREAREA, SAP_AREA, SAP_PV_UNIT_TYPE) AS SELECT PVU.IDREC AS PV_IDREC,
                   PVU.NAME AS PV_UNIT_NAME,
                   PVU.TYPPA AS PV_UNIT_TYPE,
                   PVUCS.STATUS AS PV_UNIT_STATUS,
                   PVF.NAME AS PV_NETWORK_NAME,
                   PVU.COSTCENTERIDA AS PV_CC,
                   PVU.UNITIDPA AS PV_CC_NAME,
                   PVU.division AS PV_COUNTRY,
                   PVU.district AS PV_PROV,
                   PVU.area AS PV_COREAREA,
                   PVU.FIELD AS PV_AREA,
                   DCC.CC_NUM AS SAP_CC_NUM,
                   DCC.CC_NAME AS SAP_CC_NAME,
                   DCC.CC_NAME || ' (' || DCC.CC_NUM || ')' AS SAP_PV_CC_NAME,
                   DCCH.COUNTRY_NAME AS SAP_COUNTRY,
                   DCCH.PROV_NAME AS SAP_PROV,
                   DCCH.COREAREA_NAME AS SAP_COREAREA,
                   DCCH.AREA_NAME AS SAP_AREA,
                   DECODE(SUBSTR(DCC.CC_TYPE_CODE,1,1),'C','Yes','No') SAP_PV_UNIT_TYPE
              FROM DS_PRODVIEW.PVT_PVUNIT PVU
              LEFT JOIN DS_PRODVIEW.PVT_PVFLOWNETHEADER PVF
                ON PVU.IDFLOWNET = PVF.IDFLOWNET
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMP PVUC
                ON PVU.IDFLOWNET = PVUC.IDFLOWNET
               AND PVU.IDREC = PVUC.IDRECPARENT
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPSTATUS PVUCS
                ON PVUC.IDFLOWNET = PVUCS.IDFLOWNET
               AND PVUC.IDREC = PVUCS.IDRECPARENT
              LEFT JOIN BI_LEASE_OPS.DIM_COST_CENTER_SAP DCC
                ON PVU.COSTCENTERIDA = DCC.CC_NUM
              LEFT JOIN BI_LEASE_OPS.DIM_CC_CORP_HIER_CURRENT_SAP DCCH
                ON DCC.DIM_CC_CORP_HIER_CURRENT_KEY = DCCH.DIM_CC_CORP_HIER_CURRENT_KEY
             WHERE PVU.DTTMEND IS NULL
               AND (PVU.COSTCENTERIDA IS NOT NULL AND DCC.CC_NUM IS NULL)
                OR PVU.DIVISION <> DCCH.COUNTRY_NAME
                OR PVU.DISTRICT <> DCCH.PROV_NAME
                OR PVU.AREA <> DCCH.COREAREA_NAME
                OR PVU.FIELD <> DCCH.AREA_NAME
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
        name: VIEW_PVIEW_CC_EXCEPTIONS
        noLinkRefs: []
  name: VIEW_PVIEW_CC_EXCEPTIONS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
