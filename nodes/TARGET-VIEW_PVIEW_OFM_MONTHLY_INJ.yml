fileVersion: 1
id: 78013f32-8442-46b7-b2c2-359fabe01307
name: VIEW_PVIEW_OFM_MONTHLY_INJ
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12e6a3b1-06dc-4e3f-919d-ad320ab98216
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f00e8fc-6c61-4ba7-8bae-f81179d23da4
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81cdfcf8-8b58-466d-add6-fafa52b480c2
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf6aa8f-2e96-43a3-8472-6ee102299445
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f27132fa-ff1b-4a9b-ab48-420871136f7a
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7014a46b-a09f-4d32-ae9a-66b516c1d8d6
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1721e639-70d9-438a-9949-9efb10559aa5
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47f8a18b-1555-41b2-9a09-2de136944f7f
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6ea494e-ae7d-4765-9975-725ba7ed7df0
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c67e8513-144b-4749-9eba-8643711e5c64
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cbe501d6-f18e-4c4e-b5eb-3c8352794cd4
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c9f4ba22-dfbc-43dc-a443-213326ffa15a
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e7f24b1-6c1d-4a26-aa2c-67adb730ca63
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a392e2cf-c86e-4c61-baa9-c3d127bfac71
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84f78aca-4c97-44bf-ae06-434e244074d8
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ZONENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee0ce485-7fc5-4d79-8626-61aad171372f
                stepCounter: 98e176d0-3347-490e-8270-a35d271dee24
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca8165f6-05f9-4cf6-87c4-e37497eda256
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e4a0d36c-b8b5-40b5-acd7-4b9dfe3281ee
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7123758-4fa4-43c2-909e-c42c443213d2
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b30a0bd-1871-4b09-a3f9-9429948c2f3c
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cb8f72f-5e8a-4ac4-a113-04450ecfb50b
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a6b2aa9-2068-46ef-bcb2-66e911fdd8d6
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01cf1540-10e9-46cd-adcf-58262258a284
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLDISPWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a6b2aa9-2068-46ef-bcb2-66e911fdd8d6
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d5dfe77-e725-4186-a5f9-c39b02929519
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d2d71c5-2f7f-49dc-a056-fab990abbb20
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f9f4997-d0a7-425e-97e1-0e015385db8f
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3353d311-5d57-4343-b70b-5619d8d5f5a7
          stepCounter: 78013f32-8442-46b7-b2c2-359fabe01307
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09e0bb5b-5e26-42fa-a0a4-c293c6f802d3
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_MONTHLY_INJ: 78013f32-8442-46b7-b2c2-359fabe01307
          ODS_PVIEW_PVT_PVFLOWNETHEADER: bd388a52-3d72-4c70-833d-7de7c6a8abd1
          ODS_PVIEW_PVT_PVUNITALLOCMONTH: 2b7597c9-141d-4225-b959-04fb950e44fb
          ODS_PVIEW_PVT_PVUNITCOMP: b2609f15-a93c-4c5d-b86e-0898ad7558d0
          ODS_PVIEW_PVT_PVUNIT: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
          ODS_PVIEW_PVT_PVUNITCOMPZONE: 98e176d0-3347-490e-8270-a35d271dee24
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_MONTHLY_INJ') }} (IDFLOWNET, IDREC, UWI, NAME, PERIOD, HOURS_DOWN, HOURS_ON, ZONENAME, VOLINJECTHCLIQ, VOLINJECTGAS, VOLINJECTWATER, VOLDISPWATER, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   C.IDREC ,
                   C.WELLIDREGULATORY AS UWI ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   Z.ZONENAME ,
                   P.VOLINJECTHCLIQ ,
                   P.VOLINJECTGAS ,
                   P.VOLINJECTWATER ,
                   CASE WHEN U.TYPREGULATORY LIKE 'DIS%' THEN P.VOLINJECTWATER
                        ELSE 0
                         END AS VOLDISPWATER ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW', '') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) P
                ON F.IDFLOWNET = P.IDFLOWNET
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) C
                ON P.IDRECCOMP = C.IDREC
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) U
                ON C.IDRECPARENT = U.IDREC
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPZONE') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) Z
                ON P.IDRECCOMPZONE = Z.IDREC
             WHERE P.DTTMSTART < DATEADD(DAY, 1, LAST_DAY(DATEADD(MONTH, -1, CURRENT_DATE)))
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPZONE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPZONE') }}
        name: VIEW_PVIEW_OFM_MONTHLY_INJ
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_MONTHLY_INJ
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
