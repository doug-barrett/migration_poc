fileVersion: 1
id: 578e8e07-9c0b-45a4-9eb0-506f2230773e
name: VIEW_PVIEW_OFM_MONTHLY_INJ
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aebb2f36-e591-4c0c-bf8f-fb4e24f1e541
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85d6f749-a3a9-40f6-8bc0-862e4297d5ee
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac2a3814-0dbc-4d72-bfd4-13637bab881d
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f76be576-f021-42f1-a5bc-c6dfa35d25fb
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e519720-b6db-4378-8523-2cc823582927
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295d169a-8764-40e9-9347-7e6746bb1d69
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2db29a3-ff41-4328-8dc0-a123bbcce167
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8b96ba6-fa62-4c0f-b013-fdbeffce9ce2
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2662f8ba-fc71-4362-9b3f-482c66a0528a
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54f45ce5-97fb-4903-b912-cd7f56f5e45d
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c4256c1-66de-4573-a22c-d557828c0488
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c68e8dd3-3a7d-42b0-875a-5d7a041a2d83
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15042f4e-17f8-4a26-9411-a0e37007fd8e
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d2074750-19de-4f74-8818-8d81f35001aa
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8658a9aa-d8f1-4473-88f8-49718ac79f19
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ZONENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 41a0d6b2-cb3d-4ede-b830-40b2c5d3a812
                stepCounter: cbb9ff9b-c5a0-4c6f-96c5-3ec4a8c6f899
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0f9913f-4dd9-43c3-aff8-cbee44183793
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74d8bca9-3d96-40b2-adcf-332977562fe3
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d45a8d4d-8fb0-45e9-9c4e-a0ad50e21b2b
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe3f3e03-eff2-4620-8c00-2807d78a916f
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d4374d1-2540-4b96-8228-faf0948bdca0
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLINJECTWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 299cd664-02df-4580-b65d-0f6fd7a85fac
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2913a141-0645-4d3b-b74b-962f71771509
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VOLDISPWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 299cd664-02df-4580-b65d-0f6fd7a85fac
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efa788f5-fce3-4bcb-8206-6c95b07a67bd
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2461b3f-8900-4460-9da7-dc1b4d0593bc
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b22c211a-d3eb-4655-82d1-5f2a0fd55c0c
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 225158ef-323f-4052-a5f5-8eec320d50ed
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9e5f63f-82be-4cfe-9473-0d19054e7f6d
          stepCounter: 578e8e07-9c0b-45a4-9eb0-506f2230773e
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6224e306-c453-4e0c-b1bf-b5af6bdcf306
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_MONTHLY_INJ: 578e8e07-9c0b-45a4-9eb0-506f2230773e
          ODS_PVIEW_PVT_PVFLOWNETHEADER: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
          ODS_PVIEW_PVT_PVUNITALLOCMONTH: acfa00f8-2a04-428b-95fe-92ae401c3e38
          ODS_PVIEW_PVT_PVUNITCOMP: 81e6b0b1-1728-45bf-932d-6356544cf13a
          ODS_PVIEW_PVT_PVUNIT: e5728334-2b6e-40fb-ae5e-e78da1de0994
          ODS_PVIEW_PVT_PVUNITCOMPZONE: cbb9ff9b-c5a0-4c6f-96c5-3ec4a8c6f899
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_MONTHLY_INJ') }} (IDFLOWNET, IDREC, UWI, NAME, PERIOD, HOURS_DOWN, HOURS_ON, ZONENAME, VOLINJECTHCLIQ, VOLINJECTGAS, VOLINJECTWATER, VOLDISPWATER, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   C.IDREC ,
                   C.WELLIDREGULATORY AS UWI ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   Z.ZONENAME ,
                   P.VOLINJECTHCLIQ ,
                   P.VOLINJECTGAS ,
                   P.VOLINJECTWATER ,
                   CASE WHEN U.TYPREGULATORY LIKE 'DIS%' THEN P.VOLINJECTWATER
                        ELSE 0
                         END AS VOLDISPWATER ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW', '') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) P
                ON F.IDFLOWNET = P.IDFLOWNET
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) C
                ON P.IDRECCOMP = C.IDREC
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) U
                ON C.IDRECPARENT = U.IDREC
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPZONE') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) Z
                ON P.IDRECCOMPZONE = Z.IDREC
             WHERE P.DTTMSTART < DATEADD(DAY, 1, LAST_DAY(DATEADD(MONTH, -1, CURRENT_DATE)))
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPZONE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPZONE') }}
        name: VIEW_PVIEW_OFM_MONTHLY_INJ
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_MONTHLY_INJ
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
