fileVersion: 1
id: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
name: VW_UCTRANSACTIONDATEWINDOW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34c5e589-8f2e-4cdb-85b0-759854911788
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f6e0c60b-1b32-4383-b368-138ead2b5ff8
                stepCounter: 4cf3c347-e495-424c-9978-41a5afcb0430
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc57e9b5-85a3-4fcb-8eb8-65194e599d3b
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34ef6193-8f2b-4ae7-9d77-50132a4caa94
                stepCounter: 66748719-2fa1-439f-96fb-6282ef4b1bd3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5408224-0a46-41db-a765-632764a67da6
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea887019-4509-46f0-8cc9-be68c7355dce
                stepCounter: 66748719-2fa1-439f-96fb-6282ef4b1bd3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41e02f35-1704-4782-adb2-9a396c122fe0
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a135a9e2-7046-4fec-870c-8faf930a2a26
                stepCounter: 66748719-2fa1-439f-96fb-6282ef4b1bd3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc29f979-0502-468e-a254-a76af318c55c
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d863505-1ff8-402a-827b-45989e9b1d49
                stepCounter: 66748719-2fa1-439f-96fb-6282ef4b1bd3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9684963-76a1-4025-85b8-32b9e5f12ca7
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: LEADING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.LEADINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.LEADINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77f80ce4-f736-42b8-9e1e-d7c0d9b2fb41
          stepCounter: 7b5d0417-2107-4662-aa60-cb561b2cf2e9
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: TRAILING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.TRAILINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.TRAILINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            WITH CTEMINMAXTRANSDATE \N AS (
                    SELECT \N MIN(SURLI.TRANSACTIONDATE) AS LEADINGWINDOWSTARTDATE, \N DATEADD(M, 11, MIN(SURLI.TRANSACTIONDATE)) AS LEADINGWINDOWENDDATE, \N DATEADD(M, -11, MAX(SURLI.TRANSACTIONDATE)) AS TRAILINGWINDOWSTARTDATE, \N MAX(SURLI.TRANSACTIONDATE) AS TRAILINGWINDOWENDDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTEALLTRANSACTIONDATES \N AS (
                    SELECT DISTINCT \N SURLI.TRANSACTIONDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTETRANSACTIONWINDOWS \N AS (
                    SELECT \N CATD.TRANSACTIONDATE, \N CMMTD.LEADINGWINDOWSTARTDATE, \N CMMTD.LEADINGWINDOWENDDATE, \N CMMTD.TRAILINGWINDOWSTARTDATE, \N CMMTD.TRAILINGWINDOWENDDATE, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.LEADINGWINDOWSTARTDATE AND CMMTD.LEADINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS LEADING12MONTHS, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.TRAILINGWINDOWSTARTDATE AND CMMTD.TRAILINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS TRAILING12MONTHS \N
                      FROM CTEALLTRANSACTIONDATES AS CATD \N
                     CROSS JOIN CTEMINMAXTRANSDATE AS CMMTD
                   ) \N SELECT \N CTW.TRANSACTIONDATE, \N CTW.LEADINGWINDOWSTARTDATE, \N CTW.LEADINGWINDOWENDDATE, \N CTW.TRAILINGWINDOWSTARTDATE, \N CTW.TRAILINGWINDOWENDDATE, \N CTW.LEADING12MONTHS, \N CTW.TRAILING12MONTHS \N
              FROM CTETRANSACTIONWINDOWS AS CTW
        dependencies:
          - locationName: STAGE
            nodeName: VW_ALLTRANSACTIONDATES
          - locationName: STAGE
            nodeName: VW_LEADINGTRAILINGRANGE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('STAGE','VW_ALLTRANSACTIONDATES') }}
            {{ ref('STAGE','VW_LEADINGTRAILINGRANGE') }}
        name: VWUCTRANSACTIONDATEWINDOW
        noLinkRefs: []
  name: VW_UCTRANSACTIONDATEWINDOW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
