fileVersion: 1
id: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
name: STAGE_BUDGET_CSV_UNPIVOT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "Unpivot month columns into ACCT_PER_DATE (Last Day Month)  ** Customized Update Script **"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6410576-93c7-4dd0-91a5-87ae5a4b422b
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Common ID amungst all csv files (last 14 digits - timestamp)
        name: FILE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a63239d-f3e8-48f8-86d3-621cfb037235
                stepCounter: a60f148d-5e25-46bf-9530-f38ecb33388d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a1b2aac-753d-429e-9efd-bdf95c13d60c
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Type of data in source CSV file. Prefix code of CSV file
        name: LOAD_FILE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59ad2b9f-e781-4cc7-89ce-564036975116
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6129989-9ff9-4297-a01a-424652af8115
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: BUDGET_YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e904f8e-b36f-4545-a7b5-363ae00b1701
                stepCounter: a60f148d-5e25-46bf-9530-f38ecb33388d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe53f57d-cb90-49d4-af96-96d0d4de1c83
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea0f3a80-509e-4cab-9988-fdbb0ea583c2
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eab9cfe1-d71e-4a29-843f-c25d11302962
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: COST_CENTRE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3765d102-9ca1-4c7c-afaa-4d4c60129611
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a30da9a6-0825-4fbd-bd62-5fee9dcd5d59
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: FUNCTIONAL_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 440b96a9-fd4c-483a-91dd-df92be7a7f88
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7df5b01-b9b2-4821-95e6-c0136e5b45d4
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9d2c94ea-74ac-4e6a-9aad-7e7a67ebf999
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 048eb645-4558-4675-9f56-7e8a0e653671
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ac0a417-63c4-420d-b7bd-cb6d15b2bfca
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc70295c-8312-4709-ab79-26f1ab8a1d83
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8870443-2c09-466a-8f53-1efb6904b801
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3479bff-6278-48de-be20-885eb8c29ea2
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACTVY_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LAST_DAY(TO_DATE(BUDGET_YEAR||ACCT_PER_DATE_MNTH,'YYYYMMDD'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e03e599-0c18-4a50-836f-7f1cc4057542
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LAST_DAY(TO_DATE(BUDGET_YEAR||ACCT_PER_DATE_MNTH,'YYYYMMDD'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4806c19b-5807-4415-9ce3-d88e4c187be8
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: Monthly Amount
        name: AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ACCT_PER_DATE_AMT
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 192d1485-9fec-4edd-9a31-c76ea35387ec
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: AMT_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a720327c-38aa-49e7-92db-5a7e92bd391c
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37b610b9-6de4-4c05-9245-c8dd6c2b6e6e
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: VOL_UOM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a728b502-4edc-4720-8489-8f9a43e1e59f
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34c06f26-99b0-4c8a-880c-25a98660bbae
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ORIG_FILENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 268d0a0c-1221-4b2b-b34e-4ab3097452af
                stepCounter: a60f148d-5e25-46bf-9530-f38ecb33388d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2451d5c3-f453-496b-8608-2853732ad136
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_LI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 781f54c1-0948-4331-812a-a5b4a6238b94
                stepCounter: fae5b5bc-ed57-42dc-91a9-3fa9efc79408
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3cd27a6-706f-410a-8565-17052cab60d1
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_HDR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54e8535a-25cd-4b5c-82e3-c48f3f105d9f
                stepCounter: a60f148d-5e25-46bf-9530-f38ecb33388d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6344576a-fc63-4172-a963-22471fef4cd0
          stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: CURRENT_TIMESTAMP()
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: STAGE_BUDGET_CSV_HEADER
        join:
          joinCondition: |-
            FROM (
                    SELECT * ,
                           '0101' AS ACCT_PER_DATE_MNTH ,
                           JAN_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0201' AS ACCT_PER_DATE_MNTH ,
                           FEB_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0301' AS ACCT_PER_DATE_MNTH ,
                           MAR_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0401' AS ACCT_PER_DATE_MNTH ,
                           APR_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0501' AS ACCT_PER_DATE_MNTH ,
                           MAY_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0601' AS ACCT_PER_DATE_MNTH ,
                           JUN_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0701' AS ACCT_PER_DATE_MNTH ,
                           JUL_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0801' AS ACCT_PER_DATE_MNTH ,
                           AUG_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0901' AS ACCT_PER_DATE_MNTH ,
                           SEP_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1001' AS ACCT_PER_DATE_MNTH ,
                           OCT_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1101' AS ACCT_PER_DATE_MNTH ,
                           NOV_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1201' AS ACCT_PER_DATE_MNTH ,
                           DEC_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                   ) STAGE_BUDGET_CSV_MERGED
              JOIN WS_STAGE_BT.STAGE_BUDGET_CSV_HEADER
                ON STAGE_BUDGET_CSV_HEADER.FILE_ID = STAGE_BUDGET_CSV_MERGED.FILE_ID
        name: STAGE_BUDGET_CSV_UNPIVOT
        noLinkRefs: []
  name: STAGE_BUDGET_CSV_UNPIVOT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
