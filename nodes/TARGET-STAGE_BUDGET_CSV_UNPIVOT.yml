fileVersion: 1
id: 31c27799-70cf-459d-945e-7eabffe96144
name: STAGE_BUDGET_CSV_UNPIVOT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "Unpivot month columns into ACCT_PER_DATE (Last Day Month)  ** Customized Update Script **"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b86d6181-120b-47ed-8afa-20e424bc104e
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Common ID amungst all csv files (last 14 digits - timestamp)
        name: FILE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d903ee37-ea2b-4732-9621-8a1219a3895e
                stepCounter: 87ff88ed-0f13-4ace-a008-ff1a36d802ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 237c2b05-8891-41fc-bde4-c6a5a0fec694
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Type of data in source CSV file. Prefix code of CSV file
        name: LOAD_FILE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a40e0589-e316-42db-99b3-3336e5dc7973
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a40735bf-eeee-42bc-8b7c-7ecd22710664
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: BUDGET_YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 352b64be-7166-4d81-bd58-141ec55fc3fc
                stepCounter: 87ff88ed-0f13-4ace-a008-ff1a36d802ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f2201df-73ad-44f7-9510-dace4bcab047
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2492b69e-023e-49b5-8037-f0c833ba4dfc
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1f32e19f-7141-4976-b974-1b423a05c451
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: COST_CENTRE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f6df525-b267-48f7-a220-4ba0d8a3d334
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d649b57c-0e85-4da1-9848-51ded76a6a57
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: FUNCTIONAL_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4568a37b-8b2a-4847-b829-5d964598e838
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 090da971-85f6-4d52-89cb-a1b6a05b2b21
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4a510e23-7184-4bcb-9006-28685eecb53e
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3a73482-328d-452b-b2c0-9ae691552a75
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9dfa50d1-e6fe-4def-a062-7993ccd04900
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d04ed89-733e-4f03-b143-b3cd15810024
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b467ec90-0249-49e7-ba72-3b0bbc255449
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 763911fd-31bf-4974-b759-8ec02ea33b34
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACTVY_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LAST_DAY(TO_DATE(BUDGET_YEAR||ACCT_PER_DATE_MNTH,'YYYYMMDD'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7574f424-740f-4c71-b5ba-da61040c6b9b
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LAST_DAY(TO_DATE(BUDGET_YEAR||ACCT_PER_DATE_MNTH,'YYYYMMDD'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 249b5d62-1434-4ec0-8b6b-46ff71096e70
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: Monthly Amount
        name: AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ACCT_PER_DATE_AMT
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdd3b4e0-b777-4474-878f-cd57ce2d5d2c
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: AMT_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85bc38ea-0f5c-454d-be1a-04a578f808a5
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 52c6195d-3ae7-402e-a038-dd4e6dcfccc0
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: VOL_UOM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9fc2ec4-4734-46e6-a07d-d2071bb73325
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a7a0fce-982e-4448-afcd-a3cd70640185
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ORIG_FILENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0872e107-0de0-4b64-89df-66f9b7d1ce6e
                stepCounter: 87ff88ed-0f13-4ace-a008-ff1a36d802ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5408b48-4d99-460d-9a29-d670bd078c35
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_LI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d57141f1-e241-485b-8c00-07809935272d
                stepCounter: 7076e83f-2407-40e7-bdbe-b899e0bfb4e5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da23f5fc-ad28-4e75-a828-887ff8a35482
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_HDR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5e22402-70d2-4b6a-b652-df9767463920
                stepCounter: 87ff88ed-0f13-4ace-a008-ff1a36d802ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 95c48d0a-8937-4054-9a20-50026b69ad35
          stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: CURRENT_TIMESTAMP()
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: STAGE_BUDGET_CSV_HEADER
        join:
          joinCondition: |-
            FROM (
                    SELECT * ,
                           '0101' AS ACCT_PER_DATE_MNTH ,
                           JAN_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0201' AS ACCT_PER_DATE_MNTH ,
                           FEB_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0301' AS ACCT_PER_DATE_MNTH ,
                           MAR_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0401' AS ACCT_PER_DATE_MNTH ,
                           APR_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0501' AS ACCT_PER_DATE_MNTH ,
                           MAY_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0601' AS ACCT_PER_DATE_MNTH ,
                           JUN_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0701' AS ACCT_PER_DATE_MNTH ,
                           JUL_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0801' AS ACCT_PER_DATE_MNTH ,
                           AUG_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '0901' AS ACCT_PER_DATE_MNTH ,
                           SEP_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1001' AS ACCT_PER_DATE_MNTH ,
                           OCT_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1101' AS ACCT_PER_DATE_MNTH ,
                           NOV_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                 UNION ALL SELECT * ,
                           '1201' AS ACCT_PER_DATE_MNTH ,
                           DEC_AMT AS ACCT_PER_DATE_AMT
                      FROM WS_STAGE_BT.STAGE_BUDGET_CSV_MERGED
                   ) STAGE_BUDGET_CSV_MERGED
              JOIN WS_STAGE_BT.STAGE_BUDGET_CSV_HEADER
                ON STAGE_BUDGET_CSV_HEADER.FILE_ID = STAGE_BUDGET_CSV_MERGED.FILE_ID
        name: STAGE_BUDGET_CSV_UNPIVOT
        noLinkRefs: []
  name: STAGE_BUDGET_CSV_UNPIVOT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
