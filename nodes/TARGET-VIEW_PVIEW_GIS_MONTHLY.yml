fileVersion: 1
id: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
name: VIEW_PVIEW_GIS_MONTHLY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9417b80-4489-4ab1-a2e4-ce422c3d8a95
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f00e8fc-6c61-4ba7-8bae-f81179d23da4
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da244cb4-4c02-4995-8944-dafaa3dc7d4c
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf6aa8f-2e96-43a3-8472-6ee102299445
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54dab8f3-23ad-4a0b-b7ee-8b38c6e25f83
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NUM_BEPH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 935cc6ca-edfa-477c-8cd4-fccb6046828a
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e0489c3-6c3a-4619-a7b9-5cf5a9c2e156
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47f8a18b-1555-41b2-9a09-2de136944f7f
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e371a7ee-c0b9-4cb6-9452-46f88efb0e80
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1ff8b86-4261-45c2-8bbc-120239fb3eee
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46cae1d8-8da7-4528-aeb9-ce27da003da7
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8e613d6-d6be-49d6-be63-d8099a1af1c4
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b27a167-3474-4429-866a-295fd867f924
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2838768e-20bc-4677-900e-ed6f3bc1550c
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7e963f12-5ee1-43f0-84d6-9d35129b2802
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dfc8bda9-6f48-4687-822b-c25de33890be
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6292291b-c542-47a3-b32d-4d87df3306cc
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d2f4d492-2748-4b26-b315-d5f627b92110
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e718a0e1-bd79-4144-be7c-08f030b579ce
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09c40d4c-1236-4a88-99bf-15323908cfd1
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24c6b8f8-1cbf-43a5-970f-ceb9b7811a7e
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44a65cde-0cdb-4656-96cd-61da113816cd
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74997cab-20d0-4573-917e-98493c80605c
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b412a9dd-a430-4f33-8a9f-2c4f2a6d9d3d
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0b7ffbc-e6ab-43d8-ac04-8bf7df691ac5
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51cb361b-0e44-4719-beb2-d1f94df06cae
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66ae9a05-1efd-4a44-9730-882945dbde60
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 469bc18f-8dc1-4078-a887-f96a1bc24676
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fd4b57c2-26a2-49ff-bc2a-47f664cbf1bb
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_TOTAL_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8766e74c-247a-4971-8970-187b52050349
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_OIL_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b0f5e1e-e6ac-49fa-a532-45c00eeb2755
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_WATER_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d404082-654c-4605-ab0a-facb4f53e80a
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_BSW
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e21473f-0df5-4384-b762-b5b72433b6fb
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TUBING_PRES_BAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90bbb285-5bfb-4d29-adfe-958fb830238c
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: CASING_PRES_BAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76244e98-e0a1-46e1-8df3-cf7786ceda59
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALINITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16fd7126-afff-44f4-9bab-dca0490c84d2
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3198a779-c428-4ad5-903b-5b7b845ac0c6
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FLOWDIRECTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f39367e2-7707-487c-b9ac-200fef908a67
                stepCounter: 56efdfd1-7a07-4ab6-917a-e20b72b23662
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6442fdab-3580-4745-99dc-22ffeb94f08f
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1b6701e-3405-4bfe-aaf9-bac7da4889ef
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1d5ed5b-3644-4d0b-9694-ee4f9d1430b9
          stepCounter: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_GIS_MONTHLY: a9871cb9-6f67-4a19-92f1-6e7633ad4af1
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_GIS_MONTHLY') }} AS SELECT F.IDFLOWNET ,
                   U.IDREC ,
                   U.PADNAME AS NUM_BEPH -- Updated as Unit table join for Num_BEPH
            ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   P.VOLPRODGATHHCLIQ AS PROD_OIL ,
                   P.VOLPRODGATHGAS AS PROD_GAS ,
                   P.VOLPRODGATHWATER AS PROD_WATER ,
                   P.VOLNEWPRODALLOCHCLIQ AS ALLOC_OIL ,
                   P.VOLNEWPRODALLOCGAS AS ALLOC_GAS ,
                   P.VOLNEWPRODALLOCWATER AS ALLOC_WATER ,
                   P.VOLLOSTHCLIQ AS LOST_OIL ,
                   P.VOLLOSTGAS AS LOST_GAS ,
                   P.VOLLOSTWATER AS LOST_WATER ,
                   P.VOLINJECTRECOVGAS AS INJ_GAS ,
                   P.VOLINJECTRECOVHCLIQ AS INJ_OIL ,
                   P.VOLINJECTRECOVWATER AS INJ_WATER ,
                   P.VOLDISPSALEGAS AS SALES_GAS ,
                   P.VOLDISPFUELGAS AS FUEL_GAS ,
                   P.VOLDISPFLAREGAS AS FLARE_GAS ,
                   P.VOLDISPVENTGAS AS VENT_GAS ,
                   ROUND(P.VOLNEWPRODALLOCHCLIQ * D.DENSITYHCLIQ / 1000,2) TONS_OIL ,
                   T.VOLFLUIDTOTALCALC AS TEST_TOTAL_RATE -- Added Test Total Rate
            ,
                   T.VOLHCLIQCALC AS TEST_OIL_RATE -- Added Test Oil Rate
            ,
                   T.VOLWATERCALC AS TEST_WATER_RATE -- Added Test Water Rate
            ,
                   T.BSWTOTALCALC AS TEST_BSW -- Added Test BSW
            ,
                   PA.PRESTUB / 100.00 AS TUBING_PRES_BAR -- Added Tubing Pressure in bar
            ,
                   PA.PRESCAS / 100.00 AS CASING_PRES_BAR -- Added Casing Pressure in bar
            ,
                   PA.SALINITY * 1000000.00 AS SALINITY -- Added Salinity in g/L
            ,
                   M.FLOWDIRECTION ,
                   P.DTTMSTART AS START_DATE ,
                   P.DTTMEND AS END_DATE ,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(F.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_PVFLOWNETHEADER F
             INNER JOIN DS_PRODVIEW.PVT_PVUNITALLOCMONTH P
                ON F.IDFLOWNET = P.IDFLOWNET
             INNER JOIN DS_PRODVIEW.PVT_PVUNITCOMP C
                ON P.IDRECCOMP = C.IDREC
             INNER JOIN DS_PRODVIEW.PVT_PVUNIT U
                ON P.IDRECPARENT = U.IDREC -- Joined Unit Table

             INNER JOIN DS_PRODVIEW.PVT_PVUNITCOMPMEASMETH M
                ON P.IDRECMEASMETH = M.IDREC
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPTEST T
                ON P.IDRECTEST = T.IDREC -- Join Test Table

              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPPARAM PA
                ON P.IDRECPARAM = PA.IDREC -- Join Parameter Table

              LEFT JOIN DS_PRODVIEW.PVT_PVUNITLIQUIDDENSITY D
                ON C.IDRECPARENT = D.IDRECPARENT
               AND D.DTTM = (
                    SELECT MAX(DTTM)
                      FROM DS_PRODVIEW.PVT_PVUNITLIQUIDDENSITY
                     WHERE IDRECPARENT = C.IDRECPARENT
                       AND DTTM <= P.DTTMEND
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
        name: VIEW_PVIEW_GIS_MONTHLY
        noLinkRefs: []
  name: VIEW_PVIEW_GIS_MONTHLY
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
