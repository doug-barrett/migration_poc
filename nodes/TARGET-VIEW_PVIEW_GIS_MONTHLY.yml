fileVersion: 1
id: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
name: VIEW_PVIEW_GIS_MONTHLY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b278dac-b217-44ec-8228-1bf98ac2d1fe
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85d6f749-a3a9-40f6-8bc0-862e4297d5ee
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5202e41-8cb7-4614-8f69-ee13905dce0d
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f76be576-f021-42f1-a5bc-c6dfa35d25fb
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 619d206a-e48b-4c60-ac8b-6acb8c4d4ed7
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NUM_BEPH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 116125ab-f54c-4687-9590-6e551955655e
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e22a68d-9dca-4285-9715-7b2f584b1dbd
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8b96ba6-fa62-4c0f-b013-fdbeffce9ce2
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a07bd702-310d-430f-bafb-320a36b99c12
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03348e29-4017-4646-8a2e-29067cbe5731
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91bfaaba-8129-42af-bc4c-6c30e40a1f55
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 714c835c-0ca3-438b-a956-9b7abb04edfb
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a15d27a-3264-4a29-93a6-d56f5d84e646
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 177c7386-9aed-4fe5-b629-f363847790ce
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50490388-5aa6-476e-9663-54738126936f
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3eb8c17-9a3a-450d-a3bb-0f5cdfbc6563
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fbfc4d99-2a12-4b7f-b1a7-94040bdf0f06
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e568a26-13a9-41eb-8060-81c0244f1cc3
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d76d1e16-79ba-446f-9861-ef904443803b
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 677f130a-5b02-4d8f-a409-daa48261815c
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c508187-5c64-411f-80b1-e22c956e2150
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4fc27cb8-ecf1-4ab7-91bc-fd14bf228bf6
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84149906-5238-47e5-bc19-8bf9bde2a535
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 244c3513-a4ee-454b-ba29-22c5a9ec7ca7
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aff78cd3-c1e2-46c3-ad3a-73facac830d8
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0df81e0e-bad2-4b39-a5f4-7547935ba162
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7cdd962a-11ad-4ff4-893f-d6e5225c98f8
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7fb31af-2c32-46cb-9818-337c13e96d6f
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c3045d8-9731-4fbb-92a5-d941ac183e5a
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_TOTAL_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f6a2f30-992d-43cb-a2cf-23310c53714e
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_OIL_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1bba7fa5-ab58-458f-814b-44f0a45552df
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_WATER_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b615ed26-af23-4b08-bae8-10d57661b4b5
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEST_BSW
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2a51b55-162c-4e6d-a284-0b0ceb8646ea
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TUBING_PRES_BAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8dfd6e50-b18b-4125-a503-1c47ee85c42e
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: CASING_PRES_BAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a44e196f-a6d0-4c8a-8541-ac2c7c517c6a
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALINITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87157f62-2afe-46c6-9176-9853b894d5c3
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fcccd1be-60e4-4ac1-893a-8d81c8c86d49
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FLOWDIRECTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8df1c120-b6c0-4edd-a01d-d29055be661e
                stepCounter: e3cf61ec-a4d6-45b6-8acb-b4ac8c3265d9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 615a720f-08e5-493b-8499-097b42d29ce3
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8dac05e2-ec92-45dc-a5b9-3ddc77d6ea58
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49b9f565-07b0-426b-afa3-c1ec3519ccf1
          stepCounter: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2461b3f-8900-4460-9da7-dc1b4d0593bc
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_GIS_MONTHLY: ab1d9a09-1b86-42e6-9277-bcf8596a81e0
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_GIS_MONTHLY') }} AS SELECT F.IDFLOWNET ,
                   U.IDREC ,
                   U.PADNAME AS NUM_BEPH -- Updated as Unit table join for Num_BEPH
            ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   P.VOLPRODGATHHCLIQ AS PROD_OIL ,
                   P.VOLPRODGATHGAS AS PROD_GAS ,
                   P.VOLPRODGATHWATER AS PROD_WATER ,
                   P.VOLNEWPRODALLOCHCLIQ AS ALLOC_OIL ,
                   P.VOLNEWPRODALLOCGAS AS ALLOC_GAS ,
                   P.VOLNEWPRODALLOCWATER AS ALLOC_WATER ,
                   P.VOLLOSTHCLIQ AS LOST_OIL ,
                   P.VOLLOSTGAS AS LOST_GAS ,
                   P.VOLLOSTWATER AS LOST_WATER ,
                   P.VOLINJECTRECOVGAS AS INJ_GAS ,
                   P.VOLINJECTRECOVHCLIQ AS INJ_OIL ,
                   P.VOLINJECTRECOVWATER AS INJ_WATER ,
                   P.VOLDISPSALEGAS AS SALES_GAS ,
                   P.VOLDISPFUELGAS AS FUEL_GAS ,
                   P.VOLDISPFLAREGAS AS FLARE_GAS ,
                   P.VOLDISPVENTGAS AS VENT_GAS ,
                   ROUND(P.VOLNEWPRODALLOCHCLIQ * D.DENSITYHCLIQ / 1000,2) TONS_OIL ,
                   T.VOLFLUIDTOTALCALC AS TEST_TOTAL_RATE -- Added Test Total Rate
            ,
                   T.VOLHCLIQCALC AS TEST_OIL_RATE -- Added Test Oil Rate
            ,
                   T.VOLWATERCALC AS TEST_WATER_RATE -- Added Test Water Rate
            ,
                   T.BSWTOTALCALC AS TEST_BSW -- Added Test BSW
            ,
                   PA.PRESTUB / 100.00 AS TUBING_PRES_BAR -- Added Tubing Pressure in bar
            ,
                   PA.PRESCAS / 100.00 AS CASING_PRES_BAR -- Added Casing Pressure in bar
            ,
                   PA.SALINITY * 1000000.00 AS SALINITY -- Added Salinity in g/L
            ,
                   M.FLOWDIRECTION ,
                   P.DTTMSTART AS START_DATE ,
                   P.DTTMEND AS END_DATE ,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(F.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_PVFLOWNETHEADER F
             INNER JOIN DS_PRODVIEW.PVT_PVUNITALLOCMONTH P
                ON F.IDFLOWNET = P.IDFLOWNET
             INNER JOIN DS_PRODVIEW.PVT_PVUNITCOMP C
                ON P.IDRECCOMP = C.IDREC
             INNER JOIN DS_PRODVIEW.PVT_PVUNIT U
                ON P.IDRECPARENT = U.IDREC -- Joined Unit Table

             INNER JOIN DS_PRODVIEW.PVT_PVUNITCOMPMEASMETH M
                ON P.IDRECMEASMETH = M.IDREC
              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPTEST T
                ON P.IDRECTEST = T.IDREC -- Join Test Table

              LEFT JOIN DS_PRODVIEW.PVT_PVUNITCOMPPARAM PA
                ON P.IDRECPARAM = PA.IDREC -- Join Parameter Table

              LEFT JOIN DS_PRODVIEW.PVT_PVUNITLIQUIDDENSITY D
                ON C.IDRECPARENT = D.IDRECPARENT
               AND D.DTTM = (
                    SELECT MAX(DTTM)
                      FROM DS_PRODVIEW.PVT_PVUNITLIQUIDDENSITY
                     WHERE IDRECPARENT = C.IDRECPARENT
                       AND DTTM <= P.DTTMEND
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
        name: VIEW_PVIEW_GIS_MONTHLY
        noLinkRefs: []
  name: VIEW_PVIEW_GIS_MONTHLY
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
