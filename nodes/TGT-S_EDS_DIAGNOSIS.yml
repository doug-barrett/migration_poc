fileVersion: 1
id: e0e36fbe-890a-4987-8bf4-53eaed2d265a
name: S_EDS_DIAGNOSIS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 924ebfce-91b6-4e40-8de7-a21099896ce0
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIAGNOSIS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ac75dde-66ab-474b-af42-9dedd61d49d0
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DISCHARGE_EVENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e6772c-2bdb-44c1-b1eb-0c055cff72c5
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b07a3da9-7875-49a1-81d5-8c0ffa599858
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9c7781b-909c-460d-b125-31deee42a5d6
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_EDS_Document.extEventId ORDER BY ds_EDS_Diagnosis.isPrimary DESC ,IFNULL(ds_pims_odpcd_codes.code,tt.code) ,ds_EDS_Diagnosis.diagnosisId)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4e61981-2a3e-43dc-8cb0-2ac34bcc3208
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: EVENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b07a3da9-7875-49a1-81d5-8c0ffa599858
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: |-
              CASE WHEN isnumeric(substring(ds_EDS_Document.extEventId,2,100)) = 1 THEN cast(substring(ds_EDS_Document.extEventId,2,100) AS int)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3dc4c7ca-793a-46c7-a96e-025eabf82d16
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5c1d681d-fba6-4c9e-bfdf-cc4bbe97e046
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21bf4a32-3a76-49f0-9b2e-d608ffc03563
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 329a6d1b-5b39-4dfd-82fa-2e762007a742
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5dfaa9d4-19a5-4e21-8297-7b289bc111b7
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14105a56-b26d-418b-8544-ced14941f238
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 353afb6f-23f7-4071-b1e7-cd46fd8c3530
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCHARGE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 86611718-a6fb-4347-a7ab-74b06b508503
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 94da5029-f7f6-4a51-90ca-90368f4a9a9a
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: ODPCD_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52236722-6d5f-49c3-b9a8-0b3e9a7b583f
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.odpcd_refno,tt.odpcd_refno)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d95942b7-4ecc-480f-afd5-b64a8f537618
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_odpcd_codes.code,tt.code)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d69ba11-d30b-4beb-b777-dbe071918584
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_EDS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c29f171-8b18-4ba3-8be2-11695984b8b5
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_IPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce926fd2-6430-4eb3-b6ba-fb347c954088
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c31d7836-cfd6-4d10-916b-75aa3e75fc7c
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_IPM_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e56ecb31-d819-4b60-8681-bf39ae04b1ec
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49029b66-b6a7-407c-87fa-6f488220996b
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CODING_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb0cdab8-ed28-483c-a6ab-e5a884712b91
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Y/N primary diagnosis indicator
        name: IS_PRIMARY_DIAGNOSIS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b473a818-eca7-4d95-b425-ce1a475d68f0
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9044eb6e-4e2f-478f-9e2e-24453f3e7782
          stepCounter: e0e36fbe-890a-4987-8bf4-53eaed2d265a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_EDS_DOCUMENT: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
          DS_PIMS_PATIENTS: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
          L_REFERENCE_TESTPATIENTS: 7a88f4e3-512a-476a-a161-018aae5e8bff
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_EDS_DIAGNOSIS
          - locationName: UNKNOWN
            nodeName: DS_EDS_DIAGNOSIS
          - locationName: TGT
            nodeName: DS_EDS_DOCUMENT
          - locationName: TGT
            nodeName: DS_PIMS_PATIENTS
          - locationName: TGT
            nodeName: L_REFERENCE_TESTPATIENTS
        join:
          joinCondition: |-
            FROM {{ ref('UNKNOWN','DS_EDS_DIAGNOSIS') }}
              JOIN {{ ref('TGT','DS_EDS_DOCUMENT') }}
                ON ds_EDS_Diagnosis.dischargeEventId = ds_EDS_Document.dischargeEventId
              LEFT OUTER JOIN dbo.[ds_pims_odpcd_codes]
                ON ds_EDS_Diagnosis.code = ds_pims_odpcd_codes.code --and ds_EDS_Document.dischargeDate between [ds_pims_odpcd_codes].start_dttm and IFNULL([ds_pims_odpcd_codes].end_dttm,getdate())    and ds_pims_odpcd_codes.ccsxt_code = 'AEDIG'         LEFT OUTER JOIN dbo.[ds_pims_odpcd_codes] tt    ON ds_EDS_Diagnosis.code+'.' = tt.code and tt.ccsxt_code = 'AEDIG'      LEFT OUTER JOIN {{ ref('TGT','DS_PIMS_PATIENTS') }}  ON ds_EDS_Document.patientId = ds_pims_patients.pasid    LEFT OUTER JOIN {{ ref('TGT','L_REFERENCE_TESTPATIENTS') }}  ON ds_EDS_Document.patientId = l_Reference_testpatients.nmpi and l_Reference_testpatients.nmpi is null
        name: S_EDS_DIAGNOSIS
        noLinkRefs: []
  name: S_EDS_DIAGNOSIS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
