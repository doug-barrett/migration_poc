fileVersion: 1
id: a832c05d-d821-478c-ae75-b83a2c201fcc
name: S_IN_PATIENT_CODING_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "used to build a fact table of just pdc data with audit fields back to iPM data"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4db76560-f9cc-4629-a3ea-d3b42d836e0c
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d23504a-0045-4609-8c74-c5b3a5dec0dc
                stepCounter: a7d7c8ec-88ee-49a8-b500-e3f4bce83e59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68ba53a5-4acd-473b-88f7-5360d249b726
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: ACC_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d0e3237-1d1f-4b1a-8391-f0103be0a9aa
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 958d48f9-0b5c-4be9-9296-c0862b35fe7b
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: ACCIDENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71f7db55-9185-4843-ba9e-0271d10384a4
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a3a6cfc-016b-4191-9515-4eb2033186eb
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMISSION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9e5ca76c-6f2e-4320-bd88-aa9ffacd81e8
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a42e5e16-13f0-4bf8-9a54-70dddb2b57e3
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADMISSION_WEIGHT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 482a62c7-6417-4058-b08d-d95ce29d51a1
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60d7a884-58da-49e5-9c06-eb1766a73f57
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADMITSOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 81baa494-4057-4053-a805-a18887614109
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bebe1ea-5ee0-4c19-b906-2bd905ab71b1
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADMITTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c52444d-3782-4ad0-8914-5e769d494bbf
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e8f1479-b149-4cef-ade2-34939e759790
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: BIRTH_WEIGHT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4931e9c8-0408-4aba-977c-4080070d0013
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c05e1dd7-74ec-411c-a97b-9b0c4dd6cbec
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: CCL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d8fcfd8-5f4f-4ca8-b192-bfd5c5d8a065
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45ba8e1b-b945-47e9-a8aa-be8d89569f04
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CODED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51757813-e989-47c3-8717-fbbc983b59e4
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 385e40b4-d861-4e87-bad7-d02144c36537
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CODER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26d0c2ca-50d4-430f-8c69-7ef3b6576aae
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a63f0200-3437-4479-ada2-3eaff0511430
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: CPAP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ad9a5224-6d11-42bf-9c1f-a74a4188c9df
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5a06d63-ab48-45c7-94d4-37cb0444a22c
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE_ADDED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88f82c3b-006f-423e-bb88-9ec9df4e7dd5
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c029511-0f0d-49cd-8e85-b3e365fdd011
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_coding_10.discharge_date=dim_discharge_date.discharge_calendar_date
        name: DIM_DISCHARGE_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985b56af-022e-46b3-82b0-51ae204ca926
                stepCounter: 45fbd3a8-64d0-4be6-b03a-8d128a18b549
            transform: IFNULL(dim_discharge_date.dim_discharge_date_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7eb53d0-fdf7-475e-8c13-4272dafb30c6
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_MOTHER_OF_PATIENT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8bd7a263-ee4f-4b8d-8902-6bb22fa44d2b
                stepCounter: 2e3a765f-e0e2-4b08-b394-2791ab59ccb0
            transform: IFNULL(dim_mother_of_patient.dim_mother_of_patient_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce0403ed-4781-402d-88bf-4aaf4becce40
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key,1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b807aa81-8e44-47ce-8c06-c25850c3491e
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCHARGE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4d37f65b-532a-441f-ba27-06ec52381826
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78258a69-d2c5-40af-8c6d-400fef62f571
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b485b4b8-1fe7-475e-b8e4-758248c3af98
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1c49091-2e1f-4ee7-a7b0-1cec15435630
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d10877e-31b0-4f51-9f25-3aea1f04e2e1
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 955586ba-b506-478d-bfce-6dc084b84c2a
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID_ORIG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e82e6d18-dac8-4b48-a170-bfdc145d29f2
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 856d2b86-adc1-4877-a1f7-63cccd092fd7
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: EVENTENDTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3994f1f-4d72-41cc-838c-962901e35922
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: effde8f3-01fa-4aab-a315-38d86114c166
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: EVENTTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c20aaa9-a288-41d7-b8c8-7e536e068261
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 355bd3d0-08eb-47f3-8864-cda888b4caa3
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: FILE_REFERENCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c832c909-a16e-4918-b36e-3bc25a894d2f
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b7bcf6f2-902d-46c0-b2e6-8df0d78eaaef
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: GESTATION_PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2ba20ca-d6eb-4340-b1f4-68a898afd2dc
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6ed1c2d-2be1-49f9-b19e-4044f4bcba95
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: GESTATIONAL_AGE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3777c93c-e5d1-4050-b5d6-a844c4e29b36
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41e86619-105c-4574-9822-768d2955e88c
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: HEALTH_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17fd0dfa-41f7-4e9c-9d31-7f4b17f589eb
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4fb50a1-0591-4245-9c7b-605f3aa71867
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: HOSPITAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 32936e66-1858-4f7e-9af4-b0a8952481f0
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b9a3ea0-09c7-42af-8889-5b6f027d32df
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IPM_ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a0d5a12-1979-4f2c-8064-624c175d8d47
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1002e061-675f-48b4-83cc-25d38d6276bb
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: LAST_IPM_MODIF_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4cf9e3b6-25cc-4f29-8679-71a46fd91d36
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1d3a544-369b-4f35-9ec4-02f7f9f8937b
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(150)
        defaultValue: ""
        description: ""
        name: LAST_MODIF_USER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 534297c7-a3e0-41b2-b508-a2c7d8fb60c1
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0bd497f8-5363-481d-b4ce-69300aee8e32
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_coding_10.admission_date=dim_admission_date.admission_calendar_date
        name: DIM_ADMISSION_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b402ec63-d2cf-47e5-ab27-e5c03a6296f4
                stepCounter: 9996feda-efbd-41f4-8569-36f5c8b63c75
            transform: IFNULL(dim_admission_date.dim_admission_date_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e218fb7b-7c5b-4fab-8983-ed404695c1c0
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Shows where ther is an IPM event that does not appear in PDC coding
        name: IPM_EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98c9bdfa-1455-4c81-8336-1fc71694c387
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 332369be-8093-4ca6-98e0-38f873dbfe02
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: MOH Principal Purchaser code mapped from admin category
        name: IPM_PURCHASER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6b660b08-5036-404d-bc97-5a66541c7ab3
                stepCounter: cb8ab7aa-8253-4425-bee9-afe3bc46851f
            transform: IFNULL(dim_admin_category.purchaser,'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adb836ed-5cd6-48c1-ba42-e4d9c0a4571f
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: IPM_DISCH_HEALTH_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52835f9f-4af2-4514-8cbf-e79f91a677f1
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a19706d-fcac-42b7-b16c-fc3ee01bcd35
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IPM_DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00803c1f-550d-4585-a405-68dc2cd2130c
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37d17189-90b3-4ff4-b881-f917ff6dfa2b
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IPM_MECH_VENT_HRS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d7d46ab-cdf0-45a7-bbd7-3bca240c8e3e
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1c7e4ee-880e-4851-9d47-c2c81ffe65b5
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Checks difference between iPM and PLATO for dates. Has a 10 minute tolerance.
        name: IPM_PDC_ADMIT_DATE_MATCH_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52835f9f-4af2-4514-8cbf-e79f91a677f1
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: |-
              CASE WHEN cast(s_in_patient_coding_05.admission_date AS date) <> cast(s_in_patient_event_05.admit_date AS date) THEN 'N'
                          WHEN abs(datediff(MINUTE,s_in_patient_coding_05.admission_date,s_in_patient_event_05.admit_date)) >= 60    THEN 'N'
                          ELSE 'Y'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08d206d4-b13c-43c9-bb52-1f1dcfd7fb5f
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_DISCH_DATE_MATCH_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00803c1f-550d-4585-a405-68dc2cd2130c
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: |-
              CASE WHEN cast(s_in_patient_coding_05.discharge_date AS date) <> cast(s_in_patient_event_05.disch_date AS date) THEN 'N'
                          WHEN abs(datediff(MINUTE,s_in_patient_coding_05.discharge_date, s_in_patient_event_05.disch_date)) >= 60   THEN 'N'
                          ELSE 'Y'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 391e9c6f-06b8-4300-916b-5aa6cafcb4a2
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_PURCHASER_MATCH_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN dim_admin_category.purchaser = s_in_patient_coding_05.principal_payer THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 229f7654-c582-435e-a3f7-b5ee8f32a488
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_SPECIALTY_MATCH_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74694608-ed5b-438b-9b08-e0e972211172
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: |-
              CASE WHEN s_in_patient_coding_05.health_specialty_code = s_in_patient_event_05.discharge_health_specialty_code THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c66dab8-fbf9-4b3f-a39b-4946aa7e5155
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_FACILITY_MATCH_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58a79f9-b36f-4d77-96b1-8522082fb8f7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: IIF(s_in_patient_coding_05.hospital_id = s_in_patient_event_05.hospital_id, 'Y', 'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 62e0b390-5782-4101-a30c-8de8cca17839
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_NHI_MATCH_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58a79f9-b36f-4d77-96b1-8522082fb8f7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: IIF(s_in_patient_coding_05.patient_NHI = s_in_patient_event_05.patient_NHI, 'Y', 'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 63cbf0b7-cbf8-468b-b9d8-203040ceaefc
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: IPM_PDC_EVENT_TYPE_MATCH_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58a79f9-b36f-4d77-96b1-8522082fb8f7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: IIF(s_in_patient_coding_05.eventtype = s_in_patient_event_05.event_type_code, 'Y', 'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea114ee0-dc9e-449b-94bc-677d335b7fd9
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: IPM_EVENT_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: feea49b4-8128-41d0-9de3-1592657afa2a
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f2400ee-1617-4c41-aa5b-7713fbecf83e
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: IPM_FACILITY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58a79f9-b36f-4d77-96b1-8522082fb8f7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 046f0d92-776d-415e-93d2-18ddb30c9a33
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: MDC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8a2a0c35-b5ec-4d3c-9ead-ae8ba58ac90b
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec7da387-5a88-4327-96e7-2576f4157f1d
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: MECHANICAL_VENTILATOR_HOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e9c835c-8e8a-45e9-a2b6-341f553d75f8
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0afff821-996d-4bcc-b5fe-a4f6ca3708f9
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: MOTHERS_AGE_AT_ADMISSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 510bce07-e347-4d07-b8bd-c374899aadb5
                stepCounter: 2e3a765f-e0e2-4b08-b394-2791ab59ccb0
            transform: |-
              CASE WHEN dim_mother_of_patient.date_of_birth IS NULL THEN NULL
                          WHEN s_in_patient_coding_05.eventtype = 'BT'     THEN Floor(datediff(DAY,dim_mother_of_patient.date_of_birth,s_in_patient_coding_05.admission_date)/365.25)
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50eb0ac3-58e4-4a8f-b75e-8942f506d0e9
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(7)
        defaultValue: ""
        description: ""
        name: NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 027790ac-a175-4ae8-9911-ee791af27c95
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67efcc15-9982-42d9-96ba-bf83f698c3bd
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: NZ_RESIDENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6cad999c-7072-4624-bdfe-08fe18c6388e
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b558311a-c6e2-454d-89d8-446df515a5d9
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: AGE_AT_ADMISSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed57cf98-cd84-482c-adb7-c6b58270f99e
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: Floor(datediff(DAY,s_in_patient_coding_05.patient_date_of_birth,s_in_patient_coding_05.admission_date)/365.25)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c371ca64-e804-460d-ac5c-62e4ed6404bf
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: AGE_AT_DISCHARGE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed57cf98-cd84-482c-adb7-c6b58270f99e
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: Floor(datediff(DAY,s_in_patient_coding_05.patient_date_of_birth,s_in_patient_coding_05.discharge_date)/365.25)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe4e2f38-f80a-44e4-bf92-814989725489
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ORIGINAL_FILE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 65c7bd42-da01-4e21-9a15-1d686fc39af7
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b65722be-e624-4cee-a5ee-850bd0a1b678
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PATIENT_DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed57cf98-cd84-482c-adb7-c6b58270f99e
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82e046ab-e125-4178-8cb7-01aaa6865d14
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: The date that the patient died
        name: PATIENT_DATE_OF_DEATH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5c2ff38-a66e-4814-80ba-d041584351af
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18e998ba-d705-40e2-8489-9a276b17c00f
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: POST_OP_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a4ad07e9-13e8-4dd7-ad97-ea2d99e6f846
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 553eb4a0-952b-45ab-8bda-89f091973a26
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRE_OP_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba15c550-4b25-4b55-821b-8b5877f7e0d0
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82554f03-8f66-4b5a-a9c1-5b31d60b2f5c
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: PRINCIPAL_PAYER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa3494bb-8d52-4d3f-8f8a-cf6b293f047d
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae6f1fe6-212b-4c38-98cc-79023e01bb7c
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 438770e4-3430-41d7-9dc6-7feee318b576
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: |-
              CASE WHEN s_in_patient_coding_05.purchase_unit_code = 'EXCLU' THEN s_in_patient_coding_05.excluded_purchase_unit_code
                          ELSE s_in_patient_coding_05.purchase_unit_code
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a338516c-6cd4-43fd-881c-0e940b9c5389
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: RECORD_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fcd45cab-54ba-4305-9a71-c0ef7461986d
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c72e73e1-660a-4928-81bd-4f7920c4de57
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: NUMERIC(19,5)
        defaultValue: ""
        description: ""
        name: WIES_RATING
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6307af81-e215-4a12-9b1f-07fa0eea3ac3
                stepCounter: 01a05ba7-1d18-4301-93c3-8bfe55c3f782
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98560464-5965-4af5-950d-97fbff50e657
          stepCounter: a832c05d-d821-478c-ae75-b83a2c201fcc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DIM_ADMIN_CATEGORY: cb8ab7aa-8253-4425-bee9-afe3bc46851f
          DIM_ADMISSION_DATE: 9996feda-efbd-41f4-8569-36f5c8b63c75
          DIM_DISCHARGE_DATE: 45fbd3a8-64d0-4be6-b03a-8d128a18b549
          DIM_PATIENT: d52dd438-7899-4242-9e38-539d2a1447df
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_INPATIENT_CHANGES
          - locationName: TGT
            nodeName: DIM_ADMIN_CATEGORY
          - locationName: TGT
            nodeName: DIM_ADMISSION_DATE
          - locationName: TGT
            nodeName: DIM_DISCHARGE_DATE
          - locationName: TGT
            nodeName: DIM_PATIENT
        join:
          joinCondition: |-
            FROM s_inpatient_changes
              JOIN s_in_patient_event_05
                ON s_inpatient_changes.event_encounter_id = s_in_patient_event_05.event_encounter_id
              LEFT OUTER JOIN s_in_patient_coding_05
                ON s_in_patient_event_05.event_encounter_id = s_in_patient_coding_05.event_encounter_id
              LEFT OUTER JOIN {{ ref('TGT','DIM_ADMIN_CATEGORY') }}
                ON s_in_patient_event_05.adcat_refno = dim_admin_category.admin_category_reference_no
               AND dim_admin_category.dss_current_flag ='Y'
              LEFT OUTER JOIN {{ ref('TGT','DIM_ADMISSION_DATE') }}
                ON cast(s_in_patient_coding_05.admission_date AS date) = dim_admission_date.admission_calendar_date
              LEFT OUTER JOIN {{ ref('TGT','DIM_DISCHARGE_DATE') }}
                ON cast(s_in_patient_coding_05.discharge_date AS date) = dim_discharge_date.discharge_calendar_date
              LEFT OUTER JOIN {{ ref('TGT','DIM_PATIENT') }}
                ON IFNULL(s_in_patient_coding_05.patient_NHI,'Unknown') = dim_patient.patient_NHI
               AND dim_patient.NHI_sequence = 1
              LEFT OUTER JOIN (
                    SELECT dim_mother_of_patient_key,
                           personal_carer_patient_reference_no,
                           date_of_birth,
                           modif_dttm,
                           ROW_NUMBER() OVER(PARTITION BY personal_carer_patient_reference_no ORDER BY modif_dttm DESC) row_num
                      FROM dim.dim_mother_of_patient
                     WHERE dss_current_flag = 'Y'
                   ) dim_mother_of_patient
                ON dim_mother_of_patient.personal_carer_patient_reference_no = dim_patient.patient_reference_no
               AND dim_mother_of_patient.row_num = 1
        name: S_IN_PATIENT_CODING_10
        noLinkRefs: []
  name: S_IN_PATIENT_CODING_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
