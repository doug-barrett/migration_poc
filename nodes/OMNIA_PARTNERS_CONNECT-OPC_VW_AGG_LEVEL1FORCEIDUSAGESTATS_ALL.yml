fileVersion: 1
id: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_ALL
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c859b4ac-bcaf-43d1-bb7f-13dac6cd9aa9
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e77a7dc3-430b-4324-9606-f8cbf58b2e8b
                stepCounter: d8595027-9d9c-4b33-a6a2-da78e6c5ec45
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 596a6da3-4684-4f36-91e0-6a673f349671
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbdd4c0f-b54d-40fb-b92e-87bc158230dd
                stepCounter: d8595027-9d9c-4b33-a6a2-da78e6c5ec45
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3136adc-127f-4365-809b-1a39114f63ae
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: LIFETIME_SUMOFSALES
        name: LIFETIME_SUMOFSALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9749e34d-9ec2-4d2b-a573-2a9c5851f074
                stepCounter: d8595027-9d9c-4b33-a6a2-da78e6c5ec45
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ac849c6-b68f-490c-99e4-67b8b31644ac
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: PREVIOUS12MONTHS_SUMOFSALES
        name: PREVIOUS12MONTHS_SUMOFSALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8796eac1-8abb-4e10-84e6-9a7c64c346f5
                stepCounter: 1d1e62fd-bf66-41ee-8583-3ac4d75e34b2
            transform: IFNULL(PREVIOUS12MONTHS_SUMOFSALES,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0c62411-24c8-4078-b8b2-4fde9a1deadc
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: CURRENT12MONTHS_SUMOFSALES
        name: CURRENT12MONTHS_SUMOFSALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 286a26af-892c-449c-8eff-f9870223a49d
                stepCounter: afc466d9-887d-441a-be72-19227d686861
            transform: IFNULL(CURRENT12MONTHS_SUMOFSALES,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf5fdd16-68fd-44d3-a96f-42136c44c367
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        name: CAPITALSPENDLAST3YEARS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93ee3805-60e2-48ec-8b9d-6e651c4dd343
                stepCounter: 33f65956-e0f6-4b70-9e15-7ff55f8b9deb
            transform: IFNULL(CAPITALSPENDLAST3YEARS,0) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec0d8466-3ffe-4e5b-a222-ba12e3e7ff82
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SIGNIFICANTCAPITALSPENDLAST3YEARS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: IFF(OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CAPITALSPEND3YEARS.CAPITALSPENDLAST3YEARS >='{{ parameters.CAPITALSPENDAMOUNT }}','YES','NO') \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5558465c-f71a-4f14-a2a8-8a2da675e28b
          stepCounter: 9c2ad97b-6501-4cb5-8602-b24b0fbf9ed4
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: MAXRECEIPTDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f080346-f5fd-4769-8fad-6b0600e74776
                stepCounter: d8595027-9d9c-4b33-a6a2-da78e6c5ec45
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENT12MONTHS \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY LEVEL1FORCEID) AS CURRENT12MONTHS_NUMOFSUPPLIERSUSED \N , SUM(SALES) AS CURRENT12MONTHS_SUMOFSALES \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(MONTH,TRANSACTIONDATE,MAXRECEIPTDATE) BETWEEN 0 AND 11 \N
               AND SALES IS NOT NULL
               AND SALES <> 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   LEVEL1FEDERALTAXID,
                   SUPPLIERID,
                   FINANCIALREPORTINGSUPPLIERNAME;\N
        dependencies:
          - locationName: OMNIA_PARTNERS_CONNECT
            nodeName: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CAPITALSPEND3YEARS
          - locationName: OMNIA_PARTNERS_CONNECT
            nodeName: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CURRENT12MONTHS
          - locationName: OMNIA_PARTNERS_CONNECT
            nodeName: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_LIFETIME
          - locationName: OMNIA_PARTNERS_CONNECT
            nodeName: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_PREVIOUS12MONTHS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('OMNIA_PARTNERS_CONNECT','OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CAPITALSPEND3YEARS') }}
            {{ ref('OMNIA_PARTNERS_CONNECT','OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CURRENT12MONTHS') }}
            {{ ref('OMNIA_PARTNERS_CONNECT','OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_LIFETIME') }}
            {{ ref('OMNIA_PARTNERS_CONNECT','OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_PREVIOUS12MONTHS') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_ALL
        noLinkRefs: []
  name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_ALL
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
