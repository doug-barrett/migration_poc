fileVersion: 1
id: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
name: S_OUTPATIENT_SLOT_30
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: false
  description: "Get the number of patients booked, by visit type (e.g. FSA, FUP etc), in each time slot."
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 04738ba6-18f5-4486-b23e-67bbf8404f72
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the outpatient session.
        name: OUTPATIENT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6f0adc73-08b8-4ad1-b1a7-79648c9de2ab
                stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b8c2b1d-f0f1-458d-9618-4fac45b1acac
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the slot within an outpatient session.
        name: OUTPATIENT_SLOT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fb3a3e53-d08c-4ad3-a049-ff2a625e37b7
                stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 633561e2-38e5-48ac-90a8-908f5b581f20
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time of the session slot.
        name: SLOT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aaca4bae-fba2-4ff6-9d54-aced9e48af92
                stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7dcf008d-3f2a-4a0f-ab3e-b966916331b2
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: End date and time of the session slot.
        name: SLOT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 794fe9ff-8656-4d25-bb25-a0caf138c201
                stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e9a8283-07ba-46d1-8516-e2d4d73b6886
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FSA appointments booked in the slot.
        name: BOOKED_FSA_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'N' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d2bac4b-051d-4501-b900-b7ef5197887f
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FUP appointments booked in the slot.
        name: BOOKED_FUP_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'O' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 371f54d0-2cad-4b8b-be19-8b41c61f22ea
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of Inpatient appointments booked in the slot.
        name: BOOKED_INPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'INPAT' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 292e7c2c-c8c6-4dc5-8f3b-3853d9bcdf43
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of PAC appointments booked in the slot.
        name: BOOKED_PAC_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'PAC' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3755a26a-82c6-44d9-9f0c-f1f98477f573
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of SOSFU appointments booked in the slot.
        name: BOOKED_SOSFU_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code = 'SOSFU' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09dd06ee-07b9-4dcb-909a-d3e09de56dba
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments booked in the slot that are not FSA, FUP, Inpatient, PAC or SOSFU.
        name: BOOKED_OTHER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(CASE WHEN ds_pims_reference_values.main_code NOT IN ('N','O','INPAT','PAC','SOSFU') THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc4d3f4b-3fbc-4394-8e87-83acc9b14c63
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: MAX(ds_shared_schedule.patient_reference_no)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcbbac3a-5212-48fa-9ec5-76506d939630
          stepCounter: 345ee69a-6f3f-4a4d-9ffd-32e45a0649e9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: STAGE
            nodeName: S_OUTPATIENT_SLOT_20
        join:
          joinCondition: |-
            FROM s_outpatient_slot_20
              JOIN ds_shared_schedule
                ON ds_shared_schedule.service_point_session_reference_no = s_outpatient_slot_20.outpatient_session_reference_no
               AND ds_shared_schedule.start_date <= s_outpatient_slot_20.slot_start_date
               AND ds_shared_schedule.end_date >= s_outpatient_slot_20.slot_end_date
               AND ds_shared_schedule.cancellation_reason_date IS NULL
               AND ds_shared_schedule.schedule_status_code IN ('BOOKD','PLAND')
               AND ds_shared_schedule.schedule_type_code = 'OTPAT'
               AND ds_shared_schedule.attendance_status_code NOT IN ('CANCL','0')
              JOIN ds_pims_reference_values
                ON ds_shared_schedule.visit_type_reference_no = ds_pims_reference_values.rfval_refno
             GROUP BY s_outpatient_slot_20.outpatient_session_reference_no,
                      s_outpatient_slot_20.outpatient_slot_reference_no,
                      s_outpatient_slot_20.slot_start_date,
                      s_outpatient_slot_20.slot_end_date
        name: S_OUTPATIENT_SLOT_30
        noLinkRefs: []
  name: S_OUTPATIENT_SLOT_30
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
