fileVersion: 1
id: 568a849f-e852-4f76-8908-08418c981ec9
name: S_WAITLIST_PREV_NEXT_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3a7ee0c-63f6-4ffa-83c9-139caa169351
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a83949b3-d5d2-4b2d-99e4-5f5496da967c
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 488f3065-6cc3-4f96-aa07-dfc8b90eacd0
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32a65865-0eb6-4808-8f6c-27ee153e889a
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7e5398c-0ce6-4e06-b7fd-f4879c6cbad0
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d50d141-27a8-4fbe-9354-df4b549a776b
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffc42e3f-7e66-4a96-9241-b2bf5e631891
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efa6ad96-5d53-44ff-a679-693d39160f2c
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99347122-22a5-4f32-b4e0-da223b863c17
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc5a06ba-ea76-42f1-b562-3f9cde5f182f
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67fb6626-69a5-4953-8422-31c836749e7c
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 53268b26-ea0b-41bd-aaf9-66822e7ddc3a
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81a6a3fe-86e8-440a-af4e-9840929811b6
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e284cf0-b04e-4a8f-81b6-35ba33174db9
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 427d95ac-0649-4931-ae73-c264285e5e0f
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed869db9-2d52-420d-9624-404c6bcbe632
          stepCounter: 568a849f-e852-4f76-8908-08418c981ec9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_SUSPENSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 108745a8-e30a-4861-8c09-38539d9ad3c3
                stepCounter: 72f452f1-9019-48ad-84d5-32c30b227681
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT curr.wlist_refno waitlist_reference_no ,
                   curr.wlist_date waitlist_date ,
                   curr.refrl_refno referral_reference_no ,
                   curr.spect_refno waitlist_specialty_reference_no ,
                   curr.proca_refno waitlist_clinician_reference_no ,
                   prev.wlist_refno prev_waitlist_reference_no ,
                   prev.wlist_date prev_waitlist_date ,
                   prev.refrl_refno prev_referral_reference_no ,
                   prev.spect_refno prev_waitlist_specialty_reference_no ,
                   prev.proca_refno prev_waitlist_clinician_reference_no ,
                   next.wlist_refno next_waitlist_reference_no ,
                   next.wlist_date next_waitlist_date ,
                   next.refrl_refno next_referral_reference_no ,
                   next.spect_refno next_waitlist_specialty_reference_no ,
                   next.proca_refno next_waitlist_clinician_reference_no ,
                   IFNULL(map.NPF_suspension_exception,0) prev_suspension
              FROM s_waitlist_05 curr
              LEFT OUTER JOIN s_waitlist_05 prev
                ON (prev.patnt_refno = curr.patnt_refno AND prev.patient_waitlist_seq_num = curr.patient_waitlist_seq_num - 1)
              LEFT OUTER JOIN s_waitlist_05 NEXT
                ON (next.patnt_refno = curr.patnt_refno AND next.patient_waitlist_seq_num = curr.patient_waitlist_seq_num + 1)
              LEFT OUTER JOIN s_waitlist_05 prev_r
                ON (prev_r.patnt_refno = curr.patnt_refno AND prev_r.patient_referral_waitlist_seq_num = curr.patient_referral_waitlist_seq_num - 1 AND prev_r.refrl_refno =curr.refrl_refno)
              LEFT OUTER JOIN l_mappings_WaitlistCategories map
                ON map.wlrul_refno = prev_r.local_wlrul_refno
        dependencies:
          - locationName: TGT
            nodeName: S_WAITLIST_05
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','S_WAITLIST_05') }}
        name: S_WAITLIST_PREV_NEXT_V
        noLinkRefs: []
  name: S_WAITLIST_PREV_NEXT_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
