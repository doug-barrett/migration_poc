fileVersion: 1
id: b33f9650-e857-424d-aaab-09e623026abe
name: S_EVITALS_REGIME_PARENT_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ab75d90-4141-4117-bc44-fc2c88bf51b3
          stepCounter: b33f9650-e857-424d-aaab-09e623026abe
        config: {}
        dataType: INT
        defaultValue: ""
        description: regime key
        name: EWSRG_PK
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ac832674-2bad-49be-8150-77acd93b0a20
                stepCounter: 776bd7c7-3bfb-4ee5-ade4-14347f752e64
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23e333ee-001b-4309-820b-e6b00935d38c
          stepCounter: b33f9650-e857-424d-aaab-09e623026abe
        config: {}
        dataType: INT
        defaultValue: ""
        description: Parent regime
        name: PARENT_EWSRG_PK
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb3ef784-2f34-4f19-8d38-b8c35cd085e7
                stepCounter: 776bd7c7-3bfb-4ee5-ade4-14347f752e64
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d469d89-f42c-44e3-986e-787f608a8969
          stepCounter: b33f9650-e857-424d-aaab-09e623026abe
        config: {}
        dataType: VARCHAR(1000)
        defaultValue: ""
        description: Parent Regime description
        name: PARNT_DESC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1a890aa5-5a74-44cc-9f2e-ff67c02fb194
                stepCounter: 776bd7c7-3bfb-4ee5-ade4-14347f752e64
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            WITH CTE AS (
                    SELECT EWSRG_PK,
                           PARENT_EWSRG_PK,
                           description,
                           cast(1 AS int) lvl
                      FROM l_patientrack_EWS_REGIME
                 UNION ALL SELECT cte.EWSRG_PK,
                           EWS_REGIME.PARENT_EWSRG_PK,
                           EWS_REGIME.description,
                           lvl + 1 LVL
                      FROM cte
                     INNER JOIN l_patientrack_EWS_REGIME EWS_REGIME
                        ON EWS_REGIME.EWSRG_PK = cte.PARENT_EWSRG_PK
                   ) SELECT EWSRG_PK,
                   PARENT_EWSRG_PK UltimateParnt,
                   description Parnt_Desc
              FROM (
                    SELECT * ,
                           row_number () OVER (PARTITION BY EWSRG_PK ORDER BY lvl DESC) rn
                      FROM CTE
                     WHERE PARENT_EWSRG_PK IS NOT NULL
                   ) S
             WHERE rn =1
            UNION ALL SELECT EWSRG_PK,
                   EWSRG_PK PARENT_EWSRG_PK,
                   description
              FROM l_patientrack_EWS_REGIME
             WHERE PARENT_EWSRG_PK IS NULL
        dependencies:
          - locationName: TGT
            nodeName: L_PATIENTRACK_EWS_REGIME
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','L_PATIENTRACK_EWS_REGIME') }}
        name: S_EVITALS_REGIME_PARENT_V
        noLinkRefs: []
  name: S_EVITALS_REGIME_PARENT_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
