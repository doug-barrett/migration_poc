fileVersion: 1
id: 01d03042-485b-43a7-beb8-17843d78c8b9
name: S_ETHNICITY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Ethnicity Codes and Descriptions"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56fe8db4-4320-4858-8ccf-be5c3f688289
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: ETHNICITY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97c66cf3-4136-413e-a8e6-8c887c727822
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: ETHNICITY_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55be5a7d-29f5-4ab5-9eae-1f039e41c05a
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ETHNICITY_PRIORITY_GROUP_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a76717e-24b4-46fa-a453-c2cd4b8ea888
                stepCounter: e200e5c7-4529-4ca2-9123-a47c3b807a18
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f396e5f-6a0e-437c-9a3e-66c43da540d6
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: ETHNICITY_GROUP_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b4bb4b1-2bb5-4a2e-b918-128b64fc2b7b
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ETHNICITY_PRIORITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5edd2f6-f648-43e7-b8b2-303e4c17a025
                stepCounter: e200e5c7-4529-4ca2-9123-a47c3b807a18
            transform: CONVERT(integer,ds_pims_reference_value_ids.identifier)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d6d1327-728d-4dc1-8dbd-1ae522a6d1dd
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: MoH_ethnicity_code
        name: MOH_ETHNICITY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE WHEN isnumeric(ds_pims_reference_value_ids_1.identifier) = 1 THEN ds_pims_reference_value_ids_1.identifier
                          ELSE 99
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4b77137-488c-47bc-8f15-cf486a2ab167
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: RFTYP_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 32cf4b62-0326-43ef-aa47-96886bd6d57a
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f8f61fb-0328-4c98-b9dd-8193d2d57b91
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d93e8a96-b2c6-4ecb-bd0a-f2f089d15d02
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 836f605b-5e14-4a83-b376-90da882d5632
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b83a3aaf-eb08-4e0f-b5c8-1be21d38ef47
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: IFNULL(ds_pims_reference_values.end_dttm, CONVERT(datetime, '20440630', 112))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00c8b75c-9cc5-424b-910f-0bab238f4a69
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(80)
        defaultValue: ""
        description: Health Ethnicity Description
        name: HEALTH_ETHNICITY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e506aec0-a412-428f-a9db-77c199a911fc
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.lvl2_descr,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4590f6a-596f-44c3-aa00-b78507480de9
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(10)
        defaultValue: ""
        description: Health Ethnicity Level0 Code
        name: HEALTH_ETHNICITY_LEVEL0_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d09fa813-d630-4d9c-9923-588767ac85a5
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.lvl0_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e29874f9-b073-455c-8237-422a1afd873d
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(80)
        defaultValue: ""
        description: Health Ethnicity Level0 Description
        name: HEALTH_ETHNICITY_LEVEL0_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d47b0199-7f44-4954-812a-ee6eb6c1bcaf
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.lvl0_desc,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a43eb60-9599-427b-9a27-77f1c9df258f
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(10)
        defaultValue: ""
        description: Health Ethnicity Level1 Code
        name: HEALTH_ETHNICITY_LEVEL1_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a663bd53-3f3c-432b-8c87-738c772aba78
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.lvl1_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f42617af-120e-4ae8-8b5d-bc6fabf88180
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(80)
        defaultValue: ""
        description: Health Ethnicity Level1 Description
        name: HEALTH_ETHNICITY_LEVEL1_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb141bbf-2e74-47c4-a521-0179d4fe7cc3
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.lvl1_desc,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28aeec32-55a6-41c7-8b42-04e1472a90cb
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(80)
        defaultValue: ""
        description: Health Ethnicity Level1 Alternate1 Description
        name: HEALTH_ETHNICITY_LEVEL1_ALT1_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 23b77705-aa1c-49d4-8e3a-073daf86cce0
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.custom_lvl_w1_desc,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f91ee650-a6a0-4dd9-b8a0-44adc05bc644
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: NVARCHAR(80)
        defaultValue: ""
        description: Health Ethnicity Level1 Alternate2 Description
        name: HEALTH_ETHNICITY_LEVEL1_ALT2_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fd95803-5485-495e-af96-a3ecf33d9ce4
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: IFNULL(l_reference_MOH_Ethnicity.custom_lvl_w2_desc,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8734c5f7-0e3a-486b-b2a0-e5fa92cc1fbb
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Health Ethnicity Priority
        name: HEALTH_ETHNICITY_PRIORITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 04184413-e561-4a0b-b041-532ee85286b1
                stepCounter: d207e192-df61-4ae4-8bb6-11e9518654e6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fd0b348f-1b5e-4fa8-8726-ed094f546042
          stepCounter: 01d03042-485b-43a7-beb8-17843d78c8b9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_REFERENCE_VALUES
        join:
          joinCondition: |-
            FROM ds_pims_reference_values
             INNER JOIN ds_pims_reference_value_ids
                ON ds_pims_reference_value_ids.rityp_code = 'PRIG'
               AND ds_pims_reference_value_ids.rfval_refno = ds_pims_reference_values.rfval_refno -- AND getdate() BETWEEN ds_pims_reference_values.start_dttm AND IFNULL(ds_pims_reference_values.end_dttm,getdate())          LEFT OUTER JOIN l_reference_MOH_Ethnicity       ON l_reference_MOH_Ethnicity.code = ds_pims_reference_values.main_code      -- AND getdate() BETWEEN l_reference_MOH_Ethnicity.start_date AND IFNULL(l_reference_MOH_Ethnicity.end_date,getdate())                  LEFT JOIN ds_pims_reference_value_ids ds_pims_reference_value_ids_1          ON ds_pims_reference_value_ids_1.rityp_code = 'NZNHI'       AND ds_pims_reference_value_ids_1.rfval_refno = ds_pims_reference_values.rfval_refno       -- AND getdate() BETWEEN ds_pims_reference_values.start_dttm AND IFNULL(ds_pims_reference_values.end_dttm,getdate())
        name: S_ETHNICITY
        noLinkRefs: []
  name: S_ETHNICITY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
