fileVersion: 1
id: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
name: S_PJ_PATHWAY_PROCEDURE_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Map events to pathways via DRG codes."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45b9797a-ea8b-420c-a753-88ccf01e8aef
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique ID for a patient journey
        name: JOURNEY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f7dd4ca-4b72-4471-8e15-dd1ec0a54c3c
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f8a54ee-71b7-4f2b-a7e5-1fa254571e55
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7f60003-b7a5-4f17-92d1-b8cb3e8fce89
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c91e1e1-c067-40c3-9412-a891130982b4
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Journey number for the patient.
        name: JOURNEY_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8017333-8bf1-48d8-ae28-60f8be1ba8fd
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5a33e155-9b6a-4897-b917-8ce7d41826e9
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93ccb223-fdae-4534-acd8-e49b67852ffc
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ICD_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: "''"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f542e4b-6890-49fc-8069-91ebc87a23a2
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: ICD_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: "''"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fdf5657-1134-40df-a5ab-ce85838d6afe
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(200)
        defaultValue: ""
        description: ""
        name: PROCEDURE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19ecab83-7429-4f28-854b-dc29d0c45af0
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c89102f9-96d5-4f2d-8a30-17a9dce4ab4a
                stepCounter: c9ea96b1-10f0-4480-aff0-b535fb105991
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bb39393-9c29-423a-8b70-423ed2533808
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DRG_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 82b75e7d-4a9d-4952-823d-c3c9352d871e
                stepCounter: c9ea96b1-10f0-4480-aff0-b535fb105991
            transform: d2.DRG_desc
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6b0bf13-47a5-4b7c-b67a-40426bf437c7
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_ICD_CODE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ad5ab6a-109d-4ec2-be67-bd26c4d3fea8
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_DRG_CODE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9ed08342-78bf-4d93-b0f4-9584d50c3276
                stepCounter: d65ecd15-3433-489d-a0c0-81d8d3ac4642
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7484125c-f72f-4934-9648-4e0ee829e3cf
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_ED_TREATMENT_PROTOCOL_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97e7ddf0-6f6c-4f87-be6d-2c223fe6e604
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_THEATRE_BOOKING_PROCEDURE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88e16150-fe07-45cd-9d87-563997454998
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_THEATRE_PROCEDURE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2437a63d-108a-44ff-ad43-ae5578135126
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: CODE_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c73b2a9d-2c47-46ec-8c40-d62485371c8e
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a9572ea-b3b4-46fd-8903-1190b6de9e19
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATHWAY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eeb7b32b-8f2a-437f-8a26-00aa90fc341e
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8c0bbb7-45e4-43d4-bd6f-1d6f9fb3eb80
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PATHWAY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 822a56ac-8b7d-465d-a60d-afe98e705c59
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 94f9feab-3244-4031-b232-2bf762ce469f
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6f9c4f67-e8f2-4ec7-b342-4ffc0a502a3f
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2c2fb91-a738-426f-b3b5-5dcc5cbdbdbb
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_SPECIALTY_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b85a1e98-f006-44f3-b271-293c15237feb
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd73af7e-b04d-486d-94ff-8cc050a639b2
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TREATMENT_PROTOCOL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e009f44-734a-4289-8221-7835e51a48eb
                stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c45bab05-81c6-4a14-a5fc-64a5067103e9
          stepCounter: 1a9aacee-e49a-46c8-97ac-a77e125f72d5
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_PJ_EVENT
        join:
          joinCondition: |-
            FROM s_PJ_event
              JOIN fact.fact_inpatient_clinical_coding
                ON s_PJ_event.ip_encounter_id = fact_inpatient_clinical_coding.event_encounter_ID
              JOIN dim.dim_DRG_code
                ON fact_inpatient_clinical_coding.dim_DRG_code_key = dim_DRG_code.dim_DRG_code_key
              LEFT OUTER JOIN -- Multiple rows per DRG_code so get DRG_desc from latest row   (SELECT DRG_code, DRG_desc    FROM dim.dim_DRG_code    WHERE financial_year =     (SELECT MAX(financial_year) FROM dim.dim_DRG_code WHERE dim_DRG_code_key > 0)   ) d2  ON dim_DRG_code.DRG_code = d2.DRG_code    JOIN s_PJ_pathway_code_xref  ON dim_DRG_code.DRG_code = s_PJ_pathway_code_xref.DRG_code    WHERE s_PJ_event.event_source = 'IP'  AND   s_PJ_event.coded_flag = 1
        name: S_PJ_PATHWAY_PROCEDURE_20
        noLinkRefs: []
  name: S_PJ_PATHWAY_PROCEDURE_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
