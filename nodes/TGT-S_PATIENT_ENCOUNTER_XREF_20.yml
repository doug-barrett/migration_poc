fileVersion: 1
id: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
name: S_PATIENT_ENCOUNTER_XREF_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c215bc8-2538-4e9e-8dd2-9d2000d8a002
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c61adf0c-acce-43b3-a981-036da7f0d3fc
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f59a8629-1705-4155-b101-8590aaf86cd6
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_patient_encounter_xref_20.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2210f02-96c4-46e3-95e1-a45f7aff1b7e
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985f0ba0-97cf-4152-a49b-7e86cb71409e
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: |-
              CASE WHEN IFNULL(dim_patient.dim_patient_key,0) = 0 AND s_patient_encounter_xref_10.patient_reference_no IS NOT NULL THEN 'Unknown '+CONVERT(varchar,s_patient_encounter_xref_10.patient_reference_no)
                          ELSE dim_patient.patient_NHI
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03ed0576-a898-4ec8-8c84-9cc11f6f4231
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_AGE_ON_ARRIVAL_YEARS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f201416-ac35-4870-a0c1-0836d1b9e5b7
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: FLOOR(DATEDIFF(dd,dim_patient.patient_date_of_birth, CASE WHEN IFNULL(dim_patient.patient_date_of_death,s_patient_encounter_xref_10.encounter_start_date) < s_patient_encounter_xref_10.encounter_start_date THEN IFNULL(dim_patient.patient_date_of_death,s_patient_encounter_xref_10.encounter_start_date) ELSE s_patient_encounter_xref_10.encounter_start_date END) / 365.25)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f98a7384-b959-4b3e-98ae-031b5af8c11e
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_AGE_ON_ARRIVAL_MONTHS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f201416-ac35-4870-a0c1-0836d1b9e5b7
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: FLOOR(DATEDIFF(mm,dim_patient.patient_date_of_birth, CASE WHEN IFNULL(dim_patient.patient_date_of_death,s_patient_encounter_xref_10.encounter_start_date) < s_patient_encounter_xref_10.encounter_start_date THEN IFNULL(dim_patient.patient_date_of_death,s_patient_encounter_xref_10.encounter_start_date) ELSE s_patient_encounter_xref_10.encounter_start_date END) % 12)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 29d14369-3c7c-43d3-b1ea-5696363c4c86
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_patient_encounter_xref_20.patient_age_on_arrival_years=dim_age_group.age_years
        name: DIM_AGE_GROUP_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18bfabd7-19aa-4de0-9ce7-aa560645bce6
                stepCounter: 3d5ba8a8-80ec-4848-b58a-d31b34cc53ed
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ebe395a7-f57a-45e3-9c1d-34b96ddf93d0
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: PATIENT_DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 13e3f44a-7125-438f-b00f-42c54a307c05
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f62e5997-04d0-458a-b8d5-5874161e4d99
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_patient_encounter_xref_20.patient_domicile_code=dim_domicile.domicile_code
        name: DIM_DOMICILE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e049fc8-a2a3-4bad-9b91-11b9d158b35e
                stepCounter: 330ad0aa-b8b1-4da9-ab37-b4fe8f889452
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1ea676b-609e-4c37-a5a9-b513bc73e673
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_ENCOUNTER_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 715860f9-b381-484d-9012-fa3f6b0d741c
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56de10fe-b213-4d37-a927-f8e0fd7ee4d4
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_ENCOUNTER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38cd94b9-fc0c-4092-b83f-7757408d1b50
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4d7e695-8043-496f-8f8f-35f04de5f3f0
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: REFERRAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 39880b31-164f-4a89-8557-8c94c3bca31c
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 699edefa-6e11-443f-9901-b5a1834fa357
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: ENCOUNTER_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d4f4e30-f436-492e-8ee2-c44dcbf85f74
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7080e3cb-77d2-43bf-9cc9-9d02b0b0e006
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: ENCOUNTER_TYPE_CODE_EXTN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b919044-281a-4887-ba0b-f6f654b39c48
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 236654c7-3e29-4e15-bbbf-35d377707b83
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_patient_encounter_xref_20.encounter_type_code=dim_encounter_type.encounter_type_code
        name: DIM_ENCOUNTER_TYPE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3ba8df3-db2e-40a1-97dc-d5ad6a5186a7
                stepCounter: 1d0ea6a1-9563-4fb3-a1fa-9d43dbdf296e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84f3c4f4-d6d8-4e15-b3d3-dbfc935a3c0d
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5ae2a69-0bba-4c16-b31b-2c1453c24eee
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7316c50-7a2e-4674-ae07-41004783a045
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ENCOUNTER_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0dcb0c46-b8eb-40e1-ad98-d0badb43bdf4
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42f3cf6c-6a90-4b9a-a6e2-e26a64bcdef2
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ENCOUNTER_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9d79ad9f-e883-48a6-b299-180658693be7
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: IFNULL(s_patient_encounter_xref_10.encounter_start_date,s_patient_encounter_xref_10.encounter_end_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a704a586-dcaf-4852-9fe9-456e498c9634
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_encounter_xref_20.CONVERT(date,encounter_start_date)=dim_start_date.start_calendar_date
        name: DIM_START_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4e465c3-6432-4578-b9e4-7938382edf1c
                stepCounter: b5d2a386-b1bd-4a43-9c5e-529fea37aabc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24cd010f-19f2-4a42-ab3f-1d5f7c97b91c
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ENCOUNTER_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 572c6778-a015-40d3-a030-815731e12b67
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: s_patient_encounter_xref_10.encounter_end_date
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3f97bb2-300b-4c1b-a6f5-4d8479218f94
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_patient_encounter_xref_20.CONVERT(date,encounter_end_date)=dim_end_date.end_calendar_date
        name: DIM_END_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4d9153c2-cb24-4faa-b10e-532b545578f9
                stepCounter: 877af827-33b7-4837-bc4a-455508456121
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed366789-31db-4fbc-8bee-65bd0aa60f80
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DSS_DATA_QUALITY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b241b344-1654-4c9f-b88f-a216b2bf8241
                stepCounter: 0a559a56-196f-4906-bb39-293156133502
            transform: |-
              CASE WHEN dim_patient.patient_NHI IS NULL THEN CASE WHEN s_patient_encounter_xref_10.dss_data_quality_code IS NULL THEN 'PATNT' ELSE s_patient_encounter_xref_10.dss_data_quality_code+',PATNT' END
                          ELSE s_patient_encounter_xref_10.dss_data_quality_code
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c09c31e8-19d6-463e-94b3-b81ccc48acfd
          stepCounter: e5baaac1-c3ea-498b-83f1-a0ab544d80ce
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_PATIENT_ENCOUNTER_XREF_10
        join:
          joinCondition: FROM s_patient_encounter_xref_10
        name: S_PATIENT_ENCOUNTER_XREF_20
        noLinkRefs: []
  name: S_PATIENT_ENCOUNTER_XREF_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
