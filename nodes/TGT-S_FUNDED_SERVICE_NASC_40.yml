fileVersion: 1
id: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
name: S_FUNDED_SERVICE_NASC_40
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ba5b314-b6dc-4b45-9e49-fa174bb9d09c
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: NUMERIC(18)
        defaultValue: ""
        description: ""
        name: PATIENT_PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: deca1bc9-4cdc-4835-a6ba-dda3432f27b4
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b785ad2e-f84c-4eef-851d-534445b92d05
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: STREAM_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8a5bb00f-a924-4ae1-805a-c2e7a36fd2cc
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e4bc59-4676-4154-9163-ddbb24e7f4b8
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f37a67ef-b003-4360-b8b8-0504c13ec8f1
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: abe41078-69ab-4e0d-8175-101c5ddceb4d
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: TASK_ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f37a67ef-b003-4360-b8b8-0504c13ec8f1
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ROW_NUMBER() OVER(PARTITION BY stream_id, service_provider, service_funder, service_start_date ORDER BY task_request_id DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60076b4c-d4d9-4ca2-a4b7-959b9bdb0926
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: TASK_ROW_NUM2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f37a67ef-b003-4360-b8b8-0504c13ec8f1
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: |-
              CASE WHEN task_row_num = 1 -- Most recent task
              THEN ROW_NUMBER() OVER(PARTITION BY stream_id, service_provider, service_funder, service_start_date, CASE WHEN task_row_num = 1 THEN 1 ELSE 0 END ORDER BY task_request_id DESC)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c980d8cb-9102-4e9d-8cc0-8b9c22e31b5e
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb694edf-ae9f-41cd-83b2-bb9314cb333d
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84e59ae7-c8e7-436f-b4ae-a4b80ea97497
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ef8e7166-2913-483e-8f2e-ca173efa1be5
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce33c912-4f6b-470a-b44d-9b700736abf6
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ATOMIC_OBSERVATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d50c6cc7-310b-40d2-a2d7-893f270d3ff2
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f70a63a-7498-419b-94b7-cd69a0922369
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: PLACEMENT_SOURCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1668fbe-521c-463e-a34c-2d6450d26bb5
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a499ba0f-b698-4359-9084-3025a4ec3a5f
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: PLACEMENT_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8183c5f5-9aea-41f6-a6d3-8087af8049d6
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01e27ccc-41d6-486a-9284-ff8f8aa73055
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Uniquely identifies each funded service row. Set to the MIN child_atomic_observation_id for each child row within the atomic_observation_id.
        name: FUNDED_SERVICE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d69eceeb-f797-4756-9618-cf138c55faf8
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a1833fc-fa46-48fd-b54c-eb401acbd331
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_PROVIDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b2c9406-012b-43f3-adea-43cbb79de0e6
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d15dfd75-9c6e-4fd4-a4f8-79e8d36145d7
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_FUNDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cff3022d-9e10-4c1e-a9c8-2ddce56668b3
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64314dd5-ad4c-46a9-8ed1-b16e3fa363c6
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SERVICE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8f62ed2-89a9-41d1-ac08-056840450251
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7925b80c-778a-4c95-9ba6-b6d89df1de57
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea47e224-ce76-456c-b463-f9e32c797df6
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0eee821-f0e1-4319-8834-a966c7d2bb4c
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SERVICE_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d52fecc0-c6aa-4211-baff-e67417d89e2e
                stepCounter: 223207b9-1b49-4110-984f-6ff8183217c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 200202c8-d3f0-4fce-90fa-ba9c4161da29
          stepCounter: 49dea958-f61a-4c5e-95f6-57d43fe2a56d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_FUNDED_SERVICE_NASC_30
        join:
          joinCondition: |-
            FROM s_funded_service_NASC_30
             WHERE observation_report_status IN ('A','F') -- A=Finalised F=Completed  AND service_funder = 'DSS'  AND service_desc = 'Residential Placement'   AND service_reason NOT IN ('Change in Start Date','Operator Error')
        name: S_FUNDED_SERVICE_NASC_40
        noLinkRefs: []
  name: S_FUNDED_SERVICE_NASC_40
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
