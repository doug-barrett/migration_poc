fileVersion: 1
id: 3a063457-fddc-4654-9856-f68c8de54f16
name: S_WAITLIST_SUSPENSION_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c27d6a65-9514-441b-a2f6-be49bcc2391d
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_SUSPENSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98193a8d-7e08-404d-b138-9d687845b628
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6bf19c3-5c29-4b28-ac48-4339b7c4b2ff
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f9b85551-7004-465a-8bed-b7b2a9405122
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 081c6642-ef75-482b-b768-6f80e2468488
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a856f5c2-e939-4437-8e80-56904b4d889c
                stepCounter: 27157083-4019-40ef-b39f-a70b955092ef
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f90fb2f9-9db1-4e4f-8f7d-d3fa6f18e38b
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8e25c9-7a3c-446d-b6ba-d91333ebfb6e
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30682727-ad3d-4585-bd7a-7ac3ced11cea
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_SUSPENSION_REASON_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a4a43afc-6371-40a7-b875-d402020847c4
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03900750-0941-4da8-ba24-76124f2a06b0
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITLIST_REVIEW_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ff1646c-33c1-465e-aaaa-cb9958090573
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a90df77-fbf3-4f67-bf08-d6cfe3d21643
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITLIST_SUSPENSION_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e286681b-8168-489e-9754-6bd0cadfeea7
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9957c7eb-7bea-41d6-9b9d-dc6859bef186
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITLIST_SUSPENSION_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c69fd08-4564-4cdc-8055-c33a0d697646
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: IFNULL(ds_pims_waiting_suspensions.end_dttm, ds_shared_waitlist.remvl_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 037fc100-4fb0-4c41-bfd3-6ba2ddc51a1b
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INT
        defaultValue: ""
        description: Days to date for which the patient has been suspended
        name: WAITLIST_SUSPENSION_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c69fd08-4564-4cdc-8055-c33a0d697646
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: |-
              CASE WHEN ds_pims_waiting_suspensions.start_dttm > ds_shared_waitlist.remvl_date                                             THEN 0
                          WHEN ds_pims_waiting_suspensions.start_dttm > GETDATE()                                                                 THEN 0
                          WHEN ds_shared_waitlist.remvl_date IS NOT NULL AND ds_shared_waitlist.remvl_date < ds_pims_waiting_suspensions.end_dttm THEN datediff(dd,ds_pims_waiting_suspensions.start_dttm, ds_shared_waitlist.remvl_date)
                          WHEN IFNULL(ds_pims_waiting_suspensions.end_dttm ,ds_shared_waitlist.remvl_date) > GETDATE()                            THEN datediff(dd ,ds_pims_waiting_suspensions.start_dttm,GETDATE())
                          ELSE datediff(dd ,ds_pims_waiting_suspensions.start_dttm ,IFNULL(IFNULL(ds_pims_waiting_suspensions.end_dttm ,ds_shared_waitlist.remvl_date),getdate()))
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91a7d9f6-28ab-43ce-80bd-d94b66556f83
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: INT
        defaultValue: ""
        description: Shows days suspended including those that are planned
        name: WAITLIST_SUSPENSION_DAYS_PLANNED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c69fd08-4564-4cdc-8055-c33a0d697646
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: |-
              CASE WHEN ds_pims_waiting_suspensions.start_dttm > ds_shared_waitlist.remvl_date                                               THEN 0
                          WHEN ds_shared_waitlist.remvl_date < IFNULL(ds_pims_waiting_suspensions.end_dttm,ds_pims_waiting_suspensions.review_dttm) THEN datediff(dd,ds_pims_waiting_suspensions.start_dttm,ds_shared_waitlist.remvl_date)
                          WHEN ds_pims_waiting_suspensions.review_dttm < getdate()                                                                  THEN datediff(dd,ds_pims_waiting_suspensions.start_dttm,GETDATE())
                          ELSE datediff(dd,ds_pims_waiting_suspensions.start_dttm, IFNULL(IFNULL(ds_pims_waiting_suspensions.end_dttm,ds_shared_waitlist.remvl_date), ds_pims_waiting_suspensions.review_dttm))
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a35a0167-7a01-4655-b107-700c61c28ffa
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COMMENTS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26d5061e-cd2b-4228-9022-17a8d88772ad
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2daef8a-fb76-4acb-b24e-152ccb462622
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: ACTIVE_SUSPENSION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN getdate() BETWEEN ds_pims_waiting_suspensions.start_dttm AND IFNULL(IFNULL(ds_pims_waiting_suspensions.end_dttm,ds_shared_waitlist.remvl_date),getdate()+1) THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ad812a1-bba7-4476-aa38-64da80a97394
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ec0835b-498f-4b1e-8059-fef0a29aa747
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d96ea95a-d6fe-43ad-a8d3-f1e2bffc0336
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fa18850-3f5f-4750-abe0-47a5992a17b2
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 708b481c-89e4-4d59-985b-b52945099209
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e06321d-2a02-4cef-af1e-b7c1adc5636f
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d564669c-fa03-452e-beee-ea6672924d5f
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 08892767-8665-4ccd-b16f-83c823cabd0e
                stepCounter: c9f351ee-0907-450c-9d08-85ae9f96bdba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da9be8af-2de9-45b3-809b-6fc865745269
          stepCounter: 3a063457-fddc-4654-9856-f68c8de54f16
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_SHARED_WAITLIST: 27157083-4019-40ef-b39f-a70b955092ef
          DS_PIMS_PATIENTS: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_WAITING_SUSPENSIONS
          - locationName: TGT
            nodeName: DS_SHARED_WAITLIST
          - locationName: TGT
            nodeName: DS_PIMS_PATIENTS
        join:
          joinCondition: |-
            FROM ds_pims_waiting_suspensions
              JOIN {{ ref('TGT','DS_SHARED_WAITLIST') }}
                ON ds_pims_waiting_suspensions.wlist_refno = ds_shared_waitlist.wlist_refno
              JOIN {{ ref('TGT','DS_PIMS_PATIENTS') }}
                ON ds_shared_waitlist.patnt_refno = ds_pims_patients.patnt_refno
              JOIN dbo.s_waitlist_09
                ON s_waitlist_09.wlist_refno = ds_shared_waitlist.wlist_refno
        name: S_WAITLIST_SUSPENSION_10
        noLinkRefs: []
  name: S_WAITLIST_SUSPENSION_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
