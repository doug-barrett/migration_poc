fileVersion: 1
id: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
name: S_FUNDED_SERVICE_NASC_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Flatten out the individual data item rows for each form into a single row."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f12345c5-89d0-43c9-8c2b-0e88fffcc5d9
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ATOMIC_OBSERVATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e229fff-bd59-423c-80c0-0c3d869f3997
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e54bfbbf-4cde-48f8-afca-c6437c1f428a
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ROW_INDEX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b19e68ae-441a-4e27-8184-19abfb2ceff4
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0213e990-5fab-42d6-b6a0-d1666526e280
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Uniquely identifies each funded service row. Set to the MIN child_atomic_observation_id for each child row within the atomic_observation_id.
        name: FUNDED_SERVICE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa8f835d-031e-43f0-a473-7d4d43e78c0d
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MIN(ds_cdsswe_child_atomic_observation.child_atomic_observation_id)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c19e419f-f308-41c1-bc8c-ad814e701ded
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: SERVICE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'No' THEN CONVERT(tinyint, NULLIF(ds_cdsswe_child_atomic_observation.value, '')) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c55bed29-05ad-427f-9e09-42ad04c8f673
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Type' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 50) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b584b5a6-8e77-4cf9-9b57-a85b845044eb
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_PROVIDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Provider' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 50) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d9c5d67-1377-4edc-82a2-01103c54c09e
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_FUNDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Funder' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 50) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5762d350-cbd6-4ead-803e-bbf3c78ed506
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SERVICE_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Unit' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 20) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 863de25a-0cc4-445f-84ef-1165dec1dc9b
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: SERVICE_FREQUENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Frequency' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 10) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa068385-a5af-4c20-8538-c84f03dc97d5
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SERVICE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(try_CONVERT(date, CASE WHEN l_cdsswe_table_child_data.identifier = 'StartDate' THEN LEFT(NULLIF(ds_cdsswe_child_atomic_observation.value, ''), 10) ELSE NULL END, 103))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5dbc81a5-24f3-421e-a926-07f8facfaaf5
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SERVICE_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(try_CONVERT(date, CASE WHEN l_cdsswe_table_child_data.identifier = 'EndDate' THEN LEFT(NULLIF(ds_cdsswe_child_atomic_observation.value, ''), 10) ELSE NULL END, 103))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97c5d972-36b9-471f-a581-10c1847b885c
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: NUMERIC(9,3)
        defaultValue: ""
        description: ""
        name: SERVICE_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Volume' THEN CONVERT(numeric(9,3), NULLIF(ds_cdsswe_child_atomic_observation.value, '')) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 582b3fb9-6e6b-4c40-bb2f-cd4872a16409
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: NUMERIC(6,2)
        defaultValue: ""
        description: ""
        name: SERVICE_UNIT_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Rate' THEN CONVERT(numeric(10,2), NULLIF(ds_cdsswe_child_atomic_observation.value, '')) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfcebfb2-d782-43e7-be7f-548cefa27a05
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: NUMERIC(10,2)
        defaultValue: ""
        description: ""
        name: SERVICE_WEEK_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'WeekCost' THEN CONVERT(numeric(10,2), NULLIF(ds_cdsswe_child_atomic_observation.value, '')) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e7e95b6-e721-4267-a3ba-8ac114b9168e
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SERVICE_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'Reason' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 30) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c62c0a2-7f53-44f2-b0d2-86749b62130a
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: RESIDENTIAL_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b1b10a-0250-48f6-a13a-ad23821f781c
                stepCounter: d1bfbfb3-2dca-4203-8229-98b5c86088ac
            transform: MAX(CASE WHEN l_cdsswe_table_child_data.identifier = 'ResidentialType' THEN LEFT(ds_cdsswe_child_atomic_observation.value, 30) ELSE NULL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 094a7bf0-faa0-40b9-bcff-73738e4126f3
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Dummy column added so that join to l_cdsswe_table_child_data is visible in Red meta data.
        name: COLUMN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd5cb3e1-9590-460b-a87a-4fecda4664b8
                stepCounter: 4517bf5e-2d08-4cf9-bc8e-2a656128a72c
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8415877-bf3b-45a5-ad89-f58a10a557a1
          stepCounter: 7a4a02ac-0522-45d8-895c-882d9a0e6b19
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_CDSSWE_CHILD_ATOMIC_OBSERVATION
        join:
          joinCondition: |-
            FROM ds_cdsswe_child_atomic_observation
              JOIN l_cdsswe_table_child_data
                ON l_cdsswe_table_child_data.table_child_data_id = ds_cdsswe_child_atomic_observation.child_datatype_id
             GROUP BY ds_cdsswe_child_atomic_observation.atomic_observation_id,
                      ds_cdsswe_child_atomic_observation.row_index
        name: S_FUNDED_SERVICE_NASC_20
        noLinkRefs: []
  name: S_FUNDED_SERVICE_NASC_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
