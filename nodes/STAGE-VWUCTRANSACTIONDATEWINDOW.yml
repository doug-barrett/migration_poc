fileVersion: 1
id: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
name: VWUCTRANSACTIONDATEWINDOW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46d3ac74-b98a-4cc5-87a4-3a6f89b5840d
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1daf3e61-ad6b-4492-b92f-66767738d433
                stepCounter: 40cf7875-acc4-42da-8432-28af78987aa6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46df5833-5d04-4d67-8135-67f2419f4a3d
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0bee434-e4e0-4ef1-863a-917937742e81
                stepCounter: 3c72e38a-b86e-42a5-94a2-7e42613453e7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8cc1798c-4aaf-4743-a3f6-bca5e8de7b9b
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22c5b873-b97c-411b-bdc4-5326dade4585
                stepCounter: 3c72e38a-b86e-42a5-94a2-7e42613453e7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a9db745-00c7-4a71-a7d9-5f9858a5d018
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 656faac1-f122-4b5a-8ba3-3015b5ed89ec
                stepCounter: 3c72e38a-b86e-42a5-94a2-7e42613453e7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a891a74f-eb2d-4ebd-a6c6-7f3f39791637
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 465a30b7-0c67-4cb9-b401-f24b0f832e18
                stepCounter: 3c72e38a-b86e-42a5-94a2-7e42613453e7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0150e24-46f4-4dea-a8d6-41deb8ad42a8
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: LEADING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.LEADINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.LEADINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7e371593-1423-42d6-bcf1-cacb293b4a31
          stepCounter: a57b6f11-c2a5-41e1-8a03-d9f6779a4939
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: TRAILING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.TRAILINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.TRAILINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            WITH CTEMINMAXTRANSDATE \N AS (
                    SELECT \N MIN(SURLI.TRANSACTIONDATE) AS LEADINGWINDOWSTARTDATE, \N DATEADD(M, 11, MIN(SURLI.TRANSACTIONDATE)) AS LEADINGWINDOWENDDATE, \N DATEADD(M, -11, MAX(SURLI.TRANSACTIONDATE)) AS TRAILINGWINDOWSTARTDATE, \N MAX(SURLI.TRANSACTIONDATE) AS TRAILINGWINDOWENDDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTEALLTRANSACTIONDATES \N AS (
                    SELECT DISTINCT \N SURLI.TRANSACTIONDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTETRANSACTIONWINDOWS \N AS (
                    SELECT \N CATD.TRANSACTIONDATE, \N CMMTD.LEADINGWINDOWSTARTDATE, \N CMMTD.LEADINGWINDOWENDDATE, \N CMMTD.TRAILINGWINDOWSTARTDATE, \N CMMTD.TRAILINGWINDOWENDDATE, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.LEADINGWINDOWSTARTDATE AND CMMTD.LEADINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS LEADING12MONTHS, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.TRAILINGWINDOWSTARTDATE AND CMMTD.TRAILINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS TRAILING12MONTHS \N
                      FROM CTEALLTRANSACTIONDATES AS CATD \N
                     CROSS JOIN CTEMINMAXTRANSDATE AS CMMTD
                   ) \N SELECT \N CTW.TRANSACTIONDATE, \N CTW.LEADINGWINDOWSTARTDATE, \N CTW.LEADINGWINDOWENDDATE, \N CTW.TRAILINGWINDOWSTARTDATE, \N CTW.TRAILINGWINDOWENDDATE, \N CTW.LEADING12MONTHS, \N CTW.TRAILING12MONTHS \N
              FROM CTETRANSACTIONWINDOWS AS CTW
        dependencies:
          - locationName: STAGE
            nodeName: VWALLTRANSACTIONDATES
          - locationName: STAGE
            nodeName: VWLEADINGTRAILINGRANGE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('STAGE','VWALLTRANSACTIONDATES') }}
            {{ ref('STAGE','VWLEADINGTRAILINGRANGE') }}
        name: VWUCTRANSACTIONDATEWINDOW
        noLinkRefs: []
  name: VWUCTRANSACTIONDATEWINDOW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
