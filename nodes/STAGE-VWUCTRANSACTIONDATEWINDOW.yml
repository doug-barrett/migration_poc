fileVersion: 1
id: 3fb643f4-86c4-404f-9d75-c76df4e473e7
name: VWUCTRANSACTIONDATEWINDOW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79fc9247-9436-4845-b314-6409c1e4cb41
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7fccf492-c55e-44e9-a969-3b807f9a00cf
                stepCounter: 146c31c3-d9fa-45ca-b6bb-b8478181d76a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a33eee96-071e-43f2-bc71-47b841a02661
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f3c7cdf5-60b4-49ac-8f71-85d185f5fdd1
                stepCounter: cd2c5702-37fd-4014-9f45-7dc9f43b8db8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 632e2d17-1c01-4966-b4de-22fc4dd3b73e
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: LEADINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a72621fd-653a-4c9a-848b-1e56307a7377
                stepCounter: cd2c5702-37fd-4014-9f45-7dc9f43b8db8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2fda16c-1e99-4575-8592-6b851a8e0b84
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWSTARTDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4b91ad6-15ed-4f4e-a675-bbdd1f0a8523
                stepCounter: cd2c5702-37fd-4014-9f45-7dc9f43b8db8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a5b121a-d230-4d0d-8c5d-905bfc7e5078
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRAILINGWINDOWENDDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 535ab669-1af7-439d-89d2-9047f487cc73
                stepCounter: cd2c5702-37fd-4014-9f45-7dc9f43b8db8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a0606426-f27a-468c-9b68-921922f96d07
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: LEADING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.LEADINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.LEADINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3864fcf9-e2b0-47fb-bbd7-26c6de8cdd84
          stepCounter: 3fb643f4-86c4-404f-9d75-c76df4e473e7
        config: {}
        dataType: BOOLEAN
        defaultValue: ""
        description: ""
        name: TRAILING12MONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: CAST(CASE \N WHEN VWALLTRANSACTIONDATES.TRANSACTIONDATE BETWEEN VWLEADINGTRAILINGRANGE.TRAILINGWINDOWSTARTDATE AND VWLEADINGTRAILINGRANGE.TRAILINGWINDOWENDDATE THEN 1 \N ELSE 0 \NEND AS BOOLEAN)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            WITH CTEMINMAXTRANSDATE \N AS (
                    SELECT \N MIN(SURLI.TRANSACTIONDATE) AS LEADINGWINDOWSTARTDATE, \N DATEADD(M, 11, MIN(SURLI.TRANSACTIONDATE)) AS LEADINGWINDOWENDDATE, \N DATEADD(M, -11, MAX(SURLI.TRANSACTIONDATE)) AS TRAILINGWINDOWSTARTDATE, \N MAX(SURLI.TRANSACTIONDATE) AS TRAILINGWINDOWENDDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTEALLTRANSACTIONDATES \N AS (
                    SELECT DISTINCT \N SURLI.TRANSACTIONDATE \N
                      FROM STAGE.STAGEUCSPENDREPORTINGLINEITEMS AS SURLI
                   ), \N CTETRANSACTIONWINDOWS \N AS (
                    SELECT \N CATD.TRANSACTIONDATE, \N CMMTD.LEADINGWINDOWSTARTDATE, \N CMMTD.LEADINGWINDOWENDDATE, \N CMMTD.TRAILINGWINDOWSTARTDATE, \N CMMTD.TRAILINGWINDOWENDDATE, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.LEADINGWINDOWSTARTDATE AND CMMTD.LEADINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS LEADING12MONTHS, \N CASE \N
                                WHEN CATD.TRANSACTIONDATE BETWEEN CMMTD.TRAILINGWINDOWSTARTDATE AND CMMTD.TRAILINGWINDOWENDDATE THEN 1 \N
                                ELSE 0 \N
                                 END AS TRAILING12MONTHS \N
                      FROM CTEALLTRANSACTIONDATES AS CATD \N
                     CROSS JOIN CTEMINMAXTRANSDATE AS CMMTD
                   ) \N SELECT \N CTW.TRANSACTIONDATE, \N CTW.LEADINGWINDOWSTARTDATE, \N CTW.LEADINGWINDOWENDDATE, \N CTW.TRAILINGWINDOWSTARTDATE, \N CTW.TRAILINGWINDOWENDDATE, \N CTW.LEADING12MONTHS, \N CTW.TRAILING12MONTHS \N
              FROM CTETRANSACTIONWINDOWS AS CTW
        dependencies:
          - locationName: STAGE
            nodeName: VWALLTRANSACTIONDATES
          - locationName: STAGE
            nodeName: VWLEADINGTRAILINGRANGE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('STAGE','VWALLTRANSACTIONDATES') }}
            {{ ref('STAGE','VWLEADINGTRAILINGRANGE') }}
        name: VWUCTRANSACTIONDATEWINDOW
        noLinkRefs: []
  name: VWUCTRANSACTIONDATEWINDOW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
