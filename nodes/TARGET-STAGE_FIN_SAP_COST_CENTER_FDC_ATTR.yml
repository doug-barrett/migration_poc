fileVersion: 1
id: 12f38148-3b96-4f0c-b614-36440c497173
name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e38db08-fe75-4b59-adab-c989e6ad8e34
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: UNION SOURCE
        name: SOURCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: TARGET.SOURCE
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 198f92ff-9d80-4917-84fd-81efe5b9803d
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: The cost centre which the reporting entity is representing.
        name: CC_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d37f47d0-ca23-4e9a-9442-6d4c7f467ae9
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: TARGET.CC_NUM
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6785817e-05a4-4024-b6a4-a2346a4fb32d
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number CC_NUM rows ordered by Status Date Descending
        name: CC_OCCURRENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY TARGET.CC_NUM ORDER BY TARGET.STATUS_DATE DESC, TARGET.IDFLOWNET, TARGET.FACILITY_IDREC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 215d677b-9b53-4061-b329-be63fbc4f6b1
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 874cf61d-3fa9-4d25-b9f6-ae379ffe3a72
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: TARGET.IDFLOWNET
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a32a156a-c4f5-4232-a4e0-6bcd64ba91bc
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NETWORK_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 045a9301-baae-4abc-82d5-5c73167f2797
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: TARGET.NETWORK_NAME
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98e9cae1-cb4b-4194-974c-addf5076f95d
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: FACILITY_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14c56105-e089-42b9-9f4d-51351f56f49f
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: TARGET.FACILITY_IDREC
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1013352-be5c-4218-bec0-0eb64b7d30c8
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 89f53fbe-1fe9-400f-af83-e0830518d4bb
                stepCounter: 79f31973-c5e4-4ef7-b6f2-31ffbb792f36
            transform: TARGET.FACILITY_NAME
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a53cbc7f-a6cd-46a8-8efc-16a761b0bd12
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BATTERY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a0e1cfc-017b-4c98-b868-7352c0008d59
                stepCounter: e5728334-2b6e-40fb-ae5e-e78da1de0994
            transform: TARGET.BATTERY
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4217b18-8d59-48bf-84e8-2d1f586e8f15
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MANUAL_FOREMAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64a9795c-e327-4739-81c4-a73d4c00f3aa
                stepCounter: 849135d9-bff3-41f8-9ed7-0663c17d9665
            transform: TARGET.MANUAL_FOREMAN
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 58dac073-aa54-4439-abf8-7c3fed0d506c
          stepCounter: 12f38148-3b96-4f0c-b614-36440c497173
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: STATUS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 68fbd37a-2a75-4a00-8174-4fe8d59dc926
                stepCounter: 0402e5d5-a477-4a25-94e9-bfb8097c1816
            transform: TARGET.STATUS_DATE
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies: []
        join:
          joinCondition: FROM ((SELECT DISTINCT 'DS_PRODVIEW' AS SOURCE, NULLIF(TRIM(LTRIM(ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA,'0'),' '),'') AS CC_NUM, ODS_PVIEW_PVT_PVUNIT.IDFLOWNET, ODS_PVIEW_PVT_PVFLOWNETHEADER.NAME AS NETWORK_NAME, ODS_PVIEW_PVT_PVUNIT.IDRECFACILITYCALC AS FACILITY_IDREC, ODS_PVIEW_PVT_PVFACILITY.NAME AS FACILITY_NAME, ODS_PVIEW_PVT_PVUNIT.USERTXT2 AS BATTERY, STAGE_FIN_SAP_BI_APP_CC_ATTR.MANUAL_FOREMAN AS MANUAL_FOREMAN, NVL(ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DTTM,TO_TIMESTAMP('01011900','DDMMYYYY')) AS STATUS_DATE FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT ODS_PVIEW_PVT_PVUNIT LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMP ODS_PVIEW_PVT_PVUNITCOMP ON ODS_PVIEW_PVT_PVUNIT.IDFLOWNET = ODS_PVIEW_PVT_PVUNITCOMP.IDFLOWNET AND ODS_PVIEW_PVT_PVUNIT.IDREC = ODS_PVIEW_PVT_PVUNITCOMP.IDRECPARENT AND ODS_PVIEW_PVT_PVUNITCOMP.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNITCOMP.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFLOWNETHEADER ODS_PVIEW_PVT_PVFLOWNETHEADER ON ODS_PVIEW_PVT_PVUNIT.IDFLOWNET = ODS_PVIEW_PVT_PVFLOWNETHEADER.IDFLOWNET AND ODS_PVIEW_PVT_PVFLOWNETHEADER.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVFLOWNETHEADER.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFACILITY ODS_PVIEW_PVT_PVFACILITY ON ODS_PVIEW_PVT_PVUNIT.IDRECFACILITYCALC = ODS_PVIEW_PVT_PVFACILITY.IDREC AND ODS_PVIEW_PVT_PVFACILITY.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVFACILITY.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVROUTESETROUTE ODS_PVIEW_PVT_PVROUTESETROUTE ON ODS_PVIEW_PVT_PVUNIT.IDRECROUTESETROUTECALC = ODS_PVIEW_PVT_PVROUTESETROUTE.IDREC AND ODS_PVIEW_PVT_PVROUTESETROUTE.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVROUTESETROUTE.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPSTATUS ODS_PVIEW_PVT_PVUNITCOMPSTATUS ON ODS_PVIEW_PVT_PVUNITCOMP.IDFLOWNET = ODS_PVIEW_PVT_PVUNITCOMPSTATUS.IDFLOWNET AND ODS_PVIEW_PVT_PVUNITCOMP.IDREC = ODS_PVIEW_PVT_PVUNITCOMPSTATUS.IDRECPARENT AND ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_STAGE_BT.STAGE_FIN_SAP_BI_APP_CC_ATTR STAGE_FIN_SAP_BI_APP_CC_ATTR ON ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA = STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM WHERE ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA IS NOT NULL AND ODS_PVIEW_PVT_PVUNIT.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNIT.DSS_DELETE_FLAG != 'Y') UNION (SELECT DISTINCT 'BI_APP' AS SOURCE, NULLIF(TRIM(LTRIM(STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM,'0'),' '),'') CC_NUM, NULL IDFLOWNET, NULL NETWORK_NAME, NULL FACILITY_IDREC, NULL FACILITY_NAME, STAGE_FIN_SAP_BI_APP_CC_ATTR.BATTERY, STAGE_FIN_SAP_BI_APP_CC_ATTR.MANUAL_FOREMAN, CAST(STAGE_FIN_SAP_BI_APP_CC_ATTR.DSS_UPDATE_TIME AS TIMESTAMP) AS STATUS_DATE FROM WS_STAGE_BT.STAGE_FIN_SAP_BI_APP_CC_ATTR STAGE_FIN_SAP_BI_APP_CC_ATTR WHERE NOT EXISTS (SELECT * FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT WHERE DSS_CURRENT_FLAG = 'Y' AND DSS_DELETE_FLAG != 'Y' AND COSTCENTERIDA = STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM))) AS TARGET
        name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
        noLinkRefs: []
  name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
