fileVersion: 1
id: b6918f54-b245-4c9d-b0be-2d7031a80bf7
name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 317866b9-9e6c-483e-9c69-bf3945583845
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: UNION SOURCE
        name: SOURCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: TARGET.SOURCE
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4f3cc7e-7049-48f1-85b6-b3844b010677
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: The cost centre which the reporting entity is representing.
        name: CC_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d509337f-2ce6-4703-b898-0d9f424534b9
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: TARGET.CC_NUM
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9484f35d-d4bb-4130-83e6-b2904043f146
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number CC_NUM rows ordered by Status Date Descending
        name: CC_OCCURRENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY TARGET.CC_NUM ORDER BY TARGET.STATUS_DATE DESC, TARGET.IDFLOWNET, TARGET.FACILITY_IDREC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6ee179c-99bc-4f19-8d7d-23e0c0369bc4
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5b449d2e-a7d3-425c-8f25-cc1293b6c500
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: TARGET.IDFLOWNET
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5db27d66-388e-46a7-9263-a7bf50858c77
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NETWORK_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38d1ccfc-acd0-4965-af6a-d6dcf7be7f39
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: TARGET.NETWORK_NAME
      - appliedColumnTests: {}
        columnReference:
          columnCounter: df8b4b23-37d9-4965-95a2-07314e5366af
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: FACILITY_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98db1c00-61af-4b12-a076-bab2f7510977
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: TARGET.FACILITY_IDREC
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6423062a-99ed-40cc-80e4-d67670a29fd0
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6bc32df2-872d-4cd2-af8b-18d75766d36b
                stepCounter: 2069364e-b829-44bc-90fd-46cb967ac2ee
            transform: TARGET.FACILITY_NAME
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a99739b9-5bcf-4b1f-bb29-d33e842fd23a
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BATTERY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c51d7ad-e3ef-451e-b561-0b9f20956100
                stepCounter: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
            transform: TARGET.BATTERY
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fbf610ad-4ff0-4809-81fd-78399f075883
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MANUAL_FOREMAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5808578-c9bd-498d-8d60-c63260bcbf90
                stepCounter: 09373861-bdbd-4ba2-a709-64bacc2c459c
            transform: TARGET.MANUAL_FOREMAN
      - appliedColumnTests: {}
        columnReference:
          columnCounter: abc953a7-a3ae-453b-a5e0-50ba05c1c180
          stepCounter: b6918f54-b245-4c9d-b0be-2d7031a80bf7
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: STATUS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ac75969-3c91-4d4e-8018-80b5c4546352
                stepCounter: b794b297-4c0b-4bca-914d-2044e8e1f94e
            transform: TARGET.STATUS_DATE
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies: []
        join:
          joinCondition: FROM ((SELECT DISTINCT 'DS_PRODVIEW' AS SOURCE, NULLIF(TRIM(LTRIM(ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA,'0'),' '),'') AS CC_NUM, ODS_PVIEW_PVT_PVUNIT.IDFLOWNET, ODS_PVIEW_PVT_PVFLOWNETHEADER.NAME AS NETWORK_NAME, ODS_PVIEW_PVT_PVUNIT.IDRECFACILITYCALC AS FACILITY_IDREC, ODS_PVIEW_PVT_PVFACILITY.NAME AS FACILITY_NAME, ODS_PVIEW_PVT_PVUNIT.USERTXT2 AS BATTERY, STAGE_FIN_SAP_BI_APP_CC_ATTR.MANUAL_FOREMAN AS MANUAL_FOREMAN, NVL(ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DTTM,TO_TIMESTAMP('01011900','DDMMYYYY')) AS STATUS_DATE FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT ODS_PVIEW_PVT_PVUNIT LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMP ODS_PVIEW_PVT_PVUNITCOMP ON ODS_PVIEW_PVT_PVUNIT.IDFLOWNET = ODS_PVIEW_PVT_PVUNITCOMP.IDFLOWNET AND ODS_PVIEW_PVT_PVUNIT.IDREC = ODS_PVIEW_PVT_PVUNITCOMP.IDRECPARENT AND ODS_PVIEW_PVT_PVUNITCOMP.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNITCOMP.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFLOWNETHEADER ODS_PVIEW_PVT_PVFLOWNETHEADER ON ODS_PVIEW_PVT_PVUNIT.IDFLOWNET = ODS_PVIEW_PVT_PVFLOWNETHEADER.IDFLOWNET AND ODS_PVIEW_PVT_PVFLOWNETHEADER.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVFLOWNETHEADER.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFACILITY ODS_PVIEW_PVT_PVFACILITY ON ODS_PVIEW_PVT_PVUNIT.IDRECFACILITYCALC = ODS_PVIEW_PVT_PVFACILITY.IDREC AND ODS_PVIEW_PVT_PVFACILITY.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVFACILITY.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVROUTESETROUTE ODS_PVIEW_PVT_PVROUTESETROUTE ON ODS_PVIEW_PVT_PVUNIT.IDRECROUTESETROUTECALC = ODS_PVIEW_PVT_PVROUTESETROUTE.IDREC AND ODS_PVIEW_PVT_PVROUTESETROUTE.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVROUTESETROUTE.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPSTATUS ODS_PVIEW_PVT_PVUNITCOMPSTATUS ON ODS_PVIEW_PVT_PVUNITCOMP.IDFLOWNET = ODS_PVIEW_PVT_PVUNITCOMPSTATUS.IDFLOWNET AND ODS_PVIEW_PVT_PVUNITCOMP.IDREC = ODS_PVIEW_PVT_PVUNITCOMPSTATUS.IDRECPARENT AND ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNITCOMPSTATUS.DSS_DELETE_FLAG != 'Y' LEFT JOIN WS_STAGE_BT.STAGE_FIN_SAP_BI_APP_CC_ATTR STAGE_FIN_SAP_BI_APP_CC_ATTR ON ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA = STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM WHERE ODS_PVIEW_PVT_PVUNIT.COSTCENTERIDA IS NOT NULL AND ODS_PVIEW_PVT_PVUNIT.DSS_CURRENT_FLAG = 'Y' AND ODS_PVIEW_PVT_PVUNIT.DSS_DELETE_FLAG != 'Y') UNION (SELECT DISTINCT 'BI_APP' AS SOURCE, NULLIF(TRIM(LTRIM(STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM,'0'),' '),'') CC_NUM, NULL IDFLOWNET, NULL NETWORK_NAME, NULL FACILITY_IDREC, NULL FACILITY_NAME, STAGE_FIN_SAP_BI_APP_CC_ATTR.BATTERY, STAGE_FIN_SAP_BI_APP_CC_ATTR.MANUAL_FOREMAN, CAST(STAGE_FIN_SAP_BI_APP_CC_ATTR.DSS_UPDATE_TIME AS TIMESTAMP) AS STATUS_DATE FROM WS_STAGE_BT.STAGE_FIN_SAP_BI_APP_CC_ATTR STAGE_FIN_SAP_BI_APP_CC_ATTR WHERE NOT EXISTS (SELECT * FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT WHERE DSS_CURRENT_FLAG = 'Y' AND DSS_DELETE_FLAG != 'Y' AND COSTCENTERIDA = STAGE_FIN_SAP_BI_APP_CC_ATTR.CC_NUM))) AS TARGET
        name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
        noLinkRefs: []
  name: STAGE_FIN_SAP_COST_CENTER_FDC_ATTR
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
