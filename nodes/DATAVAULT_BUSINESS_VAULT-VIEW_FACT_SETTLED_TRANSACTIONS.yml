fileVersion: 1
id: d106ee49-1641-4abf-b703-5c66e735fe44
name: VIEW_FACT_SETTLED_TRANSACTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e04b3b88-938c-4df1-b1a0-c0b864242eee
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: TRANSACTION_MERCHANT_INTERNAL_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c75e2e7-8f74-4c45-b835-90a4de9a131d
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: DIM_DATE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 40aa3c9e-9b85-4425-a47b-b0183cd58863
                stepCounter: 3f4b0133-f2a1-4a6f-8a9e-d1722827a6c7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 966f68a1-b792-4d75-b7d9-3d4df703eb4d
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_MERCHANT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 435ef0b7-fae2-42c6-a903-881ef34ca1a6
                stepCounter: 47efa677-7996-4551-9dec-b7b4d9cedb8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5abeb278-ad82-40c5-b021-892a17a5b994
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(19)
        defaultValue: ""
        description: ""
        name: TERMINAL_SERIAL_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0e2877c-3801-409b-85f2-88a210ce4d77
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_CURRENCY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d03b6495-498f-4ab5-996b-db86b71df5f0
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        name: DIM_CARD_BRAND_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 42d86a98-7324-40a5-8376-44022e77db4a
                stepCounter: 076650ac-d366-4713-9a43-7ebe2bc2fd56
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e1cc5fd0-e207-4aeb-afb5-90ba48d5f22d
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_TRANSACTION_TYPE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17f20dab-4881-437e-b0be-734dace0a9d1
                stepCounter: 8137ce3d-b2ac-4202-9832-e902b9566a8e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3bd96ee6-1962-44cc-82a3-961d9b826c80
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: MONTH_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 73f7c005-2e09-4f22-a070-61ecb57f14f0
                stepCounter: 3f4b0133-f2a1-4a6f-8a9e-d1722827a6c7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 045d30f0-5526-4e20-b95c-5f262e429160
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(18,0)
        defaultValue: ""
        description: ""
        name: DIM_PRODUCT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3cac4465-a145-493e-be6b-3bc1b9c1ca8a
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: RECID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28a678be-342d-418c-9d23-47e14d97f8e7
                stepCounter: 994161fa-1018-4b80-8fec-7fd02a2b1cdf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a14f8dd-99cd-4ff3-bb84-be8951f4ab46
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: SETTLEMENT_TRANSACTION_PROCESS_DATE_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc5fa3ba-0c2b-4a6b-a38c-b71596f229a8
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: NUMBER(19,2)
        defaultValue: ""
        description: The total amount of the transaction expressed in the settlement currency (unsigned). This will be the amount that will be settled.
        name: SETTLEMENT_TRANSACTION_AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4257a068-2fad-4898-ba89-c23c7e663d00
                stepCounter: 994161fa-1018-4b80-8fec-7fd02a2b1cdf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77c93fed-633b-472e-b8c7-dc470efd2dc7
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: The total amount of the transaction expressed in the settlement currency (unsigned). This will be the amount that will be settled.
        name: SETTLEMENT_TRANSACTION_TOTAL_AMOUNT_CAD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4257a068-2fad-4898-ba89-c23c7e663d00
                stepCounter: 994161fa-1018-4b80-8fec-7fd02a2b1cdf
            transform: |-
              CASE WHEN S.SETTLEMENT_CURRENCY_CODE = 840 THEN SETTLEMENT_TRANSACTION_TOTAL_AMOUNT * (CR.CRY_RTE_NBR / POW(10, CR.RTE_ENT_NBR))
                          ELSE SETTLEMENT_TRANSACTION_TOTAL_AMOUNT
                           END AS SETTLEMENT_TRANSACTION_TOTAL_AMOUNT_CAD
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f920ec81-5b7e-4da3-8048-89e9bb140f34
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The unique Acquirer Reference Number of the transaction
        name: DCC_USED_INDICATOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e6236f6-366c-4569-bc64-473645fbc8cb
                stepCounter: 994161fa-1018-4b80-8fec-7fd02a2b1cdf
            transform: |-
              CASE WHEN SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '400469' OR SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '523420' THEN 'D'
                          WHEN SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '415766' OR SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '518689' THEN 'M'
                          ELSE 'NONE'
                           END AS DCC_USED_INDICATOR
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7352fb3-309d-430c-96ea-9a23690b3b3d
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CONVERSION_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 771a376d-e376-4af1-8adc-06fcecfc5faa
                stepCounter: e1b7eaeb-3242-42eb-9523-ec40900490be
            transform: CR.CRY_RTE_NBR / POW(10, CR.RTE_ENT_NBR) AS CONVERSION_RATE
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ddcd4e2-88b6-4e32-b3d1-f1c64a73c2ce
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEES_AMOUNT_CAD
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b5a6504-45be-4bdf-a051-29f286c7a020
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: USER_AGENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9e0a8573-281b-452c-87b8-e91f548d9dee
                stepCounter: 54dc8d50-526a-433e-9d6d-817e5bc8e177
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8bb738d-171b-4e90-b0b6-ab767fd0e648
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(256)
        defaultValue: ""
        description: ""
        name: REF_URL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b725a1f-e614-47b6-a5dd-e1017f641341
                stepCounter: 54dc8d50-526a-433e-9d6d-817e5bc8e177
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e84e320-3bb3-4144-9712-3d14482cd1a4
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CARD_TYPE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff3191a5-c77e-4d98-8e99-f01208309fa4
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: TRANSACTION_TYPE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b85812a6-65b4-46ad-acf4-a4d8736c5977
          stepCounter: d106ee49-1641-4abf-b703-5c66e735fe44
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: SETTLEMENT_CURRENCY_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_LKP_CURRENCY_RATE_MROC_CURRENT
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_SETTLED_TRANSACTIONS_MROC_CURRENT
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_TRANSACTION_EXT_INFO_MROC_CURRENT
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_CARD_BRAND
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_CURRENCY
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_DATE
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_MERCHANT
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_TRANSACTION_TYPE
        join:
          joinCondition: ''
        name: VIEW_FACT_SETTLED_TRANSACTIONS
        noLinkRefs: []
  name: VIEW_FACT_SETTLED_TRANSACTIONS
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
