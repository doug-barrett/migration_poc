fileVersion: 1
id: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
name: VIEW_FACT_SETTLED_TRANSACTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c38b60f7-bbb6-4e3d-8770-c18a2f75277d
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: TRANSACTION_MERCHANT_INTERNAL_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da731b4e-affd-44ba-b950-1d896612696b
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: DIM_DATE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f583aa90-1525-4b60-897c-b626691934da
                stepCounter: 5205e907-f7fe-42c2-9d8b-5f54fad2bc2d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc65ecc9-cc4d-4d41-8e29-93f184c69a86
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_MERCHANT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fdc82a12-ac55-4e04-ad8d-29f1db24533b
                stepCounter: 84dffcd0-9390-473b-bb8a-2b250cfdf762
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75d6caba-2bb4-42d1-bf8e-f60ab3fd4094
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(19)
        defaultValue: ""
        description: ""
        name: TERMINAL_SERIAL_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37a527fe-13c7-4d7a-a8e6-fce18a6757fb
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_CURRENCY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19f4e1d7-0bad-4e82-9f4e-2746f09ac3db
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        name: DIM_CARD_BRAND_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8bdf8b9-c745-4dd2-998c-bb79b6598215
                stepCounter: 9776b8fe-3a2f-4034-9f10-e86710b93884
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f320e89-3829-4f4b-af45-4a5627ad0624
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_TRANSACTION_TYPE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 637ff723-556a-45d4-a0f7-ee93e8f7d206
                stepCounter: 597b63f6-611a-42c6-b8a7-ffa09a27d519
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c675de27-1d3e-441f-a4a3-e909cb7a7ffa
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: MONTH_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7d90cf1-f3b3-4ec9-b089-72b8e88f635b
                stepCounter: 5205e907-f7fe-42c2-9d8b-5f54fad2bc2d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc2ceb6a-ebc0-4ed9-9b44-3c5d5a9aaab8
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(18,0)
        defaultValue: ""
        description: ""
        name: DIM_PRODUCT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00ef014a-3ef4-4600-8bd6-92d5fe4edbe8
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: RECID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f97952e-617a-4704-82e7-7105d181c944
                stepCounter: a6d039a1-848b-4e3a-92b5-ce7e06a6994f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf053d68-7327-4096-8f66-743a9d71e270
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: SETTLEMENT_TRANSACTION_PROCESS_DATE_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b291197-17e4-49fa-82c8-8a22e93b30f4
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: NUMBER(19,2)
        defaultValue: ""
        description: The total amount of the transaction expressed in the settlement currency (unsigned). This will be the amount that will be settled.
        name: SETTLEMENT_TRANSACTION_AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d0ce473-c118-481c-ad50-d9f2b8ea9857
                stepCounter: a6d039a1-848b-4e3a-92b5-ce7e06a6994f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e11ead1b-8bec-43fb-b029-51808082d349
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: The total amount of the transaction expressed in the settlement currency (unsigned). This will be the amount that will be settled.
        name: SETTLEMENT_TRANSACTION_TOTAL_AMOUNT_CAD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d0ce473-c118-481c-ad50-d9f2b8ea9857
                stepCounter: a6d039a1-848b-4e3a-92b5-ce7e06a6994f
            transform: |-
              CASE WHEN S.SETTLEMENT_CURRENCY_CODE = 840 THEN SETTLEMENT_TRANSACTION_TOTAL_AMOUNT * (CR.CRY_RTE_NBR / POW(10, CR.RTE_ENT_NBR))
                          ELSE SETTLEMENT_TRANSACTION_TOTAL_AMOUNT
                           END AS SETTLEMENT_TRANSACTION_TOTAL_AMOUNT_CAD
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e5241aa7-f42a-4a28-9d26-dd0e903bdb11
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The unique Acquirer Reference Number of the transaction
        name: DCC_USED_INDICATOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44a185a5-0326-454e-9717-8244461c26e8
                stepCounter: a6d039a1-848b-4e3a-92b5-ce7e06a6994f
            transform: |-
              CASE WHEN SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '400469' OR SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '523420' THEN 'D'
                          WHEN SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '415766' OR SUBSTRING(S.ACQUIRER_REFERENCE_NUMBER, 2, 6) = '518689' THEN 'M'
                          ELSE 'NONE'
                           END AS DCC_USED_INDICATOR
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba5cfc4f-9a76-43a4-887b-5b0c0699bed9
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CONVERSION_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a14a5c45-bcea-4155-93f3-e539841ed0d1
                stepCounter: e3324d81-d924-4e97-8101-a80f4661d934
            transform: CR.CRY_RTE_NBR / POW(10, CR.RTE_ENT_NBR) AS CONVERSION_RATE
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5722c749-d5ab-4720-a647-11df9969dee9
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEES_AMOUNT_CAD
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc56593a-e837-4f25-adfb-f2b3a4610daa
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: USER_AGENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 790ebcd5-4c13-40d0-9022-716c8bfce787
                stepCounter: 409b3894-6a31-4ef6-82ba-b469d0d760b9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec0a4d3b-0d89-49c8-8028-d5839b4d537f
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(256)
        defaultValue: ""
        description: ""
        name: REF_URL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5f0031a1-56d9-43f9-9c9b-37c4ca5d2b54
                stepCounter: 409b3894-6a31-4ef6-82ba-b469d0d760b9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3bb9f19-c906-4203-b61d-172be53e874a
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CARD_TYPE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfa406d8-b705-4592-ac18-ca771f363140
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: TRANSACTION_TYPE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12e5635d-1317-4977-878b-8f10a5669dd2
          stepCounter: c16d1ce9-d3dc-4ec8-9f4f-27a2123732c6
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: SETTLEMENT_CURRENCY_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_LKP_CURRENCY_RATE_MROC_CURRENT
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_SETTLED_TRANSACTIONS_MROC_CURRENT
          - locationName: DATAVAULT_BUSINESS_VAULT
            nodeName: S_TRANSACTION_EXT_INFO_MROC_CURRENT
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_CARD_BRAND
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_CURRENCY
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_DATE
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_MERCHANT
          - locationName: DATAVAULT_INFORMATION_MART
            nodeName: DIM_TRANSACTION_TYPE
        join:
          joinCondition: ''
        name: VIEW_FACT_SETTLED_TRANSACTIONS
        noLinkRefs: []
  name: VIEW_FACT_SETTLED_TRANSACTIONS
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
