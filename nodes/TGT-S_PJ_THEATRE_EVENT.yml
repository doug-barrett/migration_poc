fileVersion: 1
id: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
name: S_PJ_THEATRE_EVENT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Get all the theatre data required from fact_theatre_visit."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03a4297f-da22-43a2-a03f-ef3201cc9b36
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: THEATRE_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 03d0e6c8-bd47-4ce6-a47e-a172eb3bc9b0
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02f914a1-36a0-423b-94db-f3893b6d4560
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52537801-cc2d-443e-98c6-6344aa71d269
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1bcd6906-868b-4b26-9e5a-cdde84b110d2
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_THEATRE_VISIT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c331710-6686-4da1-a65e-1157921c62a7
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 710a9a67-64f1-4137-b259-26279c9691ea
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_THEATRE_VISIT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9fa9c57-e2ad-4df5-985c-a931a9828e1a
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c593c8a-7bfd-41fd-b0f9-65d9458280b0
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: THEATRE_CANCELLED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74d36b12-8090-4054-91b1-11a8b5c411fa
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: |-
              CASE WHEN schedule_status_code = 'C' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd1b311c-d869-4283-a531-88f358420b62
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: IP_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf6706d5-cdbf-49b8-b1d5-7542af4070b7
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55445f60-08f5-4314-970a-d7c9a9556c77
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Acute_flag
        name: ACUTE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6cbed63-7271-4d25-a85a-22b90186dd7c
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: |-
              CASE WHEN fact_theatre_visit.Acute_flag = 'Y' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 570076d7-2278-4133-9020-2e5040f2be3c
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d342411b-5821-46c2-b314-adbec507220d
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0595707c-e573-4545-9cea-a4c712c07006
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1492c9d-602e-4bf6-a93f-ce03a6d2f334
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8218ab5d-bc11-46e6-81e4-c15aa738c78b
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: INTO_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9fedc035-c4de-4168-88e0-dd0ab46ea0a1
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff00e281-818b-4e0d-b128-89b488012efc
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OUT_OF_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f5aacac-ebd8-435a-82ce-c2899e50c7be
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90035fc5-5ee4-4d27-904c-7bc5742de730
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: acute_onlist_date
        name: ACUTE_ONLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 224af693-d959-4b5a-9fcc-d93b23ddc5f8
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec2be92d-edd3-4d64-8125-d86183166201
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: ASA_RATING_VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5fd096f1-06db-4e9a-b031-8f350adc03f0
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb65f367-d2cb-4a0e-99ee-7bd5bbe02f58
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_THEATRE_PRIMARY_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5f79a19-8ebb-4b0d-8807-06686382daf3
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af310f76-29a9-4a81-905d-9cda9717ba00
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_THEATRE_OUTCOME_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 578a5b53-3285-47ba-a365-55403ba6fa5f
                stepCounter: c664c368-d518-4499-b563-9b0cbfa632c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b49982a-d36d-4296-a62c-0b79305d9fb3
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: 'Numbers rows by theatre_visit_encounter_id; 2 instances where id not unique: T1411590833, NX18137'
        name: ROW_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY theatre_visit_encounter_id ORDER BY session_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e86528b4-e1ce-4b81-8ed5-f861aefe4cf9
          stepCounter: 5e652275-92c8-4da6-85d0-b9f43a68cf7a
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: FACT_THEATRE_VISIT
        join:
          joinCondition: |-
            FROM fact.fact_theatre_visit
              JOIN dim.dim_theatre_procedure
                ON fact_theatre_visit.dim_theatre_primary_procedure_key = dim_theatre_procedure.dim_theatre_procedure_key
              JOIN dim.dim_theatre_outcome
                ON fact_theatre_visit.dim_theatre_outcome_key = dim_theatre_outcome.dim_theatre_outcome_key
             WHERE fact_theatre_visit.IP_Event_encounter_ID IS NOT NULL --AND dim_theatre_outcome.theatre_outcome_code NOT IN ('CANC','CANCD')  --AND out_of_theatre_Date is not null
        name: S_PJ_THEATRE_EVENT
        noLinkRefs: []
  name: S_PJ_THEATRE_EVENT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
