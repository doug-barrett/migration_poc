fileVersion: 1
id: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
name: L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b80c7de-ce21-40bb-b523-64780bda704a
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ROWID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 465d9bad-7e48-4e22-b570-47b885dd4a46
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 579f642f-f8cc-4950-9642-b2eb7c09edcb
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c85b0e97-f1bd-4053-92c7-62c9b1b74393
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4efec59f-8ff1-4f49-b4fa-64f862c9f8d6
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PROFESSIONAL_CARER_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf9afaa6-416e-4fa7-8274-299ce2085dcc
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f01205db-caa0-49ab-85bd-0ec03975be2e
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICIAN_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6db364b8-8841-4e06-89ef-f6b0667cf506
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b502d19d-cc30-436e-a5b4-db8dd45a81b3
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: OCCUPATIONAL_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f36cc8d-ed28-4c6c-8231-c2712f6e699c
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e451b979-27a8-4277-8426-7b3218d01a58
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b34aefdd-3e4d-45ce-bf2f-84b966267d48
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f7cb12c-06e1-4881-945c-3469fc74b2f2
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTACT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6ae09d07-2241-4525-9856-c5a39837c216
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de62f364-ad8c-4cb5-994e-d9a2f0aba475
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTACT_PURPOSE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 452b6cd6-0051-4e37-94b6-ee06f82b517f
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: debf210c-f5e6-450c-a2da-b941bf5bdcc0
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: INT
        defaultValue: ""
        description: Numbers rows so that start/end dates can be repaired.
        name: ROW_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e03bf37-67d0-4619-8bfe-cb33cc32d428
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a7252ef7-8f4b-48f6-8816-85c19ef98d5a
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cdcafe13-15cd-4a30-b28a-c1b73b1ce5d0
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d2ddf31d-56a2-44da-a875-941e08dde06c
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3595d26-e997-4595-bf81-c3b2aa39ce59
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DEFAULT_PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b8cc7905-3967-482c-acb7-eda14708b0de
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34f8cc54-b5f4-4ca3-b920-53f19a8ad234
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DEFAULT_RC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09625d39-2ab2-4115-b771-dabb545cefbd
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b78663ec-119f-4d21-8924-b2e1543f0886
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DEFAULT_PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e489e832-4763-400f-a8d7-46d48e6414e4
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70d53874-a286-4aa5-9f28-c67c77c1c29b
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: MAPPED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77f5eea1-a027-4e21-a587-572abded35e6
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 868fcdfe-d35d-4a9a-bd17-90d3b6b75349
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE_ADDED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ad7f9b7f-f93e-4798-9ee1-94730a651e07
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 373d5649-8201-43f3-a5b2-b6d981216f6d
          stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: EXAMPLE_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f28ae48a-0baf-445b-b112-ecd8c19027d0
                stepCounter: b3ba0f84-0de3-4355-ad18-e0530c0ffa74
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT l.rowid,
                   l.department,
                   l.professional_carer_reference_no,
                   l.clinician_fullname,
                   l.occupational_group,
                   l.location,
                   l.contact_type,
                   l.contact_purpose_code,
                   ROW_NUMBER() OVER(PARTITION BY l.Contact_Type, l.Department, l.Occupational_group, l.Location, l.professional_carer_reference_no, l.contact_purpose_code ORDER BY l.start_date) row_num,
                   l.start_date,
                   l.end_date,
                   l.default_purchase_unit_code,
                   l.default_rc_code,
                   l.default_purchase_unit_volume,
                   l.mapped,
                   l.date_added,
                   l.example_encounter
              FROM l_mappings_PurchaseUnit_CDS_Contacts l
              JOIN (
                    SELECT Contact_Type,
                           Department,
                           Occupational_group,

                  LOCATION,
                           professional_carer_reference_no,
                           contact_purpose_code,
                           start_date,
                           MAX(rowid) rowid
                      FROM l_mappings_PurchaseUnit_CDS_Contacts
                     GROUP BY Contact_Type,
                              Department,
                              Occupational_group,

                     LOCATION,
                              professional_carer_reference_no,
                              contact_purpose_code,
                              start_date
                   ) t
                ON l.rowid = t.rowid
        dependencies:
          - locationName: TGT
            nodeName: L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS') }}
        name: L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS_V
        noLinkRefs: []
  name: L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
