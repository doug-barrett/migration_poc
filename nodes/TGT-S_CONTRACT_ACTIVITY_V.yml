fileVersion: 1
id: 99b355af-7875-4d7c-bf43-9ec9000fe53c
name: S_CONTRACT_ACTIVITY_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a17930d4-d18e-4dfd-876f-c041a043d8cb
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_CONTRACT_LINE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a17930d4-d18e-4dfd-876f-c041a043d8cb
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f9f6941-00b5-461c-8f18-9b512102ee18
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_CONTRACT_REPORTING_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f9f6941-00b5-461c-8f18-9b512102ee18
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 673ff56d-7e87-4a04-914a-346c2eb2f19c
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: NUMERIC(38,5)
        defaultValue: ""
        description: ""
        name: ACTUAL_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 673ff56d-7e87-4a04-914a-346c2eb2f19c
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a657054-1f4f-4df4-9003-8b2b44906e7c
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: NUMERIC(38,5)
        defaultValue: ""
        description: distinct count of source encounter numbers. Equivalent to count of discharges or count of outpatient attendances
        name: ENCOUNTER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a657054-1f4f-4df4-9003-8b2b44906e7c
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1fc3340-687b-4a03-b78a-e6fa8c7850d9
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: NUMERIC(38,5)
        defaultValue: ""
        description: distinct count of source encounter numbers. Equivalent to count of discharges or count of outpatient attendances
        name: UNCODED_ENCOUNTER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1fc3340-687b-4a03-b78a-e6fa8c7850d9
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a581bcf9-c262-49c7-97b6-c4c838b6739f
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: NUMERIC(38,5)
        defaultValue: ""
        description: distinct count of source encounter numbers. Equivalent to count of discharges or count of outpatient attendances
        name: CODED_ENCOUNTER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a581bcf9-c262-49c7-97b6-c4c838b6739f
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44898c0a-b7f8-4592-94ad-6ea85d858cdf
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: NUMERIC(38,5)
        defaultValue: ""
        description: ""
        name: ESTIMATED_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44898c0a-b7f8-4592-94ad-6ea85d858cdf
                stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8df149ee-c18b-4deb-ac05-060fc8ad8b5a
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: ""
        name: ACTUAL_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f1def154-f34e-4d4d-b167-dd4cf2aa42d8
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85a2741a-a8df-4a8b-a897-6a1abdd8737d
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: budget cost
        name: BUDGET_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7d8166e-1470-49e1-ba9a-0632e37a7e9c
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e6c9321-b7c2-4ba4-91d9-4cb75619464a
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: MHOP_cost
        name: MHOP_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19df8653-fa46-42f0-a21c-5f8ff8999a85
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44f0feff-5416-4b66-8bca-8b3a2df82c65
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: SURG_cost
        name: SURG_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fb39b38d-3f4c-4f3c-a6a5-7f7e2261fc18
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ad4edb9-5a9b-411e-9974-c04a8393ed4a
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: CWF_cost
        name: CWF_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f336a0a2-a5fc-4db5-a48a-d8856a5fb4b8
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21f87f1f-4525-442e-8f95-e8027da20bc7
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: ESC_cost
        name: ESC_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f2f953af-f72e-4c87-bf43-4126ae07480a
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 525d5e1e-6d1d-460d-90c3-b1451f19cf81
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: OTH_cost
        name: OTH_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92945760-b9e2-44a5-817c-cfbf54234aca
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1434572-39cd-47ad-8c24-8bd4fda3afb9
          stepCounter: 99b355af-7875-4d7c-bf43-9ec9000fe53c
        config: {}
        dataType: MONEY
        defaultValue: ""
        description: AMED_cost
        name: AMED_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4b6de778-aea9-48ec-82b2-652ad92158d5
                stepCounter: 9378e4a4-ac4f-4373-a709-764a736c5b9d
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE VIEW {{ this }}(dim_contract_line_key, dim_contract_reporting_date_key, actual_volume, encounter_count, uncoded_encounter_count, coded_encounter_count, estimated_volume, actual_cost, budget_cost, MHOP_cost, SURG_cost, CWF_cost, ESC_cost, OTH_cost, AMED_cost) AS SELECT s_contract_activity_20.dim_contract_line_key,
                   s_contract_activity_20.dim_contract_reporting_date_key,
                   sum(s_contract_activity_20.purchase_unit_volume) AS actual_volume,
                   count(DISTINCT s_contract_activity_20.source_encounter) AS encounter_count,
                   sum(CASE WHEN s_contract_activity_20.estimated_activity_flag ='Y' THEN 1 ELSE 0 END) AS uncoded_encounter_count,
                   sum(CASE WHEN s_contract_activity_20.estimated_activity_flag ='N' THEN 1 ELSE 0 END) AS coded_encounter_count,
                   sum(s_contract_activity_20.estimated_purchase_unit_volume) AS estimated_volume,
                   sum(s_contract_activity_20.actual_cost) AS actual_cost,
                   sum(s_contract_activity_20.budget_cost) AS budget_cost,
                   sum(s_contract_activity_20.MHOP_cost) AS MHOP_cost,
                   sum(s_contract_activity_20.SURG_cost) AS SURG_cost,
                   sum(s_contract_activity_20.CWF_cost) AS CWF_cost,
                   sum(s_contract_activity_20.ESC_cost) AS ESC_cost,
                   sum(s_contract_activity_20.OTH_cost) AS OTH_cost,
                   sum(s_contract_activity_20.AMED_cost) AS AMED_cost
              FROM dbo.s_contract_activity_20 s_contract_activity_20
             GROUP BY dim_contract_line_key,
                      dim_contract_reporting_date_key,
                      dss_update_time;
        dependencies:
          - locationName: TGT
            nodeName: S_CONTRACT_ACTIVITY_V
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','S_CONTRACT_ACTIVITY_V') }}
        name: S_CONTRACT_ACTIVITY_V
        noLinkRefs: []
  name: S_CONTRACT_ACTIVITY_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
