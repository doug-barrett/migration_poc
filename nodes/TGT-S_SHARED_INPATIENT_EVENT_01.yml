fileVersion: 1
id: 5874cd83-f58c-44fe-92e0-b83d47d22bab
name: S_SHARED_INPATIENT_EVENT_01
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "First step in populating ds_shared_inpatient_event."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0cb2942-8124-45bf-a3d4-ced27cb882d9
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e5d1eba-8e50-4f3c-b18d-5c67c57404e8
                stepCounter: 3e756094-7e86-4086-a4af-59124cd9e961
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fcb83293-4177-4b5a-b412-5f68e99e5381
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRVSP_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d3088d-97f2-4c53-9ebc-ae021c7b49e2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 95d240cb-857b-4f42-a1b2-be95c3eb461d
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc28819c-55e3-49c8-b08c-b1de8ea0eb0d
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa34c384-340d-4d13-af72-98b86e4d1d5f
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: ""
        name: EVENT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59d3088d-97f2-4c53-9ebc-ae021c7b49e2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ROW_NUMBER() OVER(PARTITION BY ds_pims_provider_spells.prvsp_refno ORDER BY ds_pims_provider_spells.admit_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57e828e1-376c-4227-a3a7-fc8a20caf2b3
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Specialty of the first inpatient professional carer episode
        name: ADMIT_SPECT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 72c532b7-79a7-49aa-8bc0-c737daef331d
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f7da067-4c42-4d7f-ad67-9a5d218c5168
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SPONT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 11ba3682-5d1a-4a53-bfaf-b4b646e6c99f
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30ccca1a-d162-4fd1-8b3d-46c08177246c
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Event Service Point Code
        name: EVENT_SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd8b5dc7-5f8d-48f1-96e5-e9f85b2dc97c
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e236a9be-1643-4aa4-ba73-1fba703c167c
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: hospital_code
        name: HOSPITAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b060a5be-3e78-40a1-96c9-11a9b2f6d0f3
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f97f367b-b615-4342-8006-ab358e4fc465
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: HOSPITAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c859f23e-870e-43b1-a6e4-7ff0f4ff7626
                stepCounter: 331048bb-7ff9-400f-b8c4-4ac7cc91d7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bbc078d3-75b8-4da2-b638-ae8647d88b38
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADMET_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b9fc1ad-a8cc-4c29-bd6b-b55c9007f7ce
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68f8ee9c-565a-42b2-a088-b20e8a155ef1
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADMISSION_METHOD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cfd358e5-689e-4542-a972-0aba002b02cf
                stepCounter: 469bfd7a-0084-4352-8ef5-69fd15a77ed4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a6d09d0-c591-4143-9a66-edaf41885afd
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADMISSION_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d98142f0-f261-4055-ad8c-581c6636e853
                stepCounter: 04c42cb2-f015-4d9e-ae6d-9feed9f13b97
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f767b438-59b7-468e-afa6-c915a628b211
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADSOR_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d682efad-8fd7-4911-beb0-f3a99784edd4
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0244b0a8-8514-4332-ba67-8c45753ce55b
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: READM_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5c018533-12b7-4065-b16b-5f92a9fb86f2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3df06478-90eb-4bc3-bf32-342a05c82790
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: CLEVL_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b37f4af8-553e-4dd4-9c1c-b8aa02f27b3d
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce4730b4-fab1-443e-902a-14678f252aaa
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a06254d-d86c-4cf5-ab17-b37af0d69b0a
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e27bad3-3f3e-4b12-8d4c-bde9f01dd0cd
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DISDE_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f097725-1edd-4539-b340-14de489b6fa2
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2f2c82a-2117-4093-8162-258a5459bd3d
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADCAT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4414ecc-4c91-49ec-a055-6affc8dbde9a
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a385fb8-d492-4b43-b3fb-15ad16a242cd
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DISMT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5a2db989-19c9-48be-ab15-47452de5e290
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4fc067e7-c2be-410b-aa54-23a82ce06516
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: EVENT_END_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63829b4b-cb50-47c5-b8fc-df3a7548d9af
                stepCounter: 1bd29797-d2cb-4604-b84b-82897e347c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9a40dc1-82ec-443e-82c8-29fd55a1f2df
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Flag indicating event can be the initial one in an OS3 sequence.
        name: OS3_ADMIT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cfd358e5-689e-4542-a972-0aba002b02cf
                stepCounter: 469bfd7a-0084-4352-8ef5-69fd15a77ed4
            transform: |-
              CASE WHEN dim_admission_method.admission_method_code IN ('AC','ZC','AP','WN') AND ds_pims_provider_spells.adcat_refno IN (1000008242, 1000008240, 1000008180) THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b541711c-d7c3-4159-823a-a76f018fdf5d
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Flag indicating event can be the final one in an OS3 sequence.
        name: OS3_DISCHARGE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63829b4b-cb50-47c5-b8fc-df3a7548d9af
                stepCounter: 1bd29797-d2cb-4604-b84b-82897e347c39
            transform: IIF(dim_discharge_method.event_end_type_code NOT IN ('DA', 'DF', 'DO', 'DP', 'DT', 'DW', 'ET','NA','0'), 1, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61e511b9-2fe6-4901-811a-470969df0702
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1125cf7f-7027-45ac-acc8-b3a92505c4da
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: |-
              CASE WHEN ds_pims_provider_spells.admit_dttm IS NULL OR ds_pims_provider_spells.admit_dttm <= '1990-01-01' OR ds_pims_provider_spells.admit_dttm > GETDATE() THEN IFNULL(ds_pims_provider_spells.disch_dttm, CONVERT(date, GETDATE()))
                          ELSE ds_pims_provider_spells.admit_dttm
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0fb05c79-d395-4757-af99-6f25dd443edb
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIT_DATE_ORIG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1125cf7f-7027-45ac-acc8-b3a92505c4da
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 203413be-7d2c-463d-8f9d-fb069f24a780
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee3a67e8-1a53-44ab-aa64-cafc588de09c
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: |-
              CASE WHEN ds_pims_provider_spells.disch_dttm IS NULL OR ds_pims_provider_spells.disch_dttm <= '1990-01-01' OR ds_pims_provider_spells.disch_dttm > GETDATE() OR ds_pims_provider_spells.disch_dttm < ds_pims_provider_spells.admit_dttm THEN NULL
                          ELSE ds_pims_provider_spells.disch_dttm
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88f4c767-d674-4d30-bbe0-2e7854d121e7
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCH_DATE_ORIG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee3a67e8-1a53-44ab-aa64-cafc588de09c
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68b0d09a-4008-4ac7-85d9-b00b63862b97
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFRL_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80e5eecf-b3fb-4fc8-b661-b39389f47738
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6789de5a-aa82-424c-8b60-504b978d6036
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: AEATT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d60c752-dcc2-482d-b5d3-e8c11f77a74f
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f7dc1539-efac-4c03-b6da-ea3c0f010653
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: FIRST_REGULAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b9caf7d-206b-4215-923e-0a8fcf1d38fd
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0779bc5-bf7e-4001-8440-f3cc99dc5861
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: INMGT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 76ce2d66-f620-4545-bd3f-71d1e5604f03
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1048f865-a728-4e44-b371-cc5b66b8afd3
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EXPDS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a5a335e-f714-4f3e-a830-98ebf37f63e8
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85c51bfc-e1e1-469f-9c1e-6389c2643663
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: DISABLED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19b4dc46-790d-4855-996e-74e704416106
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54232582-e014-428e-a034-10318b5c7274
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: CONFIDENTIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6604579-0800-40b1-867d-e59c721e91d4
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 766c399e-8fbf-496a-a70c-846b6e902e66
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IDENTIFIER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e7ce674-a689-4f6e-b177-025b020aa1ad
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 711aac6d-d6b3-4ad1-8772-e1b54b58bb3e
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9d1ddefc-a73c-4486-a6a2-280c2804408d
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 269dcc65-0019-498d-bdae-b55c060ba731
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: FAST_TRACK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 474c4ea1-defd-43a9-bbcc-24c1a12f7605
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c91e68cd-d829-4542-b1ce-3b37e059ecb0
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: AGEBD_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ba2821a-4594-442f-9a59-e7629eb68743
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80b762a1-a6cb-46dd-b2a7-6acf0686fb95
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: NO_FUNDS_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: adaf7607-d34e-4c33-a149-678ed4d276ce
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c045940-e028-4eb3-ba4d-f1ab9e76ac82
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: PRVSN_START_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 23a37a08-2f83-4370-9738-9133ff8e3c00
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4a1a9d2-fccc-4da9-af51-4e6b38afdb2c
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: PRVSN_END_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 75adebc2-28b6-4c2e-81fe-a7029f349f41
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: abe46941-c693-4564-9cd5-b52de854fbb3
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: CNTCT_PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3dfd02a9-1ba2-4aa2-808e-04d07280dc1b
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4bfb99b-11bf-4554-8ce3-721c455ea9d0
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MED_DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: adf2c303-3c4f-4246-a72c-d79692864825
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: |-
              CASE WHEN ds_pims_provider_spells.med_disch_dttm IS NULL OR ds_pims_provider_spells.med_disch_dttm <= '1990-01-01' OR ds_pims_provider_spells.med_disch_dttm > GETDATE() THEN ds_pims_provider_spells.disch_dttm
                          ELSE ds_pims_provider_spells.med_disch_dttm
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3697b645-b0b8-4dde-a8dc-0921c73cddd9
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MED_DISCH_DATE_ORIG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: adf2c303-3c4f-4246-a72c-d79692864825
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7144b0e0-cdb0-41f9-b9d1-294b1ccc3b01
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PMETD_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3644fefd-e190-4734-9fa9-5752d0cf61e4
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96083243-5fd0-432a-98e3-5764178202dc
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DSINF_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 67295302-afd0-45b8-bd94-f3c17581dfa1
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47bc1a16-3034-4362-a2d4-a10f164f93af
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IDPAP_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 610a8953-82f0-459f-be85-6fb303187454
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e7da23f-5da0-4bfe-8b40-de68161ccd52
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: CONSENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 300e2654-6b58-4cf5-879e-85f966675fb4
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3bff8162-ebf3-4358-a442-e0bac4267d48
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: GP_ADVISE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 620ed001-b626-4a15-8bc6-0946baba77e0
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce3bf38e-bbfd-4b6e-b35e-651a88199f16
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IRADM_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14ab4fe6-1fce-4b98-8199-a0a695c00493
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c3b97f9-acfb-46dd-a4e5-5f5bba316d7a
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: MECH_VENT_HRS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1c99fd5-9431-4507-9aed-ed743ea80145
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a560563-c54c-4f5b-810d-36f631e6776d
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: AMBULANCE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd844a44-4711-40f4-b299-8db19bad94f6
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b3bd8fe-509d-4616-b80c-20f1b0ce4870
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRIOR_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e87c7168-bf9d-43a0-aafd-bc2b4959d2dc
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 124c6a23-4073-46fd-8125-74f5127dbf97
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: RELATED_ADMISSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 442b4b35-07d7-4d71-838f-176e081c31fa
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2dc0c782-b400-46a9-9af8-b331c3f2934f
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: READM_REHAB_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b45c7aa4-a942-4d04-80f4-f2a6d595fa4f
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d00d5a05-e3b8-410d-8535-427c2c1c184c
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SRTPC_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d4d50fc-13d3-469c-9630-b41641ee3a7d
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6684c7e-b39a-486e-8263-eccaf5d57eb1
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ACAST_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64690faa-b9d5-4e60-9be7-eafc067d95aa
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6d50dac-7ec4-4be8-90b7-73dcd757fbb3
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ACC_EXPIRY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 550e0fe6-5e63-4326-9718-c13735c22824
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 325f10c1-5584-44f9-96ff-d22c4fed48ab
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REHAB_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9233bee-8c08-4b7c-924e-7fff577e1ec1
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 621c25e2-eb6d-4c90-839b-738ee50ca98b
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: WLIST_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f993f650-d845-4c5d-be64-636ff53122f0
                stepCounter: cb8cd7bc-c5c1-4ee3-a1f5-2c0bda3624d5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9557aa12-86f3-4ea7-834e-55d675697d11
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: Carer Episode Outcome
        name: CEOCM_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37c6568a-2041-4be3-acb2-4c317fab46eb
                stepCounter: cb8cd7bc-c5c1-4ee3-a1f5-2c0bda3624d5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f57d2593-d25c-4c6b-a3f1-b65f711653d1
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Specialty of the last inpatient stay episode. Discharge Specialty
        name: SPECT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              -- 23-Feb
              -- Commented out COALESCE. Not sure why it's there. Not done in Prod.
              --ALESCE(ds_pims_prof_carer_episodes_dx.spect_refno, ds_pims_provider_spells.spect_refno)
              ds_pims_prof_carer_episodes_dx.spect_refno
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c336df2-e0a1-4248-b8e2-51528903769b
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CODING_ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fe7ef84-1dca-487e-affa-fe3c1e92e15a
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 11e6f20d-60ac-4242-99c1-361f502ddd12
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CODING_DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f6e8c6a-b20c-4b30-9522-15c66332156b
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81f2bf0e-1c90-4699-afdb-dcb1785f8c28
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a888a138-9840-4736-912c-e9bbecc170b1
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fac3ac5a-e6c0-421c-a940-d3e33d1e7de8
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: CODED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a888a138-9840-4736-912c-e9bbecc170b1
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: |-
              CASE WHEN ds_plato_event_details.drg IS NULL THEN 'N'
                          ELSE 'Y'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 093a16e9-2c48-43b7-9225-2761d6eca8bf
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: MDC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bbfff9b7-6cdd-477d-aa95-451e49e98293
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 316c95d8-0518-42e0-b8c8-d6281d5dbd3d
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: NMDS_EVENT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dbd0c0df-350d-40ec-9506-fb0f852f6485
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7539eb04-63e9-4501-828e-9a2bec8988c9
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d251445f-9071-45c8-9852-33801fbc8496
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: REPLACE(ds_plato_event_details.purchaseunit, '.', '0')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 086b3fe9-5d77-4333-be81-e022ac933bbc
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE_FIXED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d251445f-9071-45c8-9852-33801fbc8496
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0db690a-a8d5-415d-8bf9-b0781871a023
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: SCBU_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d251445f-9071-45c8-9852-33801fbc8496
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: |-
              CASE WHEN ds_pims_provider_spells.inmgt_refno = 1410021940                                                                               THEN 'N' -- Incorrectly coded rows

                          WHEN REPLACE(IFNULL(NULLIF(ds_plato_event_details.purchaseunit, 'EXCLU'), ds_plato_event_details.excludedpuc), '.', '0') = 'W06003' THEN 'Y'
                          WHEN s_in_patient_stay_SCBU.prvsp_refno IS NOT NULL                                                                                 THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1642b97f-d2c2-4e4b-8ede-8cfe0c181315
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if one of the ward stays for the event is SCBU. This column not currently used. Only here for debuggint purposes.
        name: SCBU_WARD_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6425c40c-46f3-4898-a10c-0b1e7b0f3310
                stepCounter: b3db02b2-73e6-4b50-8873-51eb92151fdd
            transform: IIF(s_in_patient_stay_SCBU.prvsp_refno IS NULL, 0, 1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47d7908b-520c-496f-8d00-5e4a2d516246
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EXCLUDED_PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 153c73dc-f731-43e8-9540-7e2a583b3d4d
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51b164b2-40a4-444d-8423-0ff90dbaeaca
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: NUMERIC(19,5)
        defaultValue: ""
        description: ""
        name: WIES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b45e174c-eb7a-42b6-99e1-0f5aab799629
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3796230a-7b33-4439-8686-5aac84e456b0
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CODEDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: de6a7f94-2e9f-4ef2-97eb-88a7041af0da
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ccede749-5d03-4c00-92f3-df23f92d0c01
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CODER_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 825a0fbe-d2ca-442e-8e51-3d2c9ff9b8da
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a8bace5-76fe-4700-8096-b4d2fda74d32
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CCL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3267cd08-5fed-4f36-9f84-b284df240080
                stepCounter: e36e158e-c610-4da5-92bc-412a178a9d7a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c9e6005-3c3b-4b02-b927-6809402df593
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_SURGICAL_THEATRE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1deffcf-a4ed-43d4-b5a6-381bf06f689c
                stepCounter: 559bcb0e-7f2c-42ea-a758-d73dead63a4f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0398c3fc-4aa4-4ba2-9985-b2e9ad883330
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: surgical_theatre_group
        name: SURGICAL_THEATRE_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83f665b1-5917-4560-bcc5-f026dceaf20f
                stepCounter: 50d37543-6dd1-4ea0-bfe9-dc03dfc2dacc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d53d2fc-bfc9-4299-b007-2020a14b4254
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: PACKAGE_OF_CARE_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83f665b1-5917-4560-bcc5-f026dceaf20f
                stepCounter: 50d37543-6dd1-4ea0-bfe9-dc03dfc2dacc
            transform: |-
              --IIF(dim_admission_type.admission_type_code <> 'AC'
              --AND dim_service_point.service_point_code IN ('ESCSU', 'ESCPU', 'ESCN')
              --AND dim_surgical_theatre.surgical_theatre_group = 'ESC', 'Y', 'N')
              CASE WHEN dim_admission_type.admission_type_code <> 'AC' AND dim_service_point.service_point_code IN ('ESCSU', 'ESCPU', 'ESCN') AND ds_consolidate_theatre.session_start_date < '2024-07-01' AND dim_surgical_theatre.surgical_theatre_group = 'ESC' THEN 'Y'
                          WHEN cast(ds_consolidate_theatre.session_start_date AS date)>= '01-July-2024' AND (session_desc like '%POC' OR session_desc like '%OIF')                                                                                                        THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 231e50ac-c868-42d8-8d1c-6eca7fa044d7
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9fa58c0b-e217-4364-ae63-76c06b664a12
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f5e3ab0-4f85-4d10-ba7d-3b265222f05f
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d46d5d71-f9ed-4a34-b036-a6357ea34022
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a07d21b7-0ae2-4026-a0c8-5de952087e78
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ddce7ea8-e372-4d24-b23d-c90c5bdfaf39
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a0ab72c-5fef-4f13-8afe-d8162364898b
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: affa354a-ceac-43e3-85b3-7511cf413cd9
                stepCounter: 1206df94-8ac6-4021-a171-232e071d9dc2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38aefa86-325f-474a-968f-0b39ad747c1e
          stepCounter: 5874cd83-f58c-44fe-92e0-b83d47d22bab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_SHARED_INPATIENT_CHANGES
        join:
          joinCondition: |-
            FROM s_shared_inpatient_changes
              JOIN ds_pims_provider_spells
                ON ds_pims_provider_spells.prvsp_refno = s_shared_inpatient_changes.prvsp_refno
               AND ds_pims_provider_spells.prvsn_start_flag = 'N'
              LEFT OUTER JOIN ds_pims_prof_carer_episodes
                ON ds_pims_prof_carer_episodes.prvsp_refno = ds_pims_provider_spells.prvsp_refno
               AND ds_pims_prof_carer_episodes.start_dttm = ds_pims_provider_spells.admit_dttm
               AND ds_pims_prof_carer_episodes.archv_flag = 'N'
              LEFT OUTER JOIN ds_pims_prof_carer_episodes ds_pims_prof_carer_episodes_dx
                ON ds_pims_prof_carer_episodes_dx.prvsp_refno = ds_pims_provider_spells.prvsp_refno
               AND ds_pims_prof_carer_episodes_dx.end_dttm = ds_pims_provider_spells.disch_dttm
               AND ds_pims_prof_carer_episodes_dx.archv_flag = 'N'
              LEFT OUTER JOIN (
                    SELECT IP_Event_encounter_ID,
                           dim_surgical_theatre_key,
                           session_start_date,
                           ROW_NUMBER() OVER(PARTITION BY IP_Event_encounter_ID ORDER BY ds_consolidate_theatre.dss_update_time DESC) row_num ,
                           appointment_desc session_desc ,
                           service_point_session_reference_no
                      FROM ds_consolidate_theatre
                      LEFT JOIN ds_session_05
                        ON ds_consolidate_theatre.theatre_session_reference_no= ds_session_05.service_point_session_reference_no
                     WHERE patient_theatre_visit_seq_num = 1
                   ) ds_consolidate_theatre
                ON ds_consolidate_theatre.IP_Event_encounter_ID = ds_pims_provider_spells.encounter_id
               AND ds_consolidate_theatre.row_num = 1
              LEFT OUTER JOIN ds_plato_event_details
                ON ds_pims_provider_spells.encounter_id = ds_plato_event_details.pimsencounter
              LEFT OUTER JOIN s_in_patient_stay_SCBU
                ON ds_pims_provider_spells.prvsp_refno = s_in_patient_stay_SCBU.prvsp_refno
              LEFT OUTER JOIN dim.dim_admission_method
                ON ds_pims_provider_spells.admet_refno = dim_admission_method.admission_method_reference_no
               AND dim_admission_method.dss_current_flag = 'Y'
              LEFT OUTER JOIN dim.dim_admission_type
                ON ds_pims_provider_spells.admet_refno = dim_admission_type.admission_method_reference_no
               AND dim_admission_method.dss_current_flag = 'Y'
              LEFT OUTER JOIN dim.dim_discharge_method
                ON ds_pims_provider_spells.dismt_refno = dim_discharge_method.discharge_method_reference_no
              LEFT OUTER JOIN dim.dim_service_point
                ON ds_pims_provider_spells.spont_refno = dim_service_point.service_point_reference_no
               AND dim_service_point.dss_current_flag = 'Y'
              LEFT OUTER JOIN dim.dim_surgical_theatre
                ON ds_consolidate_theatre.dim_surgical_theatre_key = dim_surgical_theatre.dim_surgical_theatre_key
        name: S_SHARED_INPATIENT_EVENT_01
        noLinkRefs: []
  name: S_SHARED_INPATIENT_EVENT_01
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
