fileVersion: 1
id: 8add32ee-017a-4476-95b2-993059555600
name: S_THEATRE_TEAM
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Teams for each Surgical Theatre visit/event  "
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98958f14-6b0a-4b89-947f-33a02c63c7f9
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96f37922-95be-4491-8c62-9d7510ba6553
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59a4a8dd-b872-4f03-8825-8b61bbab7784
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRIMARY_SURGEON_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f94ea96-f096-4c0a-a516-8aa953af9c34
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SECONDARY_SURGEON_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32980ba2-33c6-4aed-ab22-01382c3b3744
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ASSISTANT_SURGEON_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 735ebc15-51b4-49c1-ab04-f71cfcaed2c1
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRIMARY_ANAESTHETIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c57bb62a-60c9-43cc-a6eb-52157c6f0b64
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SUPPORT_ANAESTHETIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9730b19-f428-429e-afd3-7e78d931fd4d
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TECHNICIAN_ANAESTHETIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e1313a2-82c6-48b0-8eba-c2801ca99b3d
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_SESSION_VISIT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ROW_NUMBER() OVER (PARTITION BY service_point_session_reference_no ORDER BY schedule_reference_no)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3cd12f6-48bc-4cff-81a1-03fa8841847e
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_SESSION_VISIT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: COUNT(1) OVER (PARTITION BY service_point_session_reference_no)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8ca46c2-a616-4c5f-8d54-5eda12959a4b
          stepCounter: 8add32ee-017a-4476-95b2-993059555600
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PROF_CARER_MAP
        join:
          joinCondition: |-
            FROM (
                    SELECT schedule_reference_no,
                           service_point_session_reference_no,
                           [SUPRI] AS primary_surgeon_reference_no,
                           [SUSEC] AS secondary_surgeon_reference_no,
                           [SUASS] AS assistant_surgeon_reference_no,
                           [ANATH] AS primary_anaesthetist_reference_no,
                           [ANATS] AS support_anaesthetist_reference_no,
                           [ANATE] AS technician_anaesthetist_reference_no
                      FROM (
                            SELECT schedule_reference_no ,
                                   service_point_session_reference_no ,
                                   staff_team_code ,
                                   clinician_reference_no
                              FROM staff_teams_1_v
                             UNION SELECT schedule_reference_no ,
                                   service_point_session_reference_no ,
                                   staff_team_code ,
                                   clinician_reference_no
                              FROM staff_teams_2_v
                           ) clinician PIVOT (MAX(clinician_reference_no) FOR staff_team_code IN ([SUPRI],[ANATH],[ANATS],[ANATE],[SUASS],[SUSEC])) team
                   ) ds_pims_prof_carer_map
        name: S_THEATRE_TEAM
        noLinkRefs: []
  name: S_THEATRE_TEAM
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
