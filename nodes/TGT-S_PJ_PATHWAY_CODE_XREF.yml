fileVersion: 1
id: 298d8144-7a9f-4d48-a62f-419b6da64625
name: S_PJ_PATHWAY_CODE_XREF
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Find the ICD, theatre and clinical codes associated with each Pathway declared in Mapping table tMap_Patient_Journey_Pathway."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eeb7b32b-8f2a-437f-8a26-00aa90fc341e
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATHWAY_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52029c7f-7ad8-48b4-adcf-9cb0f61aa3a9
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 822a56ac-8b7d-465d-a60d-afe98e705c59
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PATHWAY_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a5f781c-654b-4e60-8ab1-a78f2f5fec22
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c73b2a9d-2c47-46ec-8c40-d62485371c8e
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: CODE_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ed85b37-a748-4bd6-999a-fa46ff561378
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b9e377e-92c1-48bd-9d9d-f8e2d602ecb2
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(400)
        defaultValue: ""
        description: A comma separated list of code values or a pattern that can be checked with the LIKE operator.
        name: CODE_LIST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a47c79ab-a1f4-4b9b-8ff6-bbc36b0dc927
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 43491aaf-3deb-4eca-b885-be3dcc2aab1e
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DESC_SEARCH_VAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e77f4af4-f644-4d8c-89e8-e27e1ef2aef8
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f9c4f67-e8f2-4ec7-b342-4ffc0a502a3f
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3d94159-d4e1-41a3-9ac0-c46cab933c5e
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f3f9cce-f31f-4cbe-8164-9cc67b56e262
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: BIT
        defaultValue: ""
        description: Flag indicating this pathway is for a chronic condition.
        name: CHRONIC_CONDITION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8f5785e-3490-419d-a260-9a50cc52b461
                stepCounter: 72c95342-9259-4d1c-95fe-a5051e2b9ff9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b85a1e98-f006-44f3-b271-293c15237feb
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_SPECIALTY_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 79aee918-ff6f-4b0a-a656-000827899f3e
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2b8a35a-afc8-43b3-abbb-b05917268d4c
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(7)
        defaultValue: ""
        description: ""
        name: ICD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba21d7e7-ca3a-492a-ad04-72cc2422af48
                stepCounter: 14296dc0-a536-4a05-bd68-f298f228f590
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c27f143-ac64-4143-9298-f4cfb2eceda4
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ICD_SHORT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7b15931-0836-4346-928c-200b37ab5bee
                stepCounter: 14296dc0-a536-4a05-bd68-f298f228f590
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e009f44-734a-4289-8221-7835e51a48eb
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TREATMENT_PROTOCOL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 410f28dd-59d5-4f2d-b2aa-75b1a5a19b9e
                stepCounter: bca3ad6c-7baa-4f42-8e2f-7ab945c58863
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f37fa669-d9db-433e-a2f9-3441aee8071c
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: TREATMENT_PROTOCOL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4f1f474-848b-4739-bfd8-f4d62e574714
                stepCounter: bca3ad6c-7baa-4f42-8e2f-7ab945c58863
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0ca3b98-3d31-4ec8-bca9-7251c721ff28
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: theatre_procedure_code
        name: THEATRE_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 262474ea-64f5-4a8a-8e03-2f585f9dc405
                stepCounter: 840b1a44-55c1-4cbc-9199-4415e254bce4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ef1a526-529c-435b-b861-1945f03c66b4
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: theatre_procedure_desc
        name: THEATRE_PROCEDURE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4af711b3-0ba3-4364-b578-34a6270b67c8
                stepCounter: 840b1a44-55c1-4cbc-9199-4415e254bce4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 875d1286-690e-4adb-98aa-35f4b60a1423
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c89102f9-96d5-4f2d-8a30-17a9dce4ab4a
                stepCounter: c9ea96b1-10f0-4480-aff0-b535fb105991
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af918197-9e9b-42ce-8b79-adacd1aafa93
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DRG_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 82b75e7d-4a9d-4952-823d-c3c9352d871e
                stepCounter: c9ea96b1-10f0-4480-aff0-b535fb105991
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a77c887-ea43-493a-ae79-875858169c31
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 923e252d-5be7-4ea7-a451-9f19d2acab53
                stepCounter: e2bedfb6-4e4a-4772-b218-923451ca6cfc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd832d69-4b95-445d-8660-6be7cd1759ad
          stepCounter: 298d8144-7a9f-4d48-a62f-419b6da64625
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_TMAP_PATIENT_JOURNEY_PATHWAY
        join:
          joinCondition: |-
            FROM l_tMap_Patient_Journey_Pathway
              LEFT OUTER JOIN dim.dim_specialty
                ON dim_specialty.specialty_code = l_tMap_Patient_Journey_Pathway.specialty_code
               AND dim_specialty.dss_current_flag = 'Y'
              LEFT OUTER JOIN dim.dim_ed_treatment_protocol
                ON l_tMap_Patient_Journey_Pathway.code_source = 'EDProtocol'
               AND l_tMap_Patient_Journey_Pathway.code_list = CONVERT(varchar, dim_ed_treatment_protocol.treatment_protocol_no)
               AND dim_ed_treatment_protocol.dss_current_flag = 'Y'
              LEFT OUTER JOIN dim.dim_ICD_Code
                ON (CHARINDEX(',' + dim_ICD_Code.ICD_code + ',', ',' + l_tMap_Patient_Journey_Pathway.code_list + ',') > 0 OR CHARINDEX(l_tMap_Patient_Journey_Pathway.desc_search_val, dim_ICD_Code.ICD_short_desc) > 0 OR dim_ICD_Code.ICD_code LIKE l_tMap_Patient_Journey_Pathway.code_list)
               AND dim_ICD_Code.ICD_row_num = 1
               AND l_tMap_Patient_Journey_Pathway.code_source = 'ICD'
              LEFT OUTER JOIN dim.dim_theatre_procedure
                ON (CHARINDEX(',' + dim_theatre_procedure.theatre_procedure_code + ',', ',' + l_tMap_Patient_Journey_Pathway.code_list + ',') > 0 OR CHARINDEX(l_tMap_Patient_Journey_Pathway.desc_search_val, dim_theatre_procedure.theatre_procedure_desc) > 0 OR dim_theatre_procedure.theatre_procedure_code LIKE l_tMap_Patient_Journey_Pathway.code_list)
               AND l_tMap_Patient_Journey_Pathway.code_source = 'Theatre'
              LEFT OUTER JOIN -- Multiple rows for each DRG code so just get the latest one.   (SELECT DRG_code, DRG_desc    FROM dim.dim_DRG_code    WHERE financial_year =     (SELECT MAX(financial_year) FROM dim.dim_DRG_code WHERE dim_DRG_code_key > 0)   ) dim_DRG_code  ON (CHARINDEX(',' + dim_DRG_code.DRG_code + ',', ',' + l_tMap_Patient_Journey_Pathway.code_list + ',') > 0  OR  CHARINDEX(l_tMap_Patient_Journey_Pathway.desc_search_val, dim_DRG_code.DRG_desc) > 0  OR  dim_DRG_code.DRG_code LIKE l_tMap_Patient_Journey_Pathway.code_list)  AND l_tMap_Patient_Journey_Pathway.code_source = 'DRG'    LEFT OUTER JOIN   (SELECT DISTINCT booking_procedure    FROM dim.dim_theatre_booking_procedure) dim_theatre_booking_procedure  ON  dim_theatre_booking_procedure.booking_procedure = l_tMap_Patient_Journey_Pathway.desc_search_val  AND l_tMap_Patient_Journey_Pathway.code_source = 'Booking'
        name: S_PJ_PATHWAY_CODE_XREF
        noLinkRefs: []
  name: S_PJ_PATHWAY_CODE_XREF
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
