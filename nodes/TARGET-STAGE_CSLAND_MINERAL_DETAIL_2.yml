fileVersion: 1
id: 953d3125-50a6-4ff6-a5b8-edeed273709a
name: STAGE_CSLAND_MINERAL_DETAIL_2
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: edb328fc-b7b2-4bbb-8a56-a214a03d7576
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: LAND_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0cd8ff3d-dfba-444f-ad8b-a7c74f86393a
                stepCounter: 8d54fbec-775c-49e0-b137-0943ce076c94
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68c331e9-42b1-47ae-a430-b8543fae58a0
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: RIGHTS_HELD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5938d232-e166-433d-bfed-1c4657cdc3a4
                stepCounter: 216ef25c-be9a-43aa-9633-67367a1099db
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7490003d-c348-4401-a3e0-7116040c6047
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: CURR_DOI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84ad3ac6-6986-4681-8c33-4a9b339d8cae
                stepCounter: 4c591dae-8cae-4462-b16e-495c5989ebb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c3dc4db6-1d60-424d-b962-a907ed9d6481
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: REF_DOI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84ad3ac6-6986-4681-8c33-4a9b339d8cae
                stepCounter: 4c591dae-8cae-4462-b16e-495c5989ebb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ae9892d-6162-4bc3-bf73-6622153525c6
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: RENT_DOI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84ad3ac6-6986-4681-8c33-4a9b339d8cae
                stepCounter: 4c591dae-8cae-4462-b16e-495c5989ebb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01354efb-2507-408c-a1f2-c161396b90ac
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: REMARKS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9627d6b-0243-4381-aa78-8f60e416fa69
                stepCounter: b54260d9-bd75-460e-9dd3-21982a0e38e4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61146e0a-60f8-403d-85c3-16918bece35c
          stepCounter: 953d3125-50a6-4ff6-a5b8-edeed273709a
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: MINERAL_FILE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_CSLAND_MINERAL_DETAIL_2: 953d3125-50a6-4ff6-a5b8-edeed273709a
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_CSLAND_MINERAL_DETAIL_2') }} AS SELECT REPLACE(LL.LAND_DESCRIPTION,CHR(13)||CHR(10),CHR(10)) "LAND_DESCRIPTION",
                   REPLACE(LR.RIGHTS_HELD,CHR(13)||CHR(10),CHR(10)) "RIGHTS_HELD",
                   CURR_D.DOI_DETAILS "CURR_DOI",
                   REF_D.DOI_DETAILS "REF_DOI",
                   RENT_D.DOI_DETAILS "RENT_DOI",
                   MR.REMARKS,
                   TRIM(LS.FILE_NUMBER)||TRIM(LS.FILE_SUB) "MINERAL_FILE_KEY"
              FROM DS_CSLAND.L_SUB LS,
                   DS_CSLAND.L_LEGAL LL,
                   DS_CSLAND.L_RIGHTS LR,
                   (
                    SELECT FILE_NUMBER,
                           FILE_SUB,
                           REPLACE(LISTAGG(TO_CHAR(REMARKS_DATE,'YYYY-MM-DD')||': ['||TRIM(REMARKS_TYPE)||'] - '||REMARKS, '~'),'~',chr(10)) "REMARKS"
                      FROM (
                            SELECT *
                              FROM DS_CSLAND.L_REMARK
                             ORDER BY FILE_NUMBER,
                                      FILE_SUB,
                                      REMARKS_DATE,
                                      OCCURRENCE
                           )
                     GROUP BY FILE_NUMBER,
                              FILE_SUB
                   ) MR,
                   (
                    SELECT FILE_NUMBER,
                           FILE_SUB,
                           LISTAGG(DOI_TYPE || ' (' || DOI_ID || ') ' || CHR(10) || DOI_DETAIL || CHR(10), '~') "DOI_DETAILS"
                      FROM (
                            SELECT DX.FILE_NUMBER,
                                   DX.FILE_SUB,
                                   TD.DESCRIPTION "DOI_TYPE",
                                   DD.DOI_ID,
                                   REPLACE(LISTAGG('     ' || RPAD(BA.NAME||'  ('||TRIM(DD.PARTNER)||')', 50, ' ') || LPAD(TO_CHAR(NVL(DD.PARTNER_PERCENT,0),'990.0000000'),12,' ') || ' ' || DECODE(DD.SILENT_PARTNER,'*','S',' ') || ' ' || DECODE(NVL(DD.PENALTY,'N'),'Y','P',' '), '~'),'~',chr(10)) "DOI_DETAIL"
                              FROM DS_CSLAND.D_XREF DX,
                                   DS_CSLAND.D_DETAIL DD,
                                   DS_CSLAND.BA_TABLE BA,
                                   DS_CSLAND.T_OWNERS TOW,
                                   DS_CSLAND.T_DOI TD
                             WHERE DX.DOI_ID = DD.DOI_ID
                               AND DX.SUBSYSTEM = 'M'
                               AND DX.EFFECTIVE_DATE <= CURRENT_TIMESTAMP
                               AND DX.EXPIRY_DATE > CURRENT_TIMESTAMP
                               AND DD.PARTNER = BA.PRIMARY_KEY
                               AND DD.PARTNER = TOW.OWNER(+)
                               AND ACCOUNT_GROUP = 'CURR%'
                               AND DX.DOI_TYPE = TD.CODE
                             GROUP BY DX.FILE_NUMBER,
                                      DX.FILE_SUB,
                                      TD.DESCRIPTION,
                                      DD.DOI_ID
                           )
                     GROUP BY FILE_NUMBER,
                              FILE_SUB
                   ) CURR_D,
                   (
                    SELECT FILE_NUMBER,
                           FILE_SUB,
                           LISTAGG(DOI_TYPE || ' (' || DOI_ID || ') ' || CHR(10) || DOI_DETAIL || CHR(10), '~') "DOI_DETAILS"
                      FROM (
                            SELECT DX.FILE_NUMBER,
                                   DX.FILE_SUB,
                                   TD.DESCRIPTION "DOI_TYPE",
                                   DD.DOI_ID,
                                   REPLACE(LISTAGG('     ' || RPAD(BA.NAME||'  ('||TRIM(DD.PARTNER)||')', 50, ' ') || LPAD(TO_CHAR(NVL(DD.PARTNER_PERCENT,0),'990.0000000'),12,' ') || ' ' || DECODE(DD.SILENT_PARTNER,'*','S',' ') || ' ' || DECODE(NVL(DD.PENALTY,'N'),'Y','P',' '), '~'),'~',chr(10)) "DOI_DETAIL"
                              FROM DS_CSLAND.D_XREF DX,
                                   DS_CSLAND.D_DETAIL DD,
                                   DS_CSLAND.BA_TABLE BA,
                                   DS_CSLAND.T_OWNERS TOW,
                                   DS_CSLAND.T_DOI TD
                             WHERE DX.DOI_ID = DD.DOI_ID
                               AND DX.SUBSYSTEM = 'M'
                               AND DX.EFFECTIVE_DATE <= CURRENT_TIMESTAMP
                               AND DX.EXPIRY_DATE > CURRENT_TIMESTAMP
                               AND DD.PARTNER = BA.PRIMARY_KEY
                               AND DD.PARTNER = TOW.OWNER(+)
                               AND ACCOUNT_GROUP = 'REF%'
                               AND DX.DOI_TYPE = TD.CODE
                             GROUP BY DX.FILE_NUMBER,
                                      DX.FILE_SUB,
                                      TD.DESCRIPTION,
                                      DD.DOI_ID
                           )
                     GROUP BY FILE_NUMBER,
                              FILE_SUB
                   ) REF_D,
                   (
                    SELECT FILE_NUMBER,
                           FILE_SUB,
                           LISTAGG(DOI_TYPE || ' (' || DOI_ID || ') ' || CHR(10) || DOI_DETAIL || CHR(10), '~') "DOI_DETAILS"
                      FROM (
                            SELECT DX.FILE_NUMBER,
                                   DX.FILE_SUB,
                                   TD.DESCRIPTION "DOI_TYPE",
                                   DD.DOI_ID,
                                   REPLACE(LISTAGG('     ' || RPAD(BA.NAME||'  ('||TRIM(DD.PARTNER)||')', 50, ' ') || LPAD(TO_CHAR(NVL(DD.PARTNER_PERCENT,0),'990.0000000'),12,' ') || ' ' || DECODE(DD.SILENT_PARTNER,'*','S',' ') || ' ' || DECODE(NVL(DD.PENALTY,'N'),'Y','P',' '), '~'),'~',chr(10)) "DOI_DETAIL"
                              FROM DS_CSLAND.D_XREF DX,
                                   DS_CSLAND.D_DETAIL DD,
                                   DS_CSLAND.BA_TABLE BA,
                                   DS_CSLAND.T_OWNERS TOW,
                                   DS_CSLAND.T_DOI TD
                             WHERE DX.DOI_ID = DD.DOI_ID
                               AND DX.SUBSYSTEM = 'M'
                               AND DX.EFFECTIVE_DATE <= CURRENT_TIMESTAMP
                               AND DX.EXPIRY_DATE > CURRENT_TIMESTAMP
                               AND DD.PARTNER = BA.PRIMARY_KEY
                               AND DD.PARTNER = TOW.OWNER(+)
                               AND ACCOUNT_GROUP = 'RENT%'
                               AND DX.DOI_TYPE = TD.CODE
                             GROUP BY DX.FILE_NUMBER,
                                      DX.FILE_SUB,
                                      TD.DESCRIPTION,
                                      DD.DOI_ID
                           )
                     GROUP BY FILE_NUMBER,
                              FILE_SUB
                   ) RENT_D
             WHERE LS.FILE_NUMBER = LL.FILE_NUMBER(+)
               AND LS.FILE_SUB = LL.FILE_SUB(+)
               AND LS.FILE_NUMBER = LR.FILE_NUMBER(+)
               AND LS.FILE_SUB = LR.FILE_SUB(+)
               AND LS.FILE_NUMBER = CURR_D.FILE_NUMBER(+)
               AND LS.FILE_SUB = CURR_D.FILE_SUB(+)
               AND LS.FILE_NUMBER = REF_D.FILE_NUMBER(+)
               AND LS.FILE_SUB = REF_D.FILE_SUB(+)
               AND LS.FILE_NUMBER = RENT_D.FILE_NUMBER(+)
               AND LS.FILE_SUB = RENT_D.FILE_SUB(+)
               AND LS.FILE_NUMBER = MR.FILE_NUMBER(+)
               AND LS.FILE_SUB = MR.FILE_SUB(+)
        dependencies:
          - locationName: TARGET
            nodeName: ODS_CSLAND_L_LEGAL
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_CSLAND_L_LEGAL') }}
        name: STAGE_CSLAND_MINERAL_DETAIL_2
        noLinkRefs: []
  name: STAGE_CSLAND_MINERAL_DETAIL_2
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
