fileVersion: 1
id: 3caf1478-3a5c-4cae-809f-77d369138f97
name: S_ALLIED_HEALTH_SHIFT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Dimension key look up. Source table for fact_allied_health_shift."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce0a2871-9e6e-4787-99fb-0df18b32077b
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(9)
        defaultValue: ""
        description: Id that uniquely identifies the encounter in Allied Health.
        name: ALLIED_HEALTH_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: db227c5e-c1c5-4d82-bcca-8ad878086fde
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac6f1e8c-f06a-4325-b622-1921654623af
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: Unique business identifier for inpatient event.
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3458d34-4848-44ae-a07a-e07b3ef968a7
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d3c9abf-b4cd-4879-b4cd-c941f395b246
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient NHI number.
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0fca3686-231a-4ec1-bed1-e2ba9c8e5c92
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78ac9143-bf7a-489d-85ea-0d0b7efa44db
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: DATE
        defaultValue: ""
        description: Date when the Allied Health shift occurred.
        name: SHIFT_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d50d4134-4dbb-45e3-a98f-9763f3454e34
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 62a633e6-48fb-4520-bae3-cd98e46ddf0e
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: Alphanumeric value that uniquely identifies a discipline e.g. DTN (Dietitian)
        name: DISCIPLINE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 91445b66-1627-4959-9267-9e87221d9060
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2b77264-40dc-440b-81a5-18f09c191cd6
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Internal unique identifier for a patient from the Patient Management System
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ab1b2f97-0368-4a87-a7a8-78a0f786bc39
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f1ca2f5-4ced-4451-85ef-0c7f27be40a6
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: PiMS ward code.
        name: DISCHARGE_WARD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6ecee2a4-e6d9-4f4e-8a9b-d50ee46c31c5
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c04795c2-67b5-4692-b6a1-6cd25b9a72b7
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Service_Point_Reference_Number
        name: WARD_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e9bee18-ca59-4005-94ac-5a281668e5f2
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a92f8c6b-3f03-4178-a5ff-bc82817f89b5
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Alphanumeric code that uniquely identifies a user in Allied Health.
        name: USER_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c2858cfd-3b03-4422-ade8-680486e1d5a6
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7565d9e9-1609-432d-996c-af3da2430cfe
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: NUMERIC(9,5)
        defaultValue: ""
        description: Shift time spent on the activity expressed in hours e.g. 1.25 = 85 minutes
        name: ACTUAL_SHIFT_HOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c72ef8fa-38c6-444e-966c-4459e2581286
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db6a2383-9a9a-41c7-ad0a-6ff42a92e1ec
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Shift hours time converted to minutes e.g. 1.25 hours = 85 minutes
        name: ACTUAL_SHIFT_MINS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b18fcfe-201d-4706-9d29-e7e40d493138
                stepCounter: 6fe6b433-af00-4e14-84f6-9cd727ba5634
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8460aaf3-06f1-4965-bfcb-4a0d0dfb6e8f
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: General counter always set to 1.
        name: SHIFT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a25f4baf-d4c2-438d-9db2-194203ea7152
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_allied_health_shift.discipline_code=dim_allied_health_discipline.discipline_code
        name: DIM_ALLIED_HEALTH_DISCIPLINE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 665743fa-cad2-4d4a-90d4-2dd1f1119713
                stepCounter: 3326b8b2-6f82-45a8-922e-8a92158ade59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1ce97a8-f20d-442d-9ce8-d05ec3f1e2ca
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_allied_health_shift.user_code=dim_allied_health_user.user_code
        name: DIM_ALLIED_HEALTH_USER_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e2a41f6-1f93-4b55-9bbf-9b0fa68c98d2
                stepCounter: c1c4225e-84e6-4424-84e6-a6fc9337746a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9acb27ad-92b9-41fc-a74e-66e40f88f384
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_allied_health_shift.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5293a4f4-be93-483f-9543-10b4aad2b024
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_allied_health_shift.shift_date=dim_shift_date.shift_date
        name: DIM_SHIFT_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb31e2af-1aa3-4fca-9c4c-bf46baf49ccc
                stepCounter: 0de1de98-baa4-467a-bd1f-b588439ad5c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce8b81e9-6895-45f2-8677-59194e38c6ea
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_WARD_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6aa5e7b8-4dc5-4b87-a4c2-5013db0e1dfc
                stepCounter: 50c31151-9204-4154-9caf-5d28244bde1a
            transform: IFNULL(dim_ward.dim_ward_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fbad4cf7-40bb-4bff-b9c4-ef11747f93a5
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_allied_health_shift.ward_reference_no=dim_discharge_ward.discharge_ward_reference_no
        name: DIM_DISCHARGE_WARD_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a25735e-86ed-4c2f-a186-3de54d64cd3b
                stepCounter: eb6e873e-8280-46c0-88b0-99a491465182
            transform: IFNULL(dim_discharge_ward.dim_discharge_ward_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91909675-b6f2-486c-98a2-60ed95372cee
          stepCounter: 3caf1478-3a5c-4cae-809f-77d369138f97
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_ALLIED_HEALTH_SHIFT_10
        join:
          joinCondition: |-
            FROM s_allied_health_shift_10
              LEFT OUTER JOIN dim.dim_ward
                ON dim_ward.ward_reference_no = s_allied_health_shift_10.ward_reference_no
               AND dim_ward.dss_current_flag = 'Y'
              LEFT OUTER JOIN (
                    SELECT dim_allied_health_user.user_code,
                           dim_allied_health_user_key,
                           row_number() OVER (PARTITION BY user_code ORDER BY dss_update_time DESC)rn
                      FROM dim.[dim_allied_health_user]
                   ) dim_allied_health_user
                ON s_allied_health_shift_10.user_code = dim_allied_health_user.user_code
               AND rn=1
        name: S_ALLIED_HEALTH_SHIFT
        noLinkRefs: []
  name: S_ALLIED_HEALTH_SHIFT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
