fileVersion: 1
id: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
name: STAGE_DIM_PROGRAM_FINAL
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d08efd2e-dcbb-4dd3-8da6-7bec5fd103f4
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: PROGRAMNUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0723ea10-352e-4486-abf0-60e452a036fe
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73bafe91-3722-480e-a0a1-1c416e404891
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Applies logic to identify Medi-Cal programs.
        name: ISMEDICAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0723ea10-352e-4486-abf0-60e452a036fe
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN ProgramNumber IN ('01','03','08','14','15') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 379fb2d6-856c-4517-8380-1a08b46f7f92
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ' DHCS identifies our programs using this code.'
        name: PROGRAMPLANCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 36eaf36f-f677-4fcd-837b-dbe0a2abbb84
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: COALESCE(ProgramPlanCode,'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3de85d17-bd46-4d6e-bee7-456fdfc55ca1
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Applies logic for the short abbreviation for a program.
        name: ABBREVIATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8cf276f0-77e8-4afb-a0b9-a233db6ce7c5
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN abbreviation = 'SHK' THEN 'HK'
                          ELSE COALESCE(abbreviation,'Unk')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90d9ed88-fc30-43b2-ae81-ebb7010c6ebd
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Long description for a program.
        name: DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5650dd2e-db50-41d2-9e06-31ec2bc1a210
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: COALESCE(UPPER(description),'Unknown')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 349f61ae-39d5-49ea-a5a1-0b00f60065ed
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: COUNTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d80bfade-af59-4e2d-b20f-82082db83e37
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 355fb40c-72b4-4656-881e-6ed28a146ef4
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: County name for the program.
        name: COUNTY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4eff9ecf-3c31-4dcc-8cf7-029f13c8e59a
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: COALESCE(county_name,'Unknown')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9609d53f-eea6-4195-9fe6-080460e328a1
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Applies logic for county regions.
        name: REGION_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26d3af09-31b4-404f-9444-dc6c37371bd6
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN region_name = 'SANTA CRUZ' THEN 'SANTA CRUZ & MONTEREY'
                          WHEN region_name = 'MONTEREY'   THEN 'SANTA CRUZ & MONTEREY'
                          WHEN region_name = 'MERCED'     THEN 'MERCED'
                          ELSE COALESCE(region_name,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 998b27bf-d3ce-4e3c-915c-547dce2480ec
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Applies logic for the line of business for the program.
        name: PROGRAM_ROLL_UP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 590e8101-17ec-4749-92a4-452b715f1cfe
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN program_roll_up = 'MEDI_CAL'     THEN 'CMS'
                          WHEN program_roll_up = 'NON MEDI_CAL' THEN 'KK'
                          ELSE COALESCE(program_roll_up,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e816af46-d46d-4a0a-96b7-e6e3523604f4
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Applies logic for the line of business type short description based on the data source.
        name: PROGRAM_TYPE_ROLL_UP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 118934d9-84bb-4f9b-9857-2c251013dc5a
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN dss_source_system = 'HSP' AND program_type_roll_up LIKE '%MEDI-CAL' THEN 'CMS'
                          WHEN dss_source_system = 'AIS' AND PROGRAM_TYPE_ROLL_UP = 'MEDI-CAL'     THEN 'CMS'
                          WHEN program_type_roll_up = 'NON MEDI-CAL'                               THEN 'KK'
                          WHEN dss_source_system = 'AIS'                                           THEN 'ASO'
                          ELSE COALESCE(program_type_roll_up,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6765f49-90d2-4753-ab0b-f87eee3e4029
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Applies logic for the program type long description based on the data source.
        name: PROGRAM_TYPE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6214f7a5-ac95-472c-a540-8bbbee3c8da6
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN dss_source_system = 'HSP' AND program_type_roll_up LIKE '%MEDI-CAL'     THEN 'Centers for Medicare & Medicaid Services (CMS)'
                          WHEN dss_source_system = 'AIS' AND program_type_roll_up = 'MEDI-CAL'         THEN 'Centers for Medicare & Medicaid Services (CMS)'
                          WHEN dss_source_system = 'HSP' AND program_type_roll_up NOT LIKE '%MEDI-CAL' THEN 'Knox Keene'
                          WHEN dss_source_system = 'AIS' AND program_type_roll_up = 'NON MEDI-CAL'     THEN 'Knox Keene'
                          ELSE 'Administrative Services Only'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b03053dd-5daa-407d-81f2-12d334360185
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Applies logic for the government agency or contracting entity that oversees the program.
        name: PROGRAMGOVERNINGBODY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN program_roll_up='MEDI-CAL'                                 THEN 'California Department of Health Care Services (DHCS)'
                          WHEN program_roll_up='HEALTHY FAMILIES'                         THEN 'California Managed Risk Medical Insurance Board (MRMIB)'
                          WHEN program_roll_up='HEALTHY KIDS'                             THEN 'County of Santa Cruz'
                          WHEN program_roll_up='IHSS'                                     THEN 'County of Monterey'
                          WHEN program_roll_up='ALLIANCE CARE INDIVIDUAL CONVERSION PLAN' THEN 'Department of Managed Health Care'
                          WHEN program_roll_up='ALLIANCE CARE AIM PROGRAM'                THEN 'California Department of Health Care Services (DHCS)'
                          WHEN description='MERCED COUNTY LIHP'                           THEN 'N/A'
                          WHEN description='MEDICRUZ ADVANTAGE'                           THEN 'County of Santa Cruz'
                          WHEN description='VIACARE'                                      THEN 'County of Monterey'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e27c7d5d-9540-42da-ade9-2f46d33d0e6a
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: EFF_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c766e4a1-c4c5-4cd9-964d-bb4adff9d321
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76384501-ae45-4ed0-b642-58b6407bd153
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Applies logic to set the date the program ended in the county based on the short abbreviation for a program.
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3c52f34-99c0-4b11-89ce-c9edeb4fbf3b
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN abbreviation='LMC'           THEN '2013-12-31'
                          WHEN abbreviation IN ('HF','MHF') THEN '2014-12-31'
                          WHEN abbreviation = 'MHK'         THEN '2013-04-30'
                          WHEN abbreviation = 'ACI'         THEN '2013-12-31'
                          WHEN abbreviation = 'MCA'         THEN '2013-12-31'
                          WHEN abbreviation = 'VIA'         THEN '2013-12-31'
                          ELSE COALESCE(end_date,'9999-12-31')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ff111c1-35c4-49c7-8a96-5020b0e12b5b
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Applies logic to determine whether program is active or inactive, based on date the program ended in the county.
        name: PROGRAMACTIVEIND
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN CASE WHEN abbreviation='LMC' THEN '2013-12-31' WHEN abbreviation IN ('HF','MHF') THEN '2014-12-31' WHEN abbreviation = 'MHK' THEN '2013-04-30' WHEN abbreviation = 'ACI' THEN '2013-12-31' WHEN abbreviation = 'MCA' THEN '2013-12-31' WHEN abbreviation = 'VIA' THEN '2013-12-31' ELSE COALESCE(end_date,'9999-12-31') END < CURRENT_DATE() THEN 'Inactive'
                          ELSE 'Active'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44169677-458f-4732-9e87-8e005f3cd93b
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Data Source of Record
        name: DSS_SOURCE_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a789c0a0-9314-4453-84ec-65254792119c
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41b96240-e158-4a8d-9833-75ac2a08d1ec
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Medicare-related Indicator
        name: ISMEDICARE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0723ea10-352e-4486-abf0-60e452a036fe
                stepCounter: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
            transform: |-
              CASE WHEN ProgramNumber IN ('16','17','18','19','20') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5153336-3b98-4b04-8849-1a70521d7225
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Rank the records in terms of which source takes priority.
        name: RANKING
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: DENSE_RANK() OVER (PARTITION BY ProgramNumber ORDER BY CASE WHEN dss_source_system = 'HSP' THEN 1 ELSE 2 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00af7711-3886-4cb0-83cc-4dd0419e4be7
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: CHAR(32)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - columnCounter: 3de85d17-bd46-4d6e-bee7-456fdfc55ca1
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 90d9ed88-fc30-43b2-ae81-ebb7010c6ebd
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 349f61ae-39d5-49ea-a5a1-0b00f60065ed
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 355fb40c-72b4-4656-881e-6ed28a146ef4
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 9609d53f-eea6-4195-9fe6-080460e328a1
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 998b27bf-d3ce-4e3c-915c-547dce2480ec
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: e816af46-d46d-4a0a-96b7-e6e3523604f4
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: f6765f49-90d2-4753-ab0b-f87eee3e4029
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: e27c7d5d-9540-42da-ade9-2f46d33d0e6a
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 76384501-ae45-4ed0-b642-58b6407bd153
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 3ff111c1-35c4-49c7-8a96-5020b0e12b5b
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 73bafe91-3722-480e-a0a1-1c416e404891
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 379fb2d6-856c-4517-8380-1a08b46f7f92
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: b03053dd-5daa-407d-81f2-12d334360185
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 44169677-458f-4732-9e87-8e005f3cd93b
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
          - columnCounter: 41b96240-e158-4a8d-9833-75ac2a08d1ec
            stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3dde61d-fe90-49ea-8488-3fe9de94c96a
          stepCounter: c6c2bb5c-526d-47e1-b9b0-fd8b17905c24
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_DIM_PROGRAM: 5e6d4e63-9f6e-43ee-8764-24b07698bc6f
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: STAGE
            nodeName: STAGE_DIM_PROGRAM
        join:
          joinCondition: FROM {{ ref('STAGE','STAGE_DIM_PROGRAM') }} stage_dim_Program
        name: STAGE_DIM_PROGRAM_FINAL
        noLinkRefs: []
  name: STAGE_DIM_PROGRAM_FINAL
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
