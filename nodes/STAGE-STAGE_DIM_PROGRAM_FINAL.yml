fileVersion: 1
id: 141cd6f6-901f-40f8-8c64-30c3ecddd944
name: STAGE_DIM_PROGRAM_FINAL
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f59315a7-de97-4429-b2ef-32694e675eba
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: PROGRAMNUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f75183ed-a10b-48df-9a60-89dd8bce5fd9
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92a1fb5c-e83b-4688-9a6d-3cc2f978bbcc
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Applies logic to identify Medi-Cal programs.
        name: ISMEDICAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f75183ed-a10b-48df-9a60-89dd8bce5fd9
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN ProgramNumber IN ('01','03','08','14','15') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 009b296d-1d93-4f37-9a58-5d772d98f421
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ' DHCS identifies our programs using this code.'
        name: PROGRAMPLANCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 06f8fcf8-9d26-4568-9e1b-37656a2f7a1e
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: COALESCE(ProgramPlanCode,'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd428129-28b9-42c6-83e4-8031708b1723
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Applies logic for the short abbreviation for a program.
        name: ABBREVIATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba795c0e-52ac-44f1-bc51-db681d038cbd
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN abbreviation = 'SHK' THEN 'HK'
                          ELSE COALESCE(abbreviation,'Unk')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e5e889a-5318-4bef-a71f-3482f0cfa3e6
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Long description for a program.
        name: DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c16087c7-6021-40e8-a2f5-fc8cae09048d
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: COALESCE(UPPER(description),'Unknown')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3fe96e56-cc8b-48ae-a970-47a796b1a4a5
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: COUNTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 121ab54d-f0df-4204-ac25-8e9c53398643
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d76119d9-18bb-4502-a47e-f1a4ef289aaf
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: County name for the program.
        name: COUNTY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2822516-81a1-4407-bb87-ab9c97aedf04
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: COALESCE(county_name,'Unknown')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03f685af-fad9-4be0-8a0e-7b0ee92ad85c
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Applies logic for county regions.
        name: REGION_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 72a8cb10-c93a-41d9-ad69-78a0e7015792
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN region_name = 'SANTA CRUZ' THEN 'SANTA CRUZ & MONTEREY'
                          WHEN region_name = 'MONTEREY'   THEN 'SANTA CRUZ & MONTEREY'
                          WHEN region_name = 'MERCED'     THEN 'MERCED'
                          ELSE COALESCE(region_name,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6cceda3-e6ee-439d-8b08-f2947fd304dc
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Applies logic for the line of business for the program.
        name: PROGRAM_ROLL_UP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 12b82a22-e7a2-4f45-8a52-019cfa197d50
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN program_roll_up = 'MEDI_CAL'     THEN 'CMS'
                          WHEN program_roll_up = 'NON MEDI_CAL' THEN 'KK'
                          ELSE COALESCE(program_roll_up,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28c30db7-5695-4d1e-befc-b144d57dd18f
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Applies logic for the line of business type short description based on the data source.
        name: PROGRAM_TYPE_ROLL_UP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 096ff3f3-922c-446c-954b-6bde78af2469
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN dss_source_system = 'HSP' AND program_type_roll_up LIKE '%MEDI-CAL' THEN 'CMS'
                          WHEN dss_source_system = 'AIS' AND PROGRAM_TYPE_ROLL_UP = 'MEDI-CAL'     THEN 'CMS'
                          WHEN program_type_roll_up = 'NON MEDI-CAL'                               THEN 'KK'
                          WHEN dss_source_system = 'AIS'                                           THEN 'ASO'
                          ELSE COALESCE(program_type_roll_up,'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51f3aa25-6508-4a6b-ac80-3f3d79187351
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Applies logic for the program type long description based on the data source.
        name: PROGRAM_TYPE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b779f60-c305-4e12-a527-008f95561593
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN dss_source_system = 'HSP' AND program_type_roll_up LIKE '%MEDI-CAL'     THEN 'Centers for Medicare & Medicaid Services (CMS)'
                          WHEN dss_source_system = 'AIS' AND program_type_roll_up = 'MEDI-CAL'         THEN 'Centers for Medicare & Medicaid Services (CMS)'
                          WHEN dss_source_system = 'HSP' AND program_type_roll_up NOT LIKE '%MEDI-CAL' THEN 'Knox Keene'
                          WHEN dss_source_system = 'AIS' AND program_type_roll_up = 'NON MEDI-CAL'     THEN 'Knox Keene'
                          ELSE 'Administrative Services Only'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27e7d6c4-5e3a-4b54-822a-b2a33e7808f2
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Applies logic for the government agency or contracting entity that oversees the program.
        name: PROGRAMGOVERNINGBODY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN program_roll_up='MEDI-CAL'                                 THEN 'California Department of Health Care Services (DHCS)'
                          WHEN program_roll_up='HEALTHY FAMILIES'                         THEN 'California Managed Risk Medical Insurance Board (MRMIB)'
                          WHEN program_roll_up='HEALTHY KIDS'                             THEN 'County of Santa Cruz'
                          WHEN program_roll_up='IHSS'                                     THEN 'County of Monterey'
                          WHEN program_roll_up='ALLIANCE CARE INDIVIDUAL CONVERSION PLAN' THEN 'Department of Managed Health Care'
                          WHEN program_roll_up='ALLIANCE CARE AIM PROGRAM'                THEN 'California Department of Health Care Services (DHCS)'
                          WHEN description='MERCED COUNTY LIHP'                           THEN 'N/A'
                          WHEN description='MEDICRUZ ADVANTAGE'                           THEN 'County of Santa Cruz'
                          WHEN description='VIACARE'                                      THEN 'County of Monterey'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfcfcc17-9d97-4813-8ba1-42e7cee26e56
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: EFF_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0de9e687-26e3-48b0-8be3-ac5e74bc0e84
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfc19130-4c69-4ee0-82a7-1b8bac760dff
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Applies logic to set the date the program ended in the county based on the short abbreviation for a program.
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e790555-ca1a-4493-8ac3-ddc7fc95cc4a
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN abbreviation='LMC'           THEN '2013-12-31'
                          WHEN abbreviation IN ('HF','MHF') THEN '2014-12-31'
                          WHEN abbreviation = 'MHK'         THEN '2013-04-30'
                          WHEN abbreviation = 'ACI'         THEN '2013-12-31'
                          WHEN abbreviation = 'MCA'         THEN '2013-12-31'
                          WHEN abbreviation = 'VIA'         THEN '2013-12-31'
                          ELSE COALESCE(end_date,'9999-12-31')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19507499-2b63-4ad2-83fb-a85967aa59a1
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Applies logic to determine whether program is active or inactive, based on date the program ended in the county.
        name: PROGRAMACTIVEIND
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN CASE WHEN abbreviation='LMC' THEN '2013-12-31' WHEN abbreviation IN ('HF','MHF') THEN '2014-12-31' WHEN abbreviation = 'MHK' THEN '2013-04-30' WHEN abbreviation = 'ACI' THEN '2013-12-31' WHEN abbreviation = 'MCA' THEN '2013-12-31' WHEN abbreviation = 'VIA' THEN '2013-12-31' ELSE COALESCE(end_date,'9999-12-31') END < CURRENT_DATE() THEN 'Inactive'
                          ELSE 'Active'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 243c87e0-e230-4689-af42-a57fc411e8aa
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Data Source of Record
        name: DSS_SOURCE_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f310a820-8597-4591-b5ea-4697f79d1b87
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f7cad58-c580-4183-9777-ea956aba275f
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Medicare-related Indicator
        name: ISMEDICARE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f75183ed-a10b-48df-9a60-89dd8bce5fd9
                stepCounter: 40f9d64d-139e-45f9-8834-62bd766158e9
            transform: |-
              CASE WHEN ProgramNumber IN ('16','17','18','19','20') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba7e95d9-219b-464f-9e3e-958a014e49b9
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: Rank the records in terms of which source takes priority.
        name: RANKING
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: DENSE_RANK() OVER (PARTITION BY ProgramNumber ORDER BY CASE WHEN dss_source_system = 'HSP' THEN 1 ELSE 2 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8e696c9-594c-4a06-b79c-a2b2dc77f051
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: CHAR(32)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - columnCounter: dd428129-28b9-42c6-83e4-8031708b1723
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 0e5e889a-5318-4bef-a71f-3482f0cfa3e6
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 3fe96e56-cc8b-48ae-a970-47a796b1a4a5
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: d76119d9-18bb-4502-a47e-f1a4ef289aaf
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 03f685af-fad9-4be0-8a0e-7b0ee92ad85c
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: e6cceda3-e6ee-439d-8b08-f2947fd304dc
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 28c30db7-5695-4d1e-befc-b144d57dd18f
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 51f3aa25-6508-4a6b-ac80-3f3d79187351
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: cfcfcc17-9d97-4813-8ba1-42e7cee26e56
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: cfc19130-4c69-4ee0-82a7-1b8bac760dff
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 19507499-2b63-4ad2-83fb-a85967aa59a1
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 92a1fb5c-e83b-4688-9a6d-3cc2f978bbcc
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 009b296d-1d93-4f37-9a58-5d772d98f421
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 27e7d6c4-5e3a-4b54-822a-b2a33e7808f2
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 243c87e0-e230-4689-af42-a57fc411e8aa
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
          - columnCounter: 5f7cad58-c580-4183-9777-ea956aba275f
            stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 58e3f0b0-3254-4a89-a4b8-b7c50889565d
          stepCounter: 141cd6f6-901f-40f8-8c64-30c3ecddd944
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_DIM_PROGRAM: 40f9d64d-139e-45f9-8834-62bd766158e9
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: STAGE
            nodeName: STAGE_DIM_PROGRAM
        join:
          joinCondition: FROM {{ ref('STAGE','STAGE_DIM_PROGRAM') }} stage_dim_Program
        name: STAGE_DIM_PROGRAM_FINAL
        noLinkRefs: []
  name: STAGE_DIM_PROGRAM_FINAL
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
