fileVersion: 1
id: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "YTD AGGREGATE USAGE STATISTICS FOR EACH LEVEL1FORCEID"
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9d2bd467-a92f-40e6-b606-22e9745aaed2
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: LEVEL1FORCEID
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6e84be88-fa89-40f3-a850-026c57245594
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c74acbea-5235-4edd-92a6-f91ff7d7c2db
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 446bf7a6-9b8d-4276-b0e0-095c9a03fcc7
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 680ed6b8-545e-42f0-bee6-6a4c5426a4f2
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: DATE
        defaultValue: ""
        description: DSSMAXTRANSACTIONDATE
        name: DSSMAXTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ea7de9d-615e-49a0-8ce2-068d7d6447dc
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: MAX(OPSALESANDREVENUE.MAXRECEIPTDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e203fb8-2351-4e13-ac01-890e6e978cb4
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: DATE
        defaultValue: ""
        description: PREVIOUSYTD_MOSTRECENTTRANSACTIONDATE
        name: PREVIOUSYTD_MOSTRECENTTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 459b9135-f52b-4ac2-af88-f2f043966b48
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: MAX(OPSALESANDREVENUE.TRANSACTIONDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9b66c0c-005f-4dff-bcc7-e1be6525338b
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_MONTHSSINCELASTTRANSACTION
        name: PREVIOUSYTD_MONTHSSINCELASTTRANSACTION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 459b9135-f52b-4ac2-af88-f2f043966b48
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: DATEDIFF(MONTH,MAX(OPSALESANDREVENUE.TRANSACTIONDATE),MAX(OPSALESANDREVENUE.MAXRECEIPTDATE))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd4963e4-0d88-4bd4-a01f-bf6318ba3737
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFSUPPLIERSUSED
        name: PREVIOUSYTD_NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0e5efcc2-5b57-4201-8edc-7def03cf5a67
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: COUNT(DISTINCT OPSALESANDREVENUE.FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY OPSALESANDREVENUE.LEVEL1FORCEID) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ac68884-15a9-49ec-8c7b-4364e5ae90d4
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTRACTSUSED
        name: PREVIOUSYTD_NUMOFCONTRACTSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f153fab-7482-4193-b760-4b2b46c80f9e
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: COUNT(DISTINCT OPSALESANDREVENUE.INITIALCONTRACTID)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4bb7262-fa2e-463f-ad22-20cd8f9b954c
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTRACTCATEGORIESUSED
        name: PREVIOUSYTD_NUMOFCONTRACTCATEGORIESUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b0a58f1b-737f-4dcc-bff0-8a569e1112fd
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: COUNT(DISTINCT OPSALESANDREVENUE.CONTRACTCATEGORY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 479bfc35-d375-4ca7-a119-edf258e2c972
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_SUMOFSALES
        name: PREVIOUSYTD_SUMOFSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a01cb272-bc28-4fd1-a673-b02b0b725f2e
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: SUM(OPSALESANDREVENUE.SALES)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6bbaa154-4089-4e5a-b1c9-c48d53c4e3d3
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_SUMOFREVENUE
        name: PREVIOUSYTD_SUMOFREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85b4fd57-86d3-4ce0-9855-75b71fa16ecb
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: SUM(OPSALESANDREVENUE.REVENUE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f05026c8-75de-4f52-8861-cebae48e5906
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_RANKBYSALES
        name: PREVIOUSYTD_RANKBYSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a01cb272-bc28-4fd1-a673-b02b0b725f2e
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.SALES) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15d162c5-bf5c-4cc6-9042-c9c8445aec40
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_RANKBYREVENUE
        name: PREVIOUSYTD_RANKBYREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85b4fd57-86d3-4ce0-9855-75b71fa16ecb
                stepCounter: 3557aff5-4808-416f-970c-3206e4ee9667
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.REVENUE) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9e34797-a2ef-4b80-a3db-52829a378b82
          stepCounter: 4dc42a83-d14a-4118-b0b6-c57dc9a7b078
        config: {}
        dataType: INT
        defaultValue: ""
        description: PREVIOUSYTD_NUMOFCONTACTS
        name: PREVIOUSYTD_NUMOFCONTACTS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83cf9f2b-90d3-43c6-a6b1-c06956fa7f02
                stepCounter: 35f8d78b-6e7b-4fb6-a9b9-11bebbacf1ea
            transform: COUNT (DISTINCT CONTACT.DIMCONTACTKEY)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD -- (LEVEL1FORCEID, LEVEL1DISPLAYACCOUNTNAME, NUMOFSUPPLIERSUSED, NUMOFCONTRACTSUSED, NUMOFCONTRACTCATEGORIESUSED, ASOFMAXRECEIPTDATE, MONTHSSINCELASTTRANSACTION, MOSTRECENTRECEIPTDATE, SUMOFSALES, SUMOFREVENUE, SUMOFREVENUE, RANKBYREVENUE, RANKBYSALES, NUMOFCONTACTS, DSSCREATETIME, DSSUPDATETIME)
            \N \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) AS CURRENTYTD_NUMOFSUPPLIERSUSED \N , COUNT (DISTINCT INITIALCONTRACTID) AS CURRENTYTD_NUMOFCONTRACTSUSED \N , COUNT (DISTINCT CONTRACTCATEGORY) AS CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED \N , MAX(MAXRECEIPTDATE) AS DSSMAXTRANSACTIONDATE \N , DATEDIFF(MONTH, MAX(TRANSACTIONDATE), MAX(MAXRECEIPTDATE)) AS CURRENTYTD_MONTHSSINCELASTTRANSACTION \N , MAX(TRANSACTIONDATE) AS CURRENTYTD_MOSTRECENTTRANSACTIONDATE \N , SUM(SALES) AS CURRENTYTD_SUMOFSALES \N , SUM(REVENUE) AS CURRENTYTD_SUMOFREVENUE \N , RANK() OVER (ORDER BY SUM(REVENUE) DESC) AS CURRENTYTD_RANKBYREVENUE \N , RANK() OVER (ORDER BY SUM(SALES) DESC) AS CURRENTYTD_RANKBYSALES \N , COUNT (DISTINCT DIMCONTACTKEY) AS CURRENTYTD_NUMOFCONTACTS \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N
              LEFT OUTER JOIN DIM.CONTACT AS CONTACT
                ON \N CONTACT.LEVEL1FORCEID = SALESANDREVENUE.LEVEL1FORCEID \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(YEAR,TRANSACTIONDATE,MAXRECEIPTDATE) = 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   SUPPLIERID;\N
        dependencies:
          - locationName: DIM
            nodeName: CONTACT
          - locationName: OP
            nodeName: OPSALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTACT') }}
            {{ ref('OP','OPSALESANDREVENUE') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
        noLinkRefs: []
  name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_PREVIOUSYTD
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
