fileVersion: 1
id: a8b44f67-82a3-436e-821b-74ede04ae1f4
name: S_THEATRE_VISIT_CODING_SUMMARY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Summary of Clinical Coding Diagnosis data for each Theatre Visit  "
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 885ada0d-11fa-47ab-99e5-ce6dc5e000b5
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 739840fb-569c-4c5d-b2c6-4fc789b292f9
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8cacb282-8eca-4dcf-a888-59ed463821c7
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SCHEDULE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5af02d21-c926-4af0-8adc-9394fe55e41a
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f794367c-ec54-4c90-ab09-464288ee4054
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 90c76b0a-537e-4b3f-b098-d55627861663
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39d1e3e5-ae12-4706-b3b2-b8cd25362e1e
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa0a93ba-230e-4966-8dc0-0e170ceeec7a
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e90a931f-5931-4075-9161-1df29969da4f
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_clinical_coding_summary.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9d71b27-905f-49fa-ae67-ce627e973a81
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88d29aa8-1a09-4314-ad17-df4fa239e7fb
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77b683c5-799a-4d68-8826-042a5688d595
                stepCounter: 74560848-6964-491e-9f86-9d99fcb1f372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e32522b6-8fc2-4029-91dc-3352056f70df
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_01
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae151381-2cfd-42ed-9de8-c717b534e765
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_02
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7069fff-d770-4d25-8d28-bda067b92f79
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_03
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70dd853b-43c7-454e-a4bf-bdb5db1623a3
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_04
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9fbdbe1-7bce-4181-afcc-e8e74cea198e
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_05
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f76d93ed-b469-49d5-aa75-818db5511846
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_06
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa251362-f6de-47e3-9152-8a3e0dc765f3
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_07
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc62d5f9-8695-44a3-827d-54f33539de1d
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_08
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: faf55de6-11e4-458b-932a-0cd7dcc7b1b3
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_09
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03bcedcd-69ce-4d33-94d9-f504cf1af8a5
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_10
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19d53f39-3e32-49cb-94b6-1ba28a788600
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_11
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0570266e-c78e-4f96-9b16-9c3645f3a874
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_12
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08dc2537-b18f-41d6-ac63-0d59811415be
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_13
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae6d6a90-6f44-482b-9427-a41c54e85b81
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_14
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cfe89b6f-cf8c-4e00-8028-4acc3311b1b1
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_15
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea703187-53e5-4264-a30f-823b841b9bcb
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_16
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00208212-8da4-4a1d-a849-d92b3a2315d3
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_17
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4cdfa93-d5a9-47c6-9f09-e527fb46bb7c
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_18
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 758170a0-0181-4764-959d-5842254becd5
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_19
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 440eea9c-2db1-4b3f-984b-30f0e00afab1
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE_20
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35411ac8-1bd4-4322-9d60-dde61a21bae1
          stepCounter: a8b44f67-82a3-436e-821b-74ede04ae1f4
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_THEATRE_VISIT_DIAGNOSIS_PROCEDURE
        join:
          joinCondition: |-
            FROM (
                    SELECT theatre_visit_encounter_id,
                           schedule_reference_no,
                           patient_reference_no,
                           patient_NHI,
                           dim_patient_key,
                           diagnosis_procedure_type_code,
                           [1] AS diagnosis_procedure_code_01,
                           [2] AS diagnosis_procedure_code_02,
                           [3] AS diagnosis_procedure_code_03,
                           [4] AS diagnosis_procedure_code_04,
                           [5] AS diagnosis_procedure_code_05,
                           [6] AS diagnosis_procedure_code_06,
                           [7] AS diagnosis_procedure_code_07,
                           [8] AS diagnosis_procedure_code_08,
                           [9] AS diagnosis_procedure_code_09,
                           [10] AS diagnosis_procedure_code_10,
                           [11] AS diagnosis_procedure_code_11,
                           [12] AS diagnosis_procedure_code_12,
                           [13] AS diagnosis_procedure_code_13,
                           [14] AS diagnosis_procedure_code_14,
                           [15] AS diagnosis_procedure_code_15,
                           [16] AS diagnosis_procedure_code_16,
                           [17] AS diagnosis_procedure_code_17,
                           [18] AS diagnosis_procedure_code_18,
                           [19] AS diagnosis_procedure_code_19,
                           [20] AS diagnosis_procedure_code_20
                      FROM (
                            SELECT theatre_visit_encounter_id,
                                   schedule_reference_no,
                                   ds_theatre_visit_diagnosis_procedure.patient_reference_no,
                                   patient_NHI,
                                   dim_patient_key,
                                   diagnosis_procedure_type_code,
                                   diagnosis_procedure_code,
                                   medical_problem_level_no
                              FROM ds_theatre_visit_diagnosis_procedure
                              JOIN s_shared_schedule_theatre_05 with(nolock)
                                ON s_shared_schedule_theatre_05.patient_reference_no = ds_theatre_visit_diagnosis_procedure.patient_reference_no
                           ) dp PIVOT (MAX(diagnosis_procedure_code) FOR medical_problem_level_no IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [13], [14], [15], [16], [17], [18], [19], [20])) dp
                   ) s_theatre_visit_diagnosis_procedure
        name: S_THEATRE_VISIT_CODING_SUMMARY
        noLinkRefs: []
  name: S_THEATRE_VISIT_CODING_SUMMARY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
