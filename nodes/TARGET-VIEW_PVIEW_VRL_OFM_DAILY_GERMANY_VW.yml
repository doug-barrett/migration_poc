fileVersion: 1
id: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2f070cf-9667-4961-a08f-2310cec01609
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FLOW_NETWORK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acd1ec47-d0c6-4f1c-a94c-f1e0287b1916
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acd1ec47-d0c6-4f1c-a94c-f1e0287b1916
                stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1159780d-6b8f-45b9-9faa-81e143fad8b5
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1159780d-6b8f-45b9-9faa-81e143fad8b5
                stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b67cc3a8-c79a-4f53-8602-41a91e3a207b
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3dc55168-5172-4dda-b78c-6da1110f1d4b
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7cebc99f-5cbf-4f00-a478-2419d974e8db
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3dd1abb-0ae8-4cab-8b99-99a54b4ab6bc
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESTUB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ee6f2c1-12c9-4465-b37b-154bba143d3c
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70db590e-07d6-4a61-9db3-22d8f89b889c
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESCAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cc4c5c0-41bd-4baf-9231-65a7b10166d3
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eecb28a4-86f9-4a27-9d41-8fb58452fb70
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESLINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8a8a322-d205-40f9-8a30-6c67d8cf8295
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9af863e7-9ee4-427c-86d1-d4fb3208d627
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEMPWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7367603d-5cef-4b08-94a3-cf6e7cb8699a
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c12fcd8-7c4f-4059-b2f8-716f96c115c7
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SZCHOKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e0cf42e-9f0f-4201-b634-280b4b6f36fa
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c1d9319-8c7f-420c-9e51-1e6411272ab4
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50e4287d-1a74-496c-a4c4-1d906d41712e
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b65e853f-8894-4bac-92a0-57c18ab9c68c
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7baf3a60-91ed-4214-9090-f860df3b642d
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 264330e7-5c75-42f7-885c-391853596227
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c85086bc-b431-4f88-a6d9-c10f26236b56
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7e95ce71-1a9b-402d-83db-8218b304cf22
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: GOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b43d31da-1ccd-48ec-9548-d911ca96a815
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8edccd0e-b56d-47ed-9524-243120fb6242
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8273760-9f35-4a69-9a39-81110d8a06a6
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16e2d5cc-ce19-4ac4-b8ac-4cdddb60333c
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0a6efc5-8430-4a3e-b0a0-e502925c8567
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d57894f-9aae-4c39-8110-291d428e84c1
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6423f131-0589-46a8-a247-80e7b1310ba5
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 682012ea-1c43-4145-a756-c5300f82c1f2
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ad0cb55-ec67-4522-8e8c-5b5f31b8c5db
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b67319a9-8ea2-4a94-bbe5-80fca5dfbaee
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ed87a2e-c1e4-4628-8be3-213c8922e197
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b0f56fad-2bfc-43e4-aeb1-42ac3ad54e83
                stepCounter: 0f4cbe5a-209f-47f4-8dda-ada44dae38cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1f82e68-adcc-41d8-ba49-3632735eca93
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: FACILITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10e2be3f-a305-45ed-aba4-7d409f6722a0
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2de006b7-f5d4-4efb-9379-4a0fa1c40cbe
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: WCUT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3676bd98-40d6-43f8-8687-56860b6bac87
          stepCounter: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW: 2d85c03f-bec1-4158-a99e-d4cef2ca8b5a
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW') }} AS WITH gath_calcs AS(
                    SELECT c.idrec ,
                           c.completionname ,
                           co.dttm ,
                           co.ratechghcliq ,
                           co.ratechggas ,
                           co.ratechgwater ,
                           co.pctchghcliq ,
                           co.pctchggas ,
                           co.pctchgwater
                      FROM DS_PRODVIEW.PVT_pvunitcompgathmonthdaycalc co
                     INNER JOIN DS_PRODVIEW.PVT_pvunitcompgathmonthcalc mo
                        ON co.idrecparent = mo.idrec
                     INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                        ON mo.idrecparent = c.idrec
                   ) -- Main Query
            SELECT f.name flow_network ,
                   c.completionname well_name ,
                   c.wellidb uwi ,
                   p.dttm AS period ,
                   p.durop *24 AS hours_on ,
                   p.durdown* 24 AS hours_down ,
                   pa.prestub ,
                   pa.prescas ,
                   pa.presline ,
                   pa.tempwh ,
                   pa.szchoke ,
                   p.volprodgathhcliq AS prod_oil ,
                   p.volprodgathgas AS prod_gas ,
                   p.volprodgathwater AS prod_water ,
                   p.volnewprodallochcliq alloc_oil ,
                   p.volnewprodallocgas alloc_gas ,
                   p.volnewprodallocwater alloc_water ,
                   CASE WHEN (p.volprodgathhcliq > 0) THEN ((p.volprodgathgas / 1000) / p.volprodgathhcliq)
                        ELSE 0
                         END AS gor ,
                   gath_calcs.ratechghcliq ,
                   gath_calcs.ratechggas ,
                   gath_calcs.ratechgwater ,
                   gath_calcs.pctchghcliq ,
                   gath_calcs.pctchggas ,
                   gath_calcs.pctchgwater ,
                   NULL AS facility_name ,
                   round(p.volprodgathhcliq * d.densityhcliq / 1000,2) tons_oil ,
                   CASE WHEN (p.volprodgathwater + p.volprodgathhcliq) > 0 THEN p.volprodgathwater / (p.volprodgathwater + p.volprodgathhcliq)
                        ELSE 0
                         END wcut,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(f.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvflownetheader f
             INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                ON c.idflownet = f.idflownet
               AND f.syssecuritytyp = 'Germany'
             INNER JOIN DS_PRODVIEW.PVT_pvunitallocmonthday p
                ON p.idreccomp = c.idrec
               AND p.dttm < dateadd(d,-2, CURRENT_TIMESTAMP)
              LEFT JOIN DS_PRODVIEW.PVT_pvunitcompparam pa
                ON pa.idrec = p.idrecparam
              LEFT JOIN gath_calcs
                ON gath_calcs.idrec = p.idreccomp
               AND gath_calcs.dttm = p.dttm
              LEFT JOIN DS_PRODVIEW.PVT_pvUnitLiquidDensity d
                ON c.idrecparent = d.idrecparent
               AND d.dttm = (
                    SELECT max(dttm)
                      FROM DS_PRODVIEW.PVT_pvUnitLiquidDensity
                     WHERE idrecparent = c.idrecparent
                       AND dttm <= p.dttm
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
        name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
