fileVersion: 1
id: 7d48455e-606b-4110-8cbc-fbe63f4b854b
name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91fd5cda-8fbf-421b-a11b-a43bd270edb2
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FLOW_NETWORK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24634478-053f-4440-988f-73aef1f41703
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24634478-053f-4440-988f-73aef1f41703
                stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6865fa0-6b11-4477-aef6-cbd3e0ed17ea
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6865fa0-6b11-4477-aef6-cbd3e0ed17ea
                stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03849fd0-4705-41ff-a569-a4d7815b222e
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26349e6a-e5ed-4267-b8d8-2574e8f09b30
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c419b958-58b5-4707-b018-6fcbbb8a8c6a
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b63fb682-70dc-4142-aa0b-a845b57a872f
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESTUB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c10af379-bdbe-42bc-b41b-1fb7bb49e843
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b8c01f3-c590-4c50-9fe2-2d5df0025a98
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESCAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f47f5cce-108b-472c-a43a-5bc2d2562aa3
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0b2261ba-3990-4b10-b7ec-e105bdb00e8b
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PRESLINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce930dfe-6b7d-4b90-9462-803e255a4b1c
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 567ff7c1-ec81-4217-aa22-865f89ccc0ab
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TEMPWH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa908fa1-56f0-4d76-b4bf-b22cfcb1edba
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e828aefd-19e1-479c-99c8-a7fe434ada40
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SZCHOKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83ea1ca3-6335-41e7-a9ea-5d9d9f134217
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adf9e776-71aa-4ae8-b684-e9b570a970c5
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e87327bb-8c32-4000-8bad-f9cf5f77de2f
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ceec2110-9145-4f9f-82ac-29cbc8bbb5cd
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cba008b6-ea70-44ff-b720-365adae00a95
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55765bc5-5811-44ea-b988-7129171a1a70
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3257f493-bbd8-42da-95a9-c1de199f5346
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc64ab0f-9aeb-47c0-89be-5fbcbc002c6d
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: GOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f69afc7-9506-4603-80ae-4f1ecc11c2ce
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97928548-383f-4d2a-8980-5591ae8be50a
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88b0f0c1-b071-4d14-9fc1-feb7e9ac7ddc
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe849d3b-22f3-41d5-b3bc-efe056a6a2af
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6604c751-5c36-4731-a214-b3e7aa26fda8
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: RATECHGWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e146eb4-94c9-4ec4-815e-da1b335301ed
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a279ac58-62b1-457d-8fb4-72109afe8639
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGHCLIQ
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f68e4e47-c510-433a-aaa7-e5d4c5c164b3
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dbef6f74-2786-44d9-8b29-7bd7c1f852ec
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGGAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0da9039a-308e-4049-968a-003688da8c4f
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 656675d3-6667-461f-8c75-06978d54d329
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PCTCHGWATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3dffe448-494e-487f-a4ca-38865c48a42f
                stepCounter: f54c6027-52b0-4153-a894-f2a8e7f9c94c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1937bede-f988-4331-b359-cb1085f48212
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: FACILITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c04e209e-bc6e-4ac9-b1fe-b5df0e0813b5
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27560e71-c8b4-4036-bd2a-f68c42e06ea1
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: WCUT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3721bca7-6737-462b-8ec4-e343bf52851e
          stepCounter: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW: 7d48455e-606b-4110-8cbc-fbe63f4b854b
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW') }} AS WITH gath_calcs AS(
                    SELECT c.idrec ,
                           c.completionname ,
                           co.dttm ,
                           co.ratechghcliq ,
                           co.ratechggas ,
                           co.ratechgwater ,
                           co.pctchghcliq ,
                           co.pctchggas ,
                           co.pctchgwater
                      FROM DS_PRODVIEW.PVT_pvunitcompgathmonthdaycalc co
                     INNER JOIN DS_PRODVIEW.PVT_pvunitcompgathmonthcalc mo
                        ON co.idrecparent = mo.idrec
                     INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                        ON mo.idrecparent = c.idrec
                   ) -- Main Query
            SELECT f.name flow_network ,
                   c.completionname well_name ,
                   c.wellidb uwi ,
                   p.dttm AS period ,
                   p.durop *24 AS hours_on ,
                   p.durdown* 24 AS hours_down ,
                   pa.prestub ,
                   pa.prescas ,
                   pa.presline ,
                   pa.tempwh ,
                   pa.szchoke ,
                   p.volprodgathhcliq AS prod_oil ,
                   p.volprodgathgas AS prod_gas ,
                   p.volprodgathwater AS prod_water ,
                   p.volnewprodallochcliq alloc_oil ,
                   p.volnewprodallocgas alloc_gas ,
                   p.volnewprodallocwater alloc_water ,
                   CASE WHEN (p.volprodgathhcliq > 0) THEN ((p.volprodgathgas / 1000) / p.volprodgathhcliq)
                        ELSE 0
                         END AS gor ,
                   gath_calcs.ratechghcliq ,
                   gath_calcs.ratechggas ,
                   gath_calcs.ratechgwater ,
                   gath_calcs.pctchghcliq ,
                   gath_calcs.pctchggas ,
                   gath_calcs.pctchgwater ,
                   NULL AS facility_name ,
                   round(p.volprodgathhcliq * d.densityhcliq / 1000,2) tons_oil ,
                   CASE WHEN (p.volprodgathwater + p.volprodgathhcliq) > 0 THEN p.volprodgathwater / (p.volprodgathwater + p.volprodgathhcliq)
                        ELSE 0
                         END wcut,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(f.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvflownetheader f
             INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                ON c.idflownet = f.idflownet
               AND f.syssecuritytyp = 'Germany'
             INNER JOIN DS_PRODVIEW.PVT_pvunitallocmonthday p
                ON p.idreccomp = c.idrec
               AND p.dttm < dateadd(d,-2, CURRENT_TIMESTAMP)
              LEFT JOIN DS_PRODVIEW.PVT_pvunitcompparam pa
                ON pa.idrec = p.idrecparam
              LEFT JOIN gath_calcs
                ON gath_calcs.idrec = p.idreccomp
               AND gath_calcs.dttm = p.dttm
              LEFT JOIN DS_PRODVIEW.PVT_pvUnitLiquidDensity d
                ON c.idrecparent = d.idrecparent
               AND d.dttm = (
                    SELECT max(dttm)
                      FROM DS_PRODVIEW.PVT_pvUnitLiquidDensity
                     WHERE idrecparent = c.idrecparent
                       AND dttm <= p.dttm
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
        name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_OFM_DAILY_GERMANY_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
