fileVersion: 1
id: b07847c9-3421-4acf-bda2-39b0df747a68
name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59875859-47e7-45f1-b7ca-5c49985315d1
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: OUTPATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51dafd1d-7ad0-4c8e-b7ff-361f4bc1e88d
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: OUTPATIENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: "'T'+CONVERT(varchar,ds_pims_schedules.schdl_refno)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76bea6e0-d464-4a82-b983-935ec9275957
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: APPOINTMENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec8fa2c5-ca35-4bea-9290-bc50185e05e7
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e58a7d67-1c70-4500-bad0-cee5f1c5bc51
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.CONVERT(date,ds_pims_schedules.start_dttm)=dim_appointment_start_date.appointment_start_calendar_date
        name: DIM_APPOINTMENT_START_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7cb7c9c4-768a-46a1-a11a-29d725817353
                stepCounter: ad7d8a1b-35cc-4bd6-82bd-746d2f756dd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf94133b-bca6-4512-8782-06852ced3683
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 596d481c-4edf-41fe-907c-464199c623c9
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985f0ba0-97cf-4152-a49b-7e86cb71409e
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dea63cad-2522-491f-aa46-98f1c2f314a9
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7dcad9a6-52b1-402a-a292-1118300823b9
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26bd9886-51c8-4d19-982c-c3a25d9e9f62
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.patient_reference_no=ds_pims_diagnosis_procedures.dgpro_refno
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9abd603f-508e-4598-a13e-b205552ba328
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e42164d-4dc2-48b3-ad44-220664fead9d
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 271efe56-3d39-4d18-b5a7-7e1dcc80d250
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3600656-8246-48e2-8211-9552e8e94c23
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_SUBTYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b7e75777-154b-46ca-bcd8-350ebad16bdb
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecc036db-91d2-4737-b93c-f3e449aa298e
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b13793c-1c1b-48ab-a7a2-027165ad8193
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4973f5a-8acc-4b0d-be50-b512a1d20b75
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ae1a398a-9c7b-4fad-b7e2-8e105705ec6f
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9ff3693-9d18-46e0-b745-52bc7fc46cdf
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4c372ad-7e3b-459a-89ad-ec53d1b8cb49
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e174fc7-9bbb-4ce0-b468-ef7cdb36f47a
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 41477f9b-2e56-4810-8b2b-20d7496df208
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1f5375a-6fba-483d-83e3-25e31f95d135
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              -- CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN'  THEN
               --  ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --  (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END)
               --  ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
               --  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: deb99027-2b7d-4fa7-893d-0eabe09fbb78
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              --CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN'  THEN
               --     COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --      (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
               --  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36b971a5-606c-40f0-a480-64c97768c251
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_PROCEDURE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              --CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE'  THEN
               --    ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --  (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END)
               --  ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
               ----  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a625d65-e8fe-4cdd-a363-ebf96bed5299
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_PROCEDURE_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              -- CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE'  THEN
               --        COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --        (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END))
               --   ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8f3bab0-49a5-4349-8628-2a83c23a82d4
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: DIM_DIAGNOSIS_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24cebf11-1bcf-4240-a364-9b0f51cffc73
                stepCounter: 5c3dba16-610b-4df4-a82e-a17b4d31bb68
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 258ba068-b9e1-4581-8ae8-b96c55df3429
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 614e95dd-dc83-4fb6-80e2-eae0b812a7b5
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc4d8a62-a407-4a6b-ad8e-ac0785e5cd48
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f2de421-29ae-4da9-a753-3f3076972d72
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ce8dac3-8c40-4ed3-a9a3-aac35cd8e2e1
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.create_user_login_code=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dfe5e14-cc2f-4748-8352-a6d1621289af
                stepCounter: 70bd6ed5-e21b-440f-9079-7fe305bc4f30
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e6b833b-5a17-4354-86bf-38e2c0152966
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6decebff-eb31-4277-aa08-3a795ec793df
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 359f5dac-7ac7-4fdd-8de6-e0e58233ce69
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0018f473-59d0-4576-9d88-96374fcf8639
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21d0bf94-6120-4824-9271-28e527a8b097
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ceaa34a6-dd0b-40fb-bc61-9df93cc05e7b
                stepCounter: bef0768d-dddb-4d02-af8d-03160de42b62
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a58623bc-6f57-4b52-a535-b123c437f177
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_referral_30.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: OUTPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4034500c-89ca-4d35-95d9-fba1e41acbec
          stepCounter: b07847c9-3421-4acf-bda2-39b0df747a68
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_SCHEDULES
        join:
          joinCondition: |-
            FROM ds_pims_schedules
             INNER JOIN s_outpatient_diagnosis_procedure_v
                ON s_outpatient_diagnosis_procedure_v.outpatient_reference_no = ds_pims_schedules.schdl_refno
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_schedules.schdl_refno
               AND ds_pims_diagnosis_procedures.sorce_code = 'SCHDL'
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_diagnosis_procedures.mplev_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_diagnosis_procedures.cptyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.main_code = ds_pims_diagnosis_procedures.CCSXT_Code
               AND ds_pims_reference_values3.rfvdm_code = 'CCSXT'
             WHERE ds_pims_schedules.sctyp_refno = 12186 --'OTPAT'    --and ds_pims_schedules.dss_update_time > @v_pa_outpatient_incremental    --and ds_pims_schedules.dss_update_time > getdate()-3
        name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
