fileVersion: 1
id: 542e9b46-18bb-4bba-af60-f95510f992a6
name: S_ED_WHITEBOARD_ACTION
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15484b62-ae9e-4ea7-b953-1a4af3959ff2
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: whiteboard unique id from WB cacheAudit table
        isBusinessKey: true
        name: WHITEBOARD_ACTION_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c05158b-f5c7-4f5d-ad2d-b59a4e04fbb1
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9297e83a-6288-4e9a-9a95-28074c79745c
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM encounter number
        name: ATTENDANCE_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 312e2f04-68a6-4ca7-9f68-e92f8c14ecb0
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33c7930f-c772-4290-b87e-addce69dd0fc
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_specialty_code=dim_ED_WB_action_specialty.ED_WB_action_specialty_code
        name: DIM_ED_WB_ACTION_SPECIALTY_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1fa81bd-6ceb-4f45-81b1-486c9529d5d8
                stepCounter: e88b9caf-3742-47a4-9dcf-d5701b89de78
            transform: IFNULL(dim_ED_WB_action_specialty.dim_ED_WB_action_specialty_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b64e252a-2642-4910-ae14-6d3a9660cae8
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_assigned_consultant=dim_WB_action_assigned_consultant.WB_action_assigned_consultant_type_code
        name: DIM_WB_ACTION_ASSIGNED_CONSULTANT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(dim_WB_action_assigned_consultant.dim_WB_action_assigned_consultant_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74fe9dae-f26c-4ab7-be1b-9346aa34ede3
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM specialty under which the action was performed
        name: WB_ACTION_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0424e0dc-3548-468a-a8a3-7a24285fcb7d
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a62eee5-9c4a-479c-8ee9-11e112d1993f
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: 'iPM specialty group EMMED or other as they are managed independently '
        name: SPECIALTY_CODE_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0424e0dc-3548-468a-a8a3-7a24285fcb7d
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: |-
              CASE WHEN ds_WB_CacheAudit.specialtytype ='EMMED' THEN 'EMMED'
                          ELSE 'OTHER'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56907815-e876-4c4b-bb85-c0d97fa9beda
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_performed=dim_ED_WB_action.WB_action_performed
        name: DIM_ED_WB_ACTION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a3fdd58-1c7e-499c-8aec-dc1826f5fb93
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: IFNULL(dim_ED_WB_action.dim_ED_WB_action_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 83af1cad-8e23-42cc-b51a-fa9a96f3a331
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WB_ACTION_PERFORMED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3fdd97b3-1e59-4de3-880a-291aaa93c7ee
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e10c947e-78b5-4581-a16a-230751fa6941
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: datetime at which the action was performed
        name: WB_ACTION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5d086a2f-bbcc-4797-8abb-eb05cdaf63e5
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e051f9d5-5e36-4061-8e29-c834f836e778
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_seenby_doctor=dim_ED_WB_action_seenby_clinician.WB_action_seenby_clinician_user_code
        name: DIM_ED_WB_ACTION_SEENBY_CLINICIAN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e74f203f-76e7-45a2-9d8e-653c8675d1f9
                stepCounter: 66e32778-075f-4c08-af0d-cb1de97de284
            transform: 0 --IFNULL(dim_ED_WB_action_seenby_clinician.dim_ED_WB_action_seenby_clinician_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 600339d1-33e7-4fe9-a7e2-264fa114e4e9
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WB_ACTION_SEENBY_DOCTOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe8e90df-03e6-4b5a-800f-6c1c6510db08
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: |-
              CASE WHEN ds_WB_CacheAudit.performedaction IN('Doctor Handover','Nurse Seen by') THEN ds_WB_CacheAudit.userid
                          ELSE ds_WB_CacheAudit.seenbydoctorid
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60b416a1-043c-42ce-8aec-e25cd06e8ac9
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM assigned consultant at time of action
        name: WB_ACTION_ASSIGNED_CONSULTANT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3502c9b5-6bf7-4b8a-84f6-88d48b6dbe09
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6bd63002-c725-42fd-bee0-3df6fbf74c38
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: datetime the record was crated
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22cd2323-69d2-4423-a82f-1f89e773489f
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60bc8a84-8e87-430b-bfdd-f5761ec62693
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ecd7b64-a20d-4715-bcf6-789f8f0bec54
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3055260-b585-480f-93f0-4231e052f569
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d467abaf-de81-4f57-845f-d0d75d19cdc6
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9117489d-4cfe-47eb-9883-7204cea2c748
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e43fb2c3-78fe-4216-8429-150990d536f7
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.service_point_code=dim_ED_location.ED_location_reference_no
        name: DIM_ED_LOCATION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bab06ecd-8e25-475a-8a41-940ce0a7b207
                stepCounter: 795c21ea-1da9-4519-8c1b-1e9f6f1a9458
            transform: IFNULL(dim_ED_location.dim_ED_location_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91e68169-93c6-4f22-9baa-45692c77f37e
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence tof action within encounter
        name: ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4329e6de-1d47-4c72-8d8b-775879bc9a8e
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 960b4f1a-1ea5-4c78-a3cd-68599cf9a0b0
                stepCounter: 67549678-cd35-4ad8-8f92-50af3c66539f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72dbad38-efef-4006-9843-2e954385385e
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence of seen by action within encounter
        name: SEEN_BY_ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8b5d6a9-8682-4e62-b931-f096c3b17f85
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence withing an encounter grouping removal actions with thier corresponding actions
        name: REMOVAL_ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c79ac5ba-0a91-46f0-a040-d514cc6e2e27
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: 'Sequence or seen bys within an specialty grouping '
        name: SPECIALTY_GROUP_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5d9dd3c-8c70-40e2-9650-ea3380b12a31
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: 'Reverse Sequence for seen bys within an specialty grouping '
        name: SPECIALTY_GROUP_SEQUENCE_REV
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d38581c-a9e8-4ce5-97ea-7fe42a936cf2
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Grouping removal actions with thier corresponding actions
        name: REMOVAL_GROUPING
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9a13694-121c-4273-b8f2-a61e1ee52f84
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Was the action performed to remove a previous action? 1 = yes
        name: REMOVE_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecef48d8-bac8-45a8-bf9f-e0ffbe8fe477
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6f4b2d6-1151-4cd3-b841-166af9131d5b
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Is the action deleted by a removal action
        name: REMOVED_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8f2e616-a9f9-4543-8c28-7d417b41126b
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Was the action performed a seenby action? 1 = yes
        name: SEEN_BY_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0007808c-7ef7-490d-985c-0f427fa67dc9
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c788ede-f06e-4d9d-be99-00ef4eff1acb
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Action type sequence within an event
        name: EVENT_ACTION_TYPE_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_WB_CacheAudit.encounternumber ,ds_WB_CacheAudit.performedaction ORDER BY actiondttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30d4af5a-8666-4f5a-885c-9974136ea344
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence to handle non unique concerto user ids
        name: AUDIT_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY id ORDER BY actiondttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9880213-6a90-46a1-9a8b-f136244bb70f
          stepCounter: 542e9b46-18bb-4bba-af60-f95510f992a6
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_WB_CACHEAUDIT: 67549678-cd35-4ad8-8f92-50af3c66539f
          DIM_PATIENT: d52dd438-7899-4242-9e38-539d2a1447df
          DIM_ED_LOCATION: 795c21ea-1da9-4519-8c1b-1e9f6f1a9458
          DIM_ED_WB_ACTION_SEENBY_CLINICIAN: 66e32778-075f-4c08-af0d-cb1de97de284
          DIM_ED_WB_ACTION_SPECIALTY: e88b9caf-3742-47a4-9dcf-d5701b89de78
          DIM_ED_WB_ACTION: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_WB_CACHEAUDIT
          - locationName: TGT
            nodeName: DIM_PATIENT
          - locationName: TGT
            nodeName: DIM_ED_LOCATION
          - locationName: TGT
            nodeName: DIM_ED_WB_ACTION_SEENBY_CLINICIAN
          - locationName: TGT
            nodeName: DIM_ED_WB_ACTION_SPECIALTY
          - locationName: TGT
            nodeName: DIM_ED_WB_ACTION
          - locationName: UNKNOWN
            nodeName: DIM_WB_ACTION_ASSIGNED_CONSULTANT
        join:
          joinCondition: |-
            FROM {{ ref('TGT','DS_WB_CACHEAUDIT') }}
              LEFT OUTER JOIN {{ ref('TGT','DIM_PATIENT') }}
                ON ds_WB_CacheAudit.patientid = dim_patient.patient_NHI
               AND dim_patient.NHI_sequence = 1
              LEFT OUTER JOIN {{ ref('TGT','DIM_ED_LOCATION') }}
                ON ds_WB_CacheAudit.locationcode = dim_ED_location.ED_location_code
               AND IFNULL(dim_ED_location.dss_start_date, GETDATE()-10000) <= ds_WB_CacheAudit.actiondttm
               AND IFNULL(dim_ED_location.dss_end_date, GETDATE()+10000) >= ds_WB_CacheAudit.actiondttm --LEFT OUTER JOIN {{ ref('TGT','DIM_ED_WB_ACTION_SEENBY_CLINICIAN') }}   --ON dim_ED_WB_action_seenby_clinician.WB_action_seenby_clinician_user_code =    -- case when ds_WB_CacheAudit.performedaction in('Doctor Handover','Nurse Seen by')     --then ds_WB_CacheAudit.userid    -- else ds_WB_CacheAudit.seenbydoctorid end  --and ds_WB_CacheAudit.actiondttm between dim_ED_WB_action_seenby_clinician.validity_start_date and    --dim_ED_WB_action_seenby_clinician.validity_end_date  LEFT OUTER JOIN {{ ref('TGT','DIM_ED_WB_ACTION_SPECIALTY') }}   ON ds_WB_CacheAudit.specialtytype = dim_ED_WB_action_specialty.ED_WB_action_specialty_code  AND dim_ED_WB_action_specialty.dss_current_flag = @v_dss_current_flag    LEFT OUTER JOIN {{ ref('TGT','DIM_ED_WB_ACTION') }}   ON ds_WB_CacheAudit.performedaction = dim_ED_WB_action.WB_action_performed  AND IFNULL(dim_ED_WB_action.start_date, GETDATE()-10000) <= ds_WB_CacheAudit.actiondttm  AND IFNULL(dim_ED_WB_action.end_date,   GETDATE()+10000) >= ds_WB_CacheAudit.actiondttm   LEFT OUTER JOIN {{ ref('UNKNOWN','DIM_WB_ACTION_ASSIGNED_CONSULTANT') }}     ON ds_WB_CacheAudit.assignedconsultantid = dim_WB_action_assigned_consultant.WB_action_assigned_consultant_code   AND dim_WB_action_assigned_consultant.dss_current_flag = @v_dss_current_flag    WHERE [ds_WB_CacheAudit].performedaction not in ('UpdateTransfer','UpdateLocation')
        name: S_ED_WHITEBOARD_ACTION
        noLinkRefs: []
  name: S_ED_WHITEBOARD_ACTION
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
