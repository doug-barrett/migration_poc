fileVersion: 1
id: 0786b164-a18e-44f0-bb0d-c226cce58737
name: S_WAITLIST_LDD_DATA_VALUE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc1ad003-e9e5-4ab9-89e4-cfe3b102252e
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WLIST_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ec8272b-f72d-4ecf-aa7b-a61679fff722
                stepCounter: 0e59e3db-b31a-4a51-a1c6-783b4fb7ebb6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a01d9303-950c-423f-8a6c-16d5b6dcd654
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NBRS_PROCEDURE_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: NULLIF(MAX(CASE WHEN ds_pims_reference_values.rfvdm_code = 'ZZPRT' THEN ds_pims_reference_values.rfval_refno ELSE NULL END),1000011771)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b93c21c9-c751-4815-a89e-d60f0e1ca450
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NBRS_PERIOD_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80d92f98-7d23-41c5-9b85-10a320dea324
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(CASE ds_pims_ldd_local_datavalues.ussob_value_2 WHEN '95' THEN 42 WHEN '90' THEN 60 WHEN '85' THEN 90 WHEN '75' THEN 120 WHEN '65' THEN 180 WHEN '55' THEN 270 WHEN '45' THEN 365 WHEN '35' THEN 540 WHEN '25' THEN 730 WHEN '15' THEN 1095 WHEN '10' THEN 1825 WHEN '99' THEN 0 ELSE 0 END),0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d2c139c7-80d8-4c36-847b-4b720a511685
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: NBRS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80d92f98-7d23-41c5-9b85-10a320dea324
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(ds_pims_ldd_local_datavalues.ussob_value_2),'0')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35276d16-946f-4c5d-b932-cb2bb879b5dd
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SURVEILLANCE_PERIOD_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: NULLIF(MAX(CASE WHEN ds_pims_reference_values.rfvdm_code = 'SURVP' THEN ds_pims_reference_values.rfval_refno ELSE NULL END),2005997016)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 795f3079-ca6f-4b8f-8f7b-3c3039084870
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SURVEILLANCE_PERIOD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: NULLIF(MAX(CASE WHEN ds_pims_reference_values.rfvdm_code = 'SURVP' THEN ds_pims_reference_values.main_code ELSE NULL END),'SUDEF')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e5d1051-7545-47bb-b0ef-6605549b5be8
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SURVEILLANCE_PERIOD_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1734faec-2997-4df1-bd7d-9eef1dbb8c5d
                stepCounter: 51a223fb-ad9c-4a43-8fea-4421fbf95bbd
            transform: |-
              NULLIF(MAX(ds_pims_reference_values.period_days),0) --NULLIF(MAX(CASE ds_pims_reference_values.main_code
               --                WHEN 'SURY5'  THEN 5*365
               --                WHEN 'SURY4'  THEN 4*365
               --                WHEN 'SURY3'  THEN 3*365
               --                WHEN 'SURY2'  THEN 2*365
               --                WHEN 'SURM18' THEN 18*30
               --                WHEN 'SURM12' THEN 365
               --                WHEN 'SURM9'  THEN 9*30
               --                WHEN 'SURM6'  THEN 6*30
               --                WHEN 'SURM5'  THEN 5*30
               --                WHEN 'SURM3'  THEN 3*30
               --                WHEN 'SURM2'  THEN 2*30
               --                WHEN 'SURW6'  THEN 6*7
               --                WHEN 'SUDEF'  THEN 0
               --                ELSE 0 END),0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76b34351-736a-401c-84ae-f18d6009ba5e
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: outsourced
        name: OUTSOURCED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e6a5869-786f-4b65-b201-661aa4d9a779
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =1400020360 THEN ds_pims_ldd_local_datavalues.ussob_value_1 ELSE NULL END),'N')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b61c93a-8429-49eb-a7ea-2ae386bd3ac4
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: date_outsourced
        name: DATE_OUTSOURCED
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =1400020360 THEN ds_pims_ldd_local_datavalues.USSOB_DTTM_VALUE_3 ELSE NULL END),'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3acfa04b-af6c-419b-b81c-5ce8470abf5b
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: If outsourced the facility outsourced to.
        name: EXTERNAL_FACILITY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =1400020360 THEN ds_pims_ldd_local_datavalues.USSOB_VALUE_14 ELSE NULL END),'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1b5a1dc-3829-4bd4-9e72-ec3937da6d44
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OUTSOURCED_RETURN_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2574627-8c28-455b-a4fc-1ecdb5d9829b
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =1400020360 THEN ds_pims_ldd_local_datavalues.USSOB_VALUE_11 ELSE NULL END),1400019026)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55f79aa3-cdf4-444a-ae9a-74f52c10a352
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OUTSOURCED_RETURN_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2574627-8c28-455b-a4fc-1ecdb5d9829b
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =1400020360 THEN ds_pims_ldd_local_datavalues.USSOB_DTTM_VALUE_4 ELSE NULL END),'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f962fe77-2c25-4fad-befe-d48dbfc4da13
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: SORCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2574627-8c28-455b-a4fc-1ecdb5d9829b
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fea46813-2530-45ed-9db5-191e3ef6aaff
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: INT
        defaultValue: ""
        description: clincal_exclusion_reference, the reson it isn't on the normal ESPI path.
        name: CLINCAL_EXCLUSION_REFERENCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2574627-8c28-455b-a4fc-1ecdb5d9829b
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: NULLIF(MAX(CASE WHEN ds_pims_ldd_local_datavalues.USSCR_REFNO =2000020300 THEN ds_pims_ldd_local_datavalues.USSOB_VALUE_6 ELSE NULL END),'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f46b92c-5875-4648-a704-8d2932f9cee9
          stepCounter: 0786b164-a18e-44f0-bb0d-c226cce58737
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_WAITLIST_09
        join:
          joinCondition: |-
            FROM s_waitlist_09
             INNER JOIN ds_pims_ldd_local_datavalues
                ON ds_pims_ldd_local_datavalues.sorce_refno = s_waitlist_09.wlist_refno
               AND ds_pims_ldd_local_datavalues.sorce_code = 'WLIST'
              LEFT JOIN (
                    SELECT rfvdm_code,
                           rfval_refno,
                           main_code,
                           0 period_days
                      FROM ds_pims_reference_values
                     WHERE rfvdm_code = 'ZZPRT'
                 UNION ALL SELECT surveillance_period_reference_code,
                           surveillance_period_reference_no,
                           surveillance_period_code,
                           surveillance_period_days
                      FROM dim.dim_surveillance_period
                     WHERE dss_current_flag = 'Y'
                   ) ds_pims_reference_values
                ON CONVERT(varchar, ds_pims_reference_values.rfval_refno) IN (USSOB_VALUE_1,USSOB_VALUE_2,USSOB_VALUE_3,USSOB_VALUE_4)
             WHERE ds_pims_ldd_local_datavalues.USSCR_REFNO IN (1400020360,2000020300,1000020060)
             GROUP BY ds_pims_ldd_local_datavalues.sorce_code,
                      s_waitlist_09.wlist_refno
        name: S_WAITLIST_LDD_DATA_VALUE
        noLinkRefs: []
  name: S_WAITLIST_LDD_DATA_VALUE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
