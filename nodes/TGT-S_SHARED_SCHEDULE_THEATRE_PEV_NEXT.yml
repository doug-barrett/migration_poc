fileVersion: 1
id: c9bb6f82-1b38-4237-8453-17e8f161a032
name: S_SHARED_SCHEDULE_THEATRE_PEV_NEXT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3cecb92c-5c85-4220-8bca-13571796affd
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 012d8e4e-320a-43fa-93c5-5b93a773d2d7
                stepCounter: bce68d83-6566-4bab-ba63-16cd402d1cdc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6806ce5b-d2be-4c54-99d2-ba8208eac37f
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SESSION_FIRST_THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 63617700-4df1-4c68-a0de-1fc348cb169b
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SESSION_LAST_THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acb9a26a-f7a3-42f3-9c69-e4c938c9379c
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SESSION_PREVIOUS_THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f16bea9b-f539-4d95-9525-f5548456da34
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SESSION_NEXT_THEATRE_VISIT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 07d79a81-f6d8-4d01-ae44-db01d09246ba
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_PREVIOUS_INTO_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IFNULL(s_theatre_visit_prev.into_theatre_date,s_theatre_visit_prev.visit_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c396f821-5a38-4b69-89f9-b987b9dca171
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_PREVIOUS_OUT_OF_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99f0db2a-036b-4103-969b-7fc8f880226d
                stepCounter: bce68d83-6566-4bab-ba63-16cd402d1cdc
            transform: |-
              CASE WHEN s_shared_schedule_theatre_10.session_into_theatre_seq_num = 1 THEN s_shared_schedule_theatre_10.into_theatre_date
                          ELSE COALESCE(s_theatre_visit_prev.out_of_theatre_date,s_theatre_visit_prev.into_postop_date,s_theatre_visit_prev.visit_end_date)
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47e8c1d9-7488-4a1a-b000-fbcd6beec962
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_NEXT_INTO_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IFNULL(s_theatre_visit_next.into_theatre_date,s_theatre_visit_next.visit_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 911dfb31-6071-4b13-b8c1-685c73919fc1
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SESSION_NEXT_OUT_OF_THEATRE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: COALESCE(s_theatre_visit_next.out_of_theatre_date,s_theatre_visit_next.into_postop_date,s_theatre_visit_next.visit_end_date) session_next_out_of_theatre_date
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0b3cd4f-cd4f-4aab-9ea4-8a7bd3c83081
          stepCounter: c9bb6f82-1b38-4237-8453-17e8f161a032
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_SHARED_SCHEDULE_THEATRE_10
        join:
          joinCondition: |-
            FROM s_shared_schedule_theatre_10
              LEFT OUTER JOIN s_shared_schedule_theatre_10 s_theatre_visit_prev
                ON s_shared_schedule_theatre_10.service_point_session_reference_no = s_theatre_visit_prev.service_point_session_reference_no
               AND s_shared_schedule_theatre_10.session_into_theatre_seq_num - 1 = s_theatre_visit_prev.session_into_theatre_seq_num
              LEFT OUTER JOIN s_shared_schedule_theatre_10 s_theatre_visit_next
                ON s_shared_schedule_theatre_10.service_point_session_reference_no = s_theatre_visit_next.service_point_session_reference_no
               AND s_shared_schedule_theatre_10.session_into_theatre_seq_num + 1 = s_theatre_visit_next.session_into_theatre_seq_num
              LEFT OUTER JOIN s_shared_schedule_theatre_10 s_theatre_visit_first
                ON s_shared_schedule_theatre_10.service_point_session_reference_no = s_theatre_visit_first.service_point_session_reference_no
               AND s_theatre_visit_first.session_into_theatre_seq_num = 1
              LEFT OUTER JOIN s_shared_schedule_theatre_10 s_theatre_visit_last
                ON s_shared_schedule_theatre_10.service_point_session_reference_no = s_theatre_visit_last.service_point_session_reference_no
               AND s_theatre_visit_last.session_into_theatre_seq_num = s_theatre_visit_last.session_into_theatre_count
        name: S_SHARED_SCHEDULE_THEATRE_PEV_NEXT
        noLinkRefs: []
  name: S_SHARED_SCHEDULE_THEATRE_PEV_NEXT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
