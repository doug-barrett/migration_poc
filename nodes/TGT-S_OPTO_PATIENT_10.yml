fileVersion: 1
id: 687e8b78-238c-4482-942c-cfcefb43673b
name: S_OPTO_PATIENT_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "starts to bring the patient attributes together"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ee9417dc-2b3d-4a40-baf9-2db7d9530b6b
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 53c4c5fb-2f08-49b8-a4f5-8f42a26af492
                stepCounter: 3d65c973-b9b1-48ea-87ba-d151f2417cee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25e0890d-32a4-417b-8c18-e6798a0089ee
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(40)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd053bbc-d624-40a1-9bf1-8a4e910a2e82
                stepCounter: fde84e17-7e71-4436-9cfc-073f733174db
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a51aaf23-79f4-4fea-99bf-cf0598a833ce
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: patient_date_of_birth
        name: PATIENT_DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: cast(opto_dob.demographic_value AS date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56dd5ef2-6ef3-4578-892c-07bb5eb00b77
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: patient_date_of_death
        name: PATIENT_DATE_OF_DEATH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: cast(opto_dod.demographic_value AS date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a37d13a-eb53-43e0-97a4-0d8730af678a
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: v
        name: GENDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3850fa5e-43e4-4ae5-9956-4a97246be59a
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: v
        name: CURRENT_DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efe72b83-a023-48ae-8423-2d91f37b4498
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PRIMARY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51b30dc4-9101-46d5-922f-3fcb0ca09eeb
                stepCounter: 3d65c973-b9b1-48ea-87ba-d151f2417cee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb3da0ad-50ea-451e-87d8-03b701a10ce9
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: TITLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26ccf62c-928c-4021-8c3e-ddcd8a23e123
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2fef1d2b-a152-4d9e-9df1-e95581a5b831
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: FORENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5d282cf-0122-45b5-a11d-4f5659abd1e3
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2338e5f1-cde3-44d7-95cc-0900d8d5fe55
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b22aa296-1f7e-4934-8d74-a7b18e8e51f7
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 863c7431-401a-485f-a0c5-b873e7a02296
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(256)
        defaultValue: ""
        description: ""
        name: OTHER_NAMES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 901cecd9-e373-4a00-a58a-ef5f20aa3782
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d16cb88-2ef0-410c-8bb1-60cb4fc768e1
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(256)
        defaultValue: ""
        description: ""
        name: PATIENT_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 901cecd9-e373-4a00-a58a-ef5f20aa3782
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: l_opto_person_name.surname + ', ' + l_opto_person_name.forename
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87a9c836-e703-4897-973b-325ee645c456
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: CURRENT_ADDRESS_LINE1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cab3f3d8-dd8a-40aa-9e82-674b283343ce
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0666cbd5-6c0a-4219-b6c8-f01f1e819c5b
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: CURRENT_ADDRESS_LINE2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0cc0131-09d8-4b5e-b278-94e8242aad4a
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4622c913-ab04-42f0-8e3c-74bd4fbe1677
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(35)
        defaultValue: ""
        description: ""
        name: CURRENT_TOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29832a03-7eda-42d7-9794-8f53b346979c
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1d4a025-ed4e-435b-a6e2-214a7f9798e6
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(35)
        defaultValue: ""
        description: ""
        name: CURRENT_REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5a0d2eb-c1b8-4248-9ace-74d48ff1e82a
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37d798cd-4839-466b-8657-5a59a882e880
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: NVARCHAR(15)
        defaultValue: ""
        description: ""
        name: CURRENT_POSTALCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6589b742-c100-420c-8f7f-8168767c409e
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec0d17e3-9ecf-4a6e-820c-f8e668de05cd
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PERSON_NAME_VALID_FROM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd5142d3-6261-4177-9b13-421a6a8d2349
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24b13376-2c3e-4ba4-8b9d-921844662d30
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PERSON_NAME_VALID_TO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6f34d302-37b7-4f30-bd3d-2c255e0685fb
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a94253b4-399e-4407-b1ee-7d90ab2c173a
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PERSON_NAME_DELETION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cab88509-e35e-450f-a558-0388d44ce98d
                stepCounter: 75e07e92-95c0-4185-ba60-8d883593a98a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc32ed29-fbe5-43ab-ba85-6213127756fb
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: CHAR(36)
        defaultValue: ""
        description: ""
        name: UNIQUE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf24bd51-d4cc-4df5-8b83-73c1b43ccc83
                stepCounter: 3d65c973-b9b1-48ea-87ba-d151f2417cee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc273a94-4fbd-4ecb-9381-2fd4579c7dfa
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4a998588-8f14-49bf-a340-b7fa4368d653
                stepCounter: 3d65c973-b9b1-48ea-87ba-d151f2417cee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0c67191-86ee-43f6-95fc-bb1900340279
          stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 75bd0399-115b-4713-a857-11b663aafd20
                stepCounter: 3d65c973-b9b1-48ea-87ba-d151f2417cee
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_OPTO_PATIENT: 3d65c973-b9b1-48ea-87ba-d151f2417cee
          L_OPTO_PERSON_NAME: 75e07e92-95c0-4185-ba60-8d883593a98a
          L_OPTO_PERSON_ID: fde84e17-7e71-4436-9cfc-073f733174db
          S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10: 329ad9eb-3b55-484f-a208-a4b5c5655f4a
          L_OPTO_ADDRESS: 12b262ef-f328-4dae-9484-556736065537
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_OPTO_PATIENT
          - locationName: TGT
            nodeName: L_OPTO_PERSON_NAME
          - locationName: TGT
            nodeName: L_OPTO_PERSON_ID
          - locationName: TGT
            nodeName: S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10
          - locationName: TGT
            nodeName: L_OPTO_ADDRESS
        join:
          joinCondition: |-
            FROM {{ ref('TGT','L_OPTO_PATIENT') }} l_opto_patient
              JOIN {{ ref('TGT','L_OPTO_PERSON_NAME') }} l_opto_person_name
                ON l_opto_patient.primarynameid = l_opto_person_name.id
              JOIN {{ ref('TGT','L_OPTO_PERSON_ID') }} l_opto_person_id
                ON l_opto_patient.primaryidentifierid = l_opto_person_id.id
               AND l_opto_person_id.kindid = 4
              LEFT JOIN {{ ref('TGT','S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10') }} opto_dob
                ON l_opto_patient.id = opto_dob.patient_id
               AND opto_dob.demographic_kind_id = 4
              LEFT JOIN {{ ref('TGT','S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10') }} opto_dod
                ON l_opto_patient.id = opto_dod.patient_id
               AND opto_dod.demographic_kind_id = 5
              LEFT JOIN {{ ref('TGT','S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10') }} opto_ethnicity
                ON l_opto_patient.id = opto_ethnicity.patient_id
               AND opto_ethnicity.demographic_kind_id = 6
              LEFT JOIN {{ ref('TGT','S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10') }} opto_gender
                ON l_opto_patient.id = opto_gender.patient_id
               AND opto_gender.demographic_kind_id = 7
              LEFT JOIN {{ ref('TGT','S_OPTO_PATIENT_DEMOGRAPHIC_DETAILS_10') }} opto_domcode
                ON l_opto_patient.id = opto_domcode.patient_id
               AND opto_domcode.demographic_kind_id = 28
              JOIN {{ ref('TGT','L_OPTO_ADDRESS') }}
                ON l_opto_patient.primaryidentifierid = l_opto_address.id
        name: S_OPTO_PATIENT_10
        noLinkRefs: []
  name: S_OPTO_PATIENT_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
