fileVersion: 1
id: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
name: S_THEATRE_BOOKING_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Get all the acute theatre booking information from load tables."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1eda1e16-cacd-47f2-863f-25a78267b9eb
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1101be0-a7fd-4b7a-9817-c7491d42fb9f
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57fea6b7-f878-4df3-92ad-957557db3a63
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: BOOKING_SENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cae80057-bf01-403c-802e-1e9cf9fbc2fb
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db8686fd-63e7-427e-9fbf-c4d4995b9451
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_OUTCOME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31ff5cda-c032-42e1-ac41-fbf4225deb3a
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4579cdee-fe11-4e09-8f1b-d5a06210a586
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: BOOKING_STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: abfd7480-7271-4d02-9392-e6f92e36b7bc
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb257db3-7066-4ac1-bda9-9c3b642c9aee
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: BOOKING_STATUS_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: abfd7480-7271-4d02-9392-e6f92e36b7bc
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: |-
              CASE ds_cvdis_HES.status
                          WHEN 0              THEN 'Saved'
                          WHEN 1              THEN 'New/Sent'
                          WHEN 2              THEN 'Accepted'
                          WHEN 3              THEN 'Declined'
                          WHEN 7              THEN 'On Hold'
                          WHEN 8              THEN 'Cancelled'
                          WHEN 9              THEN 'Completed'
                          ELSE COALESCE(CONVERT(varchar, ds_cvdis_HES.status), 'Unknown')
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c95f2e2b-4320-4f26-a06c-fa9b8ddf3aa4
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: BOOKING_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71d44a1e-82fd-4c24-8511-f2a165ce89de
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a857d60-48c5-40d5-b48c-dbc838d9a75b
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: RESPONSIBLE_CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9ab44a17-17ad-48e3-b50b-07a557ae332e
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37eb6e06-341c-4ad7-8569-0da62d55c5ca
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(8000)
        defaultValue: ""
        description: ""
        name: LAST_COMMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2cfc7bd-d930-471b-9f3e-fa2347d8ed1f
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3adfa531-f3e8-4df1-9762-26ea284cec3d
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(8000)
        defaultValue: ""
        description: ""
        name: REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 593d110e-ecbd-4305-a5cd-355e9ed9c5b8
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87ebb862-7dc8-4cab-9327-fc5477174803
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: REF_WARD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe881413-081a-48ef-aaa8-2701046c6a3d
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a352c6c0-3396-4b59-95ec-1fa55395cfbe
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CURRENT_PRIORITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 176d9d0f-9a73-4074-a232-de20ee604e0c
                stepCounter: ccdf1f63-49a3-40e0-85f0-985255ee2146
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b67fc543-a30d-41c2-85fc-b2828ece4c58
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: BOOKING_PRIORITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f6d20c1b-f0ca-41f4-851d-047aeffc833f
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e34a6c5f-fac3-4dd0-bbab-8a22c6116a8f
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: BOOKING_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8f4b85d-ca7f-484e-af5e-41b44b9ec8ec
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e829177f-95cf-4f5f-9989-524aebdbeb16
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b8dc25f-b3a2-44c3-aa3f-15359fab814e
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE ds_datastore_AcuteSurgeryBooking.Specialty
                          WHEN 'Anaesthesia'                         THEN 'ANAES'
                          WHEN 'Cardiology'                          THEN 'CARDI'
                          WHEN 'Endoscopy'                           THEN 'GASTR'
                          WHEN 'ENT'                                 THEN 'ORL'
                          WHEN 'General Surgery'                     THEN 'GENSU'
                          WHEN 'Interventional Radiology'            THEN 'INRAD'
                          WHEN 'Orthopaedic Surgery'                 THEN 'ORTSU'
                          WHEN 'Obstetrics & Gynaecology'            THEN 'GENSU'
                          WHEN 'Obstetrics &amp; Gynaecology'        THEN 'GENSU'
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42648fca-a995-48e4-a68f-7bad0f5ec77c
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BOOKING_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b8dc25f-b3a2-44c3-aa3f-15359fab814e
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: NULLIF(ds_datastore_AcuteSurgeryBooking.Specialty, '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 183d1ee7-2246-4205-8ef0-b8f3e458b313
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 56f82fa0-c98a-43e2-959b-3daaf8a016fd
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: COALESCE(NULLIF(EndoscopyProcedure, ''), NULLIF(ENTProcedure, ''), NULLIF(GSProcedure, ''), NULLIF(GynaeProcedure, ''), NULLIF(IRProcedure, ''), NULLIF(OSProcedure, ''), NULLIF(AnaesthProcedure, ''), NULLIF(cardProcedure, ''), '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 474e8cb4-df2c-4d5b-9d76-11acd05d4cff
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_SUB_PROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b8dc25f-b3a2-44c3-aa3f-15359fab814e
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN Specialty = 'Interventional Radiology' AND IRProcedure = 'Acute biliary'     THEN IRABSubprocedure
                          WHEN Specialty = 'Interventional Radiology' AND IRProcedure = 'Acute renal'       THEN IRARSubprocedure
                          WHEN Specialty = 'Interventional Radiology' AND IRProcedure = 'Acute vascular'    THEN IRAVSupprocedure
                          WHEN Specialty = 'Interventional Radiology' AND IRProcedure = 'Acute haemorrhage' THEN IRAHSubprocedure
                          WHEN Specialty = 'Interventional Radiology' AND IRProcedure = 'Other'             THEN IROtherSubprocedure
                          ELSE ''
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c1188ed-3f1b-452b-a534-03404e076212
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: BOOKING_SUB_PROCEDURE_OTHER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6faa981b-d879-4f4e-907b-0a7170d515b7
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: IFNULL(ds_datastore_AcuteSurgeryBooking.IRAHOther, '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c179a8e-5516-4eb1-a91b-92ea59bddef0
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f3d77b81-5da9-4d7d-9f16-6697fc0d0464
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ac77e7a-5188-4635-b950-8492fd522657
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMMENTS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b1fcd4a-4a38-4260-8462-fe42f002a65f
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: left(ds_datastore_AcuteSurgeryBooking.Comments,1000)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0208afd-906a-4666-80dd-29d33b2ac55f
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Current average theatre time loaded from HES.
        name: CURRENT_AVERAGE_THEATRE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1a8c6d28-ef0f-489c-94b6-67790479217f
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: CONVERT(smallint, CurrentAverageTheatreTime)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec63d169-b616-41a7-96c2-368b650f425f
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: Adjusted theatre time loaded from HES. Free format field but may contain a value that can be interpreted as minutes or hours.
        name: ADJUSTED_THEATRE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3238d9e1-897d-4b3a-b62d-e98482f44639
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d46892b6-2bae-4b1b-ae7f-d82fb0e208a9
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: 'Set to either the Adjusted Theatre Time (if a value is entered and it can be converted to minutes) or the Current Average Theatre Time.  '
        name: BOOKED_THEATRE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3238d9e1-897d-4b3a-b62d-e98482f44639
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN NULLIF(AdjustedTheatreTime, '') IS NULL AND ISNUMERIC(CurrentAverageTheatreTime) = 1                                                THEN CurrentAverageTheatreTime
                          WHEN ISNUMERIC(NULLIF(AdjustedTheatreTime, '')) = 1 AND LEN(AdjustedTheatreTIme) <= 3                                                    THEN AdjustedTheatreTime
                          WHEN PATINDEX('%m%', AdjustedTheatreTime) > 1 AND ISNUMERIC(LEFT(AdjustedTheatreTime, patindex('%m%', AdjustedTheatreTime) - 1)) = 1     THEN LEFT(AdjustedTheatreTime, PATINDEX('%m%', AdjustedTheatreTime) - 1)
                          WHEN PATINDEX('%h%r%', AdjustedTheatreTime) > 1 AND ISNUMERIC(LEFT(AdjustedTheatreTime, patindex('%h%r%', AdjustedTheatreTime) - 1)) = 1 THEN LEFT(AdjustedTheatreTime, PATINDEX('%h%r%', AdjustedTheatreTime) - 1) * 60.0
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 95b81251-e342-4c89-b79b-69f921fbce1d
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: ACUTE_BOOKING_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5534146f-5f31-40b8-bdf2-98c9bd01c7c5
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: CONSENT_SIGNED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eed315b8-71f9-40a2-afe3-7b5545c411fa
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN LEFT(ds_datastore_AcuteSurgeryBooking.ConsentSigned, 1) = 'Y' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91334bac-c226-4c39-91b7-d13e50268728
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: INTERPRETER_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ca8fd9a-4509-49b5-832f-af773ff190ea
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN LEFT(ds_datastore_AcuteSurgeryBooking.interp, 1) = 'Y' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8b0ffbd-6ac1-4b5b-b885-890df823bd6d
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: LANGUAGE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02733b2a-b731-4bdf-9ca8-ebfe6f2ee04e
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 740f23c7-2f10-4cde-8bdd-d9f6307b50ea
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: THEATRE_COORD_CONTACTED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d8266dc-adbd-44aa-a36d-888d3e409c87
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN LEFT(ds_datastore_AcuteSurgeryBooking.TheatreCoordCnttd, 1) = 'Y' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9add32a9-8fc7-4947-a220-0ac5f85ec67c
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: ANAESTHETIST_CONTACTED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9029d849-432e-4823-a1df-24bfd9034c0b
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: |-
              CASE WHEN LEFT(ds_datastore_AcuteSurgeryBooking.AnaeCoordCntct, 1) = 'Y' THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 71ce5f3a-4772-438b-9a76-f32937dec170
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: LAST_FLUID_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3d82dab-fe86-4a17-a449-5454adf8c48c
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9ea3148-6593-4490-8b74-547f70268f9d
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: LAST_FLUID_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d0f3c6e7-2623-4b7a-8d39-ed0317f70df7
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 553dd244-6ecf-4a30-9407-5a43c65e30e0
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: LAST_FLUID_DATETIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3d82dab-fe86-4a17-a449-5454adf8c48c
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: CONVERT(datetime, CASE WHEN LastFluid LIKE '[0-3][0-9]/[0-1][0-9]/20[0-9][0-9]' THEN CONVERT(varchar, CONVERT(date, LastFluid, 103), 120) ELSE NULL END + ' ' + CASE WHEN LastFluidTime like '[0-2][0-9][.,:][0-5][0-9]' THEN REPLACE(REPLACE(LastFluidTime, '.', ':'), '24:', '00:') WHEN LEFT(LastFluidTime, 4) LIKE '[0-2][0-9][0-5][0-9]' THEN REPLACE(LEFT(LastFluidTime, 2), '24', '00') + ':' + SUBSTRING(LastFluidTime, 3, 2) ELSE NULL END, 121)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a446edec-3db0-4c98-8a40-b1e92ca666e2
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: LAST_ATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec960277-81ca-484c-b430-87a79670f155
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c735bce-4c78-460f-9efd-169e94d03794
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: LAST_ATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ffaa2f7-07ed-46a7-873c-5ebd0c332d99
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 528af105-67f4-468b-b18d-5c7dc00cf31e
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: LAST_ATE_DATETIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec960277-81ca-484c-b430-87a79670f155
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: CONVERT(datetime, CASE WHEN LastAte LIKE '[0-3][0-9]/[0-1][0-9]/20[0-9][0-9]' THEN CONVERT(varchar, CONVERT(date, LastAte, 103), 120) ELSE NULL END + ' ' + CASE WHEN REPLACE(LastAteTime, ' ', '') LIKE '[0-9]am' THEN '0' + LEFT(LastAteTime, 1) + ':00' WHEN REPLACE(LastAteTime, ' ', '') LIKE '[0-9]pm' THEN '0' + CONVERT(varchar, CONVERT(int, LEFT(LastAteTime, 1) + 12)) + ':00' WHEN LastAteTime = 'midnight' THEN '23:59' WHEN LastAteTime LIKE '[0-2][0-9][.,:][0-5][0-9]' THEN REPLACE(REPLACE(LastAteTime, '.', ':'), '24:', '00:') WHEN LEFT(LastAteTime, 4) LIKE '[0-2][0-9][0-5][0-9]' THEN REPLACE(LEFT(LastAteTime, 2), '24', '00') + ':' + SUBSTRING(LastAteTime, 3, 2) ELSE NULL END, 121)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e5d101f-c070-42eb-8703-369ad7503f47
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: REQUIREMENTS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f22536c-85d5-4e11-ae3e-e2ea87b3e1b2
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e762a68b-442d-4be9-8bad-efaab4c723b4
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bca24540-6bbb-4eaa-b52f-2578fc51f0ad
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities1, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0cf328e7-e16d-42cf-a751-6fc1bae169be
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY1_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b0069a7-55ed-4137-be5d-778807e1dc76
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86ca7b16-f4e7-47e3-b8ab-3aa294c65989
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54359902-1634-47f2-91c7-17c6b88ae36d
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities2, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f41a51b6-e5ce-4c18-bf8c-288ec9f499f1
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY2_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ab48d679-3807-4dbf-bd19-3144d7f83ea2
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25000074-9219-4512-8494-ad500d007df1
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: afd469a8-5425-4490-9b60-95379f3a018c
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities3, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c33d9c77-d5fa-4d97-b6c1-aae289990f5d
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY3_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e190c20f-80fa-46d3-b0af-2cd015bf7b65
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 608a5ac3-275b-42f5-b0d8-bfab12904287
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY4
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 338e4ff4-61d6-4bfe-8c5e-b1ee09dada3d
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities4, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2a2aefb-2a01-41d5-85d5-71cae0bd6c6e
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY4_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b8b666f-fef6-43e5-af88-4c7b574e3409
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0fb7508-48af-4aef-b859-724b35c8baa6
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY5
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 268701f0-e828-46d2-a19b-de31b3d4ee46
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities5, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40687690-9d3d-4c25-a838-abbc9c61d9b3
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY5_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63390d34-9273-4916-b657-d71efe1d0571
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66626732-ee2b-4de4-8ab2-1f044d244eea
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: COMORBIDITY6
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6bde36d9-28a0-4c71-b126-599e310c27e1
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: REPLACE(Comorbidities6, 'None', '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd0ddf5e-918c-4aee-a46a-0107d0b7a848
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: COMORBIDITY6_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f486faf8-0f1f-4236-ace5-ca5b67d2679b
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: afbdf457-abfa-430c-9936-9cec06d42993
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'Internal unique identifier for a patient from the Patient Management System '
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 702dfc9d-df5e-42d8-86f8-9e68f29c462c
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34b24c53-0b5d-4c5b-a150-92aaf7f447da
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(7)
        defaultValue: ""
        description: ""
        name: NMPI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b42accf4-725d-4f5f-9fa1-2ab0e6c7b802
                stepCounter: 7a88f4e3-512a-476a-a161-018aae5e8bff
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3660f76-45a7-43dd-af50-0660e53520d3
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: VARCHAR(2510)
        defaultValue: ""
        description: ""
        name: OSSUBPROCEDURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4fc4088f-486a-40d8-82ed-3f082c89aec9
                stepCounter: f05d4364-4f55-4ad6-8a9e-260b0b900497
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8943ae0b-6ab7-43ca-8093-14955511bdba
          stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_CVDIS_HES
        join:
          joinCondition: |-
            FROM ds_datastore_AcuteSurgeryBooking
              JOIN ds_cvdis_HES
                ON ds_datastore_AcuteSurgeryBooking.HESID = ds_cvdis_HES.HESID
              LEFT OUTER JOIN dim.dim_patient
                ON dim_patient.patient_NHI = ds_cvdis_HES.NHI
               AND dim_patient.NHI_sequence = 1
              LEFT OUTER JOIN l_reference_testpatients
                ON ds_cvdis_HES.NHI = l_reference_testpatients.NMPI
             WHERE l_reference_testpatients.NMPI IS NULL
               AND ds_datastore_AcuteSurgeryBooking.hesid IN (
                    SELECT hesid
                      FROM ds_datastore_AcuteSurgeryBooking
                     WHERE dss_update_time > @v_pa_theatre_incremental
                   )
        name: S_THEATRE_BOOKING_10
        noLinkRefs: []
  name: S_THEATRE_BOOKING_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
