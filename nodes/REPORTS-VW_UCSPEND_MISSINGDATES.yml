fileVersion: 1
id: 68f16207-296a-480c-b471-2d8d03a193bf
name: VW_UCSPEND_MISSINGDATES
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd6e5a58-cbcb-49e7-84bb-2ca1e630e463
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CAMPUS=UCCAMPUS.UCCAMPUS
        name: UCCAMPUSKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 30e66e41-8f09-4060-83bd-ba33e16d182b
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44ab25ad-f011-4503-99f3-9967741b4a32
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_1=UCCATEGORYLEVEL1.UCCATEGORY_LEVEL_1
        name: UCCATEGORYLEVEL1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88ef84c0-4a54-4269-8360-a2a191c7c686
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ea279570-3ff1-411c-a3f0-b1e68e43979e
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_2=UCCATEGORYLEVEL2.UCCATEGORY_LEVEL_2
        name: UCCATEGORYLEVEL2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47e995ab-4924-4107-bc3c-0f53f3463ec1
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7aa1e216-f38e-41e6-99d9-fb071c32ccb7
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_3=UCCATEGORYLEVEL3.UCCATEGORY_LEVEL_3
        name: UCCATEGORYLEVEL3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bd00e858-4094-41b2-966f-177d7f27ab2c
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18e3b3c0-fa8c-4ad1-be1e-ba5a6e408c4a
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_4=UCCATEGORYLEVEL4.UCCATEGORY_LEVEL_4
        name: UCCATEGORYLEVEL4KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5f958446-417d-44a6-acfb-cde03b35844b
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73031f6b-1668-4cae-a7e2-bd8c8b310388
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.SUPPLIER=UCSUPPLIER.UCSUPPLIERNAME
        name: UCSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02b106e4-3219-4f9f-8e30-34bfc9db8d53
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0c3dd39-ab79-4fbd-9aab-9fe1b2067d1f
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_1=UCTIER1.UC_TIER_1
        name: UCTIER1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f3939a3-fae3-463a-a705-0d15fcee59c6
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6e2d4cf-b15d-4de1-ba13-b494aed19b78
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_2=UCTIER2.UC_TIER_2
        name: UCTIER2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e52dd22d-5f0a-427b-805a-fa6285e6ed4c
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f78fb1b-1d11-412d-8200-6aef30985526
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_3=UCTIER3.UC_TIER_3
        name: UCTIER3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a51d847-a45f-47d4-8844-6e30b04116d9
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff0362c9-97e1-42cf-95e5-20af83691ff8
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: UCCOMPONENTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4597e448-82f1-4a64-b84f-0d980962b0e3
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0607764e-80c6-4d9f-bb93-a078209c46fb
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0224dcab-2ff2-47e6-a7df-150acad0430e
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 173f2973-5423-400f-8a67-4cd54879426c
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPSUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa098726-e80d-4c5f-aae5-a03dbacc8b9e
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e105a316-8845-43c4-96e8-87b3ab60f6f4
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPCONTRACTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: db98d86f-0f08-47d7-bdce-9e327456b815
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a2a53ca-5dc9-41eb-9c3f-08916f6a23b8
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPCONTRACTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8a18a1ab-8f11-4562-9d0b-357df1328b8f
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f362d1bc-769c-40b9-9eff-9b8bd8e653b5
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: OPCONTRACTMAPPINGSTATUSID
        name: OPCONTRACTMAPPINGSTATUSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba12d4dc-760a-48e9-b576-b8213e49669f
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88f1c18a-b1fc-4bf5-b431-22aa09252e24
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: UCSPEND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6b4f08d8-322b-46d1-bc1b-b0e1764ee010
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ef24fb3-94fd-4690-a1de-7a7f3c127a9d
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: INT
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.TRANSACTIONDATE=DIMTRANSACTIONDATE.TRANSACTIONDATE
        name: TRANSACTIONDATEKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 602a7aee-0a7a-4ae5-8518-8b02fb617d24
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adc41784-13d0-4013-ac32-125ad2162110
          stepCounter: 68f16207-296a-480c-b471-2d8d03a193bf
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fccd6866-e87a-47ef-bb81-cd7de8941b01
                stepCounter: 31d735d9-62b3-430e-b30b-41f9b80f4355
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          MAXRECEIPTDATE: 523e7148-cad2-48f6-ba45-e94751d49406
          UCCAMPUS: 68f18dd6-8aa2-44b9-9662-176fea6ef561
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref('UNKNOWN','VWUCSPEND_MISSINGDATES') }} (\NUCCAMPUSKEY,\NUCCATEGORYLEVEL1KEY,\NUCCATEGORYLEVEL2KEY,\NUCCATEGORYLEVEL3KEY,\NUCCATEGORYLEVEL4KEY,\NUCSUPPLIERKEY,\NUCTIER1KEY,\NUCTIER2KEY,\NUCTIER3KEY,\NUCCOMPONENTKEY,\NOPSUPPLIERKEY,\NOPSUPPLIERID,\NOPCONTRACTKEY,\NOPCONTRACTID,\NOPCONTRACTMAPPINGSTATUSID,\NUCSPEND,\NTRANSACTIONDATEKEY,\N TRANSACTIONDATE\N)\NAS\N WITH CTEALLTRANSDATES \N AS (
                    SELECT \N DTD.TRANSACTIONDATEKEY, \N DTD.TRANSACTIONDATE \N
                      FROM {{ ref('UNKNOWN','DIMTRANSACTIONDATE') }} AS DTD \N
                     WHERE DTD.TRANSACTIONDATEKEY BETWEEN 20180101 AND (
                            SELECT REPLACE(MAXRECEIPTDATE,'-','')
                              FROM {{ ref('FACT','MAXRECEIPTDATE') }}
                           ) \N
                       AND DTD.TRANSACTIONDATEKEY LIKE '%01'
                   ), \N CTEALLCAMPUSES \N AS (
                    SELECT \N UCCAMPUSKEY \N
                      FROM {{ ref('DIM','UCCAMPUS') }} AS U \N
                     WHERE U.UCCAMPUSKEY > 0
                   ), \N CTEALLUCROWSMINUSTRANSDATE \N AS (
                    SELECT DISTINCT \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID \N
                      FROM {{ ref('UNKNOWN','AGGUCSPEND') }} AS AU \N
                     WHERE AU.OPCONTRACTMAPPINGSTATUSID IN (1, 2)
                   ), \N CTEALLUCROWSALLDATESALLCAMPUSES \N AS (
                    SELECT \N * \N
                      FROM CTEALLUCROWSMINUSTRANSDATE AS CAAUMTD, \N CTEALLCAMPUSES AS CAC, --CROSS JOIN TO GENERATE ROWS FOR ALL CAMPUSES AND FOR ALL DATES
            \N CTEALLTRANSDATES AS CATD
                   ) \N --,
            \N --CTEALLOPROWS
            \N --AS (SELECT DISTINCT
            \N --		AOARBC.UCCAMPUSKEY AS UCCAMPUSKEY,
            \N --		--AOARBC.CONTRACTKEY AS OPCONTRACTKEY,
            \N --		AOARBC.TRANSACTIONDATEKEY
            \N -- FROM   OMNIAPARTNERSDW.REPORTS.AGGOPSALESANDREVENUEBYCONTRACT AS AOARBC
            \N --		INNER JOIN CTEALLTRANSDATES AS CATD ON AOARBC.TRANSACTIONDATEKEY = CATD.TRANSACTIONDATEKEY)
            \N --CTEALLOPROWSWITHUCCOLUMNS
            \N --AS (SELECT
            \N --		CTEUC.*
            \N -- FROM   CTEALLUCROWSALLDATESALLCAMPUSES AS CTEUC
            \N --		INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEUC.UCCAMPUSKEY
            \N --												AND CTEOP.OPCONTRACTKEY = CTEUC.OPCONTRACTKEY
            \N --												AND CTEOP.TRANSACTIONDATEKEY = CTEUC.TRANSACTIONDATEKEY
            \N -- WHERE  CTEUC.UCCATEGORYLEVEL1KEY IS NOT NULL),
            \N --SELECT * FROM CTEALLOPROWS
            \N SELECT \N CTEALLUC.UCCAMPUSKEY, \N CTEALLUC.UCCATEGORYLEVEL1KEY, \N CTEALLUC.UCCATEGORYLEVEL2KEY, \N CTEALLUC.UCCATEGORYLEVEL3KEY, \N CTEALLUC.UCCATEGORYLEVEL4KEY, \N CTEALLUC.UCSUPPLIERKEY, \N CTEALLUC.UCTIER1KEY, \N CTEALLUC.UCTIER2KEY, \N CTEALLUC.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N CTEALLUC.OPSUPPLIERKEY, \N CTEALLUC.OPSUPPLIERID, \N CTEALLUC.OPCONTRACTKEY, \N CTEALLUC.OPCONTRACTID, \N CTEALLUC.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N CTEALLUC.TRANSACTIONDATEKEY, \N CTEALLUC.TRANSACTIONDATE \N
              FROM CTEALLUCROWSALLDATESALLCAMPUSES AS CTEALLUC \N --INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEALLUC.UCCAMPUSKEY AND CTEOP.TRANSACTIONDATEKEY = CTEALLUC.TRANSACTIONDATEKEY
            \N
            EXCEPT \N SELECT DISTINCT \N AU.UCCAMPUSKEY, \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N AU.TRANSACTIONDATEKEY, \N AU.TRANSACTIONDATE \N
              FROM {{ ref('UNKNOWN','AGGUCSPEND') }} AS AU
        dependencies:
          - locationName: REPORTS
            nodeName: AGG_UCSPEND
          - locationName: UNKNOWN
            nodeName: VWUCSPEND_MISSINGDATES
          - locationName: UNKNOWN
            nodeName: DIMTRANSACTIONDATE
          - locationName: FACT
            nodeName: MAXRECEIPTDATE
          - locationName: DIM
            nodeName: UCCAMPUS
          - locationName: UNKNOWN
            nodeName: AGGUCSPEND
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('REPORTS','AGG_UCSPEND') }}
            {{ ref('UNKNOWN','VWUCSPEND_MISSINGDATES') }}
            {{ ref('UNKNOWN','DIMTRANSACTIONDATE') }}
            {{ ref('FACT','MAXRECEIPTDATE') }}
            {{ ref('DIM','UCCAMPUS') }}
            {{ ref('UNKNOWN','AGGUCSPEND') }}
        name: VWUCSPEND_MISSINGDATES
        noLinkRefs: []
  name: VW_UCSPEND_MISSINGDATES
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
