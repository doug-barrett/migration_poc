fileVersion: 1
id: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
name: VW_UCSPEND_MISSINGDATES
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c7d21fd-398b-4a28-9a9b-f79960825874
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CAMPUS=UCCAMPUS.UCCAMPUS
        name: UCCAMPUSKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5848d10-02b7-4c04-80a4-a1e9cf9dc307
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd4cdbfb-425c-4a35-9752-6ea073e76c8e
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_1=UCCATEGORYLEVEL1.UCCATEGORY_LEVEL_1
        name: UCCATEGORYLEVEL1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf1218f9-5c61-4687-a5ed-10f5b4c58742
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c27ab5be-271d-4196-a16e-b73e1495e129
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_2=UCCATEGORYLEVEL2.UCCATEGORY_LEVEL_2
        name: UCCATEGORYLEVEL2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5065e21-2c31-4eef-9eef-ec550c8eceaa
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 509b1493-be8d-4ba8-9f60-83106235449e
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_3=UCCATEGORYLEVEL3.UCCATEGORY_LEVEL_3
        name: UCCATEGORYLEVEL3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e562a39a-adfc-468e-94b1-c72d3e8f21cb
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ad9839a-b058-4810-b52d-a5e0778dc670
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_4=UCCATEGORYLEVEL4.UCCATEGORY_LEVEL_4
        name: UCCATEGORYLEVEL4KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7fa8414-a91a-4f8a-8c60-a865fc7eea70
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9bdc7906-dfbd-42b3-a8d9-3012740c6e1b
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.SUPPLIER=UCSUPPLIER.UCSUPPLIERNAME
        name: UCSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c90dd701-53c7-48a0-8547-11c8b2705a04
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45136fb6-37b3-430a-a9fa-4a60f34037f8
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_1=UCTIER1.UC_TIER_1
        name: UCTIER1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 141f4122-413c-4b47-b861-9b089b59ec54
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac7adbe0-d28d-4a12-ae68-3279544da2ea
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_2=UCTIER2.UC_TIER_2
        name: UCTIER2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a32c7639-9ac7-4705-98bf-0211df42728c
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b959eef0-4257-4b6b-af59-51f7945ce140
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_3=UCTIER3.UC_TIER_3
        name: UCTIER3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99d79281-535c-45bc-8941-8d7f7acfd09f
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a0b8d15-b7a1-4b5f-86d0-9542e91d5abf
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: UCCOMPONENTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 81016921-f0f0-45bc-92f0-e046e1c33a64
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23070e73-a4fe-4c26-99e9-6db4e5120dd7
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b61d17c6-9afa-4f34-a3ff-89caa414d9d5
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26c1313d-18d9-41b5-9661-3f8c7a84699e
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPSUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4ada938-f65e-4552-81b8-1975f3df23f3
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1b25467-6e27-45c2-95c4-def66642d31e
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPCONTRACTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9f45af8-a91e-4d2c-9191-30f2d7e156bd
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a573a07-af9c-47b6-8f52-39f1fb6101f2
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPCONTRACTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 819b504b-e9ed-45ee-946a-39c640ebc761
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8531041f-ea34-4f0e-b3bf-cfabbdd1420b
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: OPCONTRACTMAPPINGSTATUSID
        name: OPCONTRACTMAPPINGSTATUSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5bb68baa-bc7e-4909-9ccd-6a0529861a63
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73a62df3-5a43-49a5-affc-df96f2132074
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: UCSPEND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77c3debd-762e-4a0f-b5fb-96e9b52ad1e5
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b85391e-ab86-4a70-b8b0-c9c8e6faae38
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: INT
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.TRANSACTIONDATE=DIMTRANSACTIONDATE.TRANSACTIONDATE
        name: TRANSACTIONDATEKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f7869ed-3f53-4972-8360-b24db308ee53
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 016fff73-138a-4f84-81a4-e414afd6da25
          stepCounter: 0c88d52b-e521-44ae-ab43-0ae72eaed29e
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 276b68b3-a147-414d-87f0-34907e188d24
                stepCounter: 06771ebd-97b5-47d3-ba9e-e0b86bf08a26
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          MAXRECEIPTDATE: 53374084-22a0-4b73-96c4-e43de8fc6f59
          UCCAMPUS: f40ae327-6f80-42a9-8c61-95ea4e2660a7
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref('UNKNOWN','VWUCSPEND_MISSINGDATES') }} (\NUCCAMPUSKEY,\NUCCATEGORYLEVEL1KEY,\NUCCATEGORYLEVEL2KEY,\NUCCATEGORYLEVEL3KEY,\NUCCATEGORYLEVEL4KEY,\NUCSUPPLIERKEY,\NUCTIER1KEY,\NUCTIER2KEY,\NUCTIER3KEY,\NUCCOMPONENTKEY,\NOPSUPPLIERKEY,\NOPSUPPLIERID,\NOPCONTRACTKEY,\NOPCONTRACTID,\NOPCONTRACTMAPPINGSTATUSID,\NUCSPEND,\NTRANSACTIONDATEKEY,\N TRANSACTIONDATE\N)\NAS\N WITH CTEALLTRANSDATES \N AS (
                    SELECT \N DTD.TRANSACTIONDATEKEY, \N DTD.TRANSACTIONDATE \N
                      FROM {{ ref('UNKNOWN','DIMTRANSACTIONDATE') }} AS DTD \N
                     WHERE DTD.TRANSACTIONDATEKEY BETWEEN 20180101 AND (
                            SELECT REPLACE(MAXRECEIPTDATE,'-','')
                              FROM {{ ref('FACT','MAXRECEIPTDATE') }}
                           ) \N
                       AND DTD.TRANSACTIONDATEKEY LIKE '%01'
                   ), \N CTEALLCAMPUSES \N AS (
                    SELECT \N UCCAMPUSKEY \N
                      FROM {{ ref('DIM','UCCAMPUS') }} AS U \N
                     WHERE U.UCCAMPUSKEY > 0
                   ), \N CTEALLUCROWSMINUSTRANSDATE \N AS (
                    SELECT DISTINCT \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID \N
                      FROM {{ ref('UNKNOWN','AGGUCSPEND') }} AS AU \N
                     WHERE AU.OPCONTRACTMAPPINGSTATUSID IN (1, 2)
                   ), \N CTEALLUCROWSALLDATESALLCAMPUSES \N AS (
                    SELECT \N * \N
                      FROM CTEALLUCROWSMINUSTRANSDATE AS CAAUMTD, \N CTEALLCAMPUSES AS CAC, --CROSS JOIN TO GENERATE ROWS FOR ALL CAMPUSES AND FOR ALL DATES
            \N CTEALLTRANSDATES AS CATD
                   ) \N --,
            \N --CTEALLOPROWS
            \N --AS (SELECT DISTINCT
            \N --		AOARBC.UCCAMPUSKEY AS UCCAMPUSKEY,
            \N --		--AOARBC.CONTRACTKEY AS OPCONTRACTKEY,
            \N --		AOARBC.TRANSACTIONDATEKEY
            \N -- FROM   OMNIAPARTNERSDW.REPORTS.AGGOPSALESANDREVENUEBYCONTRACT AS AOARBC
            \N --		INNER JOIN CTEALLTRANSDATES AS CATD ON AOARBC.TRANSACTIONDATEKEY = CATD.TRANSACTIONDATEKEY)
            \N --CTEALLOPROWSWITHUCCOLUMNS
            \N --AS (SELECT
            \N --		CTEUC.*
            \N -- FROM   CTEALLUCROWSALLDATESALLCAMPUSES AS CTEUC
            \N --		INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEUC.UCCAMPUSKEY
            \N --												AND CTEOP.OPCONTRACTKEY = CTEUC.OPCONTRACTKEY
            \N --												AND CTEOP.TRANSACTIONDATEKEY = CTEUC.TRANSACTIONDATEKEY
            \N -- WHERE  CTEUC.UCCATEGORYLEVEL1KEY IS NOT NULL),
            \N --SELECT * FROM CTEALLOPROWS
            \N SELECT \N CTEALLUC.UCCAMPUSKEY, \N CTEALLUC.UCCATEGORYLEVEL1KEY, \N CTEALLUC.UCCATEGORYLEVEL2KEY, \N CTEALLUC.UCCATEGORYLEVEL3KEY, \N CTEALLUC.UCCATEGORYLEVEL4KEY, \N CTEALLUC.UCSUPPLIERKEY, \N CTEALLUC.UCTIER1KEY, \N CTEALLUC.UCTIER2KEY, \N CTEALLUC.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N CTEALLUC.OPSUPPLIERKEY, \N CTEALLUC.OPSUPPLIERID, \N CTEALLUC.OPCONTRACTKEY, \N CTEALLUC.OPCONTRACTID, \N CTEALLUC.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N CTEALLUC.TRANSACTIONDATEKEY, \N CTEALLUC.TRANSACTIONDATE \N
              FROM CTEALLUCROWSALLDATESALLCAMPUSES AS CTEALLUC \N --INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEALLUC.UCCAMPUSKEY AND CTEOP.TRANSACTIONDATEKEY = CTEALLUC.TRANSACTIONDATEKEY
            \N
            EXCEPT \N SELECT DISTINCT \N AU.UCCAMPUSKEY, \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N AU.TRANSACTIONDATEKEY, \N AU.TRANSACTIONDATE \N
              FROM {{ ref('UNKNOWN','AGGUCSPEND') }} AS AU
        dependencies:
          - locationName: REPORTS
            nodeName: AGG_UCSPEND
          - locationName: UNKNOWN
            nodeName: VWUCSPEND_MISSINGDATES
          - locationName: UNKNOWN
            nodeName: DIMTRANSACTIONDATE
          - locationName: FACT
            nodeName: MAXRECEIPTDATE
          - locationName: DIM
            nodeName: UCCAMPUS
          - locationName: UNKNOWN
            nodeName: AGGUCSPEND
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('REPORTS','AGG_UCSPEND') }}
            {{ ref('UNKNOWN','VWUCSPEND_MISSINGDATES') }}
            {{ ref('UNKNOWN','DIMTRANSACTIONDATE') }}
            {{ ref('FACT','MAXRECEIPTDATE') }}
            {{ ref('DIM','UCCAMPUS') }}
            {{ ref('UNKNOWN','AGGUCSPEND') }}
        name: VWUCSPEND_MISSINGDATES
        noLinkRefs: []
  name: VW_UCSPEND_MISSINGDATES
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
