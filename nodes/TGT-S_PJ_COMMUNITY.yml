fileVersion: 1
id: b49e7248-b606-453c-a5b7-a20a67000f2b
name: S_PJ_COMMUNITY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Details of referrals related to community contacts or EDARS (Early Discharge Rehab Service) contacts."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5e350d2-0904-48dd-96b1-0cda9095cc63
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b40b49cf-eb92-4c2a-8a33-7208b7d07783
                stepCounter: 8608df78-2980-4eda-89d6-b7928f84cb8a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f455d641-442f-4d4f-b2a6-c155a262069d
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18848ef4-9210-4c0d-b496-21bf2f1e2481
                stepCounter: 8608df78-2980-4eda-89d6-b7928f84cb8a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0135322-7217-44c5-8c79-1da69fbd5dc7
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PARENT_REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14113898-8c09-41cb-8fed-5b6d3c240124
                stepCounter: 8608df78-2980-4eda-89d6-b7928f84cb8a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3fc816b3-e032-403a-a4cb-6b80cca2676e
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: REFERRAL_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e07c9d0-cc46-4991-8a57-7ae6d53690d9
                stepCounter: 8608df78-2980-4eda-89d6-b7928f84cb8a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9fbb497-e439-4370-9f54-b427182f4a28
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: referral_status_code
        name: REFERRAL_STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 21fc7db1-e0e1-4d9c-9916-3bf72f3e5035
                stepCounter: 6abb18ca-79da-4f03-98d9-18dc0bf8c1a0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98d89d04-5574-481a-bcc6-314b0e75a276
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: referral_type_code
        name: REFERRAL_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3cd32e58-9d2e-4f22-bc88-9e66a16fb6a0
                stepCounter: 98967b6a-61a3-4c8e-b291-6447cdf2fc9d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4974497-8831-40bc-a7b1-d36eb6b3fb72
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: REFERRAL_COMPLETION_REASON_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 79997109-e0ea-4d57-87bd-a6a354b4db72
                stepCounter: 5869a5b8-7044-46bc-9fc6-67f49dfa30ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3bfd6bd-2ce8-46b4-82b5-96274c872742
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Professional_Type_Code
        name: REFERRED_TO_CLINICIAN_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 169d5f35-26af-4d29-b6f8-a93df5125da5
                stepCounter: 29481079-6a75-49a5-90b6-5a62a9091370
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba36fdda-d368-43ca-ad61-2c0192210b40
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Set to 1 if the referral involves the EDARS team.
        name: EDARS_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: baa68aca-bceb-4b98-8f90-47b7ca143892
                stepCounter: 29481079-6a75-49a5-90b6-5a62a9091370
            transform: |-
              CASE WHEN referred_to_clinician_surname = 'EDARS' OR (referred_to_clinician_surname = 'Referral' AND referral_type_code = 'EXTRL') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d16792a-19e1-4561-a1c7-885f49a231d8
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93461c62-7866-4b78-84a4-a1f762e9c9f2
                stepCounter: fde74f73-d0e5-45d3-8928-a905661b0fb1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 321d4c27-228e-4503-86aa-8aed7e74b191
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: CONTACT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1ce798b-319b-43cb-84f6-4b9a4128d69e
                stepCounter: fde74f73-d0e5-45d3-8928-a905661b0fb1
            transform: COALESCE(fact_contact_community.contact_start_date, fact_referral.referral_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef1b8f48-e389-467e-bec7-a96a640c7a0f
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_COMPLETION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf73907a-62d7-4ca4-aacb-49cae61882c6
                stepCounter: fde74f73-d0e5-45d3-8928-a905661b0fb1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffb2b5bb-32fc-4bdc-993a-2d14280257ab
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Is the contact type FTF Y/N
        name: FTF_CONTACT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88c2235d-24c8-454c-8923-1c17ad0d6816
                stepCounter: fde74f73-d0e5-45d3-8928-a905661b0fb1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9d66e5c-a2c3-4263-bceb-56de07e52011
          stepCounter: b49e7248-b606-453c-a5b7-a20a67000f2b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          FACT_REFERRAL: 8608df78-2980-4eda-89d6-b7928f84cb8a
          DIM_REFERRAL_STATUS: 6abb18ca-79da-4f03-98d9-18dc0bf8c1a0
          DIM_REFERRAL_TYPE: 98967b6a-61a3-4c8e-b291-6447cdf2fc9d
          DIM_REFERRAL_COMPLETION_REASON: 5869a5b8-7044-46bc-9fc6-67f49dfa30ae
          DIM_REFERRED_TO_CLINICIAN: 29481079-6a75-49a5-90b6-5a62a9091370
          FACT_CONTACT_COMMUNITY: fde74f73-d0e5-45d3-8928-a905661b0fb1
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: FACT_REFERRAL
          - locationName: TGT
            nodeName: DIM_REFERRAL_STATUS
          - locationName: TGT
            nodeName: DIM_REFERRAL_TYPE
          - locationName: TGT
            nodeName: DIM_REFERRAL_COMPLETION_REASON
          - locationName: TGT
            nodeName: DIM_REFERRED_TO_CLINICIAN
          - locationName: TGT
            nodeName: FACT_CONTACT_COMMUNITY
        join:
          joinCondition: |-
            FROM {{ ref('TGT','FACT_REFERRAL') }} fact_referral
              JOIN {{ ref('TGT','DIM_REFERRAL_STATUS') }} dim_referral_status
                ON fact_referral.dim_referral_status_key = dim_referral_status.dim_referral_status_key
              JOIN {{ ref('TGT','DIM_REFERRAL_TYPE') }} dim_referral_type
                ON fact_referral.dim_referral_type_key = dim_referral_type.dim_referral_type_key
              JOIN {{ ref('TGT','DIM_REFERRAL_COMPLETION_REASON') }} dim_referral_completion_reason
                ON fact_referral.dim_referral_completion_reason_key = dim_referral_completion_reason.dim_referral_completion_reason_key
              JOIN {{ ref('TGT','DIM_REFERRED_TO_CLINICIAN') }} dim_referred_to_clinician
                ON fact_referral.dim_referred_to_clinician_key = dim_referred_to_clinician.dim_referred_to_clinician_key
              LEFT OUTER JOIN {{ ref('TGT','FACT_CONTACT_COMMUNITY') }} fact_contact_community
                ON fact_contact_community.referral_encounter_id = fact_referral.referral_encounter_id
             WHERE 1=1
               AND ((dim_referral_status.referral_status_code <> 'RJECT' AND fact_contact_community.FTF_contact = 'Y') -- Not Rejected, Community FTF  OR   (referred_to_clinician_surname = 'Referral'          AND referral_type_code = 'EXTRL')             -- EDARS parent referral  OR   (referred_to_clinician_surname = 'EDARS'))                                                         -- EDARS referral
        name: S_PJ_COMMUNITY
        noLinkRefs: []
  name: S_PJ_COMMUNITY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
