fileVersion: 1
id: 6ce426a7-cdee-4226-b320-23212c473524
name: STAGE_BUDGET_CSV_FINAL
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "Final transformation of lifted text CSV data into Budget Data Store values"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6a84a5c-00f2-4f5c-8678-4c3ef0282a86
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Common ID amungst all csv files (last 14 digits - timestamp)
        name: FILE_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b86d6181-120b-47ed-8afa-20e424bc104e
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.FILE_ID),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7772f4ad-04d9-4b8d-954e-43ce039daf92
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Type of data in source CSV file. Prefix code of CSV file
        name: LOAD_FILE_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 237c2b05-8891-41fc-bde4-c6a5a0fec694
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.LOAD_FILE_TYPE),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86f5a24c-cf46-49bc-82d8-3d051b10583f
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: R_VERSION.IDX for Budget Version currently being loaded
        name: FK_R_VERSION_IDX
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: '{{ parameters.BUDGET_R_VERSION_IDX }}'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d0f57f9-5f80-4c71-9102-2c9906efc5ac
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: EFFECTIVE_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a40735bf-eeee-42bc-8b7c-7ecd22710664
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: TO_DATE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.BUDGET_YEAR)||'0101', 'YYYYMMDD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c53307c7-40f4-445c-9fc3-bb7e295ed90a
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        name: DEST_ORG_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f2201df-73ad-44f7-9510-dace4bcab047
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: TO_NUMBER(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ORG_ID))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab587d5b-b80f-44c1-85e4-f8f44566272a
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: COST_CENTRE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f32e19f-7141-4976-b974-1b423a05c451
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.COST_CENTRE), 1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 726c7b0e-af57-4c2c-9eb4-e623ed4b9741
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: FUNCTIONAL_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d649b57c-0e85-4da1-9848-51ded76a6a57
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.FUNCTIONAL_AREA),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f21bf47-bc9d-4468-8dd1-237aaeb3abc7
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 090da971-85f6-4d52-89cb-a1b6a05b2b21
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ACCOUNT),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9adfdddc-c368-4961-8233-7d64d7cf377c
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3a73482-328d-452b-b2c0-9ae691552a75
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AFE_TYPE),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f663336-7be0-42dd-9c80-edc56f8646bc
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5d04ed89-733e-4f03-b143-b3cd15810024
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: UPPER(NVL(SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.GROSS_OR_NET),1,1),'N'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c883f453-5676-42d3-a941-ce27f2b0a8eb
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACTVY_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 763911fd-31bf-4974-b759-8ec02ea33b34
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73183f5d-5f1c-4784-8463-71430973e862
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7574f424-740f-4c71-b5ba-da61040c6b9b
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2d5e72d-2389-4860-8543-7c371985759e
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: AMT_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fdd3b4e0-b777-4474-878f-cd57ce2d5d2c
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: UPPER(SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT_CURR_CODE),1,3))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce6e8021-2341-4e6e-8a07-1591f3b3c9f2
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: VOL_UOM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52c6195d-3ae7-402e-a038-dd4e6dcfccc0
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ced408b8-3e74-40ee-9b99-90bb60fd19f6
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Monthly Total Amount
        name: AMT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 249b5d62-1434-4ec0-8b6b-46ff71096e70
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: DECODE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT), '-','0', NULL,'0', STAGE_BUDGET_CSV_UNPIVOT.AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 810fd1b1-c391-4de0-903b-15711daf48bd
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ORIG_FILENAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a7a0fce-982e-4448-afcd-a3cd70640185
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ORIG_FILENAME),1,255)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b60c915a-a2a9-49bc-b3e8-6a0a8753cd7d
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_LI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5408b48-4d99-460d-9a29-d670bd078c35
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.DSS_RECORD_SOURCE_LI),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 163dee77-cff6-4f2e-9a90-d5872dfcb971
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_HDR
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: da23f5fc-ad28-4e75-a828-887ff8a35482
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.DSS_RECORD_SOURCE_HDR),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57a36567-2c5f-42f6-ab69-f4a6a52109b6
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95c48d0a-8937-4054-9a20-50026b69ad35
                stepCounter: 31c27799-70cf-459d-945e-7eabffe96144
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db01524c-c85f-4fd7-ad4e-e774b2a531ec
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00ff6923-1c06-4f93-95a7-3dc91426c2b6
          stepCounter: 6ce426a7-cdee-4226-b320-23212c473524
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_BUDGET_CSV_UNPIVOT: 31c27799-70cf-459d-945e-7eabffe96144
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: STAGE_BUDGET_CSV_UNPIVOT
        join:
          joinCondition: |-
            FROM {{ ref('TARGET','STAGE_BUDGET_CSV_UNPIVOT') }} STAGE_BUDGET_CSV_UNPIVOT
             WHERE STAGE_BUDGET_CSV_UNPIVOT.ORG_ID IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.COST_CENTRE IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.GROSS_OR_NET IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.ACTVY_PER_DATE IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.ACCT_PER_DATE IS NOT NULL
               AND DECODE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT), '-','0', NULL,'0', STAGE_BUDGET_CSV_UNPIVOT.AMT) <> 0
        name: STAGE_BUDGET_CSV_FINAL
        noLinkRefs: []
  name: STAGE_BUDGET_CSV_FINAL
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
