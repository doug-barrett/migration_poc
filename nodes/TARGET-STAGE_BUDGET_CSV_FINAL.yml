fileVersion: 1
id: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
name: STAGE_BUDGET_CSV_FINAL
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "Final transformation of lifted text CSV data into Budget Data Store values"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b175f75d-3df2-4848-a064-e90b06d7c630
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Common ID amungst all csv files (last 14 digits - timestamp)
        name: FILE_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6410576-93c7-4dd0-91a5-87ae5a4b422b
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.FILE_ID),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7291bb72-7c25-4965-b15a-8ba3ace2a2ec
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Type of data in source CSV file. Prefix code of CSV file
        name: LOAD_FILE_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a1b2aac-753d-429e-9efd-bdf95c13d60c
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.LOAD_FILE_TYPE),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c426fa3c-3b43-49ea-84ee-a46727639d3c
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: R_VERSION.IDX for Budget Version currently being loaded
        name: FK_R_VERSION_IDX
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: '{{ parameters.BUDGET_R_VERSION_IDX }}'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92f27b33-c795-48ff-a6e9-d7aca696534c
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: EFFECTIVE_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f6129989-9ff9-4297-a01a-424652af8115
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: TO_DATE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.BUDGET_YEAR)||'0101', 'YYYYMMDD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0fedf2af-e795-48c4-b3db-ace129373218
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        name: DEST_ORG_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe53f57d-cb90-49d4-af96-96d0d4de1c83
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: TO_NUMBER(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ORG_ID))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcaf84cf-d09a-4ec8-9326-61f3fec89cd4
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: COST_CENTRE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eab9cfe1-d71e-4a29-843f-c25d11302962
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.COST_CENTRE), 1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0e99d00-325e-4be0-89af-cbb910b8ce7d
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: FUNCTIONAL_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a30da9a6-0825-4fbd-bd62-5fee9dcd5d59
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.FUNCTIONAL_AREA),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85fd2052-ced4-40bc-935a-2400bcf61330
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7df5b01-b9b2-4821-95e6-c0136e5b45d4
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ACCOUNT),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 737b0f07-227a-428b-92f2-c60f87ae99db
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 048eb645-4558-4675-9f56-7e8a0e653671
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AFE_TYPE),1,10)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acee564e-ccf0-48df-87d6-485b6fd43fc1
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc70295c-8312-4709-ab79-26f1ab8a1d83
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: UPPER(NVL(SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.GROSS_OR_NET),1,1),'N'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 431325a4-a95a-44a1-84b2-18827e036fb4
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACTVY_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e3479bff-6278-48de-be20-885eb8c29ea2
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d04c7f54-24a6-4734-ae57-ddd3d4101bf6
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e03e599-0c18-4a50-836f-7f1cc4057542
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4999c4a1-0d3b-4693-821f-1ad9ed3e78d1
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: AMT_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 192d1485-9fec-4edd-9a31-c76ea35387ec
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: UPPER(SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT_CURR_CODE),1,3))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14b05968-0fb2-44e4-8234-2789c16db971
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: VOL_UOM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37b610b9-6de4-4c05-9245-c8dd6c2b6e6e
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d44db43-57c5-47a2-a628-9b15f5031fd7
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Monthly Total Amount
        name: AMT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4806c19b-5807-4415-9ce3-d88e4c187be8
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: DECODE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT), '-','0', NULL,'0', STAGE_BUDGET_CSV_UNPIVOT.AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f2f1b87-ff57-46f4-ac46-d4fc2e4e91f5
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ORIG_FILENAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34c06f26-99b0-4c8a-880c-25a98660bbae
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.ORIG_FILENAME),1,255)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b808b01-74a4-4235-a7be-a290574b6777
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_LI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2451d5c3-f453-496b-8608-2853732ad136
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.DSS_RECORD_SOURCE_LI),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a27296a-442c-468d-916a-1e689648388b
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: VARCHAR(64)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE_HDR
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3cd27a6-706f-410a-8565-17052cab60d1
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: SUBSTR(TRIM(STAGE_BUDGET_CSV_UNPIVOT.DSS_RECORD_SOURCE_HDR),1,64)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 89cde4f8-0620-4840-929d-76af5b120f94
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6344576a-fc63-4172-a963-22471fef4cd0
                stepCounter: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1790a40b-50b1-4970-a26f-f77fbf9a2515
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ad759f4-9f1e-4ffd-a813-49af3bb80b9c
          stepCounter: db6d0c16-edfb-4ef6-9dd1-71529cbc1dd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_BUDGET_CSV_UNPIVOT: baa18a22-0f9e-4da8-b3ba-dcbbd854dfd6
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: STAGE_BUDGET_CSV_UNPIVOT
        join:
          joinCondition: |-
            FROM {{ ref('TARGET','STAGE_BUDGET_CSV_UNPIVOT') }} STAGE_BUDGET_CSV_UNPIVOT
             WHERE STAGE_BUDGET_CSV_UNPIVOT.ORG_ID IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.COST_CENTRE IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.GROSS_OR_NET IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.ACTVY_PER_DATE IS NOT NULL
               AND STAGE_BUDGET_CSV_UNPIVOT.ACCT_PER_DATE IS NOT NULL
               AND DECODE(TRIM(STAGE_BUDGET_CSV_UNPIVOT.AMT), '-','0', NULL,'0', STAGE_BUDGET_CSV_UNPIVOT.AMT) <> 0
        name: STAGE_BUDGET_CSV_FINAL
        noLinkRefs: []
  name: STAGE_BUDGET_CSV_FINAL
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
