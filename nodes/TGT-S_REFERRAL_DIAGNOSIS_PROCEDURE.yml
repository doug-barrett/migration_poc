fileVersion: 1
id: 822612f8-5207-4864-9bfa-bd47edc6b68d
name: S_REFERRAL_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47b38cf3-9ed7-4dfd-a44d-4d48e407644b
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ea5d433-91ca-48a7-9ae4-faea9f093b1b
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92e81e55-49c8-4bdb-969c-7cedd3eda52a
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ea5d433-91ca-48a7-9ae4-faea9f093b1b
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: "'R'+CONVERT(varchar,ds_pims_referrals.refrl_refno)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d2afa43-2a76-4433-8e74-b97b07b6e77a
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: REFERRAL_RECEIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d559d91-e33e-47a7-a819-1f7cce3c6112
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfda27b2-76c6-4261-a855-010655f36ec6
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_referral_diagnosis_procedure.CONVERT(date,ds_pims_referrals.recvd_dttm)=dim_referral_received_date.referral_received_calendar_date
        name: DIM_REFERRAL_RECEIVED_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc304ff6-e51c-4892-805b-bebeaaaf465a
                stepCounter: 2039d8f6-8e40-418e-99bd-5f6ef6cede8a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b43e9900-491b-43c5-8a68-be76808ef63a
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b958777-5cbb-4a87-a4d5-2df92d9f4399
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f7bee63-77d3-4c34-9039-7c6bce4af10c
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985f0ba0-97cf-4152-a49b-7e86cb71409e
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4955ed7d-6763-48f3-abee-722923dd4e68
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_referral_diagnosis_procedure.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fd7b434b-2796-47f5-b2d5-67b27521e1e7
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7dcad9a6-52b1-402a-a292-1118300823b9
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37247b3b-e0e0-450b-946b-c941b64eb7c8
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acf9cd35-f61f-4ef8-a0a8-c8a3b0f89866
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 271efe56-3d39-4d18-b5a7-7e1dcc80d250
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c0410d1-e297-4095-8531-87cea78f80c9
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_SUBTYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4202524b-d639-456c-8251-7a90b135e703
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecc036db-91d2-4737-b93c-f3e449aa298e
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c50d66b-5140-4557-a5e3-5fd4823a4dfa
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 899ed272-ee1d-4786-a7b5-9ebc17d10dfb
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ae1a398a-9c7b-4fad-b7e2-8e105705ec6f
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0b6a9f7-0f78-439f-b4f5-f090a934ed2b
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4c372ad-7e3b-459a-89ad-ec53d1b8cb49
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26bf0fb5-215a-4282-99ab-feebd8e28a6a
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_referral_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: DIM_DIAGNOSIS_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24cebf11-1bcf-4240-a364-9b0f51cffc73
                stepCounter: 5c3dba16-610b-4df4-a82e-a17b4d31bb68
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41eeb347-1108-46b3-bcae-f8caa339e1f4
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b958777-5cbb-4a87-a4d5-2df92d9f4399
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_referrals.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_referrals.recvd_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98f02a6c-6a95-4c09-8d42-8bf4220e30cb
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b958777-5cbb-4a87-a4d5-2df92d9f4399
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN COUNT(1) OVER (PARTITION BY ds_pims_referrals.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f9f955c-7072-4088-a571-e9bc6c6052f0
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b958777-5cbb-4a87-a4d5-2df92d9f4399
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_referrals.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_referrals.recvd_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d811ade1-9828-4564-9c77-72c173c13fa9
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b958777-5cbb-4a87-a4d5-2df92d9f4399
                stepCounter: ae7c0e60-053e-4fb8-aa4e-d49e3e08e3c2
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN COUNT(1) OVER (PARTITION BY ds_pims_referrals.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b83cd95-ccac-456f-a9b9-a450bdf68250
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_referral_30.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: REFERRAL_DIAGNOSIS_PROCEDURE_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d183e9d-6aff-441b-a4bb-99054fdbbcaf
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 614e95dd-dc83-4fb6-80e2-eae0b812a7b5
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9424a9a5-366e-4cac-b348-d2d40091360a
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f2de421-29ae-4da9-a753-3f3076972d72
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03bc515a-5cb9-49e5-adb4-3bafef770602
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_referral_diagnosis_procedure.create_user_login_code=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dfe5e14-cc2f-4748-8352-a6d1621289af
                stepCounter: 70bd6ed5-e21b-440f-9079-7fe305bc4f30
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5114ce59-8861-4d31-a5f4-044bf188462e
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6decebff-eb31-4277-aa08-3a795ec793df
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c67edb9-b512-4837-ac40-7d2bf86aa291
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0018f473-59d0-4576-9d88-96374fcf8639
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 577c67bb-34e8-4dc1-ba41-e1864f7c15f3
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_referral_diagnosis_procedure.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ceaa34a6-dd0b-40fb-bc61-9df93cc05e7b
                stepCounter: bef0768d-dddb-4d02-af8d-03160de42b62
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c846a151-1acd-4cd0-a244-b781973c7126
          stepCounter: 822612f8-5207-4864-9bfa-bd47edc6b68d
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_REFERRALS
        join:
          joinCondition: |-
            FROM ds_pims_referrals
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_referrals.refrl_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_diagnosis_procedures.mplev_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_diagnosis_procedures.cptyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.main_code = ds_pims_diagnosis_procedures.CCSXT_Code
               AND ds_pims_reference_values3.rfvdm_code = 'CCSXT'
             WHERE ds_pims_diagnosis_procedures.sorce_code = 'REFRL'
        name: S_REFERRAL_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_REFERRAL_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
