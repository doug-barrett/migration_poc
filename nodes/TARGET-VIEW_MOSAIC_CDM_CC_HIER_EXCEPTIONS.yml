fileVersion: 1
id: fe3bd521-e5ba-4155-b051-da71db757aa5
name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "Cost Center Hierarchy exceptions (AREA, CORE_AREA attributes)in Mosaic CDM entities  "
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09ddee4b-4f8e-40b3-bdd4-dfb22a117026
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: BUSINESS_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9429758-6c5c-42c7-8fc1-674e8a4642a1
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cac74028-17ec-44c3-9d18-69cc0a30764c
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DISTRICT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5c60d01-ffa6-4adb-85d5-5909ee583b07
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 855f819a-63be-4084-af22-78b0965f920c
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9975a8c4-379d-4e86-9cbc-b5b26f3460b4
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ad8a1ee-3db4-41c8-bbbb-f219d355b627
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f345ae8-3b59-46e1-a6d3-098448fcfe07
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ee920aeb-b816-4a78-913f-f4a472202561
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc05f879-ef8e-40fc-b0fc-1a7b1f92f15e
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86443430-572f-4912-9986-fdecf0d0b314
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3bbf1b56-d091-4708-942b-d4bacc22d1dd
                stepCounter: 8f4f3d1c-46d5-481b-96bb-c3eef002c08c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 620e8ca0-1afc-4031-b696-39857cc553df
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: CORP_HIER_CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 619126d9-0cd3-45df-bfbd-2f5dca6da0bd
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2502c9bb-6b72-41a1-9ec7-afbd51d8a768
          stepCounter: fe3bd521-e5ba-4155-b051-da71db757aa5
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: CORP_HIER_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec8da7e4-2ee4-4296-8f0a-7c334356d71e
                stepCounter: 2cca214d-2f7a-400c-a483-58b288ed6097
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS: fe3bd521-e5ba-4155-b051-da71db757aa5
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS') }} AS WITH cdm AS (
                    SELECT DISTINCT BUSINESS_UNIT,
                           DISTRICT,
                           ENTITY_NAME,
                           TRIM(CC) AS CC,
                           TRIM(CORE_AREA) AS CORE_AREA,
                           TRIM(AREA) AS AREA
                      FROM BI_ECON.VW_CDM_ECONOMICS
                     WHERE ENTITY_STATE_ID = 0
                   ),
                   hier AS (
                    SELECT DISTINCT TRIM(CC_NUM) AS CC,
                           TRIM(COREAREA_NAME) AS CORE_AREA,
                           TRIM(AREA_NAME) AS AREA
                      FROM BI_LEASE_OPS.DIM_CC_CORP_HIER_CURRENT_SAP
                   ) SELECT cdm.BUSINESS_UNIT,
                   cdm.DISTRICT,
                   cdm.ENTITY_NAME,
                   cdm.CC,
                   cdm.CORE_AREA,
                   cdm.AREA,
                   DECODE(cdm.CC, NULL, '[CC NOT DEFINED]', DECODE(hier.CC, NULL, '[CC NOT FOUND]',hier.CORE_AREA)) AS CC_CORP_HIER_CORE_AREA,
                   DECODE(cdm.CC, NULL, '[CC NOT DEFINED]', DECODE(hier.CC, NULL, '[CC NOT FOUND]',hier.AREA)) AS CC_CORP_HIER_AREA
              FROM cdm
              LEFT JOIN hier
                ON cdm.CC = hier.CC
             WHERE hier.CC IS NULL
                OR (hier.CC IS NOT NULL AND (cdm.AREA <> hier.AREA OR cdm.CORE_AREA <> hier.CORE_AREA))
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_MOSAIC_CDM_ECONOMICS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_MOSAIC_CDM_ECONOMICS') }}
        name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
        noLinkRefs: []
  name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
