fileVersion: 1
id: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "Cost Center Hierarchy exceptions (AREA, CORE_AREA attributes)in Mosaic CDM entities  "
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23084af1-dfdd-4936-9f45-352a0f0d3520
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: BUSINESS_UNIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ac8360d-de4a-4bbd-87f4-8f83a8e4e628
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1efcdcf-a00c-4b31-916c-0a7e47f43ef3
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DISTRICT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2bbd556-e1a8-401a-b8c4-2354e22562d5
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56da6f01-f1f3-4f73-95f9-5a70bc0338d7
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd0ac9aa-173a-4550-8fb9-edad8c56fcce
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19a82f4d-dda4-4534-9d03-4970edd6bb6a
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64e966a7-6d4f-474d-866f-2d3927d14bee
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 62727954-8b51-4899-b0b2-869e70fada2e
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37dbf81a-6800-45c2-b475-a09c7ad61c3a
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdd25967-c85a-40b7-8293-cb429431c81b
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c4dca25-fbf6-472c-9927-62aeedd016a4
                stepCounter: 6a153077-f654-4dcf-a1a5-284b17fb227d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 867b5cc3-6f9e-4594-8d4d-bc42dd0ef977
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: CORP_HIER_CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8d8af15-264c-40af-8b0b-4dce3b18ed31
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 199a845e-9a95-4d99-8542-8d850e9a1878
          stepCounter: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: CORP_HIER_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a489a103-50e2-4347-8d34-6965b140eea8
                stepCounter: 067903b4-15b6-458b-abc2-85946f5a3432
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS: c3ca7696-c5ce-43e4-8cc1-f64b3b64e988
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS') }} AS WITH cdm AS (
                    SELECT DISTINCT BUSINESS_UNIT,
                           DISTRICT,
                           ENTITY_NAME,
                           TRIM(CC) AS CC,
                           TRIM(CORE_AREA) AS CORE_AREA,
                           TRIM(AREA) AS AREA
                      FROM BI_ECON.VW_CDM_ECONOMICS
                     WHERE ENTITY_STATE_ID = 0
                   ),
                   hier AS (
                    SELECT DISTINCT TRIM(CC_NUM) AS CC,
                           TRIM(COREAREA_NAME) AS CORE_AREA,
                           TRIM(AREA_NAME) AS AREA
                      FROM BI_LEASE_OPS.DIM_CC_CORP_HIER_CURRENT_SAP
                   ) SELECT cdm.BUSINESS_UNIT,
                   cdm.DISTRICT,
                   cdm.ENTITY_NAME,
                   cdm.CC,
                   cdm.CORE_AREA,
                   cdm.AREA,
                   DECODE(cdm.CC, NULL, '[CC NOT DEFINED]', DECODE(hier.CC, NULL, '[CC NOT FOUND]',hier.CORE_AREA)) AS CC_CORP_HIER_CORE_AREA,
                   DECODE(cdm.CC, NULL, '[CC NOT DEFINED]', DECODE(hier.CC, NULL, '[CC NOT FOUND]',hier.AREA)) AS CC_CORP_HIER_AREA
              FROM cdm
              LEFT JOIN hier
                ON cdm.CC = hier.CC
             WHERE hier.CC IS NULL
                OR (hier.CC IS NOT NULL AND (cdm.AREA <> hier.AREA OR cdm.CORE_AREA <> hier.CORE_AREA))
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_MOSAIC_CDM_ECONOMICS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_MOSAIC_CDM_ECONOMICS') }}
        name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
        noLinkRefs: []
  name: VIEW_MOSAIC_CDM_CC_HIER_EXCEPTIONS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
