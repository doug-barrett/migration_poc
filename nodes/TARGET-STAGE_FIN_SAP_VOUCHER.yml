fileVersion: 1
id: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
name: STAGE_FIN_SAP_VOUCHER
operation:
  config:
    distinct: true
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0dbcd07-acae-4edc-80d2-1a165898ee97
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(28)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: VOUCHER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 087f18e3-3489-42af-a08a-e7544931ff30
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ODS_SAP_ACDOCA.RLDNR|| ODS_SAP_ACDOCA.RBUKRS|| TO_CHAR(ODS_SAP_ACDOCA.GJAHR)|| ODS_SAP_ACDOCA.BELNR
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae4d7287-31cc-45aa-9c12-8dcbb204d513
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The organization owning the voucher.
        name: VCHR_ORG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ef3848d-ddce-442b-a5ee-f6b082df2138
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae507647-7264-4a22-a471-cc059940488c
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: organization for which the Voucher was created
        name: VCHR_ORG_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e063e94c-f948-49aa-854c-1e1627c372f1
                stepCounter: 2c701d0c-4f6b-4d48-bf42-61b56bce4087
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88497cd8-913b-4a51-8e89-1dfb5e171377
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: The user"s voucher number.
        name: VCHR_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 087f18e3-3489-42af-a08a-e7544931ff30
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6616a4a7-35f1-4347-bea6-a596668a62f7
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: Indicates voucher type.
        name: VCHR_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99616118-8b27-4d99-b813-00a0a2b17310
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64b3e68f-a6b0-422b-8e61-397e75fe6165
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: The accounting period (end date) when the voucher is entered.  This date is usually expressed as the last day of the month.
        name: VCHR_ACCT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 537ef8b5-ba80-42d8-898e-69ef89c148cc
                stepCounter: a0af4353-38fe-4b99-9582-f996832a6066
            transform: LAST_DAY(ODS_SAP_ACDOCA.BUDAT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b76930d-d487-4077-b2f3-2e10e36f2ef2
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: 'The source currency for line items on the voucher.  Used for all foreign currency methods. For method #3, this is the currency of the amount in reporting curr amt.'
        name: VCHR_CURR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8930af17-897b-446c-94c1-d61128479aec
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca2c753b-90e8-4db7-9ead-7c63ffa73206
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: Originating group or department.
        name: VCHR_SRC
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9afdbd6a-661d-4a66-8414-fbd8e503cf42
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: The voucher status (posted, unposted, deferred, archived).
        name: VCHR_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0116899a-6da4-429f-9cfa-e056a5f1a9ea
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(40)
        defaultValue: ""
        description: Voucher description.
        name: VCHR_REMARK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71d7731c-37ca-4524-8578-0ad7fdf64a34
                stepCounter: a0af4353-38fe-4b99-9582-f996832a6066
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82749bbf-9205-4e31-bc24-9b220fd01584
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date the voucher was created.
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f6e888ea-c302-4ede-99de-644c4984f77b
                stepCounter: a0af4353-38fe-4b99-9582-f996832a6066
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0dcaeeba-9305-4857-8a10-d92f99053fbe
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Name or user ID of the person entering the voucher.
        name: CREATE_USER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 980109ab-435b-4b18-9d5e-5ec9605cd434
                stepCounter: a0af4353-38fe-4b99-9582-f996832a6066
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc6b797a-2913-41c6-9b37-e94a5c29f6ad
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date voucher line items are posted to the general ledger.
        name: GL_POSTING_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 637dc3c6-f4ef-4fd0-b198-d8f84ac80f73
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa7c962f-5dc2-48a6-b426-f102e33d3b15
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: The user id that posted a voucher.
        name: GL_POST_USER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2a11e42-fc2e-4360-bfd5-d3622899247d
                stepCounter: d310660d-8d8d-4155-898e-2bc2c935b749
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e78e68a0-09ae-4542-a554-90a030e5e9a3
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEST_ORG_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13132d62-0854-4444-802d-fb55df2bcd4c
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: The voucher status (posted, unposted, deferred, archived).
        name: PWV_LINK
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN ODS_SAP_BKPF.BLART = 'OI' THEN '{{ parameters.SAP_INVOICE_URL _PREFIX_OI }}'||ODS_SAP_BKPF.XBLNR
                          ELSE '{{ parameters.SAP_INVOICE_URL _PREFIX_FIORI }}'||ODS_SAP_BKPF.BELNR|| '&CompanyCode='||ODS_SAP_BKPF.BUKRS|| '&FiscalPeriod='||ODS_SAP_BKPF.MONAT|| '&FiscalYear='||ODS_SAP_BKPF.GJAHR|| '&/detail/'||ODS_SAP_BKPF.BUKRS||'/'||ODS_SAP_BKPF.GJAHR||'/'||ODS_SAP_BKPF.BELNR
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ddeca02-4b17-441f-af25-c234c21d770b
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: CODERS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 65854792-abac-41f8-9be9-3508f5b779e4
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: APPROVERS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9764e816-8cb0-4f15-9dcf-00fdc1e75bd3
          stepCounter: 0fcc7387-fe6b-4123-9f2a-d1b53ac74349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: TRANSLATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa5ff6d4-63cd-46e7-b3cc-f4b189b41d10
                stepCounter: a0af4353-38fe-4b99-9582-f996832a6066
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          ODS_SAP_ACDOCA: d310660d-8d8d-4155-898e-2bc2c935b749
          ODS_SAP_BKPF: a0af4353-38fe-4b99-9582-f996832a6066
          ODS_SAP_T001: 2c701d0c-4f6b-4d48-bf42-61b56bce4087
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: ODS_SAP_ACDOCA
          - locationName: TARGET
            nodeName: ODS_SAP_BKPF
          - locationName: TARGET
            nodeName: ODS_SAP_T001
        join:
          joinCondition: |-
            FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_SAP_ACDOCA') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) ODS_SAP_ACDOCA
              LEFT JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_SAP_BKPF') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) ODS_SAP_BKPF
                ON ODS_SAP_ACDOCA.BELNR = ODS_SAP_BKPF.BELNR
               AND ODS_SAP_ACDOCA.GJAHR = ODS_SAP_BKPF.GJAHR
               AND ODS_SAP_ACDOCA.RBUKRS = ODS_SAP_BKPF.BUKRS
              LEFT JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_SAP_T001') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) ODS_SAP_T001
                ON ODS_SAP_ACDOCA.RBUKRS = ODS_SAP_T001.BUKRS
        name: STAGE_FIN_SAP_VOUCHER
        noLinkRefs: []
  name: STAGE_FIN_SAP_VOUCHER
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
