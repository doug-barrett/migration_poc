fileVersion: 1
id: d7bae19e-b42c-4a9b-96f3-e91e5d27d877
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f4d7483-a097-4b01-98a2-287ef0d972fa
          stepCounter: d7bae19e-b42c-4a9b-96f3-e91e5d27d877
        config: {}
        dataType: INT
        defaultValue: ""
        description: Supplier Key
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7716f78-2fd0-4067-989c-7cafdab51b5f
                stepCounter: 60b39932-2692-4360-ae42-25e43379d6f6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 426fd588-d5a5-4412-9393-ef067e9ff11d
          stepCounter: d7bae19e-b42c-4a9b-96f3-e91e5d27d877
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: Contract Public Or Private By Source Entity
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00f34fed-f39e-4c9c-8873-ff8e296da78f
                stepCounter: 60b39932-2692-4360-ae42-25e43379d6f6
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: d7bae19e-b42c-4a9b-96f3-e91e5d27d877
          CONTRACT: 60b39932-2692-4360-ae42-25e43379d6f6
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (SupplierKey, ContractPublicOrPrivateBySourceEntity) AS WITH cteTemp AS (
                    SELECT DISTINCT SupplierKey,
                           CASE SourceEntityName --Public

                                WHEN 'OMNIA Public Sector'  THEN 'Public'
                                WHEN 'US Communities'       THEN 'Public'
                                WHEN 'National IPA'         THEN 'Public'
                                WHEN 'Vizient'              THEN 'Public'
                                WHEN 'TCPN'                 THEN 'Public'
                                WHEN 'NCPA'                 THEN 'Public' --Private

                                WHEN 'OMNIA Private Sector' THEN 'Private'
                                WHEN 'Corporate United'     THEN 'Private'
                                WHEN 'Prime Advantage'      THEN 'Private'
                                WHEN 'Insight GPO'          THEN 'Private'
                                WHEN 'OP PPE'               THEN 'Private' --Other

                                ELSE 'Unknown'
                                 END AS ContractPublicOrPrivateBySourceEntity
                      FROM {{ ref('DIM','CONTRACT') }}
                     GROUP BY SupplierKey,
                              SourceEntityName
                   ) SELECT SupplierKey,
                   LISTAGG(DISTINCT ContractPublicOrPrivateBySourceEntity, ',') WITHIN GROUP (ORDER BY ContractPublicOrPrivateBySourceEntity DESC) AS ContractPublicOrPrivateBySourceEntity
              FROM cteTemp
             GROUP BY Supplierkey ;
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
