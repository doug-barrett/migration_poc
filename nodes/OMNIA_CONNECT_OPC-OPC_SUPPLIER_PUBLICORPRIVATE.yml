fileVersion: 1
id: c6bda4c9-a784-495c-b8d3-52030a22d1d0
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 671c11f6-d0b1-41e5-bbdb-17cbad89be4f
          stepCounter: c6bda4c9-a784-495c-b8d3-52030a22d1d0
        config: {}
        dataType: INT
        defaultValue: ""
        description: SUPPLIER KEY
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2aa55bd1-f8be-4d08-ade3-2ff2c3000b9a
                stepCounter: a550c43a-4d5a-4a69-aa48-4cefa3de4b21
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1d9d624-de58-4089-a8bb-e4f0587508ad
          stepCounter: c6bda4c9-a784-495c-b8d3-52030a22d1d0
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: CONTRACT PUBLIC OR PRIVATE BY SOURCE ENTITY
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34fa6a04-f1b5-4f31-b01d-acf427ab53d2
                stepCounter: a550c43a-4d5a-4a69-aa48-4cefa3de4b21
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: c6bda4c9-a784-495c-b8d3-52030a22d1d0
          CONTRACT: a550c43a-4d5a-4a69-aa48-4cefa3de4b21
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (\NSUPPLIERKEY, \NCONTRACTPUBLICORPRIVATEBYSOURCEENTITY\N)\NAS\NWITH CTETEMP \N AS (
                    SELECT DISTINCT SUPPLIERKEY, \N CASE SOURCEENTITYNAME \N --PUBLIC
            \N
                                WHEN 'OMNIA PUBLIC SECTOR'       THEN 'PUBLIC' \N
                                WHEN 'US COMMUNITIES'            THEN 'PUBLIC' \N
                                WHEN 'NATIONAL IPA'              THEN 'PUBLIC' \N
                                WHEN 'VIZIENT'                   THEN 'PUBLIC' \N
                                WHEN 'TCPN'                      THEN 'PUBLIC' \N
                                WHEN 'NCPA'                      THEN 'PUBLIC' \N --PRIVATE
            \N
                                WHEN 'OMNIA PRIVATE SECTOR'      THEN 'PRIVATE' \N
                                WHEN 'CORPORATE UNITED'          THEN 'PRIVATE' \N
                                WHEN 'PRIME ADVANTAGE'           THEN 'PRIVATE' \N
                                WHEN 'INSIGHT GPO'               THEN 'PRIVATE' \N
                                WHEN 'OP PPE'                    THEN 'PRIVATE' \N --OTHER
            \N
                                ELSE 'UNKNOWN' \N
                                 END AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
                      FROM {{ ref('DIM','CONTRACT') }} \N
                     GROUP BY \N SUPPLIERKEY, \N SOURCEENTITYNAME
                   ) \N SELECT \N SUPPLIERKEY, \N LISTAGG(DISTINCT CONTRACTPUBLICORPRIVATEBYSOURCEENTITY, ',') WITHIN GROUP (ORDER BY CONTRACTPUBLICORPRIVATEBYSOURCEENTITY DESC) AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
              FROM CTETEMP \N
             GROUP BY SUPPLIERKEY \N;\N\N
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
