fileVersion: 1
id: 63d94667-4c7e-4b2a-8ef9-8bcdfe835691
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ada579c-b6ee-4153-9d45-d63db1a034ef
          stepCounter: 63d94667-4c7e-4b2a-8ef9-8bcdfe835691
        config: {}
        dataType: INT
        defaultValue: ""
        description: Supplier Key
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 651b2502-6437-43f9-be30-5cd0c3a311cc
                stepCounter: c745f44c-5c71-4400-897b-ff90a502a9cb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d05c945b-f97d-4eb9-adcb-33052c861b80
          stepCounter: 63d94667-4c7e-4b2a-8ef9-8bcdfe835691
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: Contract Public Or Private By Source Entity
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 76d06f54-2161-41c6-8de5-b9c4f8074260
                stepCounter: c745f44c-5c71-4400-897b-ff90a502a9cb
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: 63d94667-4c7e-4b2a-8ef9-8bcdfe835691
          CONTRACT: c745f44c-5c71-4400-897b-ff90a502a9cb
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (SupplierKey, ContractPublicOrPrivateBySourceEntity) AS WITH cteTemp AS (
                    SELECT DISTINCT SupplierKey,
                           CASE SourceEntityName --Public

                                WHEN 'OMNIA Public Sector'  THEN 'Public'
                                WHEN 'US Communities'       THEN 'Public'
                                WHEN 'National IPA'         THEN 'Public'
                                WHEN 'Vizient'              THEN 'Public'
                                WHEN 'TCPN'                 THEN 'Public'
                                WHEN 'NCPA'                 THEN 'Public' --Private

                                WHEN 'OMNIA Private Sector' THEN 'Private'
                                WHEN 'Corporate United'     THEN 'Private'
                                WHEN 'Prime Advantage'      THEN 'Private'
                                WHEN 'Insight GPO'          THEN 'Private'
                                WHEN 'OP PPE'               THEN 'Private' --Other

                                ELSE 'Unknown'
                                 END AS ContractPublicOrPrivateBySourceEntity
                      FROM {{ ref('DIM','CONTRACT') }}
                     GROUP BY SupplierKey,
                              SourceEntityName
                   ) SELECT SupplierKey,
                   LISTAGG(DISTINCT ContractPublicOrPrivateBySourceEntity, ',') WITHIN GROUP (ORDER BY ContractPublicOrPrivateBySourceEntity DESC) AS ContractPublicOrPrivateBySourceEntity
              FROM cteTemp
             GROUP BY Supplierkey ;
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
