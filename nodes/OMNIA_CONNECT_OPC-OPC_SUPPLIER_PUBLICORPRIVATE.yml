fileVersion: 1
id: 8ac21b57-053d-4ec3-8f7e-867909eded5f
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67f5fb13-66e0-4a05-b2a7-bb6eb0a42077
          stepCounter: 8ac21b57-053d-4ec3-8f7e-867909eded5f
        config: {}
        dataType: INT
        defaultValue: ""
        description: SUPPLIER KEY
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63de3923-ac93-4f74-bdaf-fba1a1c87ff6
                stepCounter: 59cadb79-2e03-4a1c-9c6e-7e6588e89674
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4340252-4189-445a-a8bd-39690937058d
          stepCounter: 8ac21b57-053d-4ec3-8f7e-867909eded5f
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: CONTRACT PUBLIC OR PRIVATE BY SOURCE ENTITY
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f6bf04b-62bd-4173-b272-a52ad5c61f4d
                stepCounter: 59cadb79-2e03-4a1c-9c6e-7e6588e89674
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: 8ac21b57-053d-4ec3-8f7e-867909eded5f
          CONTRACT: 59cadb79-2e03-4a1c-9c6e-7e6588e89674
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (\NSUPPLIERKEY, \NCONTRACTPUBLICORPRIVATEBYSOURCEENTITY\N)\NAS\NWITH CTETEMP \N AS (
                    SELECT DISTINCT SUPPLIERKEY, \N CASE SOURCEENTITYNAME \N --PUBLIC
            \N
                                WHEN 'OMNIA PUBLIC SECTOR'       THEN 'PUBLIC' \N
                                WHEN 'US COMMUNITIES'            THEN 'PUBLIC' \N
                                WHEN 'NATIONAL IPA'              THEN 'PUBLIC' \N
                                WHEN 'VIZIENT'                   THEN 'PUBLIC' \N
                                WHEN 'TCPN'                      THEN 'PUBLIC' \N
                                WHEN 'NCPA'                      THEN 'PUBLIC' \N --PRIVATE
            \N
                                WHEN 'OMNIA PRIVATE SECTOR'      THEN 'PRIVATE' \N
                                WHEN 'CORPORATE UNITED'          THEN 'PRIVATE' \N
                                WHEN 'PRIME ADVANTAGE'           THEN 'PRIVATE' \N
                                WHEN 'INSIGHT GPO'               THEN 'PRIVATE' \N
                                WHEN 'OP PPE'                    THEN 'PRIVATE' \N --OTHER
            \N
                                ELSE 'UNKNOWN' \N
                                 END AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
                      FROM {{ ref('DIM','CONTRACT') }} \N
                     GROUP BY \N SUPPLIERKEY, \N SOURCEENTITYNAME
                   ) \N SELECT \N SUPPLIERKEY, \N LISTAGG(DISTINCT CONTRACTPUBLICORPRIVATEBYSOURCEENTITY, ',') WITHIN GROUP (ORDER BY CONTRACTPUBLICORPRIVATEBYSOURCEENTITY DESC) AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
              FROM CTETEMP \N
             GROUP BY SUPPLIERKEY \N;\N\N
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
