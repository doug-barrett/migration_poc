fileVersion: 1
id: 39a0de1a-f080-4c3e-85b4-1a275db9183c
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0755d2f7-9df9-486e-8d86-65ee8bfb24ff
          stepCounter: 39a0de1a-f080-4c3e-85b4-1a275db9183c
        config: {}
        dataType: INT
        defaultValue: ""
        description: SUPPLIER KEY
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc0cef1f-3af8-4dd2-8564-4bec2c8984e2
                stepCounter: 84116e71-ebf6-4262-b818-71628fbd5079
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cbb825d5-94b1-48f3-993f-c14b061ac447
          stepCounter: 39a0de1a-f080-4c3e-85b4-1a275db9183c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: CONTRACT PUBLIC OR PRIVATE BY SOURCE ENTITY
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e1e2250-a506-4dd3-b205-5d44fc88c591
                stepCounter: 84116e71-ebf6-4262-b818-71628fbd5079
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: 39a0de1a-f080-4c3e-85b4-1a275db9183c
          CONTRACT: 84116e71-ebf6-4262-b818-71628fbd5079
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (\NSUPPLIERKEY, \NCONTRACTPUBLICORPRIVATEBYSOURCEENTITY\N)\NAS\NWITH CTETEMP \N AS (
                    SELECT DISTINCT SUPPLIERKEY, \N CASE SOURCEENTITYNAME \N --PUBLIC
            \N
                                WHEN 'OMNIA PUBLIC SECTOR'       THEN 'PUBLIC' \N
                                WHEN 'US COMMUNITIES'            THEN 'PUBLIC' \N
                                WHEN 'NATIONAL IPA'              THEN 'PUBLIC' \N
                                WHEN 'VIZIENT'                   THEN 'PUBLIC' \N
                                WHEN 'TCPN'                      THEN 'PUBLIC' \N
                                WHEN 'NCPA'                      THEN 'PUBLIC' \N --PRIVATE
            \N
                                WHEN 'OMNIA PRIVATE SECTOR'      THEN 'PRIVATE' \N
                                WHEN 'CORPORATE UNITED'          THEN 'PRIVATE' \N
                                WHEN 'PRIME ADVANTAGE'           THEN 'PRIVATE' \N
                                WHEN 'INSIGHT GPO'               THEN 'PRIVATE' \N
                                WHEN 'OP PPE'                    THEN 'PRIVATE' \N --OTHER
            \N
                                ELSE 'UNKNOWN' \N
                                 END AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
                      FROM {{ ref('DIM','CONTRACT') }} \N
                     GROUP BY \N SUPPLIERKEY, \N SOURCEENTITYNAME
                   ) \N SELECT \N SUPPLIERKEY, \N LISTAGG(DISTINCT CONTRACTPUBLICORPRIVATEBYSOURCEENTITY, ',') WITHIN GROUP (ORDER BY CONTRACTPUBLICORPRIVATEBYSOURCEENTITY DESC) AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
              FROM CTETEMP \N
             GROUP BY SUPPLIERKEY \N;\N\N
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
