fileVersion: 1
id: 5d37693b-7ed8-4928-951f-3389f895c38f
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIA_CONNECT_OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39122840-9c0a-444c-b9c1-7563f6dc08ad
          stepCounter: 5d37693b-7ed8-4928-951f-3389f895c38f
        config: {}
        dataType: INT
        defaultValue: ""
        description: SUPPLIER KEY
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4ddcfa98-9457-429a-934c-5d263e6bb527
                stepCounter: 930a330f-3276-4f21-bd05-9ed55fd63528
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9607e58a-655a-4c49-8cc4-bb1d99d92085
          stepCounter: 5d37693b-7ed8-4928-951f-3389f895c38f
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: CONTRACT PUBLIC OR PRIVATE BY SOURCE ENTITY
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c22df81-de68-445f-b0e9-f2dbcbe9e2ae
                stepCounter: 930a330f-3276-4f21-bd05-9ed55fd63528
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          OPC_SUPPLIER_PUBLICORPRIVATE: 5d37693b-7ed8-4928-951f-3389f895c38f
          CONTRACT: 930a330f-3276-4f21-bd05-9ed55fd63528
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('OMNIA_CONNECT_OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (\NSUPPLIERKEY, \NCONTRACTPUBLICORPRIVATEBYSOURCEENTITY\N)\NAS\NWITH CTETEMP \N AS (
                    SELECT DISTINCT SUPPLIERKEY, \N CASE SOURCEENTITYNAME \N --PUBLIC
            \N
                                WHEN 'OMNIA PUBLIC SECTOR'       THEN 'PUBLIC' \N
                                WHEN 'US COMMUNITIES'            THEN 'PUBLIC' \N
                                WHEN 'NATIONAL IPA'              THEN 'PUBLIC' \N
                                WHEN 'VIZIENT'                   THEN 'PUBLIC' \N
                                WHEN 'TCPN'                      THEN 'PUBLIC' \N
                                WHEN 'NCPA'                      THEN 'PUBLIC' \N --PRIVATE
            \N
                                WHEN 'OMNIA PRIVATE SECTOR'      THEN 'PRIVATE' \N
                                WHEN 'CORPORATE UNITED'          THEN 'PRIVATE' \N
                                WHEN 'PRIME ADVANTAGE'           THEN 'PRIVATE' \N
                                WHEN 'INSIGHT GPO'               THEN 'PRIVATE' \N
                                WHEN 'OP PPE'                    THEN 'PRIVATE' \N --OTHER
            \N
                                ELSE 'UNKNOWN' \N
                                 END AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
                      FROM {{ ref('DIM','CONTRACT') }} \N
                     GROUP BY \N SUPPLIERKEY, \N SOURCEENTITYNAME
                   ) \N SELECT \N SUPPLIERKEY, \N LISTAGG(DISTINCT CONTRACTPUBLICORPRIVATEBYSOURCEENTITY, ',') WITHIN GROUP (ORDER BY CONTRACTPUBLICORPRIVATEBYSOURCEENTITY DESC) AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
              FROM CTETEMP \N
             GROUP BY SUPPLIERKEY \N;\N\N
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
