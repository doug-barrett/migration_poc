fileVersion: 1
id: 32be66ae-7ab8-4a8c-a729-968068619e81
name: DS_SHARED_WAITLIST_PREV_NEXT_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "Detals of the previous and next waitlist row for each patient."
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adf3b0d6-025f-44da-aca4-a0a3d604b1e6
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe7a1419-49fc-499c-bac9-a0f152bbfed1
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 275045d6-d701-4a5b-8aaa-a9843b48441b
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5cebdce7-6246-42e3-9d88-6e8a2146f313
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe1f831d-2dae-4cb7-b10e-3d0daaef38b4
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c89147c5-3b1f-49d8-b697-55d69c6d2d10
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef329a40-49cb-4a8f-9dea-5bd893fff23d
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92e1891e-46c9-403d-a095-01d983763c82
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57b859d0-a917-4688-b1e5-14ba0b1a9a94
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb955197-34ef-4db0-ba29-6f6adfe8f3c2
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 778239df-6676-45bd-ad49-c24613e1ba4f
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 148a4ae3-5406-4d3c-9b09-4ce804692969
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 155cd41b-4c31-4a6a-aac9-bb34b8acdacc
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6437576f-d342-4c32-984f-dee4bfd414a3
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_SPECIALTY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41f6c708-4784-49cd-9839-efc078059561
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEXT_WAITLIST_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d53bc7e-2d63-410d-b28e-08ed01a2b2ab
          stepCounter: 32be66ae-7ab8-4a8c-a729-968068619e81
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PREV_SUSPENSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 108745a8-e30a-4861-8c09-38539d9ad3c3
                stepCounter: 72f452f1-9019-48ad-84d5-32c30b227681
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT curr.wlist_refno waitlist_reference_no ,
                   curr.wlist_date waitlist_date ,
                   curr.refrl_refno referral_reference_no ,
                   curr.spect_refno waitlist_specialty_reference_no ,
                   curr.proca_refno waitlist_clinician_reference_no ,
                   prev.wlist_refno prev_waitlist_reference_no ,
                   prev.wlist_date prev_waitlist_date ,
                   prev.refrl_refno prev_referral_reference_no ,
                   prev.spect_refno prev_waitlist_specialty_reference_no ,
                   prev.proca_refno prev_waitlist_clinician_reference_no ,
                   next.wlist_refno next_waitlist_reference_no ,
                   next.wlist_date next_waitlist_date ,
                   next.refrl_refno next_referral_reference_no ,
                   next.spect_refno next_waitlist_specialty_reference_no ,
                   next.proca_refno next_waitlist_clinician_reference_no ,
                   IFNULL(map.NPF_suspension_exception,0) prev_suspension
              FROM ds_shared_waitlist curr
              LEFT OUTER JOIN ds_shared_waitlist prev
                ON prev.patnt_refno = curr.patnt_refno
               AND prev.patient_waitlist_seq_num = curr.patient_waitlist_seq_num - 1
              LEFT OUTER JOIN ds_shared_waitlist NEXT
                ON next.patnt_refno = curr.patnt_refno
               AND next.patient_waitlist_seq_num = curr.patient_waitlist_seq_num + 1
              LEFT OUTER JOIN ds_shared_waitlist prev_r
                ON prev_r.patnt_refno = curr.patnt_refno
               AND prev_r.patient_referral_waitlist_seq_num = curr.patient_referral_waitlist_seq_num - 1
               AND prev_r.refrl_refno = curr.refrl_refno
              LEFT OUTER JOIN l_mappings_WaitlistCategories map
                ON map.wlrul_refno = prev_r.local_wlrul_refno
        dependencies:
          - locationName: TGT
            nodeName: DS_SHARED_WAITLIST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_SHARED_WAITLIST') }}
        name: DS_SHARED_WAITLIST_PREV_NEXT_V
        noLinkRefs: []
  name: DS_SHARED_WAITLIST_PREV_NEXT_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
