fileVersion: 1
id: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
name: S_ALLIED_HEALTH_ENCOUNTER
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Link encounters defined in Allied Health with the patient dimension."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2c236c5-a318-4693-8f9c-1f992938f654
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: VARCHAR(9)
        defaultValue: ""
        description: Id that uniquely identifies the encounter in Allied Health.
        name: ALLIED_HEALTH_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b8c80e1c-c5e9-4a54-b2b5-5083d4fd0088
                stepCounter: 18b96b05-c87a-4553-806a-82a94005c085
            transform: RTRIM(l_tcare_InpatientEncounter.inpPatientReference)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b62c9526-ac21-4fc3-b102-da150d7fb070
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: Unique business identifier for inpatient event.
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6b755ef-8dd2-4092-aa40-54f9db2f2a04
                stepCounter: 18b96b05-c87a-4553-806a-82a94005c085
            transform: RTRIM(l_tcare_InpatientEncounter.inpLastEOCNumber)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c7ace5d-297d-4714-b0d8-531430ae4ba9
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient NHI number.
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0940be4-b7d6-4ecc-80b3-bee89462dfb1
                stepCounter: 18b96b05-c87a-4553-806a-82a94005c085
            transform: RTRIM(l_tcare_InpatientEncounter.inpPatientNumber)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57f1e950-8714-470f-b8b6-f0795239650b
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: 'Internal unique identifier for a patient from the Patient Management System '
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 702dfc9d-df5e-42d8-86f8-9e68f29c462c
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc87374d-d42b-418a-81cf-fc734d7bf272
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: Allied Health discharge ward code.
        name: DISCHARGE_WARD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6af276b9-81b4-4edb-9828-345108c5ad24
                stepCounter: 18b96b05-c87a-4553-806a-82a94005c085
            transform: NULLIF(RTRIM(inpDischargeWardCode), '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68ffec0c-081c-4f7c-8309-ff750880cd45
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: The PiMS ward code that maps to the Allied Health discharge ward code.
        name: PIMSWARDCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e0ef9ddb-0b61-487d-ab0d-ad159fdeed0e
                stepCounter: 1bd6e63a-9925-418b-9449-acaed616a7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 513e9099-d47c-4528-8b67-705c5b48f0b2
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Service_Point_Reference_Number
        name: WARD_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe4759bc-c968-4e0b-95f7-850118a3d88b
                stepCounter: 50c31151-9204-4154-9caf-5d28244bde1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f359ea68-0c41-46ca-be3d-73aaa9045c2d
          stepCounter: 87df5a4f-d5d5-47f9-bd8c-1a1e85133acc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_TCARE_INPATIENTENCOUNTER
        join:
          joinCondition: |-
            FROM l_tcare_InpatientEncounter
              LEFT OUTER JOIN dim.dim_patient
                ON dim_patient.patient_nhi = l_tcare_InpatientEncounter.inpPatientNumber
               AND dim_patient.NHI_sequence = 1
              LEFT OUTER JOIN l_mappings_WardsTC
                ON l_mappings_WardsTC.wdWardCode = l_tcare_InpatientEncounter.inpDischargeWardCode
               AND l_mappings_WardsTC.End_Date IS NULL
              LEFT OUTER JOIN dim.dim_ward
                ON dim_ward.ward_code = l_mappings_WardsTC.PiMSWardCode
               AND dim_ward.dss_current_flag = 'Y'
               AND LEFT(dim_ward.ward_name, 3) <> 'XXX'
        name: S_ALLIED_HEALTH_ENCOUNTER
        noLinkRefs: []
  name: S_ALLIED_HEALTH_ENCOUNTER
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
