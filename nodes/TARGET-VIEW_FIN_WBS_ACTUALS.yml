fileVersion: 1
id: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
name: VIEW_FIN_WBS_ACTUALS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16706c38-122e-4015-8b2b-247928c2c986
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: WBS_ELEMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1d82d36-1c18-4ea0-ac08-1be6e06555bb
                stepCounter: 0ababbaf-41b3-4bd0-a251-c8aab7eb6948
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e6fe3a5-e5b9-4aa0-9469-862842523ff1
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: WBS_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 636d0a54-887c-4824-b158-bdb53d5fb06d
                stepCounter: 0ababbaf-41b3-4bd0-a251-c8aab7eb6948
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 267d710f-5fb7-4849-9ee2-c55022f36351
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29722a03-29be-40ea-86d4-b02403f924a2
                stepCounter: 99b4a618-454e-46de-874d-ad30b4d42108
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7719c8df-cdd0-4ec1-97f4-f326eda2e1f4
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_UUID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c2705d9c-79fd-43af-9c02-dbb7f6ee418c
                stepCounter: 088ecd9c-d865-4943-85ca-d981bacfe3b6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 674b3653-6c34-4f47-a8f9-f6a8d9875155
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0531083-75c3-40ab-9120-804f63efb3a4
                stepCounter: 030f9454-0584-4b79-8319-768ccf1fc4ab
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79b47f1c-0593-437e-8878-230e2697d4d4
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d13919f-c041-49de-a1aa-3af21787b41d
                stepCounter: eded27ac-fd68-4b41-8110-94b692c365d5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b918266-8e3b-42e8-9019-8836e68fb289
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: NET_CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e055e314-18ce-4bff-80b0-f5d4899a6259
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: WBS_GROSS_CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4bd21b1a-7a56-49c8-bc9a-58fe67ae6a43
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: NET_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd659b15-7e79-4542-93a3-836a75bdaf23
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92ae5bec-6785-4ce0-84f6-01509d00a8c1
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: WBS_GROSS_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b19499b0-75fa-4602-ba7e-b09928030a82
          stepCounter: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7cf83eb-0256-4f0f-9d7e-6e63f4d3ac83
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_FIN_WBS_ACTUALS: e3cd9be4-ec5c-45c4-bec1-b253830bce6a
          DIM_LO_SAP_AFE: 0ababbaf-41b3-4bd0-a251-c8aab7eb6948
          DIM_LO_SAP_AFE_TYPE: f1879670-70ca-4133-bc5d-193fd6cd9104
          FACT_LO_SAP_LEASE_OPS: 5056d5d9-0fcf-47de-8ff6-c885edbeaf96
          DIM_LO_SAP_ACCT_PER_DATE: 030f9454-0584-4b79-8319-768ccf1fc4ab
          DIM_LO_SAP_LEDGER: 231e86b2-e335-450f-b991-fc6aa2c2fe4c
          DIM_LO_SAP_GROSS_NET: 592816dc-3717-40cf-ac36-2ff66c9e8146
          DIM_LO_SAP_GL_ACCOUNT: eded27ac-fd68-4b41-8110-94b692c365d5
          DIM_LO_SAP_COST_CENTER: 99b4a618-454e-46de-874d-ad30b4d42108
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_FIN_WBS_ACTUALS') }} AS SELECT DA.AFE_NUM "WBS_ELEMENT",
                   DA.AFE_TYPE_CODE "WBS_TYPE",
                   DCC.CC_NUM "COST_CENTER",
                   ZMP.ENTITY_UUID,
                   DAPD.DATE "ACCT_PER_DATE",
                   DGA.ACCOUNT,
                   FLO.CAD_AMT "NET_CAD_AMT",
                   DECODE(NVL(DA.VET_WBS_WI,0),0,0,ROUND(100 * NVL(FLO.CAD_AMT,0) / NVL(DA.VET_WBS_WI,0),2)) WBS_GROSS_CAD_AMT,
                   FLO.OP_AMT "NET_OP_AMT",
                   DECODE(NVL(DA.VET_WBS_WI,0),0,0,ROUND(100 * NVL(FLO.OP_AMT,0) / NVL(DA.VET_WBS_WI,0),2)) WBS_GROSS_OP_AMT,
                   FLO.OP_CURR_CODE
              FROM {{ ref('TARGET','DIM_LO_SAP_AFE') }} DA
              JOIN {{ ref('TARGET','DIM_LO_SAP_AFE_TYPE') }} DAT
                ON (DA.DIM_AFE_TYPE_KEY = DAT.DIM_AFE_TYPE_KEY)
              JOIN {{ ref('TARGET','FACT_LO_SAP_LEASE_OPS') }} FLO
                ON (FLO.DIM_AFE_KEY = DA.DIM_AFE_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_ACCT_PER_DATE') }} DAPD
                ON (FLO.DIM_ACCT_PER_DATE_KEY = DAPD.DIM_ACCT_PER_DATE_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_LEDGER') }} DL
                ON (FLO.DIM_LEDGER_KEY = DL.DIM_LEDGER_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_GROSS_NET') }} DGN
                ON (FLO.DIM_GROSS_NET_KEY = DGN.DIM_GROSS_NET_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_GL_ACCOUNT') }} DGA
                ON (FLO.DIM_GL_ACCOUNT_KEY = DGA.DIM_GL_ACCOUNT_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_COST_CENTER') }} DCC
                ON (FLO.DIM_COST_CENTER_KEY = DCC.DIM_COST_CENTER_KEY)
              LEFT JOIN DS_SAP.ZCZFINMOSAICPRJ ZMP
                ON DA.CORP_PLANNING_PROJECT = ZMP.ZZMOSAIC_PRJ
             WHERE DA.DIM_AFE_KEY <> 0
               AND DGN.GROSS_OR_NET_CODE = 'N'
               AND DL.LEDGER_CODE = '{{ parameters.SAP_LEADING_LEDGER_CODE }}'
        dependencies:
          - locationName: TARGET
            nodeName: DIM_LO_SAP_AFE
          - locationName: TARGET
            nodeName: DIM_LO_SAP_AFE_TYPE
          - locationName: TARGET
            nodeName: FACT_LO_SAP_LEASE_OPS
          - locationName: TARGET
            nodeName: DIM_LO_SAP_ACCT_PER_DATE
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEDGER
          - locationName: TARGET
            nodeName: DIM_LO_SAP_GROSS_NET
          - locationName: TARGET
            nodeName: DIM_LO_SAP_GL_ACCOUNT
          - locationName: TARGET
            nodeName: DIM_LO_SAP_COST_CENTER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','DIM_LO_SAP_AFE') }}
            {{ ref('TARGET','DIM_LO_SAP_AFE_TYPE') }}
            {{ ref('TARGET','FACT_LO_SAP_LEASE_OPS') }}
            {{ ref('TARGET','DIM_LO_SAP_ACCT_PER_DATE') }}
            {{ ref('TARGET','DIM_LO_SAP_LEDGER') }}
            {{ ref('TARGET','DIM_LO_SAP_GROSS_NET') }}
            {{ ref('TARGET','DIM_LO_SAP_GL_ACCOUNT') }}
            {{ ref('TARGET','DIM_LO_SAP_COST_CENTER') }}
        name: VIEW_FIN_WBS_ACTUALS
        noLinkRefs: []
  name: VIEW_FIN_WBS_ACTUALS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
