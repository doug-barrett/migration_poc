fileVersion: 1
id: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
name: VIEW_FIN_WBS_ACTUALS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2adde7ef-6805-4c6a-add7-6eaed0387d8a
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: WBS_ELEMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 270699d5-caa0-4a2a-bb87-9c4903a4317d
                stepCounter: d581a60e-c37c-4e7b-a259-5faf3ac3ff93
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 71231e22-2dcc-40ca-aeaf-4b1f4d4dd597
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: WBS_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ac01e489-c141-4acd-a2a4-fd09e03f56c1
                stepCounter: d581a60e-c37c-4e7b-a259-5faf3ac3ff93
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a840d171-e067-4559-b589-7664a1c7454f
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d28aa41c-a9a8-4fe7-be64-2f4058706ecd
                stepCounter: f601baef-839f-49ab-b102-ee3fad93f21c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d384b20-37cc-4ab1-bb9b-f3df07d7931f
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_UUID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 666c78bb-d9cd-4d76-bed1-e98e0df70ce2
                stepCounter: dc8a0563-c4d8-4f59-ae8e-d5ee1e838372
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ea81837-12e5-4434-be6e-9305f4177383
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 45fe8510-7013-4779-ad36-b2fca6a58b30
                stepCounter: 16046caa-0e21-4501-abd9-fc6a817b0803
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d325deea-a2eb-46f0-a887-b22da9427e79
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 591aaa3e-043e-4bb4-809a-85367e86d7a3
                stepCounter: 435a18b2-1dc7-4fc8-b5d0-3eab3af614fd
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6cec3c2-e3cd-4711-a780-4a4265390fd4
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: NET_CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f4c9f97-c943-4afb-ab5f-08911bd1fc48
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: WBS_GROSS_CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38888729-f82f-416f-9dfd-50273d834048
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: NET_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 04b4957d-47de-4f6b-9a2d-5f35272bf96a
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c921ab5-3d5a-4676-bf6c-c2b5d4716f21
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: WBS_GROSS_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 28f8d590-7847-4e2b-9107-e79cbb1c7cd6
          stepCounter: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f14caff-f556-4ed1-9a4a-942bbe4aff82
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_FIN_WBS_ACTUALS: 4ebe4beb-757d-4137-8ea3-9642058f9bbc
          DIM_LO_SAP_AFE: d581a60e-c37c-4e7b-a259-5faf3ac3ff93
          DIM_LO_SAP_AFE_TYPE: f93a8e45-7804-49aa-b6a3-966e768997dc
          FACT_LO_SAP_LEASE_OPS: e18b78ec-51b6-4772-bef1-4d3d9c5be49e
          DIM_LO_SAP_ACCT_PER_DATE: 16046caa-0e21-4501-abd9-fc6a817b0803
          DIM_LO_SAP_LEDGER: e8524c23-d9e0-4d83-86ae-428803327912
          DIM_LO_SAP_GROSS_NET: 38bc0451-df93-413f-b149-93d0fd46c572
          DIM_LO_SAP_GL_ACCOUNT: 435a18b2-1dc7-4fc8-b5d0-3eab3af614fd
          DIM_LO_SAP_COST_CENTER: f601baef-839f-49ab-b102-ee3fad93f21c
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_FIN_WBS_ACTUALS') }} AS SELECT DA.AFE_NUM "WBS_ELEMENT",
                   DA.AFE_TYPE_CODE "WBS_TYPE",
                   DCC.CC_NUM "COST_CENTER",
                   ZMP.ENTITY_UUID,
                   DAPD.DATE "ACCT_PER_DATE",
                   DGA.ACCOUNT,
                   FLO.CAD_AMT "NET_CAD_AMT",
                   DECODE(NVL(DA.VET_WBS_WI,0),0,0,ROUND(100 * NVL(FLO.CAD_AMT,0) / NVL(DA.VET_WBS_WI,0),2)) WBS_GROSS_CAD_AMT,
                   FLO.OP_AMT "NET_OP_AMT",
                   DECODE(NVL(DA.VET_WBS_WI,0),0,0,ROUND(100 * NVL(FLO.OP_AMT,0) / NVL(DA.VET_WBS_WI,0),2)) WBS_GROSS_OP_AMT,
                   FLO.OP_CURR_CODE
              FROM {{ ref('TARGET','DIM_LO_SAP_AFE') }} DA
              JOIN {{ ref('TARGET','DIM_LO_SAP_AFE_TYPE') }} DAT
                ON (DA.DIM_AFE_TYPE_KEY = DAT.DIM_AFE_TYPE_KEY)
              JOIN {{ ref('TARGET','FACT_LO_SAP_LEASE_OPS') }} FLO
                ON (FLO.DIM_AFE_KEY = DA.DIM_AFE_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_ACCT_PER_DATE') }} DAPD
                ON (FLO.DIM_ACCT_PER_DATE_KEY = DAPD.DIM_ACCT_PER_DATE_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_LEDGER') }} DL
                ON (FLO.DIM_LEDGER_KEY = DL.DIM_LEDGER_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_GROSS_NET') }} DGN
                ON (FLO.DIM_GROSS_NET_KEY = DGN.DIM_GROSS_NET_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_GL_ACCOUNT') }} DGA
                ON (FLO.DIM_GL_ACCOUNT_KEY = DGA.DIM_GL_ACCOUNT_KEY)
              JOIN {{ ref('TARGET','DIM_LO_SAP_COST_CENTER') }} DCC
                ON (FLO.DIM_COST_CENTER_KEY = DCC.DIM_COST_CENTER_KEY)
              LEFT JOIN DS_SAP.ZCZFINMOSAICPRJ ZMP
                ON DA.CORP_PLANNING_PROJECT = ZMP.ZZMOSAIC_PRJ
             WHERE DA.DIM_AFE_KEY <> 0
               AND DGN.GROSS_OR_NET_CODE = 'N'
               AND DL.LEDGER_CODE = '{{ parameters.SAP_LEADING_LEDGER_CODE }}'
        dependencies:
          - locationName: TARGET
            nodeName: DIM_LO_SAP_AFE
          - locationName: TARGET
            nodeName: DIM_LO_SAP_AFE_TYPE
          - locationName: TARGET
            nodeName: FACT_LO_SAP_LEASE_OPS
          - locationName: TARGET
            nodeName: DIM_LO_SAP_ACCT_PER_DATE
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEDGER
          - locationName: TARGET
            nodeName: DIM_LO_SAP_GROSS_NET
          - locationName: TARGET
            nodeName: DIM_LO_SAP_GL_ACCOUNT
          - locationName: TARGET
            nodeName: DIM_LO_SAP_COST_CENTER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','DIM_LO_SAP_AFE') }}
            {{ ref('TARGET','DIM_LO_SAP_AFE_TYPE') }}
            {{ ref('TARGET','FACT_LO_SAP_LEASE_OPS') }}
            {{ ref('TARGET','DIM_LO_SAP_ACCT_PER_DATE') }}
            {{ ref('TARGET','DIM_LO_SAP_LEDGER') }}
            {{ ref('TARGET','DIM_LO_SAP_GROSS_NET') }}
            {{ ref('TARGET','DIM_LO_SAP_GL_ACCOUNT') }}
            {{ ref('TARGET','DIM_LO_SAP_COST_CENTER') }}
        name: VIEW_FIN_WBS_ACTUALS
        noLinkRefs: []
  name: VIEW_FIN_WBS_ACTUALS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
