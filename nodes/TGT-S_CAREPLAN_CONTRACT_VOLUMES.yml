fileVersion: 1
id: ca3d7c8a-189c-4bce-9f99-69db552963f9
name: S_CAREPLAN_CONTRACT_VOLUMES
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e233e2ad-9cf0-4d32-996a-9e4705ec6e89
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 203426e6-90b1-4671-9b1f-3401de1f9512
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd8c908e-ab85-473b-8a36-701479bd4781
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: links back to encounter in fact careplan community
        name: SOURCE_ENCOUNTER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31a438f3-7385-44b4-8a4f-d4041e989e93
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c317b13-0e88-4d7c-a5ca-f483f805dbba
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: based on the careplan identifier altered to reflect the contract grain
        name: ACTIVE_CAREPLAN_MONTH_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8966cbe2-8bf9-4a48-b8d4-15768abbf4b1
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d0387518-2cd7-4972-8339-2c34ff12b28d
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b32a38e9-9e35-468b-b6d8-939af9383a56
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 841025b4-9d14-467b-8dd4-d4337c27235e
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_DOMICILE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e559bf8c-5bb3-4bca-b023-558a17fb2615
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06972060-8e37-4de2-b572-516371fc621c
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: phase_start_date
        name: PHASE_START_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a76c6ab-e4ec-45a5-a4c4-9b0ca5f71b4d
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe222462-72d1-4866-a45d-5a1db2c2bd9c
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: phase_end_date
        name: PHASE_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 356231b7-f19e-4fd3-a0e2-d71e654c107a
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f08fe04-6dbe-4b2b-9d9c-b7ca25e8a3b3
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_CONTRACT_MONTH_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 725146a6-f830-48c6-9fab-993f0e6ae72e
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4be93bee-4a96-43cc-bd01-0a2306cf9ff8
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CONTRACT_MONTH_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 302f6b19-f97e-442e-9a7d-dcf640445638
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91697fea-c91b-423d-98d9-1757ed60237b
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: purchase_unit_volume
        name: PURCHASE_UNIT_VOLUME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7157d2a8-b0ab-464d-9dd9-d727dd43b337
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d4d85db-634e-4768-b496-be0b7598ec5a
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_CAREPLAN_COMMUNITY_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: defc2433-9275-46ca-85a1-bb6f8072418a
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9eb4b63b-a166-4f3c-b0d1-6ab1d859142e
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: presenting_issue_category_desc
        name: PRESENTING_ISSUE_CATEGORY_DESC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c239543b-ad58-47f8-a3af-469559ae0598
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5fb95ac2-a92a-4904-ac24-81e87c7b5244
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: YEAR_OFFSET
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b822f331-aeb1-4d6a-abab-058a6e89d7ff
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c3d9aa5-a3dc-4b7e-bef8-b95b321fb4b7
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_careplan_contract_volumes.purchase_unit_code=dim_purchase_unit.purchase_unit_code
        name: DIM_PURCHASE_UNIT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d9c041f-76d6-44c7-8d88-936673dfd7a0
                stepCounter: d198650d-0f77-489d-92ec-0c0257cd5a43
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc127ed8-0ed4-4cbb-9e6d-6c0dd1b61c43
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b94c028-7535-49a3-8c53-6b17f08531d9
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1c2b2fff-726d-4cd9-84fc-cbbd1f7f8743
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: careplan_month
        name: CAREPLAN_MONTH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 04ca0609-d8ee-4a36-b948-ac1315c0d99b
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eedc28bc-55e3-47d5-ba57-6101f5bb49c0
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: Used to work around duplicate phases of care
        name: UNIQUE_MONTH_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY s_careplan_contract_volumes_v.patient_NHI, s_careplan_contract_volumes_v.careplan_month, s_careplan_contract_volumes_v.purchase_unit_code ORDER BY s_careplan_contract_volumes_v.contract_month_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10a9e1ca-afc2-48f8-b51c-5edbf4375c5e
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: INT
        defaultValue: ""
        description: NNPAC_volume, is one volume for the first month in the year the careplan is open
        name: NNPAC_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6561448-ed0b-4782-adc8-59540a3186bc
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a2ce123-82b4-4770-bea0-6d09c3127876
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: SEEN_BY_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 983535ff-6457-4943-bef9-a084d2bd5543
                stepCounter: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4688c8f-fb39-45f3-9b8c-300ed48a4ab4
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: responsibility_centre_code
        name: RESPONSIBILITY_CENTRE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcc5a104-7de7-45c0-b498-af1c338506f4
          stepCounter: ca3d7c8a-189c-4bce-9f99-69db552963f9
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_CAREPLAN_CONTRACT_VOLUMES_V: 4f9eee1c-eb4c-4ef6-a0a1-5c130b9a76a4
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_CAREPLAN_CONTRACT_VOLUMES_V
        join:
          joinCondition: FROM {{ ref('TGT','S_CAREPLAN_CONTRACT_VOLUMES_V') }}
        name: S_CAREPLAN_CONTRACT_VOLUMES
        noLinkRefs: []
  name: S_CAREPLAN_CONTRACT_VOLUMES
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
