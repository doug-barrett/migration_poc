fileVersion: 1
id: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
name: S_ADMIN_CATEGORY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ad8046b-b778-4ece-aade-b6d78650ef9b
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50a16503-e02d-41b0-8921-ddab44d5d208
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5904edc-1c01-43be-ac62-fce09eb24097
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 751cfda2-ee4a-4d2d-a764-7b5bc5122b00
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PURCHASER_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b945653-9635-44fe-b12a-70993970380c
                stepCounter: b2fe2009-e544-4b28-af89-e952d2cfa941
            transform: IFNULL(l_reference_MOH_Purchaser.purchaser_description,'Unassigned')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e283075d-f581-4091-b5e3-ef1846f6684c
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d93e8a96-b2c6-4ecb-bd0a-f2f089d15d02
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e51cb46-ba05-40cf-968f-cbb735a90630
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b83a3aaf-eb08-4e0f-b5c8-1be21d38ef47
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8ba7b2a-a976-4c3a-a51e-01fee76ca4c5
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_REFERENCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc52b689-cd00-4eb4-ae6e-f2b338d8975a
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cddd67b4-99e5-48d5-8fce-2177d4cead9f
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: PURCHASER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9ce7367a-f4c2-464a-892d-1113c64f272e
                stepCounter: a1739b5c-4d46-4e43-8d42-5d6c977147f2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0bb027c9-d0de-4511-a80d-0233ec47805f
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(150)
        defaultValue: ""
        description: ""
        name: PURCHASER_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bd154e67-abf0-4f95-8e82-cf878143a1c0
                stepCounter: a1739b5c-4d46-4e43-8d42-5d6c977147f2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 863069bd-c024-4663-8e31-1efba38ee6f0
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: FUNDING_AGENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e906aa5-8172-4126-a668-6baf2d8718b9
                stepCounter: a1739b5c-4d46-4e43-8d42-5d6c977147f2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d6676a0-a9c7-4c8e-9cb5-bf8884290387
          stepCounter: 74f3aa94-9c0a-45fa-82b0-85d01b14d1ec
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_MAPPINGS_ADCAT_PURCHASER: a1739b5c-4d46-4e43-8d42-5d6c977147f2
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_REFERENCE_VALUES
          - locationName: TGT
            nodeName: L_MAPPINGS_ADCAT_PURCHASER
        join:
          joinCondition: |-
            FROM ds_pims_reference_values
              LEFT OUTER JOIN (
                    SELECT r.rfval_refno,
                           r.identifier,
                           p.purchaser_description
                      FROM ds_pims_reference_value_ids r
                     INNER JOIN l_reference_MOH_purchaser p
                        ON r.identifier = p.purchaser_code
                       AND rityp_code IN ('NZNHI')
                   ) l_reference_MOH_purchaser
                ON ds_pims_reference_values.rfval_refno = l_reference_MOH_purchaser.rfval_refno
              LEFT OUTER JOIN {{ ref('TGT','L_MAPPINGS_ADCAT_PURCHASER') }}
                ON ds_pims_reference_values.rfval_refno = l_mappings_AdCat_Purchaser.RFVAL_REFNO
               AND getdate() BETWEEN l_mappings_AdCat_Purchaser.Start_date AND IFNULL(l_mappings_AdCat_Purchaser.End_date,dateadd(DAY,1000,getdate()))
             WHERE rfvdm_code = 'ADCAT' --and ds_pims_reference_values.dss_update_time > @v_pa_referral_incremental
        name: S_ADMIN_CATEGORY
        noLinkRefs: []
  name: S_ADMIN_CATEGORY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
