fileVersion: 1
id: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6fdc5bbd-9678-46a8-9557-934e0157326e
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: DIM_WELL_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52601fc0-68e1-4e5f-876a-00645d2f467e
                stepCounter: d08539ff-37af-4c21-9836-963dca56c39d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd816d25-f31f-4b39-8a11-08b553d5db2d
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMP_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f76be576-f021-42f1-a5bc-c6dfa35d25fb
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88b2f57d-dad9-4060-8d78-744bf124896c
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TUBING_PRESSURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ee6f2c1-12c9-4465-b37b-154bba143d3c
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a1ed75a-dcce-4795-8699-1762ef8f9c7e
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CASING_PRESSURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cc4c5c0-41bd-4baf-9231-65a7b10166d3
                stepCounter: 9108fb02-8d09-48b3-ba27-88a8ce494c39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c911c018-f697-4033-9298-0b925ddc0265
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4af2b4d1-f446-41f6-aa52-467522375d92
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 724136dd-2030-4870-b606-e299cee51570
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPPUMPROD_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bd43553-d206-4ff5-9039-3098a5a69bee
                stepCounter: 08038d68-863c-4792-a2f6-e7a314c9887a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49e60247-18e2-46e0-825d-ef9c855d1070
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPPUMPRODENTRY_IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09afad9b-2f1e-481b-acea-a8397c232731
                stepCounter: 50036d71-fe59-4721-acb7-224077daf923
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dfd85ae7-dbef-437a-b3b3-3378e82162c0
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPTEST_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e2301cc-9971-48aa-a328-dac866ae911a
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3dd858a1-184e-472b-b5fc-d78a3c25c435
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_ACTIVITY_PERIOD_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4af52595-84cb-4015-9b7d-71cd8287ad95
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 757c717f-fedb-48dd-9344-3e1492fa8cb1
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SEPARATOR_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6fd90d4-cff0-430c-9ab8-223caad05586
                stepCounter: 26ea0c83-0b1c-4874-b9de-a7b8ce5183c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90ca0a70-d7f0-4e5d-9fee-a742232d7322
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5fe2619e-4e3a-46d9-ba7e-3641a9f243ed
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8980550-a351-42a0-beb7-14d695c46805
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 53eca316-41ed-4c1c-9e83-57d4275755dd
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc085f19-797c-43d3-bba3-a6ee992ff2d6
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 058c4f00-f899-4c92-8283-42e91dcd2a05
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ff5e368-be44-4799-80f6-5e4d49030bf5
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TYP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 35a1d5a5-e3ac-45c3-81a4-bd40d55bdf8d
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3cf4391a-d529-4145-b1c0-6c7c8e0b581b
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: JSD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d09e0d51-1790-4317-b451-a4c62290bab9
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffca63a0-9b8e-4904-ae4a-d80607de134d
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: JACK_RATIO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 096b9036-f47d-49c9-805a-8e32865befd8
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f971098a-4fc6-4eef-ab71-039d3dbe29cb
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BELT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cb8dea7-d7b5-41d0-8ab8-a61205243f7a
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96cc25cf-7d5b-493f-b803-cf986b8bf131
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: MOTOR_HP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7acafaf4-212f-46b8-8742-99e0a3514688
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eaa36f78-c1ca-42d3-a85f-31e0d09098dc
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: RPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d5128ae1-34dd-44b4-b599-6a9c1af7c681
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcb1c6b6-1032-4291-9336-045bad7fd893
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: MSD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4088797c-20f8-4393-8f81-8fb65244c766
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf3fc4e0-300e-4368-93b8-f62d38486e63
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: CT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0bff93a3-da04-44e9-a823-7ea92e178401
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e2bd3f1-f6fd-48cc-b958-e6959b1be79a
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4db333a6-67e1-47f9-b565-c74a7bdd7143
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 834c1a30-8ed8-471c-94ef-15afb4f5efe6
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0e3cf405-86ef-4166-abf6-a72c7a2baa74
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b096c671-2ffd-4237-bab5-a5271d407921
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d36893a0-5866-48b9-9c4c-162fbfa1c8ee
                stepCounter: 627d46a4-df01-44cb-b382-a289091c63cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97312ff9-921c-40ab-a48f-79cd4c53532f
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: STROKELENGTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d2ecef26-a0b0-4a0f-9e1b-c82ec42c7f21
                stepCounter: 50036d71-fe59-4721-acb7-224077daf923
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da138eb0-2588-4bdd-b8e3-5594ba79e31d
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3570bf61-263b-4a27-bc46-2eb33a0473e1
                stepCounter: 50036d71-fe59-4721-acb7-224077daf923
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f99c1a0b-9856-4d86-98c1-dc380e3f9e40
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PUMPDIAMETER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b10e371-c89c-4e70-be25-62ab43f4cdc3
                stepCounter: 08038d68-863c-4792-a2f6-e7a314c9887a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4ee7463-1238-41dc-9c2f-79a75cb301e9
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEFLUIDTOTALCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 57494cf0-50b3-44e0-9a92-ce4afb9d3fee
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7df15882-1fd7-43d3-ae8e-18d1ce26b1f0
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: TEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4af52595-84cb-4015-9b7d-71cd8287ad95
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90c4edd2-220c-480f-a14e-7ec0b2c93ae8
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEWATERCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0157618-ad60-44e0-8f3e-b49ad806bf04
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5992c0b1-dfe7-4f6b-b5cc-8958efbaba3e
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEPRODGASCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 89088173-631b-4ee9-80ea-92c2207adf9d
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d6e884c-5d7e-4bbc-917e-bf2dd4e3be7b
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BSWTOTALCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f9237edc-5a04-42f8-9ac6-ac96aba538d5
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f2484a8-59aa-47da-a711-d5760c69d858
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GORCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4dd77203-5df4-46d1-9515-b82c07f267b3
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47bfa0ef-f082-4dd2-bfa9-1300b9d28bca
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CODEDOWNTM3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87418533-315d-45d4-9a5b-86c249519bb9
                stepCounter: 74f44647-9ca6-45b0-bbe0-7eba25f1476b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab3f3526-edec-4b4d-8756-5748793ac520
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DT_FIRST_DAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f451cb4a-7adc-4ac7-8eac-e419524513bb
                stepCounter: 74f44647-9ca6-45b0-bbe0-7eba25f1476b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ada70373-225b-4897-9cb8-a1cab994a2e7
          stepCounter: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEHCLIQCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df972ffa-374c-4b51-a9ab-f05fe8e9a22d
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_FACT_FDC_PRODVIEW_WELL_TESTS: 5f8d9d3e-d30c-457f-b4ad-5ad780fa8b92
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_FACT_FDC_PRODVIEW_WELL_TESTS') }} AS WITH EQUIPMENT AS (
                    SELECT E.NAME ,
                           E.IDRECPARENT ,
                           E.TYP ,
                           E.MAKE ,
                           E.MODEL ,
                           E.IMPORTID1 AS JSD ,
                           E.IMPORTID2 AS JACK_RATIO ,
                           E.IMPORTTYP1 AS BELT ,
                           E.EXPORTID2 AS MOTORHP ,
                           E.IMPORTTYP2 AS RPM ,
                           E.EXPORTID1 AS MSD ,
                           E.COM AS CT ,
                           E.EXPORTTYP1 AS CM ,
                           E.EXPORTTYP2 AS CMOD ,
                           E.OTHERID AS CTYP
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITEQUIP E
                     WHERE E.NAME = 'Surface Equipment'
                       AND E.DSS_CURRENT_FLAG = 'Y'
                       AND E.DSS_DELETE_FLAG != 'Y'
                   ) ,
                   PUMPS AS (
                    SELECT RE.IDREC ,
                           RE.IDRECPARENT ,
                           RE.STROKELENGTH * 39.3700787 AS STROKE_LENGTH ,
                           RE.SPM ,
                           R.PUMPDIAMETER * 39.3700787 AS PUMP_DIAMETER ,
                           P.DTTMSTART AS BH_PUMP_INSTALL_DATE
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMPRODENTRY RE
                      JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMPROD R
                        ON R.IDREC = RE.IDRECPARENT
                       AND R.DSS_CURRENT_FLAG = 'Y'
                       AND R.DSS_DELETE_FLAG != 'Y'
                      JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMP P
                        ON R.IDRECPARENT = P.IDREC
                       AND P.DSS_CURRENT_FLAG = 'Y'
                       AND P.DSS_DELETE_FLAG != 'Y'
                     WHERE RE.DSS_CURRENT_FLAG = 'Y'
                       AND RE.DSS_DELETE_FLAG != 'Y'
                   ) ,
                   TESTS AS (
                    SELECT T.RATEFLUIDTOTALCALC AS TOTAL_FLUID_RATE_METRIC ,
                           T.DTTM AS TEST_DATE ,
                           T.IDRECPARENT AS TEST_PARENT ,
                           T.IDREC AS TEST_IDREC ,
                           T.RATEHCLIQCALC AS RATE_OIL_METRIC ,
                           T.RATEWATERCALC AS RATE_WATER_METRIC ,
                           T.RATEPRODGASCALC / 1000 AS RATE_GAS_METRIC ,
                           T.BSWTOTALCALC AS TOTAL_BSW ,
                           T.GORCALC AS GOR ,
                           T.IDRECSEP AS TESTSEP_IDREC ,
                           ROW_NUMBER() OVER (PARTITION BY T.IDRECPARENT ORDER BY T.DTTM ASC) AS TEST_NUMBER ,
                           ROW_NUMBER() OVER (PARTITION BY T.IDRECPARENT ORDER BY T.DTTM DESC) AS TEST_NUMBER_DESC
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPTEST T
                     WHERE T.DSS_CURRENT_FLAG = 'Y'
                       AND T.DSS_DELETE_FLAG != 'Y'
                       AND NVL(T.DONTUSE, 0) != 1
                   ) ,
                   LAST_DT AS (
                    SELECT *
                      FROM (
                            SELECT DT.IDREC AS DT_IDREC ,
                                   P.IDRECUNIT AS DT_IDRECUNIT ,
                                   DT.DTTMSTART ,
                                   DT.DTTMEND ,
                                   DT.CODEDOWNTM3 ,
                                   ROW_NUMBER() OVER (PARTITION BY P.IDRECUNIT ORDER BY DT.DTTMSTART DESC) AS R
                              FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPDOWNTM DT
                              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY P
                                ON DT.IDREC = P.IDRECDOWNTIME
                               AND P.DSS_CURRENT_FLAG = 'Y'
                               AND P.DSS_DELETE_FLAG != 'Y'
                             WHERE DT.DSS_CURRENT_FLAG = 'Y'
                               AND DT.DSS_DELETE_FLAG != 'Y'
                           )
                     WHERE R = 1
                   ) SELECT U.IDREC AS DIM_WELL_KEY ,
                   TO_VARCHAR(P.DTTM, 'YYYYMMDD') AS DIM_ACTIVITY_PERIOD_DATE_KEY ,
                   '1' AS DIM_GROSS_NET_KEY ,
                   'pv_test' AS DIM_SCENARIO_KEY ,
                   P.DTTM AS ACTIVITY_DATE ,
                   TO_VARCHAR(C.DTTMONPROD, 'YYYYMMDD') AS DIM_ON_PROD_DATE_KEY ,
                   TS.NAME AS SEPARATOR_NAME ,
                   E.TYP AS TYPE ,
                   E.MAKE AS JACK_MAKE ,
                   E.MODEL AS JACK_MODEL ,
                   E.JACK_RATIO ,
                   E.JSD AS JACK_SHEAVE_DIAM ,
                   E.MSD AS MOTOR_SHEAVE_DIAM ,
                   E.BELT ,
                   E.MOTORHP AS ALL_HP ,
                   E.RPM AS ALL_RPM ,
                   E.CM AS CONTROLLER_MAKE ,
                   E.CMOD AS CONTROLLER_MODEL ,
                   E.CTYP AS CONTROLLER_TYPE ,
                   PM.BH_PUMP_INSTALL_DATE AS INSTALL_DATE ,
                   PM.PUMP_DIAMETER AS PUMP_SIZE ,
                   PM.STROKE_LENGTH AS CURRENT_STROKE ,
                   PM.SPM AS CURRENT_SPM ,
                   T.TEST_DATE ,
                   T.RATE_OIL_METRIC ,
                   T.RATE_WATER_METRIC ,
                   T.TOTAL_FLUID_RATE_METRIC ,
                   T.RATE_GAS_METRIC ,
                   T.TOTAL_BSW ,
                   T.GOR ,
                   NVL(T.RATE_OIL_METRIC, 0) * CF.LIQUID_BOE_THERMAL + NVL(T.RATE_GAS_METRIC, 0) / 1000 * CF.GAS_BOE_THERMAL AS TEST_BOE ,
                   CASE WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumpespentry' THEN 'ESP'
                        WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumprodentry' THEN 'Rod Pump'
                        WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumppcpentry' THEN 'PCP'
                        ELSE NULL
                         END AS BHP_PUMP_TYPE ,
                   P.PUMPEFF ,
                   FL.DTTM AS FL_DATE ,
                   FL.JOINTSTOFLUID AS JTF ,
                   FL.JOINTSINHOLE AS JIH ,
                   S.STATUS ,
                   DT.CODEDOWNTM3 ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   DT.DTTMSTART AS DT_FIRST_DAY ,
                   DT.DTTMEND AS DT_LAST_DAY ,
                   PA.PRESTUB AS TUBING_PRESSURE ,
                   PA.PRESCAS AS CASING_PRESSURE ,
                   T.TEST_NUMBER ,
                   CASE WHEN T.TEST_NUMBER_DESC = '1' THEN 'Y'
                        ELSE 'N'
                         END AS LAST_TEST
              FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY P
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT U
                ON U.IDREC = P.IDRECUNIT
               AND U.DSS_CURRENT_FLAG = 'Y'
               AND U.DSS_DELETE_FLAG != 'Y'
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFLOWNETHEADER H
                ON H.IDFLOWNET = P.IDFLOWNET
               AND H.DSS_CURRENT_FLAG = 'Y'
               AND H.DSS_DELETE_FLAG != 'Y'
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMP C
                ON C.IDREC = P.IDRECCOMP
               AND C.DSS_CURRENT_FLAG = 'Y'
               AND C.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFACILITY F
                ON F.IDREC = P.IDRECFACILITY
               AND F.DSS_CURRENT_FLAG = 'Y'
               AND F.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVROUTESETROUTE R
                ON R.IDREC = U.IDRECROUTESETROUTECALC
               AND R.DSS_CURRENT_FLAG = 'Y'
               AND R.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN EQUIPMENT E
                ON E.IDRECPARENT = P.IDRECUNIT
              LEFT JOIN PUMPS PM
                ON PM.IDREC = P.IDRECPUMPENTRY
             RIGHT JOIN TESTS T
                ON T.TEST_IDREC = P.IDRECTEST
               AND P.DTTM = T.TEST_DATE
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITTESTSEP TS
                ON TS.IDREC = T.TESTSEP_IDREC
               AND TS.DSS_CURRENT_FLAG = 'Y'
               AND TS.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL FL
                ON FL.IDREC = P.IDRECFLUIDLEVEL
               AND FL.DSS_CURRENT_FLAG = 'Y'
               AND FL.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPSTATUS S
                ON S.IDREC = P.IDRECSTATUS
               AND S.DSS_CURRENT_FLAG = 'Y'
               AND S.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN LAST_DT DT
                ON P.IDRECUNIT = DT.DT_IDRECUNIT
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPARAM PA
                ON PA.IDREC = P.IDRECPARAM
               AND PA.DSS_CURRENT_FLAG = 'Y'
               AND PA.DSS_DELETE_FLAG != 'Y'
              JOIN (
                    SELECT DISTINCT MAX(CASE WHEN PROD_CODE IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN SI_TO_IMP_CONV_FACTOR END) AS GAS_SI_TO_IMP_CONV_FACTOR ,
                           MAX(CASE WHEN PROD_CODE IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN BOE_THERMAL END) AS GAS_BOE_THERMAL ,
                           MAX(CASE WHEN PROD_CODE NOT IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN BOE_THERMAL END) AS LIQUID_BOE_THERMAL
                      FROM WS_STAGE_BT.STAGE_FIN_SAP_PRODUCT_TYPE
                   ) CF
                ON 1 = 1
             WHERE P.DSS_CURRENT_FLAG = 'Y'
               AND P.DSS_DELETE_FLAG != 'Y'
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }}
        name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
        noLinkRefs: []
  name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
