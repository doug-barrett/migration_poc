fileVersion: 1
id: fa57e40b-63e8-475b-9b3c-18687cba591c
name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47682e2e-516e-4983-ba53-c47ef255365a
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: DIM_WELL_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 850244b2-cf63-447e-9a9e-2898428215e9
                stepCounter: b78e68df-21f7-427c-9ce7-426d1d304567
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3e62d92-8cba-40c4-b1c0-27b92ce90588
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMP_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf6aa8f-2e96-43a3-8472-6ee102299445
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ec629cf-bce8-4b66-82b3-66ba3318db3e
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TUBING_PRESSURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c10af379-bdbe-42bc-b41b-1fb7bb49e843
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff34fe20-e9b4-472b-870b-de13c7443cee
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CASING_PRESSURE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f47f5cce-108b-472c-a43a-5bc2d2562aa3
                stepCounter: 3c6f5981-3218-423d-b012-74039f0258fc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a7cc7a43-a7fa-461b-8067-eb474b683aa2
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 821f14dd-8e34-4318-8adb-e519858a6df4
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff83eb8a-45fa-4e97-9bf6-daa1d3f24772
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPPUMPROD_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1075a5c-6f36-4d2d-9df8-0fa42b7a8395
                stepCounter: a3eea4b0-6885-4062-a502-39ce0698e82e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9afa2926-f6b9-4bbc-8da7-d47e2dbac50c
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPPUMPRODENTRY_IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e18049e-2c5c-4121-abc2-6eaa373ae014
                stepCounter: 7e053bc7-7052-48d7-981a-0f94480eef01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c88c1ee1-ff0a-4037-90cf-68efb02d1279
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: PVUNITCOMPTEST_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14043e91-dd02-418c-9f47-d3b998aa59db
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d1d613f-3659-4d37-9823-35c5ae0ce234
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DIM_ACTIVITY_PERIOD_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f836d015-9378-425e-8356-2fad77845465
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a50dd46d-db7c-412c-9217-f4517db198a0
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SEPARATOR_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af17b007-462b-4c79-b1d1-fc4b82ac99d5
                stepCounter: 3380887d-83de-44ee-af33-9907e293807a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f19f4a7-04f7-46ff-832f-d688e7859d69
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7a90bdc-af48-4f24-91f1-5802ec808b91
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96fa4f30-b71f-43c1-a466-54f81143c326
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0a8e589d-c3fd-4d5b-87f1-710150dd4155
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85e2ca6e-390b-4b60-b5bd-c316a5f6f822
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48abee56-55c8-4266-aaed-1cd56592dabc
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14ee888c-6baa-45e1-8e2a-34f5d5fe32b6
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TYP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 189f2e75-1dc8-434b-aa98-4fc5976c927a
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a65d0e61-fe25-4333-a153-bb4115f6bc7b
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: JSD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c11c18a9-c91c-4266-80e5-d441cc23bcb3
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dabdc120-26fd-4d83-a743-3df30b0a96f9
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: JACK_RATIO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 89313556-a466-4c18-97eb-3f29549236b8
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47673f50-f2ee-41c3-a3f3-7af5b520b619
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BELT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a8e9c1f-769a-48c7-8751-db66c65f4a9a
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 867ad35e-1d0d-4e42-aa11-2ecd08a172a3
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: MOTOR_HP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88c9913f-ac05-43dd-a9b7-0dd11be42951
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 711af720-7adc-4eaf-b4e4-10d8d34090b6
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: RPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47dd9964-b97b-446d-a167-5aadb3909669
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3970292-4e73-4b6a-ac4f-5f6ab97a9fe0
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: MSD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 27c19f43-9ae1-4c7f-b68d-1d340db1627a
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 589a4ae6-f472-4d8b-b24a-8fe16272932f
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: CT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9dff24d6-d071-4a79-9ffa-d568fb1fac2d
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dee7ef6b-aa40-4368-9a98-932a8b2157e3
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ca815d5-540b-448e-9ad4-98f20f0a33f9
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22bd4e8c-34e9-470f-880c-7a2e48b21d1e
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 432aabc5-42a1-422a-ae61-2c7da6d8d5d5
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f83c164-c18c-4fb6-bfeb-6d25e7723417
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTROLLER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b8600330-a6d7-4308-8bfa-08d0b36cbc3e
                stepCounter: 75af0565-954d-439b-9e43-9b99ffea4a1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9ba364d-8f04-4b54-8e4e-624fb24cb798
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: STROKELENGTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: daf8eb72-f1e8-4b0e-ae61-42de2ddbfe0e
                stepCounter: 7e053bc7-7052-48d7-981a-0f94480eef01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51a579e7-5dc0-4343-b79a-1ec17d6a6edc
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: baa90081-dc4a-4813-875b-b8af359be9a5
                stepCounter: 7e053bc7-7052-48d7-981a-0f94480eef01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9dedd48-2131-4e95-a532-55ebe538ad96
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PUMPDIAMETER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a448ad1-b36d-477c-882b-3c565a568508
                stepCounter: a3eea4b0-6885-4062-a502-39ce0698e82e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7708be08-f83b-4c4b-a2ec-f8ae9ac0f671
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEFLUIDTOTALCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df58d1db-39b2-4d53-8ae4-e968676779bb
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 614e6b31-3fcc-43d6-9658-6e39ae851047
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: TEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f836d015-9378-425e-8356-2fad77845465
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33a23276-863d-4454-8bd5-4b63a052f8ae
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEWATERCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 263d4d12-6681-4030-8904-8114afa08fe8
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ead22486-3198-4694-ae08-dc6d1204fb25
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEPRODGASCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a4a5e21f-ffb7-4804-a4f4-57773fd65266
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8bd10f44-17a7-49b7-820d-4d0833668462
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BSWTOTALCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6428361-5ab6-48ee-b9e4-461203b26433
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96e5876e-d40e-48dc-a1cf-4f9cbacab502
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GORCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14963ef4-0007-4611-baf8-f15f0c681d43
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 867dc9f4-a74c-4cd5-a91d-352e6ef40df6
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CODEDOWNTM3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5d45b8b-cc48-45f6-9ca4-fd0ce63ce6fd
                stepCounter: 1cfae906-aa80-4fdd-86b2-b1b3da4133d3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2675bef-97a4-4fc9-b083-2981397e6c21
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DT_FIRST_DAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ec91ba2-1c19-49d8-89a2-128e0424bb53
                stepCounter: 1cfae906-aa80-4fdd-86b2-b1b3da4133d3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 701cc75b-f252-4005-a788-ecc710740908
          stepCounter: fa57e40b-63e8-475b-9b3c-18687cba591c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: RATEHCLIQCALC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cde26852-da4b-4409-b964-d67547252bd0
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_FACT_FDC_PRODVIEW_WELL_TESTS: fa57e40b-63e8-475b-9b3c-18687cba591c
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_FACT_FDC_PRODVIEW_WELL_TESTS') }} AS WITH EQUIPMENT AS (
                    SELECT E.NAME ,
                           E.IDRECPARENT ,
                           E.TYP ,
                           E.MAKE ,
                           E.MODEL ,
                           E.IMPORTID1 AS JSD ,
                           E.IMPORTID2 AS JACK_RATIO ,
                           E.IMPORTTYP1 AS BELT ,
                           E.EXPORTID2 AS MOTORHP ,
                           E.IMPORTTYP2 AS RPM ,
                           E.EXPORTID1 AS MSD ,
                           E.COM AS CT ,
                           E.EXPORTTYP1 AS CM ,
                           E.EXPORTTYP2 AS CMOD ,
                           E.OTHERID AS CTYP
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITEQUIP E
                     WHERE E.NAME = 'Surface Equipment'
                       AND E.DSS_CURRENT_FLAG = 'Y'
                       AND E.DSS_DELETE_FLAG != 'Y'
                   ) ,
                   PUMPS AS (
                    SELECT RE.IDREC ,
                           RE.IDRECPARENT ,
                           RE.STROKELENGTH * 39.3700787 AS STROKE_LENGTH ,
                           RE.SPM ,
                           R.PUMPDIAMETER * 39.3700787 AS PUMP_DIAMETER ,
                           P.DTTMSTART AS BH_PUMP_INSTALL_DATE
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMPRODENTRY RE
                      JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMPROD R
                        ON R.IDREC = RE.IDRECPARENT
                       AND R.DSS_CURRENT_FLAG = 'Y'
                       AND R.DSS_DELETE_FLAG != 'Y'
                      JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPUMP P
                        ON R.IDRECPARENT = P.IDREC
                       AND P.DSS_CURRENT_FLAG = 'Y'
                       AND P.DSS_DELETE_FLAG != 'Y'
                     WHERE RE.DSS_CURRENT_FLAG = 'Y'
                       AND RE.DSS_DELETE_FLAG != 'Y'
                   ) ,
                   TESTS AS (
                    SELECT T.RATEFLUIDTOTALCALC AS TOTAL_FLUID_RATE_METRIC ,
                           T.DTTM AS TEST_DATE ,
                           T.IDRECPARENT AS TEST_PARENT ,
                           T.IDREC AS TEST_IDREC ,
                           T.RATEHCLIQCALC AS RATE_OIL_METRIC ,
                           T.RATEWATERCALC AS RATE_WATER_METRIC ,
                           T.RATEPRODGASCALC / 1000 AS RATE_GAS_METRIC ,
                           T.BSWTOTALCALC AS TOTAL_BSW ,
                           T.GORCALC AS GOR ,
                           T.IDRECSEP AS TESTSEP_IDREC ,
                           ROW_NUMBER() OVER (PARTITION BY T.IDRECPARENT ORDER BY T.DTTM ASC) AS TEST_NUMBER ,
                           ROW_NUMBER() OVER (PARTITION BY T.IDRECPARENT ORDER BY T.DTTM DESC) AS TEST_NUMBER_DESC
                      FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPTEST T
                     WHERE T.DSS_CURRENT_FLAG = 'Y'
                       AND T.DSS_DELETE_FLAG != 'Y'
                       AND NVL(T.DONTUSE, 0) != 1
                   ) ,
                   LAST_DT AS (
                    SELECT *
                      FROM (
                            SELECT DT.IDREC AS DT_IDREC ,
                                   P.IDRECUNIT AS DT_IDRECUNIT ,
                                   DT.DTTMSTART ,
                                   DT.DTTMEND ,
                                   DT.CODEDOWNTM3 ,
                                   ROW_NUMBER() OVER (PARTITION BY P.IDRECUNIT ORDER BY DT.DTTMSTART DESC) AS R
                              FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPDOWNTM DT
                              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY P
                                ON DT.IDREC = P.IDRECDOWNTIME
                               AND P.DSS_CURRENT_FLAG = 'Y'
                               AND P.DSS_DELETE_FLAG != 'Y'
                             WHERE DT.DSS_CURRENT_FLAG = 'Y'
                               AND DT.DSS_DELETE_FLAG != 'Y'
                           )
                     WHERE R = 1
                   ) SELECT U.IDREC AS DIM_WELL_KEY ,
                   TO_VARCHAR(P.DTTM, 'YYYYMMDD') AS DIM_ACTIVITY_PERIOD_DATE_KEY ,
                   '1' AS DIM_GROSS_NET_KEY ,
                   'pv_test' AS DIM_SCENARIO_KEY ,
                   P.DTTM AS ACTIVITY_DATE ,
                   TO_VARCHAR(C.DTTMONPROD, 'YYYYMMDD') AS DIM_ON_PROD_DATE_KEY ,
                   TS.NAME AS SEPARATOR_NAME ,
                   E.TYP AS TYPE ,
                   E.MAKE AS JACK_MAKE ,
                   E.MODEL AS JACK_MODEL ,
                   E.JACK_RATIO ,
                   E.JSD AS JACK_SHEAVE_DIAM ,
                   E.MSD AS MOTOR_SHEAVE_DIAM ,
                   E.BELT ,
                   E.MOTORHP AS ALL_HP ,
                   E.RPM AS ALL_RPM ,
                   E.CM AS CONTROLLER_MAKE ,
                   E.CMOD AS CONTROLLER_MODEL ,
                   E.CTYP AS CONTROLLER_TYPE ,
                   PM.BH_PUMP_INSTALL_DATE AS INSTALL_DATE ,
                   PM.PUMP_DIAMETER AS PUMP_SIZE ,
                   PM.STROKE_LENGTH AS CURRENT_STROKE ,
                   PM.SPM AS CURRENT_SPM ,
                   T.TEST_DATE ,
                   T.RATE_OIL_METRIC ,
                   T.RATE_WATER_METRIC ,
                   T.TOTAL_FLUID_RATE_METRIC ,
                   T.RATE_GAS_METRIC ,
                   T.TOTAL_BSW ,
                   T.GOR ,
                   NVL(T.RATE_OIL_METRIC, 0) * CF.LIQUID_BOE_THERMAL + NVL(T.RATE_GAS_METRIC, 0) / 1000 * CF.GAS_BOE_THERMAL AS TEST_BOE ,
                   CASE WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumpespentry' THEN 'ESP'
                        WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumprodentry' THEN 'Rod Pump'
                        WHEN LOWER(P.IDRECPUMPENTRYTK) = 'pvunitcomppumppcpentry' THEN 'PCP'
                        ELSE NULL
                         END AS BHP_PUMP_TYPE ,
                   P.PUMPEFF ,
                   FL.DTTM AS FL_DATE ,
                   FL.JOINTSTOFLUID AS JTF ,
                   FL.JOINTSINHOLE AS JIH ,
                   S.STATUS ,
                   DT.CODEDOWNTM3 ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   DT.DTTMSTART AS DT_FIRST_DAY ,
                   DT.DTTMEND AS DT_LAST_DAY ,
                   PA.PRESTUB AS TUBING_PRESSURE ,
                   PA.PRESCAS AS CASING_PRESSURE ,
                   T.TEST_NUMBER ,
                   CASE WHEN T.TEST_NUMBER_DESC = '1' THEN 'Y'
                        ELSE 'N'
                         END AS LAST_TEST
              FROM WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY P
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNIT U
                ON U.IDREC = P.IDRECUNIT
               AND U.DSS_CURRENT_FLAG = 'Y'
               AND U.DSS_DELETE_FLAG != 'Y'
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFLOWNETHEADER H
                ON H.IDFLOWNET = P.IDFLOWNET
               AND H.DSS_CURRENT_FLAG = 'Y'
               AND H.DSS_DELETE_FLAG != 'Y'
              JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMP C
                ON C.IDREC = P.IDRECCOMP
               AND C.DSS_CURRENT_FLAG = 'Y'
               AND C.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVFACILITY F
                ON F.IDREC = P.IDRECFACILITY
               AND F.DSS_CURRENT_FLAG = 'Y'
               AND F.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVROUTESETROUTE R
                ON R.IDREC = U.IDRECROUTESETROUTECALC
               AND R.DSS_CURRENT_FLAG = 'Y'
               AND R.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN EQUIPMENT E
                ON E.IDRECPARENT = P.IDRECUNIT
              LEFT JOIN PUMPS PM
                ON PM.IDREC = P.IDRECPUMPENTRY
             RIGHT JOIN TESTS T
                ON T.TEST_IDREC = P.IDRECTEST
               AND P.DTTM = T.TEST_DATE
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITTESTSEP TS
                ON TS.IDREC = T.TESTSEP_IDREC
               AND TS.DSS_CURRENT_FLAG = 'Y'
               AND TS.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL FL
                ON FL.IDREC = P.IDRECFLUIDLEVEL
               AND FL.DSS_CURRENT_FLAG = 'Y'
               AND FL.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPSTATUS S
                ON S.IDREC = P.IDRECSTATUS
               AND S.DSS_CURRENT_FLAG = 'Y'
               AND S.DSS_DELETE_FLAG != 'Y'
              LEFT JOIN LAST_DT DT
                ON P.IDRECUNIT = DT.DT_IDRECUNIT
              LEFT JOIN WS_DATA_STORE.ODS_PVIEW_PVT_PVUNITCOMPPARAM PA
                ON PA.IDREC = P.IDRECPARAM
               AND PA.DSS_CURRENT_FLAG = 'Y'
               AND PA.DSS_DELETE_FLAG != 'Y'
              JOIN (
                    SELECT DISTINCT MAX(CASE WHEN PROD_CODE IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN SI_TO_IMP_CONV_FACTOR END) AS GAS_SI_TO_IMP_CONV_FACTOR ,
                           MAX(CASE WHEN PROD_CODE IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN BOE_THERMAL END) AS GAS_BOE_THERMAL ,
                           MAX(CASE WHEN PROD_CODE NOT IN ('GAS', 'GCOMP', 'GGATH', 'GPROC') THEN BOE_THERMAL END) AS LIQUID_BOE_THERMAL
                      FROM WS_STAGE_BT.STAGE_FIN_SAP_PRODUCT_TYPE
                   ) CF
                ON 1 = 1
             WHERE P.DSS_CURRENT_FLAG = 'Y'
               AND P.DSS_DELETE_FLAG != 'Y'
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }}
        name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
        noLinkRefs: []
  name: VIEW_FACT_FDC_PRODVIEW_WELL_TESTS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
