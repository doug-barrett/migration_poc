fileVersion: 1
id: 4e76f403-637c-4e39-bf7a-641cd030cf92
name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d24408c-d3f0-4159-bb90-4b32f3d9b8e6
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: OUTPATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d235708-6251-4ae1-9228-d497240a922b
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm,ds_pims_schedules.schdl_refno)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b087930a-60e5-4eeb-8812-0b72b3a8d60b
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d958215-89ab-4314-9284-cc2f5767c9d8
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_SEQ_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01ad4c00-6767-43db-8ee4-80831196d5ff
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_COUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0d6757c-ed7c-487d-9040-9182caf7e237
          stepCounter: 4e76f403-637c-4e39-bf7a-641cd030cf92
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7dcad9a6-52b1-402a-a292-1118300823b9
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_SCHEDULES
        join:
          joinCondition: |-
            FROM ds_pims_schedules
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_schedules.schdl_refno
               AND ds_pims_diagnosis_procedures.sorce_code = 'SCHDL'
               AND ds_pims_schedules.sctyp_refno = 12186 --'OTPAT'
        name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE_V
        noLinkRefs: []
  name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE_V
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
