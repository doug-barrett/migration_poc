fileVersion: 1
id: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
name: S_OUTPATIENT_APPOINTMENT_SUMMARY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Outpatient Appointment summaries for a Outpatient Session facts"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45e329cb-a9a7-469b-acd0-acac8f25fcbf
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: OUTPATIENT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1eaf2554-222f-42c2-a8c7-a69a672ad50f
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1cc00c68-de1d-41b5-8e59-c94003c7a61a
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: APPOINTMENTS_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.appointment_status_type_code ='A' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ea29706-39ce-4938-81e1-9a2a88c6dc05
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEW_ATTENDS_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 277344c7-5111-49b7-8e65-e4d83bb217c5
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.new_attend_flag = 'Y' AND ds_outpatient_appointment_30.DNA_flag = 'N' AND ds_outpatient_appointment_30.appointment_status_type_code='A' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ee84399-c553-46f3-b4e7-afd2683b56dc
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEW_DNA_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f0d7e6b-1efe-4e3c-bd20-201acaa46ade
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.new_attend_flag = 'Y' AND ds_outpatient_appointment_30.DNA_flag = 'Y' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e60afe08-3163-4aba-abc2-b449301ec930
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: NEW_INCOMPLETE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 277344c7-5111-49b7-8e65-e4d83bb217c5
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.new_attend_flag = 'Y' AND ds_outpatient_appointment_30.appointment_status_type_code='A' AND NULLIF(ds_outpatient_appointment_30.appointment_outcome_reference_no,11586) IS NULL AND COALESCE(ds_outpatient_appointment_30.appointment_start_date,ds_outpatient_appointment_30.patient_arrived_date,ds_outpatient_appointment_30.patient_seen_by_date) < getdate() THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0269be7e-443e-4902-b7f4-d40c045f6741
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: FUP_ATTENDS_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 81287ebd-ad87-4a29-9060-bd84d0e893bd
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.FUP_attend_flag = 'Y' AND ds_outpatient_appointment_30.DNA_flag = 'N' AND ds_outpatient_appointment_30.appointment_status_type_code ='A' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cd055ff-35da-4afd-a870-182c921b1c24
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: FUP_DNA_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f0d7e6b-1efe-4e3c-bd20-201acaa46ade
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.FUP_attend_flag = 'Y' AND ds_outpatient_appointment_30.DNA_flag = 'Y' THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14fd80fb-bcf5-455c-84dc-369448879d2a
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: FUP_INCOMPLETE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 81287ebd-ad87-4a29-9060-bd84d0e893bd
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: SUM(CASE WHEN ds_outpatient_appointment_30.FUP_attend_flag = 'Y' AND NULLIF(ds_outpatient_appointment_30.appointment_outcome_reference_no,11586) IS NULL AND ds_outpatient_appointment_30.appointment_status_type_code='A' AND COALESCE(ds_outpatient_appointment_30.appointment_start_date,ds_outpatient_appointment_30.patient_arrived_date,ds_outpatient_appointment_30.patient_seen_by_date) < getdate() THEN 1 ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 599e9cc0-d191-4e1b-bebb-ea6bf4a2d452
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: first_patient_start_date
        name: FIRST_PATIENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f992eaf5-e801-445f-b5b4-d7751230d3a0
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: MIN(IFNULL(ds_outpatient_appointment_30.patient_seen_by_date,ds_outpatient_appointment_30.patient_arrived_date))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e376661b-5f67-4b13-9c3a-be06d29082b5
          stepCounter: 3de56f06-db46-4d99-a6a6-f9e9fbab814b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: last_patient_end_date
        name: LAST_PATIENT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9f9038a-86c2-4d79-86fd-3ae3e84aac6f
                stepCounter: 93c63ba9-752b-4aed-8129-37fe9d2a3fea
            transform: MAX(IFNULL(ds_outpatient_appointment_30.patient_departed_date,ds_outpatient_appointment_30.patient_departed_date))
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_OUTPATIENT_APPOINTMENT_30
        join:
          joinCondition: |-
            FROM ds_outpatient_appointment_30
             GROUP BY outpatient_session_reference_no
        name: S_OUTPATIENT_APPOINTMENT_SUMMARY
        noLinkRefs: []
  name: S_OUTPATIENT_APPOINTMENT_SUMMARY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
