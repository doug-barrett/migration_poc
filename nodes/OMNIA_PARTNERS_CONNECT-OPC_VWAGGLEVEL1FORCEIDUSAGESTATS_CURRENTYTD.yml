fileVersion: 1
id: 55d63b1d-ce92-4d02-b7da-82909a13cab0
name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "YTD AGGREGATE USAGE STATISTICS FOR EACH LEVEL1FORCEID"
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: abb0587b-8f2b-414f-a01b-28ba800c6baa
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: LEVEL1FORCEID
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1de87393-0700-4c5c-be5d-5c0372728439
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 71b18168-83e6-44e4-8573-c08ac915709a
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dfd1a95b-0f6b-4978-8224-f1f00097d399
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fd32e691-793b-4e2e-98d3-88a87ad9f123
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: DATE
        defaultValue: ""
        description: DSSMAXTRANSACTIONDATE
        name: DSSMAXTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce0e6a6b-00a6-4ba8-9ce4-21bce37791d6
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: MAX(OPSALESANDREVENUE.MAXRECEIPTDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d55b0c9-7d0e-4b6a-b22a-05ac418bc6cf
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: DATE
        defaultValue: ""
        description: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        name: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80d17a33-518c-4f54-8e26-57ffed609918
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: MAX(OPSALESANDREVENUE.TRANSACTIONDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 458e0ced-36ca-4bc5-a802-61513e3187cf
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        name: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80d17a33-518c-4f54-8e26-57ffed609918
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: DATEDIFF(MONTH,MAX(OPSALESANDREVENUE.TRANSACTIONDATE),MAX(OPSALESANDREVENUE.MAXRECEIPTDATE))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72de6e99-a83c-49d2-9444-e12b70fb8fb0
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFSUPPLIERSUSED
        name: CURRENTYTD_NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 72ac346e-6768-4b12-bb81-72a585a1cec9
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: COUNT(DISTINCT OPSALESANDREVENUE.FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY OPSALESANDREVENUE.LEVEL1FORCEID) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4091b17b-2924-4ba9-9f6d-95a341194e06
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTSUSED
        name: CURRENTYTD_NUMOFCONTRACTSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c015a8d3-66f0-42af-9a08-09c74ed59c83
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: COUNT(DISTINCT OPSALESANDREVENUE.INITIALCONTRACTID)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7910f3d6-059a-423f-991f-43ea41b2c6c3
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        name: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02173c15-d440-4a25-b6d6-3a7039a681a2
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: COUNT(DISTINCT OPSALESANDREVENUE.CONTRACTCATEGORY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f777f94f-da77-4214-a2d7-d7919a7cc2c3
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFSALES
        name: CURRENTYTD_SUMOFSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5092198a-0218-48bb-87de-a48312c9fa3e
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: SUM(OPSALESANDREVENUE.SALES)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1dc6153-7e61-40fe-80c1-d17f46b5055c
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFREVENUE
        name: CURRENTYTD_SUMOFREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7eee542-aedc-425b-b555-d34e6a38a1b5
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: SUM(OPSALESANDREVENUE.REVENUE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1f239f46-d294-4544-8b67-7dfe17105399
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYSALES
        name: CURRENTYTD_RANKBYSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5092198a-0218-48bb-87de-a48312c9fa3e
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.SALES) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3c3fe57-0a47-4148-bbfd-da9c86a52daf
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYREVENUE
        name: CURRENTYTD_RANKBYREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7eee542-aedc-425b-b555-d34e6a38a1b5
                stepCounter: 879abdc9-ef4e-4897-a376-115167a76138
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.REVENUE) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8b80edc-d1fd-4464-be52-0156a044a424
          stepCounter: 55d63b1d-ce92-4d02-b7da-82909a13cab0
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTACTS
        name: CURRENTYTD_NUMOFCONTACTS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f8b0170-7680-48a3-8b6d-02c5d2e7d012
                stepCounter: 69bed407-4a56-4539-a027-399a1d5dc1bb
            transform: COUNT (DISTINCT CONTACT.DIMCONTACTKEY)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD -- (LEVEL1FORCEID, LEVEL1DISPLAYACCOUNTNAME, NUMOFSUPPLIERSUSED, NUMOFCONTRACTSUSED, NUMOFCONTRACTCATEGORIESUSED, ASOFMAXRECEIPTDATE, MONTHSSINCELASTTRANSACTION, MOSTRECENTRECEIPTDATE, SUMOFSALES, SUMOFREVENUE, SUMOFREVENUE, RANKBYREVENUE, RANKBYSALES, NUMOFCONTACTS, DSSCREATETIME, DSSUPDATETIME)
            \N \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) AS CURRENTYTD_NUMOFSUPPLIERSUSED \N , COUNT (DISTINCT INITIALCONTRACTID) AS CURRENTYTD_NUMOFCONTRACTSUSED \N , COUNT (DISTINCT CONTRACTCATEGORY) AS CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED \N , MAX(MAXRECEIPTDATE) AS DSSMAXTRANSACTIONDATE \N , DATEDIFF(MONTH, MAX(TRANSACTIONDATE), MAX(MAXRECEIPTDATE)) AS CURRENTYTD_MONTHSSINCELASTTRANSACTION \N , MAX(TRANSACTIONDATE) AS CURRENTYTD_MOSTRECENTTRANSACTIONDATE \N , SUM(SALES) AS CURRENTYTD_SUMOFSALES \N , SUM(REVENUE) AS CURRENTYTD_SUMOFREVENUE \N , RANK() OVER (ORDER BY SUM(REVENUE) DESC) AS CURRENTYTD_RANKBYREVENUE \N , RANK() OVER (ORDER BY SUM(SALES) DESC) AS CURRENTYTD_RANKBYSALES \N , COUNT (DISTINCT DIMCONTACTKEY) AS CURRENTYTD_NUMOFCONTACTS \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N
              LEFT OUTER JOIN DIM.CONTACT AS CONTACT
                ON \N CONTACT.LEVEL1FORCEID = SALESANDREVENUE.LEVEL1FORCEID \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(YEAR,TRANSACTIONDATE,MAXRECEIPTDATE) = 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   SUPPLIERID;\N
        dependencies:
          - locationName: DIM
            nodeName: CONTACT
          - locationName: OP
            nodeName: OPSALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTACT') }}
            {{ ref('OP','OPSALESANDREVENUE') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
        noLinkRefs: []
  name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
