fileVersion: 1
id: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "YTD AGGREGATE USAGE STATISTICS FOR EACH LEVEL1FORCEID"
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ee01ac8-96de-452b-adc2-43acb9414d0b
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: LEVEL1FORCEID
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: faa39d05-ad4b-4320-88be-08a0e38bba91
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 53ab3955-6b27-4859-bdb2-0c1bf1d427c9
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84ff62a0-dcca-4f0c-aca1-121e8f56404c
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79f513c5-b0b8-4dfa-8f7f-9e82a5571a09
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: DATE
        defaultValue: ""
        description: DSSMAXTRANSACTIONDATE
        name: DSSMAXTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f3671ee-1f5e-4608-b2dc-ef2df8c47c07
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: MAX(OPSALESANDREVENUE.MAXRECEIPTDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3556b5ac-023c-4653-94a6-668ea226ac00
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: DATE
        defaultValue: ""
        description: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        name: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a87abb2f-ed0c-497c-b9b4-e0b9cb12e75b
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: MAX(OPSALESANDREVENUE.TRANSACTIONDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b71da925-b4da-4fdb-9224-892daf5353da
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        name: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a87abb2f-ed0c-497c-b9b4-e0b9cb12e75b
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: DATEDIFF(MONTH,MAX(OPSALESANDREVENUE.TRANSACTIONDATE),MAX(OPSALESANDREVENUE.MAXRECEIPTDATE))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 981cfbe7-d730-4051-bb14-204499890870
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFSUPPLIERSUSED
        name: CURRENTYTD_NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34b3c978-7453-4b09-8eca-b5c11b0da4dd
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: COUNT(DISTINCT OPSALESANDREVENUE.FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY OPSALESANDREVENUE.LEVEL1FORCEID) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed7b300b-5488-4565-86e6-e4165dc66b88
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTSUSED
        name: CURRENTYTD_NUMOFCONTRACTSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d0243d42-daa0-4fff-81a8-3d1ff960c278
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: COUNT(DISTINCT OPSALESANDREVENUE.INITIALCONTRACTID)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 257fe78d-3198-4a11-b06d-11be8b5a6a01
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        name: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 081b0839-12a7-4ef8-be30-b57ade00762d
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: COUNT(DISTINCT OPSALESANDREVENUE.CONTRACTCATEGORY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41bcdf14-3d18-4221-8eb6-d41f9f4c96e3
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFSALES
        name: CURRENTYTD_SUMOFSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb52d989-abf6-47f4-8029-21ddec3341d6
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: SUM(OPSALESANDREVENUE.SALES)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3908570c-1963-46ec-a7bb-48f06da726c7
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFREVENUE
        name: CURRENTYTD_SUMOFREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8fd3df23-8ff0-4058-8397-d9dbe0be8ead
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: SUM(OPSALESANDREVENUE.REVENUE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d346d1f0-aba8-41f0-8bf8-1f979c35992e
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYSALES
        name: CURRENTYTD_RANKBYSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb52d989-abf6-47f4-8029-21ddec3341d6
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.SALES) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ac4d5a1-5013-480a-9747-004243dfef3c
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYREVENUE
        name: CURRENTYTD_RANKBYREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8fd3df23-8ff0-4058-8397-d9dbe0be8ead
                stepCounter: 495c8ca1-6293-4020-a385-cd9c34783595
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.REVENUE) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0920b711-6918-4ac7-bbb4-0bb578281ad9
          stepCounter: 9d6a5ed8-a14c-4a49-834a-b920b9e11571
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTACTS
        name: CURRENTYTD_NUMOFCONTACTS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dcf5f781-2b00-4e01-9503-c981ed1ab780
                stepCounter: 4015cdd7-ddd6-45b0-996c-53903de48f6b
            transform: COUNT (DISTINCT CONTACT.DIMCONTACTKEY)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD -- (LEVEL1FORCEID, LEVEL1DISPLAYACCOUNTNAME, NUMOFSUPPLIERSUSED, NUMOFCONTRACTSUSED, NUMOFCONTRACTCATEGORIESUSED, ASOFMAXRECEIPTDATE, MONTHSSINCELASTTRANSACTION, MOSTRECENTRECEIPTDATE, SUMOFSALES, SUMOFREVENUE, SUMOFREVENUE, RANKBYREVENUE, RANKBYSALES, NUMOFCONTACTS, DSSCREATETIME, DSSUPDATETIME)
            \N \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) AS CURRENTYTD_NUMOFSUPPLIERSUSED \N , COUNT (DISTINCT INITIALCONTRACTID) AS CURRENTYTD_NUMOFCONTRACTSUSED \N , COUNT (DISTINCT CONTRACTCATEGORY) AS CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED \N , MAX(MAXRECEIPTDATE) AS DSSMAXTRANSACTIONDATE \N , DATEDIFF(MONTH, MAX(TRANSACTIONDATE), MAX(MAXRECEIPTDATE)) AS CURRENTYTD_MONTHSSINCELASTTRANSACTION \N , MAX(TRANSACTIONDATE) AS CURRENTYTD_MOSTRECENTTRANSACTIONDATE \N , SUM(SALES) AS CURRENTYTD_SUMOFSALES \N , SUM(REVENUE) AS CURRENTYTD_SUMOFREVENUE \N , RANK() OVER (ORDER BY SUM(REVENUE) DESC) AS CURRENTYTD_RANKBYREVENUE \N , RANK() OVER (ORDER BY SUM(SALES) DESC) AS CURRENTYTD_RANKBYSALES \N , COUNT (DISTINCT DIMCONTACTKEY) AS CURRENTYTD_NUMOFCONTACTS \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N
              LEFT OUTER JOIN DIM.CONTACT AS CONTACT
                ON \N CONTACT.LEVEL1FORCEID = SALESANDREVENUE.LEVEL1FORCEID \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(YEAR,TRANSACTIONDATE,MAXRECEIPTDATE) = 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   SUPPLIERID;\N
        dependencies:
          - locationName: DIM
            nodeName: CONTACT
          - locationName: OP
            nodeName: OPSALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTACT') }}
            {{ ref('OP','OPSALESANDREVENUE') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
        noLinkRefs: []
  name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
