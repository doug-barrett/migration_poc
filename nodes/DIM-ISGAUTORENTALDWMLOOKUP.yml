fileVersion: 1
id: ef7adf10-d645-4308-87d6-cfdbb44e8402
name: ISGAUTORENTALDWMLOOKUP
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DIM
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2520a99b-22e1-44c1-88ae-bf9f2364f80e
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        isBusinessKey: true
        name: CHARGEDAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b573f009-600e-4be6-9c5d-55c4454b757d
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: WEEKDAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eaaba137-c3a1-4895-bd02-8cc00c377b11
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: MONTHDAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d84dd791-dbfa-47aa-be82-f3677b0ef8d9
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: BLMONTHS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3897c55f-af46-4e68-b892-f46e40f728d3
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: BLWEEKS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b027c84-9ce4-4312-a9f2-7995b1def578
          stepCounter: ef7adf10-d645-4308-87d6-cfdbb44e8402
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: BLDAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          ISGAUTORENTALDWMLOOKUP: ef7adf10-d645-4308-87d6-cfdbb44e8402
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('DIM','ISGAUTORENTALDWMLOOKUP') }} (ChargeDays, BLMonths, BLWeeks, BLDays, WeekDays, MonthDays) AS WITH DaysWeeksMonthsConfig AS (
                    SELECT 5.25 AS WeekDays,
                           20 AS MonthDays,
                           183 AS TotalDays
                   ),
                   DayCount AS (
                    SELECT seq4() AS ChargeDays
                      FROM TABLE(generator(rowcount => (SELECT TotalDays FROM DaysWeeksMonthsConfig))) v
                   ),
                   BaseData AS (
                    SELECT *
                      FROM DaysWeeksMonthsConfig,
                           DayCount
                   ),
                   BLMonths AS (
                    SELECT *,
                           FLOOR((ChargeDays+(30-MonthDays))/30) AS BLMonths
                      FROM BaseData
                   ),
                   BLWeeks AS (
                    SELECT *,
                           FLOOR((IFF(ChargeDays-(BLMonths*30)>0,ChargeDays-(BLMonths*30),0)+7-WeekDays)/7) AS BLWeeks
                      FROM BLMonths
                   ),
                   BLDays AS (
                    SELECT *,
                           IFF(ChargeDays-BLMonths*30-BLWeeks*7>0,ChargeDays-BLMonths*30-BLWeeks*7,0) AS BLDays
                      FROM BLWeeks
                   ) SELECT ChargeDays,
                   BLMonths,
                   BLWeeks,
                   BLDays,
                   WeekDays,
                   MonthDays
              FROM BLDays
        dependencies: []
        join:
          joinCondition: '-- Nodes used in the SQL override:'
        name: ISGAUTORENTALDWMLOOKUP
        noLinkRefs: []
  name: ISGAUTORENTALDWMLOOKUP
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
