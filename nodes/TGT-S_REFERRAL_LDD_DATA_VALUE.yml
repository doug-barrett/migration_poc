fileVersion: 1
id: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
name: S_REFERRAL_LDD_DATA_VALUE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5bea8a5-0c71-44a2-ad79-fb45cd66de79
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFRL_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01568488-c9c7-4129-991f-c4b5dc886de6
                stepCounter: 32661289-2246-4a7c-a2ad-9907fdccd6ac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e088c28-9cb8-406e-a731-35dc643bd05a
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DISABILITY_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WHDDT' THEN ds_pims_reference_values.rfval_refno ELSE NULL END,1000002586))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6283fcb-226c-4235-bd64-1dd76e7d8e75
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: DISABILITY_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WHDDT' THEN ds_pims_reference_values.main_code ELSE NULL END,'NSP'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 905cb0c1-fe3c-4f13-9394-37432d21a7fe
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DISABILITY_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WHDDT' THEN ds_pims_reference_values.description ELSE NULL END,'Not Specified'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9246b518-9cfc-4d34-bb03-07823df0b095
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: COURT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBC' THEN ds_pims_reference_values.rfval_refno ELSE NULL END,1000001160))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21063164-5a06-4ff5-b6d4-6be07ddc7feb
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: COURT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBC' THEN ds_pims_reference_values.main_code ELSE NULL END,'NSP'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 07d5aaa6-d040-40fd-9dea-02bea05959b9
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COURT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBC' THEN ds_pims_reference_values.description ELSE NULL END,'Not Specified'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 176e7ae7-d784-4f1e-b84f-3f37c14b879d
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: PRISON_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBP' THEN ds_pims_reference_values.main_code ELSE NULL END,'NSP'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64bdabba-a75a-4154-8f45-327a32fb6828
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRISON_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBP' THEN ds_pims_reference_values.rfval_refno ELSE NULL END,1000001174))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc22bc9a-6928-46e7-94d2-285bd8569c17
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PRISON_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHBP' THEN ds_pims_reference_values.description ELSE NULL END,'Not Specified'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c25640a2-a808-4e79-835c-eebbcbcbab08
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PRISON_LOCATION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHPL' THEN ds_pims_reference_values.rfval_refno ELSE NULL END,1000003126))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c90b6c2-1380-4a85-8f93-908fc6146a34
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: PRISON_LOCATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHPL' THEN ds_pims_reference_values.main_code ELSE NULL END,'NSP'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96c78629-7425-46a4-a92f-dfbcb457acc5
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PRISON_LOCATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'WDHPL' THEN ds_pims_reference_values.description ELSE NULL END,'Not Specified'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25e4d33d-4aab-4459-88c3-8a432911573d
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Temporary LDDI value for transfering patients to another DHB, this is while IPM is being set up to do this properly
        name: TRANSFER_OUT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97aebd53-8994-45f0-9fea-1b3150a90054
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'NPFTR' THEN ds_pims_reference_values.rfval_refno ELSE NULL END,0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 836777b5-9987-4d57-953e-61b1a9379542
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Temporary LDDI value for transfering patients to another DHB, this is while IPM is being set up to do this properly
        name: TRANSFER_OUT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'NPFTR' THEN ds_pims_reference_values.main_code ELSE NULL END,'NSP'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08b89f33-6dcc-4002-8ab2-30adc5c9729c
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: TRANSFER_OUT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: MAX(NULLIF(CASE WHEN ds_pims_reference_values.rfvdm_code = 'NPFTR' THEN ds_pims_reference_values.description ELSE NULL END,'Not Specified'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f7efda8-c1d7-4c48-9c66-c51889d18a3b
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: SORCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2574627-8c28-455b-a4fc-1ecdb5d9829b
                stepCounter: c5429209-b899-4e7f-9548-ca0e9a55f302
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6eb1a5b-ee31-432a-9ec7-785751c7d299
          stepCounter: 34a76a33-8369-4f07-bfed-e5f7cebaa4ef
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_SHARED_REFERRAL
        join:
          joinCondition: |-
            FROM ds_shared_referral,
                   ds_pims_ldd_local_datavalues,
                   ds_pims_reference_values
             WHERE ds_shared_referral.refrl_refno = ds_pims_ldd_local_datavalues.sorce_refno
               AND ds_pims_ldd_local_datavalues.sorce_code = 'REFRL'
               AND ds_pims_reference_values.rfvdm_code IN ('WHDDT','WDHBC','WDHBP','WDHPL','NPFTR')
               AND CONVERT(varchar, ds_pims_reference_values.rfval_refno) IN (USSOB_VALUE_1, USSOB_VALUE_2, USSOB_VALUE_3, USSOB_VALUE_4)
             GROUP BY ds_pims_ldd_local_datavalues.sorce_code,
                      ds_shared_referral.refrl_refno
        name: S_REFERRAL_LDD_DATA_VALUE
        noLinkRefs: []
  name: S_REFERRAL_LDD_DATA_VALUE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
