fileVersion: 1
id: ee2510fb-94ec-4119-a675-99fb10fceb80
name: S_OUTPATIENT_SLOT_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Summarise the time slot information into one row per time slot with counts for each visit type."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ec0396d-4c27-44eb-afa4-9a92acf9a769
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the slot within an outpatient session.
        name: OUTPATIENT_SLOT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64b794a7-1c1c-4054-ae0c-c779fdea256b
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f0bc5a5-dc9d-4ca5-87f5-78d1803e84f5
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the outpatient session.
        name: OUTPATIENT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f005bf4-03b4-40f0-8da3-79a4ea67b58d
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f00dbd5e-5c04-4d7e-a4fc-f8c9e3528bd1
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier of the outpatient clinic.
        name: OUTPATIENT_CLINIC_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 21b3d59a-3501-488b-9b8a-3eb64e6b7be3
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5a98d4b1-61c0-4a82-9ed4-8e43aa028acb
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time of the session slot.
        name: SLOT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 138d3536-6a32-484e-9a26-74ea5cb64730
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c991cb4c-bcb1-4344-9584-19b913ef4ce0
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: End date and time of the session slot.
        name: SLOT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 55143fda-ad6d-4f5c-aada-ca254ec07c7d
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b34d5da8-83c9-4c8e-8a0a-a3afd9b468e4
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Possible values include AVAIL (Available), NOLAV (No longer available), BUKED (Booked), RESRV (Reserved).
        name: SLOT_STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 811adacb-6e68-43b0-b62a-35a93df288c5
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59893625-5efe-451d-8de0-6b5bbd8d7c74
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Duration of a session slot in minutes.
        name: SLOT_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 62d09497-8564-4e26-9157-db4306b4e8f0
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 972201f1-c766-4fd8-b7ce-cae9f2b30443
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the session slot has been cancelled
        name: SLOT_CANCELLED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54b8c0c6-218f-49ca-9751-8425cd0badeb
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19506107-3bb0-4246-a12f-8ad3e33ae13c
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: 'Set to 1 if the slot is booked and so no longer available.  '
        name: SLOT_BOOKED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59e23920-c7d2-4c78-ae12-2d562d98704c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4cdaefd9-19ef-4724-b2ea-138015bb19ae
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the slot has a forced booking i.e. slot not normally available but has been booked anyway. Such bookings have no visit type.
        name: FORCED_BOOKING_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0dc2199b-a54d-4ae0-9797-1362b801a0c6
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: df74a4a3-40af-4340-af47-fe4224a000bb
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments booked in the slot.
        name: SLOT_BOOKING_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aede122f-5b31-407a-ad47-a45293a28d5d
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc3dda12-7335-41c8-8f22-a377b3e559b3
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FSA appointments available in the slot.
        name: SLOT_FSA_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code = 'N' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2fa650e6-f61f-4232-a819-43d76181016d
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FUP appointments available in the slot.
        name: SLOT_FUP_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code = 'O' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2208d7d9-02de-4a44-835c-11ad35a16ce4
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of Inpatient appointments available in the slot.
        name: SLOT_INPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code = 'INPAT' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8bcf2c0-aaa4-4b20-86f4-b1581a397cac
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of PAC appointments available in the slot.
        name: SLOT_PAC_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code = 'PAC' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b962012-465c-4dad-9e0a-38a1fae1add5
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of SOSFU appointments available in the slot.
        name: SLOT_SOSFU_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code = 'SOSFU' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 893cee82-acc4-40ab-a6a2-914697cec756
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments available in the slot that are not FSA, FUP, Inpatient, PAC or SOSFU.
        name: SLOT_OTHER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8751f6a4-baf7-48b1-b0c3-70abc15b433c
                stepCounter: c84a73e7-c410-440a-bbc7-9b0e810afff8
            transform: SUM(CASE WHEN visit_code NOT IN ('N','O','INPAT','PAC','SOSFU') THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d530c0f6-ad32-4544-9afc-957f09ca07ff
          stepCounter: ee2510fb-94ec-4119-a675-99fb10fceb80
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_OUTPATIENT_SLOT_10
        join:
          joinCondition: |-
            FROM s_outpatient_slot_10
             GROUP BY outpatient_slot_reference_no,
                      outpatient_session_reference_no,
                      outpatient_clinic_reference_no,
                      slot_start_date,
                      slot_end_date,
                      slot_status_code,
                      slot_duration,
                      slot_cancelled_flag,
                      slot_booked_flag,
                      forced_booking_flag,
                      slot_booking_count
        name: S_OUTPATIENT_SLOT_20
        noLinkRefs: []
  name: S_OUTPATIENT_SLOT_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
