fileVersion: 1
id: 81afa816-6419-4369-b99d-64d343dc3c40
name: STAFF_TEAMS_2_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a516f538-d6f9-4057-9c54-439d9f8c58ec
          stepCounter: 81afa816-6419-4369-b99d-64d343dc3c40
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SCHEDULE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9aa2600b-ca26-45ca-ae3f-9b834ef3d2e4
          stepCounter: 81afa816-6419-4369-b99d-64d343dc3c40
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SERVICE_POINT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 849899d1-23c5-4751-9dee-2a919651f1c0
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1dc6534b-1b48-41bf-9fd0-fc74e1db274d
          stepCounter: 81afa816-6419-4369-b99d-64d343dc3c40
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: STAFF_TEAM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1bd7cca6-1df9-4086-b7c7-4ad1f8d6e2e7
          stepCounter: 81afa816-6419-4369-b99d-64d343dc3c40
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINICIAN_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 455d7269-34d2-440e-b123-0e7ff8fe8978
                stepCounter: 3f7e4431-5c07-47a3-b850-49b3af652a4b
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE VIEW {{ this }}(schedule_reference_no, service_point_session_reference_no, staff_team_code, clinician_reference_no) AS SELECT ds_pims_schedules.schdl_refno schedule_reference_no,
                   ds_pims_schedules.spssn_refno service_point_session_reference_no,
                   s_staff_team.staff_team_code,
                   ds_pims_prof_carer_map.proca_refno clinician_reference_no
              FROM ds_pims_prof_carer_map
             INNER JOIN ds_pims_schedules
                ON ds_pims_schedules.schdl_refno = ds_pims_prof_carer_map.schdl_refno
             INNER JOIN s_staff_team
                ON s_staff_team.staff_team_reference_no = ds_pims_prof_carer_map.steam_refno
               AND s_staff_team.staff_team_code IN ('SUPRI','ANATH','ANATS','ANATE','SUASS','SUSEC')
             INNER JOIN s_staff_team_type
                ON s_staff_team_type.staff_team_type_reference_no = s_staff_team.staff_team_type_reference_no
               AND s_staff_team_type.staff_team_type_code = 'TT'
             INNER JOIN s_healthcare_professional_team_role
                ON s_healthcare_professional_team_role.healthcare_professional_team_role_reference_no = ds_pims_prof_carer_map.prrol_refno
               AND s_healthcare_professional_team_role.healthcare_professional_team_role_code = 'OPLIST'
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_SCHEDULES
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_PIMS_SCHEDULES') }}
        name: STAFF_TEAMS_2_V
        noLinkRefs: []
  name: STAFF_TEAMS_2_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
