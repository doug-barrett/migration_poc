fileVersion: 1
id: 9a51432f-3610-43ed-bdc7-358d5ba91531
name: S_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Fixes duplicated end_date values in load table."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8511c827-c217-4927-b70e-202ac3d1d9bb
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ROWID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b80c7de-ce21-40bb-b523-64780bda704a
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4f155ad-bd13-4695-9770-ce3e0ffda060
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 579f642f-f8cc-4950-9642-b2eb7c09edcb
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3621069f-30a2-40d0-ba63-9653aced21f7
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PROFESSIONAL_CARER_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4efec59f-8ff1-4f49-b4fa-64f862c9f8d6
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 142a6b16-f4ab-415c-83e9-9a9cf60225ef
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICIAN_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f01205db-caa0-49ab-85bd-0ec03975be2e
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7f55562-ed07-4caa-894b-7bbcb4a177e0
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: OCCUPATIONAL_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b502d19d-cc30-436e-a5b4-db8dd45a81b3
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f31cc05e-d284-4524-86b5-0c0ab4003f04
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e451b979-27a8-4277-8426-7b3218d01a58
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e2ee2bf4-8051-4f5a-b93c-a68e4b7c3881
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTACT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f7cb12c-06e1-4881-945c-3469fc74b2f2
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb35f712-4c71-49fd-9ad5-e3f83450f142
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTACT_PURPOSE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: de62f364-ad8c-4cb5-994e-d9a2f0aba475
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a69efa48-ce5c-4f49-83f3-1f6324f008d3
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: INT
        defaultValue: ""
        description: Numbers rows so that start/end dates can be repaired.
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: debf210c-f5e6-450c-a2da-b941bf5bdcc0
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 288bfa58-0d64-4955-9f3b-3c6fdeb24c24
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e03bf37-67d0-4619-8bfe-cb33cc32d428
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0836b8dd-e1bb-4a49-b693-ce802ecea50d
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cdcafe13-15cd-4a30-b28a-c1b73b1ce5d0
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: IIF(l_mappings_PurchaseUnit_CDS_Contacts_v.end_date > t2.start_date, DATEADD(SS, -1, t2.start_date), l_mappings_PurchaseUnit_CDS_Contacts_v.end_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9adce83-8939-4384-b5a0-a6ce6b1862cc
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ORIG_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cdcafe13-15cd-4a30-b28a-c1b73b1ce5d0
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 886ec2df-f8d7-4a56-a75b-808cd406f4df
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DEFAULT_PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3595d26-e997-4595-bf81-c3b2aa39ce59
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ae29560-7db1-4a94-98c7-d0710e7013d9
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DEFAULT_RC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 34f8cc54-b5f4-4ca3-b920-53f19a8ad234
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1aede745-f11d-4a32-9a01-d01ddc324c9a
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DEFAULT_PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b78663ec-119f-4d21-8924-b2e1543f0886
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4932c39d-ee2b-40b3-b469-d3da46d3f78e
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: MAPPED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 70d53874-a286-4aa5-9f28-c67c77c1c29b
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13173ad2-09d3-4023-88a2-801ffe0adaa9
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE_ADDED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 868fcdfe-d35d-4a9a-bd17-90d3b6b75349
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4397a368-a8e8-4265-b02a-47665c741144
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: EXAMPLE_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 373d5649-8201-43f3-a5b2-b6d981216f6d
                stepCounter: a91840cc-f7ba-4f4e-abb8-ef17335ce7ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7394462e-cd32-402b-afa8-b9d343264ab4
          stepCounter: 9a51432f-3610-43ed-bdc7-358d5ba91531
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS_V
        join:
          joinCondition: |-
            FROM l_mappings_PurchaseUnit_CDS_Contacts_v
              LEFT OUTER JOIN l_mappings_PurchaseUnit_CDS_Contacts_v t2
                ON l_mappings_PurchaseUnit_CDS_Contacts_v.Contact_Type = t2.Contact_Type
               AND l_mappings_PurchaseUnit_CDS_Contacts_v.Department = t2.Department
               AND l_mappings_PurchaseUnit_CDS_Contacts_v.Occupational_group = t2.Occupational_group
               AND l_mappings_PurchaseUnit_CDS_Contacts_v.Location = t2.Location
               AND l_mappings_PurchaseUnit_CDS_Contacts_v.professional_carer_reference_no = t2.professional_carer_reference_no
               AND IFNULL(l_mappings_PurchaseUnit_CDS_Contacts_v.contact_purpose_code, '') = IFNULL(t2.contact_purpose_code, '')
               AND l_mappings_PurchaseUnit_CDS_Contacts_v.row_num = t2.row_num - 1
        name: S_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS
        noLinkRefs: []
  name: S_MAPPINGS_PURCHASEUNIT_CDS_CONTACTS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
