fileVersion: 1
id: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
name: S_PJ_ALLIED_HEALTH
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Get all the Allied Health data required."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34d9d6c7-6ef8-43ba-9602-cafe251fe8a9
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique ID for a patient journey
        name: JOURNEY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f7dd4ca-4b72-4471-8e15-dd1ec0a54c3c
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09411880-941d-48e9-b6ef-3b58b77ecf5c
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7f60003-b7a5-4f17-92d1-b8cb3e8fce89
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a580def2-1d66-481f-b801-0e3d194c70f0
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Journey number for the patient.
        name: JOURNEY_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e8017333-8bf1-48d8-ae28-60f8be1ba8fd
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e82ca216-3a4f-4ddf-a53a-8786a0398712
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: encounter unique identifier
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 574b9ff8-3604-4f73-b718-1ec758c0ff18
                stepCounter: 025cc51b-16d6-4445-83f7-5229e679b705
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eebf9964-be73-4d4c-a8e4-61daf85c7dec
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: VARCHAR(9)
        defaultValue: ""
        description: Id that uniquely identifies the encounter in Allied Health.
        name: ALLIED_HEALTH_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dc9521dd-7c6a-4423-b13c-1d16d861a37a
                stepCounter: 109455e2-a90a-42a8-8f58-3f7d0b0ef799
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4433ea8b-bd2d-4e27-91e2-cea27a74c8ab
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SHIFT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66771c6b-2e8b-46c4-8417-717ba396f030
                stepCounter: 109455e2-a90a-42a8-8f58-3f7d0b0ef799
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb35722b-ea5a-4457-9802-45fd997df0f3
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Actual activity time in minutes
        name: ACTUAL_ACTIVITY_MINS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54d30a9d-1c56-4850-9421-bfc3fc241734
                stepCounter: 109455e2-a90a-42a8-8f58-3f7d0b0ef799
            transform: SUM(fact_allied_health_activity.actual_activity_mins)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7809fe22-1a94-41df-9e61-858b4d36ebeb
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: DISCIPLINE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92c37440-fdde-4666-bac9-715f1f83c455
                stepCounter: 3326b8b2-6f82-45a8-922e-8a92158ade59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22a46120-d0ed-40f7-a033-2bf90768ecd7
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Numbers rows for each journey_id, discipline_code combination in shift_date order.
        name: ROW_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY journey_id, discipline_code ORDER BY shift_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd511c04-e712-4f9d-bf99-8c7fbf4a79ec
          stepCounter: 06488a2b-70c1-4dfe-ba3d-7e29c99d4d3f
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_PJ_EVENT
        join:
          joinCondition: |-
            FROM s_PJ_event
              JOIN fact.fact_allied_health_activity
                ON fact_allied_health_activity.event_encounter_id = s_PJ_event.encounter_id
               AND fact_allied_health_activity.activity_declined_flag = 0 --AND fact_allied_health_activity.actual_activity_hours  > 0    JOIN dim.dim_allied_health_discipline  ON fact_allied_health_activity.dim_allied_health_discipline_key = dim_allied_health_discipline.dim_allied_health_discipline_key    GROUP BY    s_PJ_event.journey_id,    s_PJ_event.patient_NHI,    s_PJ_event.journey_num,    s_PJ_event.encounter_id,    fact_allied_health_activity.allied_health_id,    fact_allied_health_activity.shift_date,    dim_allied_health_discipline.discipline_code
        name: S_PJ_ALLIED_HEALTH
        noLinkRefs: []
  name: S_PJ_ALLIED_HEALTH
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
