fileVersion: 1
id: 89a3d047-ef50-4c61-b03b-096d3b4777fb
name: S_OUTPATIENT_APPOINTMENT_08
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: false
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8d45c41-66d3-4b55-9917-f114914beade
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SCHEDULE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76f34d6d-7e08-4486-91d9-357bcab3da02
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3452b29-c0cd-425a-9d1d-71e6d86d015f
                stepCounter: f11a6090-a295-49e8-9ae4-052de05fcf53
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e476d2dc-4aeb-49d7-be6c-dd2d1c4b28a3
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcd82ac3-a71e-438d-8dba-ddbe8f8e6878
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SERVICE_POINT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60d7e721-d720-4afb-8290-9abec86435e0
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7f12f50-0be3-403e-94b4-d831e16022a5
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_APPOINTMENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c445ede3-e893-46c2-b67b-30b5aa4e2a66
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: --COUNT(1) OVER (PARTITION BY ds_shared_schedule.patient_reference_no)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8631c6a-1f22-4971-8d20-be29ce918076
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_APPOINTMENT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecbb380e-9573-4336-84bf-fd9384f38c42
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: '#NAME?'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e4cd755-abb9-41a1-a595-19d057fa0872
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SESSION_APPOINTMENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb9953bc-7cdf-407f-b659-1a31dbd8e900
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: --CASE WHEN ds_shared_schedule.service_point_session_reference_no IS NULL THEN NULL ELSE COUNT(1) OVER (PARTITION BY ds_shared_schedule.service_point_session_reference_no) END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9980a5da-f471-48d2-9658-eb5abb0f74ef
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: SESSION_APPOINTMENT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: db538dc4-243e-4e3f-92a4-38dfe23e5d9e
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: '#NAME?'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f22946e4-4312-4997-bd76-4da04c08d6e9
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_APPOINTMENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63e237d2-3d0a-467c-bc34-48a77c9be643
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: --CASE WHEN ds_shared_schedule.referral_reference_no IS NULL THEN NULL ELSE COUNT(1) OVER (PARTITION BY ds_shared_schedule.referral_reference_no) END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64f44b9b-dbaf-457a-877d-2619f7231f07
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: REFERRAL_APPOINTMENT_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d730d666-95d1-4e85-9c9f-b32a306906b4
                stepCounter: 3dac6fb6-2ab0-47f6-9504-09cae4fd7470
            transform: '#NAME?'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db9a66bb-7b07-4cb1-8414-9a0a6b7759a8
          stepCounter: 89a3d047-ef50-4c61-b03b-096d3b4777fb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: UNKNOWN
            nodeName: DS_SHARED_SCHEDULE
        join:
          joinCondition: |-
            FROM s_outpatient_appointment_05
              JOIN {{ ref('UNKNOWN','DS_SHARED_SCHEDULE') }} ds_shared_schedule
                ON ds_shared_schedule.patient_reference_no = s_outpatient_appointment_05.patient_reference_no --and isnull(ds_shared_schedule.service_point_session_reference_no,0) = isnull(s_outpatient_appointment_05.service_point_session_reference_no,0)  join s_outpatient_appointment_08_v  on s_outpatient_appointment_08_v.schedule_reference_no = ds_shared_schedule.schedule_reference_no    WHERE schedule_type_code = 'OTPAT'  --and ds_shared_schedule.dss_update_time > @v_pa_theatre_incremental
        name: S_OUTPATIENT_APPOINTMENT_08
        noLinkRefs: []
  name: S_OUTPATIENT_APPOINTMENT_08
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
