fileVersion: 1
id: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
name: S_MERCHANT_AGREEMENT_PII_HISTORY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75caaa05-c952-40a5-a1f8-db6f6fc75554
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_MERCHANT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 35649734-d17e-401f-94cf-f97363a36db1
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d416637a-1c92-4359-b174-0bba72a6da36
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The Merchant Internal Number, the unique identifier to the system.
        isBusinessKey: true
        name: MERCHANT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ac0c623-413f-4d0c-b28a-e90ece841e46
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40dc9946-cb8a-429d-bd24-76c87cea6e11
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LST_UPD_UID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20acb5fc-18ea-4538-992e-82493b9a4a56
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3961792-d084-46f3-b1e2-8053baab37ff
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 752308d2-012f-44e7-984c-5f6c54a3c745
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 295a91b8-2d4d-4321-9648-9af9456cc84a
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4cfd8bb4-843d-4703-a6f5-9ea429f935e5
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44f466fd-bf1f-474b-8365-adc757f0832a
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 163e0976-0f75-40ac-ad0f-3a7140ba59ce
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b748401c-5d4b-4123-80d2-bcf7b4816f21
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f73c0f63-d51b-4c00-86fc-b60234c8dac5
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc2990a8-846a-4486-97ba-d00b5c552380
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e56a396b-5721-49fc-99b1-dec744a6070d
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf380d29-0cbb-4d5f-ac96-6952581dca11
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8564b497-297d-4d8f-bdba-aa4ee9b87251
                stepCounter: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f893ecfe-4a77-489f-a4bf-3ed4a7e948c9
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: End date determined by the next Satellite change record dss_start_date
        isSystemEndDate: true
        name: DSS_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LEAD(dss_start_date, 1, '9999-12-31') OVER(PARTITION BY hk_h_merchant ORDER BY dss_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b5942ed-6f37-4277-88fd-8b6c5827fe28
          stepCounter: 1e64bfea-4cbb-49e6-91b8-59d5af507f8d
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: CurrentFlag 'N' unless next Satellite change record dss_start_date is null, indicating this is the most current record.
        isSurrogateKey: true
        isSystemCurrentFlag: true
        name: DSS_CURRENT_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN LEAD(dss_start_date, 1, NULL) OVER(PARTITION BY hk_h_merchant ORDER BY dss_start_date) IS NULL THEN 'Y'
                          ELSE 'N'
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_MERCHANT_AGREEMENT_PII: 754e2f8a-1a1c-44ca-8f3e-b16b4518ed8b
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_MERCHANT_AGREEMENT_PII
        join:
          joinCondition: FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_AGREEMENT_PII') }} s_merchant_agreement_pii
        name: S_MERCHANT_AGREEMENT_PII_HISTORY
        noLinkRefs: []
  name: S_MERCHANT_AGREEMENT_PII_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
