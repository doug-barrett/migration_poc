fileVersion: 1
id: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
name: S_MERCHANT_AGREEMENT_PII_HISTORY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9537a09-fd33-4548-a767-41b483c2193d
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_MERCHANT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: baa5a806-32af-489f-abbd-b206cccd4edd
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6efd8b43-fe37-4ccc-9900-1d30202da8af
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The Merchant Internal Number, the unique identifier to the system.
        isBusinessKey: true
        name: MERCHANT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ef6e174-cf13-4a96-a84e-e3ad3f2b0fd8
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c3515fcf-a8ee-4a02-981f-16f1a54a3552
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LST_UPD_UID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7792b160-53d2-4d82-b5ae-edd58d1ecd84
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e76c3ded-fa74-4294-8d3e-9220fd4a6f14
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e0f2633-b181-48eb-b999-c5622b62289f
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ac90094-2b4c-4350-9963-f6dada4d5761
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c49ebfaf-8da1-433f-a25b-ebb7cf6a6238
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: feedceb7-0cb2-4cb4-a587-28a97cca684b
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18d6df1f-0849-41dc-a42f-fab9123ab05e
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d34141e-f2ec-4fd3-a3fa-e721e5adfa90
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8627a46-2822-4afe-b636-0b5bd4afad30
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b221813-5f12-4649-8143-91d5286c8ce0
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4697bfd-8bda-4e30-a693-08f362dfab91
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76a4b7ac-ce9e-499f-b23f-0be77cd659f4
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51f8f3ac-0d6c-4071-a901-873a7d10c91a
                stepCounter: 638ef79d-c166-4df6-92ac-bd764db15e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0eadfabf-b250-4077-8095-f464688c0b4c
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: End date determined by the next Satellite change record dss_start_date
        isSystemEndDate: true
        name: DSS_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: LEAD(dss_start_date, 1, '9999-12-31') OVER(PARTITION BY hk_h_merchant ORDER BY dss_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4dd77d5b-0cf5-4a8a-a4ac-355ed1a57671
          stepCounter: 186b05e4-cb4f-429e-8e5d-7747b366ceaf
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: CurrentFlag 'N' unless next Satellite change record dss_start_date is null, indicating this is the most current record.
        isSurrogateKey: true
        isSystemCurrentFlag: true
        name: DSS_CURRENT_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN LEAD(dss_start_date, 1, NULL) OVER(PARTITION BY hk_h_merchant ORDER BY dss_start_date) IS NULL THEN 'Y'
                          ELSE 'N'
                           END
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_MERCHANT_AGREEMENT_PII: 638ef79d-c166-4df6-92ac-bd764db15e52
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_MERCHANT_AGREEMENT_PII
        join:
          joinCondition: FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_AGREEMENT_PII') }} s_merchant_agreement_pii
        name: S_MERCHANT_AGREEMENT_PII_HISTORY
        noLinkRefs: []
  name: S_MERCHANT_AGREEMENT_PII_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
