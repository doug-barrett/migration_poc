fileVersion: 1
id: c6015070-b7c3-498f-9d21-f0fa8c01d392
name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 852699d9-f732-42f8-928e-59676bbeb793
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: WELLHEADER_IDWELL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50c64390-66ec-4073-90f1-8dcb45fb1d04
                stepCounter: 916c650e-a994-4ba8-998d-0998ffdbd809
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18a842e4-1e18-43d0-9696-68a2ca4b631a
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: JOBAFE_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3c29d37a-4d08-4d3a-9fb0-eb27d2fadc7e
                stepCounter: 13af06cf-2d84-4a9b-9c21-f717053339db
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 952c1192-6d55-481c-be31-afa5d23d4366
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: GL_ACCOUNT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3361fee1-f29a-425f-bfa8-2b6f6b054891
                stepCounter: 435a18b2-1dc7-4fc8-b5d0-3eab3af614fd
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc4ab247-4ee9-4b96-95e2-476dba0459cd
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: GL_ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e829d800-0601-467b-8bfc-1c5137835c45
                stepCounter: 435a18b2-1dc7-4fc8-b5d0-3eab3af614fd
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30164ec7-da3b-42c6-86f7-375ec13850e5
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT_FLPD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 187523fb-a066-413b-9dd3-2d7a27414d72
                stepCounter: e18b78ec-51b6-4772-bef1-4d3d9c5be49e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38820459-db00-4c7a-91ff-0b9419ebd1db
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: INVOICE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b154b07-d616-46d0-9236-ef5866271de0
                stepCounter: da942990-f8c6-4b3b-8228-c0b3b421d97c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 52ada326-e3cb-4cf6-a461-ce613d486289
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: INVOICE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e832aae4-3923-4dc1-83b3-6e4179f1a404
                stepCounter: da942990-f8c6-4b3b-8228-c0b3b421d97c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 94fff3c6-bab4-4dc2-aa62-97a2d429dcf4
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BUSINESS_ASSOCIATE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7529f5e9-fe91-4ae5-adb2-b76e952e6332
                stepCounter: da942990-f8c6-4b3b-8228-c0b3b421d97c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78d1cdc0-7918-4425-b6a7-5ce2557bc293
          stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: BUSINESS_ASSOCIATE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6e0fdee-c888-4f80-9478-b34416060c01
                stepCounter: da942990-f8c6-4b3b-8228-c0b3b421d97c
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_WVIEW_WBS_INVOICE_ACTUALS: c6015070-b7c3-498f-9d21-f0fa8c01d392
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_WVIEW_WBS_INVOICE_ACTUALS') }} AS SELECT wvheader.idwell WELLHEADER_IDWELL,
                   wvafe.idrec JOBAFE_IDREC,
                   gl_account.acct_desc GL_ACCOUNT_DESC,
                   gl_account.major_acct GL_ACCOUNT,
                   sum(lease_ops.CAD_AMT_FLPD) CAD_AMT_FLPD,
                   invoice.invoice_date INVOICE_DATE,
                   invoice.invoice_num INVOICE_NUM,
                   coalesce(invoice.business_associate_name,'UNKNOWN VENDOR') business_associate_name,
                   coalesce(invoice.business_associate_id, 'UNKNOWN') business_associate_id
              FROM BI_LEASE_OPS.FACT_LEASE_OPS_SAP lease_ops
              JOIN BI_LEASE_OPS.DIM_AFE_SAP afe
                ON lease_ops.dim_afe_key = afe.dim_afe_key
              JOIN BI_LEASE_OPS.DIM_INVOICE_SAP invoice
                ON lease_ops.dim_invoice_key = invoice.dim_invoice_key
              JOIN BI_LEASE_OPS.DIM_GL_ACCOUNT_SAP gl_account
                ON lease_ops.dim_gl_account_key = gl_account.dim_gl_account_key
              JOIN BI_LEASE_OPS.DIM_COST_CENTER_SAP cc
                ON lease_ops.dim_cost_center_key = cc.dim_cost_center_key
              JOIN BI_LEASE_OPS.DIM_LEDGER_SAP ledger
                ON lease_ops.dim_ledger_key = ledger.dim_ledger_key
              JOIN BI_LEASE_OPS.DIM_LEASE_OPS_HIER_SAP lines
                ON lease_ops.dim_lease_ops_hier_key = lines.dim_lease_ops_hier_key
              JOIN BI_LEASE_OPS.DIM_LEASE_OPS_VERSION_SAP scenario
                ON lease_ops.dim_lease_ops_version_key = scenario.dim_lease_ops_version_key
              JOIN BI_LEASE_OPS.DIM_GROSS_NET_SAP gross_net
                ON lease_ops.dim_gross_net_key = gross_net.dim_gross_net_key
              LEFT JOIN DS_WELLVIEW.WVT_WVWELLHEADER wvheader
                ON cc.cc_num = wvheader.usertxt3
              LEFT JOIN DS_WELLVIEW.WVT_WVJOBAFE wvafe
                ON regexp_replace(regexp_replace(regexp_replace(afe.afe_num,' S.',''),' R.',''),'R. ','') = regexp_replace(regexp_replace(regexp_replace(wvafe.afenumber,' S.',''),' R.',''),'R. ','')
               AND wvheader.idwell = wvafe.idwell
              LEFT JOIN DS_WELLVIEW.WVT_WVJOB wvjob
                ON wvafe.idrecparent = wvjob.idrec
             WHERE ledger.LEDGER_CODE = '0L'
               AND lines.flg_summary_subset = 'N'
               AND scenario.IDX = 1
               AND gross_net.GROSS_OR_NET_CODE = 'N'
               AND wvafe.afenumber IS NOT NULL
               AND wvheader.usertxt3 IS NOT NULL
             GROUP BY invoice.invoice_num,
                      invoice.invoice_date,
                      invoice.business_associate_name,
                      invoice.business_associate_id,
                      gl_account.acct_desc,
                      gl_account.major_acct,
                      wvafe.idrec,
                      wvheader.idwell ;
        dependencies:
          - locationName: TARGET
            nodeName: ODS_WVIEW_WVT_WVWELLHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_WVIEW_WVT_WVWELLHEADER') }}
        name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
        noLinkRefs: []
  name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
