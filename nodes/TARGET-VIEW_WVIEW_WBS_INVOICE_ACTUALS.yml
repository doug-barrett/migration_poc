fileVersion: 1
id: 146829bc-2eb5-4e37-90ab-ca666a28f86a
name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 421c784a-ab83-44e7-a1f9-8a508736edc8
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: WELLHEADER_IDWELL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1efd0fd4-05e0-4b54-9df2-a5b8ed23045f
                stepCounter: 83eb9dbf-0b83-4bd9-916d-e4c3098394aa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67ebcabc-05d6-478b-8d79-86264e0f4af2
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: JOBAFE_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 062258fe-ff2b-4a14-8ec2-09e0376377dc
                stepCounter: d5db9ea0-5e76-4b55-b7d6-79d03d63032f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e6374f2-9790-4ae5-bd5b-9b14b2ec1b92
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: GL_ACCOUNT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2237daf0-4078-468f-a937-1b6f0113f180
                stepCounter: eded27ac-fd68-4b41-8110-94b692c365d5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b9e0af4-c683-417a-a27e-ded67220d7a2
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: GL_ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aeaf7af2-259c-4377-80d4-ed33f3d2b453
                stepCounter: eded27ac-fd68-4b41-8110-94b692c365d5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f02f61c8-a52e-497f-963f-92a7a0aff259
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT_FLPD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 649815d8-e869-4801-8498-22340c3ea06c
                stepCounter: 5056d5d9-0fcf-47de-8ff6-c885edbeaf96
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8035281-2f4e-4686-b7b8-4c7d73433f7c
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: INVOICE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 53c7d4bb-508c-438c-9ef1-0b4069e5ed1c
                stepCounter: 1d34134b-57a2-432b-b3e2-cbfbc27ed60e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6a364bc-2302-492c-920f-ffcadd2985d4
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: INVOICE_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b256eec-f6fd-4860-83f1-ba00118fcb5b
                stepCounter: 1d34134b-57a2-432b-b3e2-cbfbc27ed60e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb0f62ad-d5ef-4e5c-b25b-e34d0b5b44f0
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BUSINESS_ASSOCIATE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 560ca710-0eb6-4d8f-b8d0-b144a15205a9
                stepCounter: 1d34134b-57a2-432b-b3e2-cbfbc27ed60e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2f2de50-0ed0-4c3d-9285-5314bc822e3c
          stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: BUSINESS_ASSOCIATE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e5bfdbb-4de6-4580-9253-e79ab6b9412d
                stepCounter: 1d34134b-57a2-432b-b3e2-cbfbc27ed60e
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_WVIEW_WBS_INVOICE_ACTUALS: 146829bc-2eb5-4e37-90ab-ca666a28f86a
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_WVIEW_WBS_INVOICE_ACTUALS') }} AS SELECT wvheader.idwell WELLHEADER_IDWELL,
                   wvafe.idrec JOBAFE_IDREC,
                   gl_account.acct_desc GL_ACCOUNT_DESC,
                   gl_account.major_acct GL_ACCOUNT,
                   sum(lease_ops.CAD_AMT_FLPD) CAD_AMT_FLPD,
                   invoice.invoice_date INVOICE_DATE,
                   invoice.invoice_num INVOICE_NUM,
                   coalesce(invoice.business_associate_name,'UNKNOWN VENDOR') business_associate_name,
                   coalesce(invoice.business_associate_id, 'UNKNOWN') business_associate_id
              FROM BI_LEASE_OPS.FACT_LEASE_OPS_SAP lease_ops
              JOIN BI_LEASE_OPS.DIM_AFE_SAP afe
                ON lease_ops.dim_afe_key = afe.dim_afe_key
              JOIN BI_LEASE_OPS.DIM_INVOICE_SAP invoice
                ON lease_ops.dim_invoice_key = invoice.dim_invoice_key
              JOIN BI_LEASE_OPS.DIM_GL_ACCOUNT_SAP gl_account
                ON lease_ops.dim_gl_account_key = gl_account.dim_gl_account_key
              JOIN BI_LEASE_OPS.DIM_COST_CENTER_SAP cc
                ON lease_ops.dim_cost_center_key = cc.dim_cost_center_key
              JOIN BI_LEASE_OPS.DIM_LEDGER_SAP ledger
                ON lease_ops.dim_ledger_key = ledger.dim_ledger_key
              JOIN BI_LEASE_OPS.DIM_LEASE_OPS_HIER_SAP lines
                ON lease_ops.dim_lease_ops_hier_key = lines.dim_lease_ops_hier_key
              JOIN BI_LEASE_OPS.DIM_LEASE_OPS_VERSION_SAP scenario
                ON lease_ops.dim_lease_ops_version_key = scenario.dim_lease_ops_version_key
              JOIN BI_LEASE_OPS.DIM_GROSS_NET_SAP gross_net
                ON lease_ops.dim_gross_net_key = gross_net.dim_gross_net_key
              LEFT JOIN DS_WELLVIEW.WVT_WVWELLHEADER wvheader
                ON cc.cc_num = wvheader.usertxt3
              LEFT JOIN DS_WELLVIEW.WVT_WVJOBAFE wvafe
                ON regexp_replace(regexp_replace(regexp_replace(afe.afe_num,' S.',''),' R.',''),'R. ','') = regexp_replace(regexp_replace(regexp_replace(wvafe.afenumber,' S.',''),' R.',''),'R. ','')
               AND wvheader.idwell = wvafe.idwell
              LEFT JOIN DS_WELLVIEW.WVT_WVJOB wvjob
                ON wvafe.idrecparent = wvjob.idrec
             WHERE ledger.LEDGER_CODE = '0L'
               AND lines.flg_summary_subset = 'N'
               AND scenario.IDX = 1
               AND gross_net.GROSS_OR_NET_CODE = 'N'
               AND wvafe.afenumber IS NOT NULL
               AND wvheader.usertxt3 IS NOT NULL
             GROUP BY invoice.invoice_num,
                      invoice.invoice_date,
                      invoice.business_associate_name,
                      invoice.business_associate_id,
                      gl_account.acct_desc,
                      gl_account.major_acct,
                      wvafe.idrec,
                      wvheader.idwell ;
        dependencies:
          - locationName: TARGET
            nodeName: ODS_WVIEW_WVT_WVWELLHEADER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_WVIEW_WVT_WVWELLHEADER') }}
        name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
        noLinkRefs: []
  name: VIEW_WVIEW_WBS_INVOICE_ACTUALS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
