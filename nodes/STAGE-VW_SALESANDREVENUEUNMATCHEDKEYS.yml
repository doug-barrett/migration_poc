fileVersion: 1
id: 2273b09e-0568-43df-9b56-035ba851ee63
name: VW_SALESANDREVENUEUNMATCHEDKEYS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef5e27e6-1821-4d6d-87ad-efa26da4fe9f
          stepCounter: 2273b09e-0568-43df-9b56-035ba851ee63
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: LOADDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcb2f400-5539-41bc-ab44-d0249c78b88e
          stepCounter: 2273b09e-0568-43df-9b56-035ba851ee63
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: KEYNAME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a7366a9-ac4b-412b-959d-232c35a14d18
          stepCounter: 2273b09e-0568-43df-9b56-035ba851ee63
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: KEYCOUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref('UNKNOWN','VWSALESANDREVENUEUNMATCHEDKEYS') }}(\NLOADDATE, \NKEYNAME, \NKEYCOUNT \N) \NAS \NWITH CTE \N AS (
                    SELECT SUM(CASE WHEN ACCOUNTGEOGRAPHYKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTGEOGRAPHYKEY, \N SUM(CASE WHEN ACCOUNTHIERARCHYKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTHIERARCHYKEY, \N SUM(CASE WHEN ACCOUNTKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTKEY, \N SUM(CASE WHEN CONTRACTKEY = 0 THEN 1 ELSE 0 END) AS CONTRACTKEY, \N SUM(CASE WHEN DIRECTSALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS DIRECTSALESTERRITORYKEY, \N SUM(CASE WHEN FINANCIALSALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS FINANCIALSALESTERRITORYKEY , \N SUM(CASE WHEN ORGANIZATIONKEY = 0 THEN 1 ELSE 0 END) AS ORGANIZATIONKEY, \N SUM(CASE WHEN RECEIPTDATEKEY = 0 THEN 1 ELSE 0 END) AS RECEIPTDATEKEY, \N SUM(CASE WHEN REVENUEBUDGETFORCEIDDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETFORCEIDDETAILKEY, \N SUM(CASE WHEN REVENUEBUDGETFORCEIDDIRECTDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETFORCEIDDIRECTDETAILKEY, \N SUM(CASE WHEN REVENUEBUDGETPDDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETPDDETAILKEY, \N SUM(CASE WHEN SALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS SALESTERRITORYKEY, \N SUM(CASE WHEN SUPPLIERKEY = 0 THEN 1 ELSE 0 END) AS SUPPLIERKEY, \N SUM(CASE WHEN TRANSACTIONDATEKEY = 0 THEN 1 ELSE 0 END) AS TRANSACTIONDATEKEY, \N MAX(DSS_LOAD_DATE) AS LOADDATE \N \N
                      FROM STAGE.STAGESALESMERGE_ADDKEYS AS SMAK \N
                     WHERE ACCOUNTGEOGRAPHYKEY = 0 \N
                        OR ACCOUNTHIERARCHYKEY = 0 \N
                        OR ACCOUNTKEY = 0 \N
                        OR CONTRACTKEY = 0 \N
                        OR DIRECTSALESTERRITORYKEY = 0 \N
                        OR FINANCIALSALESTERRITORYKEY = 0 \N
                        OR ORGANIZATIONKEY = 0 \N
                        OR RECEIPTDATEKEY = 0 \N
                        OR REVENUEBUDGETFORCEIDDETAILKEY = 0 \N
                        OR REVENUEBUDGETFORCEIDDIRECTDETAILKEY = 0 \N
                        OR REVENUEBUDGETPDDETAILKEY = 0 \N
                        OR SALESTERRITORYKEY = 0 \N
                        OR SUPPLIERKEY = 0 \N
                        OR TRANSACTIONDATEKEY = 0
                   ) \N SELECT LOADDATE, \N KEYNAME, \N KEYCOUNT \N
              FROM CTE UNPIVOT(KEYCOUNT FOR KEYNAME IN(\N ACCOUNTGEOGRAPHYKEY , \N ACCOUNTHIERARCHYKEY , \N ACCOUNTKEY , \N CONTRACTKEY , \N DIRECTSALESTERRITORYKEY , \N FINANCIALSALESTERRITORYKEY, \N ORGANIZATIONKEY , \N RECEIPTDATEKEY , \N REVENUEBUDGETFORCEIDDETAILKEY, \N REVENUEBUDGETFORCEIDDIRECTDETAILKEY, \N REVENUEBUDGETPDDETAILKEY , \N SALESTERRITORYKEY , \N SUPPLIERKEY)) AS UNPVT \N
             ORDER BY KEYNAME
        dependencies:
          - locationName: UNKNOWN
            nodeName: VWSALESANDREVENUEUNMATCHEDKEYS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('UNKNOWN','VWSALESANDREVENUEUNMATCHEDKEYS') }}
        name: VWSALESANDREVENUEUNMATCHEDKEYS
        noLinkRefs: []
  name: VW_SALESANDREVENUEUNMATCHEDKEYS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
