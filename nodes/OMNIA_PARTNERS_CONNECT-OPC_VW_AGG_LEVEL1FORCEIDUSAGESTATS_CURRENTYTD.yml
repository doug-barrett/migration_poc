fileVersion: 1
id: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CURRENTYTD
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "YTD AGGREGATE USAGE STATISTICS FOR EACH LEVEL1FORCEID"
  isMultisource: false
  locationName: OMNIA_PARTNERS_CONNECT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93e71518-75e0-49ca-8713-28163e44dc79
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: LEVEL1FORCEID
        name: LEVEL1FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebddc1ec-03f3-4ca6-9b55-ba9f07816acd
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a4dc7a2-c4d3-4d81-9560-65ad49883a96
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: SUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01ae3ae0-c5ee-4730-b128-2a004fb30eab
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 335e717f-b172-4d15-9fa7-d12430c172ad
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: DATE
        defaultValue: ""
        description: DSSMAXTRANSACTIONDATE
        name: DSSMAXTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4b1df2a-baf7-4982-b541-30178d8c5755
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: MAX(OPSALESANDREVENUE.MAXRECEIPTDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 83048e73-9ef8-45f9-b29d-20719450673e
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: DATE
        defaultValue: ""
        description: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        name: CURRENTYTD_MOSTRECENTTRANSACTIONDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f2efedf3-6aa1-454c-bc3a-699e40896d1c
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: MAX(OPSALESANDREVENUE.TRANSACTIONDATE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c40c2704-04ab-4903-acc9-c738ee53ad17
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        name: CURRENTYTD_MONTHSSINCELASTTRANSACTION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f2efedf3-6aa1-454c-bc3a-699e40896d1c
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: DATEDIFF(MONTH,MAX(OPSALESANDREVENUE.TRANSACTIONDATE),MAX(OPSALESANDREVENUE.MAXRECEIPTDATE))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4e3e623-21b6-40bc-8141-17903fbfc519
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFSUPPLIERSUSED
        name: CURRENTYTD_NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: afa58226-55f1-416b-9069-342e9d697241
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: COUNT(DISTINCT OPSALESANDREVENUE.FINANCIALREPORTINGSUPPLIERNAME) OVER (PARTITION BY OPSALESANDREVENUE.LEVEL1FORCEID) \N
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19e5c7df-0a5e-4f6f-804c-52e3ad082dfe
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTSUSED
        name: CURRENTYTD_NUMOFCONTRACTSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d03eb64-65c5-4d9b-8b1b-f4063c45a714
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: COUNT(DISTINCT OPSALESANDREVENUE.INITIALCONTRACTID)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e255c55-91d0-4ca3-8980-533ab6d82186
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        name: CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 952ef1bd-f360-4972-970a-1e4c33581452
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: COUNT(DISTINCT OPSALESANDREVENUE.CONTRACTCATEGORY)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3afb6482-9f70-46b8-aa4d-9e7568f99efc
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFSALES
        name: CURRENTYTD_SUMOFSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd9aadb2-f8b1-40d5-aa32-e2e0a70f860a
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: SUM(OPSALESANDREVENUE.SALES)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f829d74-518f-4e1e-bbe7-c0c2f4fd6b3e
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_SUMOFREVENUE
        name: CURRENTYTD_SUMOFREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5be108e-317c-4777-a760-f19f598c7b01
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: SUM(OPSALESANDREVENUE.REVENUE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e55b7424-685f-410e-a555-a9a3d7c7b46f
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYSALES
        name: CURRENTYTD_RANKBYSALES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd9aadb2-f8b1-40d5-aa32-e2e0a70f860a
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.SALES) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d599158-6f16-40f9-9c88-a2d7ec9a7b4a
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_RANKBYREVENUE
        name: CURRENTYTD_RANKBYREVENUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5be108e-317c-4777-a760-f19f598c7b01
                stepCounter: 3f7a6e30-b5e5-4304-8352-fc30511415ba
            transform: RANK() OVER (ORDER BY SUM(OPSALESANDREVENUE.REVENUE) DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca41d865-2399-46a8-8c37-642def3e5749
          stepCounter: dbc1e7c7-b1b3-4885-b9dd-51aad8092763
        config: {}
        dataType: INT
        defaultValue: ""
        description: CURRENTYTD_NUMOFCONTACTS
        name: CURRENTYTD_NUMOFCONTACTS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 976b3ce8-1550-4210-b1a5-ca1733e41661
                stepCounter: 48094b19-3332-40c8-a5ed-b656d7687e09
            transform: COUNT (DISTINCT CONTACT.DIMCONTACTKEY)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW OPC.VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD -- (LEVEL1FORCEID, LEVEL1DISPLAYACCOUNTNAME, NUMOFSUPPLIERSUSED, NUMOFCONTRACTSUSED, NUMOFCONTRACTCATEGORIESUSED, ASOFMAXRECEIPTDATE, MONTHSSINCELASTTRANSACTION, MOSTRECENTRECEIPTDATE, SUMOFSALES, SUMOFREVENUE, SUMOFREVENUE, RANKBYREVENUE, RANKBYSALES, NUMOFCONTACTS, DSSCREATETIME, DSSUPDATETIME)
            \N \NAS \NSELECT \N SALESANDREVENUE.LEVEL1FORCEID AS LEVEL1FORCEID \N , SALESANDREVENUE.LEVEL1DISPLAYACCOUNTNAME AS LEVEL1DISPLAYACCOUNTNAME \N , SALESANDREVENUE.SUPPLIERID AS SUPPLIERID \N , COUNT (DISTINCT FINANCIALREPORTINGSUPPLIERNAME) AS CURRENTYTD_NUMOFSUPPLIERSUSED \N , COUNT (DISTINCT INITIALCONTRACTID) AS CURRENTYTD_NUMOFCONTRACTSUSED \N , COUNT (DISTINCT CONTRACTCATEGORY) AS CURRENTYTD_NUMOFCONTRACTCATEGORIESUSED \N , MAX(MAXRECEIPTDATE) AS DSSMAXTRANSACTIONDATE \N , DATEDIFF(MONTH, MAX(TRANSACTIONDATE), MAX(MAXRECEIPTDATE)) AS CURRENTYTD_MONTHSSINCELASTTRANSACTION \N , MAX(TRANSACTIONDATE) AS CURRENTYTD_MOSTRECENTTRANSACTIONDATE \N , SUM(SALES) AS CURRENTYTD_SUMOFSALES \N , SUM(REVENUE) AS CURRENTYTD_SUMOFREVENUE \N , RANK() OVER (ORDER BY SUM(REVENUE) DESC) AS CURRENTYTD_RANKBYREVENUE \N , RANK() OVER (ORDER BY SUM(SALES) DESC) AS CURRENTYTD_RANKBYSALES \N , COUNT (DISTINCT DIMCONTACTKEY) AS CURRENTYTD_NUMOFCONTACTS \N , GETDATE() AS DSSCREATETIME \N , GETDATE() AS DSSUPDATETIME \N
              FROM \N OP.OPSALESANDREVENUE AS SALESANDREVENUE \N
              LEFT OUTER JOIN DIM.CONTACT AS CONTACT
                ON \N CONTACT.LEVEL1FORCEID = SALESANDREVENUE.LEVEL1FORCEID \N -- AND ISCAPITALCONTRACT = 0 --EXCLUDE CAPITAL CONTRACTS
            \N
             WHERE DATEDIFF(YEAR,TRANSACTIONDATE,MAXRECEIPTDATE) = 0 \N
             GROUP BY \N SALESANDREVENUE.LEVEL1FORCEID,
                   LEVEL1DISPLAYACCOUNTNAME,
                   SUPPLIERID;\N
        dependencies:
          - locationName: DIM
            nodeName: CONTACT
          - locationName: OP
            nodeName: OPSALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTACT') }}
            {{ ref('OP','OPSALESANDREVENUE') }}
        name: OPC_VWAGGLEVEL1FORCEIDUSAGESTATS_CURRENTYTD
        noLinkRefs: []
  name: OPC_VW_AGG_LEVEL1FORCEIDUSAGESTATS_CURRENTYTD
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
