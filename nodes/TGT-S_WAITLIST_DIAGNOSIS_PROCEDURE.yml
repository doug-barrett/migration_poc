fileVersion: 1
id: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
name: S_WAITLIST_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1473843e-136a-44d4-81a2-6c83b11a79fa
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: DGPRO_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f49ba7ec-9b7c-499d-ae59-ed3ecd3a63a5
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c6b36c5-0878-4ca6-9c4c-bd99c1822a60
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4c372ad-7e3b-459a-89ad-ec53d1b8cb49
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa10d439-60f2-4435-a6c4-20d81d1b0804
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: WAITLIST_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ec8272b-f72d-4ecf-aa7b-a61679fff722
                stepCounter: 0e59e3db-b31a-4a51-a1c6-783b4fb7ebb6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e33aa902-d6bb-4753-9a3f-252207bbe398
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: WAITLIST_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 72ac5d31-0410-466a-83cf-88855b88368c
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: "'W'+CONVERT(varchar,ds_pims_waiting_list_entries.wlist_refno)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e764504-7007-4bd1-9806-0c0670be3409
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_waitlist_diagnosis_procedure.waiting_start_date=dim_waiting_start_date.waiting_start_calendar_date
        name: DIM_WAITING_START_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e6aa523-c796-4463-a114-18919b4494e2
                stepCounter: ea840484-f70c-4bad-aad7-a289315c11d8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a3d6e2e-a78d-47f5-91b7-a4abd05c87f6
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: WAITING_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a977f9e-b766-4b63-9fad-8ebc40710eab
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f61b482-2444-4fde-8016-29ef3b6de678
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e16ad8e0-4912-482e-9888-176f95f3db3e
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8e1c6b4-058f-4c27-a4cc-0247027ef794
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985f0ba0-97cf-4152-a49b-7e86cb71409e
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a996737-5734-4e47-bba2-65eb54ae0553
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_waitlist_diagnosis_procedure.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 486099d1-4f25-48eb-8e85-8c9a4e18de3e
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7dcad9a6-52b1-402a-a292-1118300823b9
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 438c9785-4508-46db-9910-12c9ef63e38a
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f63ac616-79ac-4e89-9af3-4eef8adcffa5
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 271efe56-3d39-4d18-b5a7-7e1dcc80d250
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2cf9131-34bb-4a33-ba91-da3d2da52bb0
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_SUBTYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c86b4c8-d58c-4be5-993f-aee643ff17b8
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecc036db-91d2-4737-b93c-f3e449aa298e
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0353e3b8-bb7c-4946-8918-e82120b5ce12
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d897b24-82bb-4a0a-9ed3-6167609daa64
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ae1a398a-9c7b-4fad-b7e2-8e105705ec6f
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ce60c433-58b9-41ea-b373-dda7c4c63ca6
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 474d7c94-2844-4fd3-a545-689f9362af17
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4ab650d-fb86-412d-bc3f-9aa3ab74a80b
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_waitlist_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: DIM_DIAGNOSIS_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24cebf11-1bcf-4240-a364-9b0f51cffc73
                stepCounter: 5c3dba16-610b-4df4-a82e-a17b4d31bb68
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c8164ec-1f9a-4991-84a6-45e316d26dc4
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e16ad8e0-4912-482e-9888-176f95f3db3e
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_waiting_list_entries.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_waiting_list_entries.wlist_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54d5def5-ce6e-4cf8-805d-519f02548f3c
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e16ad8e0-4912-482e-9888-176f95f3db3e
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN COUNT(1) OVER (PARTITION BY ds_pims_waiting_list_entries.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab5a77b7-1c09-4c39-bc8f-568496335dc4
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e16ad8e0-4912-482e-9888-176f95f3db3e
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_waiting_list_entries.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_waiting_list_entries.wlist_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f046521-1c21-45ce-b0a6-6bf77328e0d8
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_PROCEDURE_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e16ad8e0-4912-482e-9888-176f95f3db3e
                stepCounter: 5bae6c33-9021-48f2-90a9-01c3d6e29585
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN COUNT(1) OVER (PARTITION BY ds_pims_waiting_list_entries.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6edb4e32-5ea8-4500-8d78-b8e693ad70c4
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ICD10_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b799a6ca-241a-4223-a1ef-93b4640430cd
                stepCounter: 74cee5ef-711a-4220-9a8d-feaea60f1b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ddce62c6-52c3-43b7-8468-7eb5160b362d
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PROCEDURE_NBRS_SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5d69f18c-f3df-4232-b7d8-e8c82ebb2973
                stepCounter: 74cee5ef-711a-4220-9a8d-feaea60f1b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1fd8f9e-7e19-4e43-920c-defc437c08b0
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 614e95dd-dc83-4fb6-80e2-eae0b812a7b5
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef2493bf-b2e0-4370-84e7-11a2e499f361
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f2de421-29ae-4da9-a753-3f3076972d72
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9694a58f-46ff-47e3-a9c7-f256857d42f7
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_waitlist_diagnosis_procedure.create_user_login_code=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dfe5e14-cc2f-4748-8352-a6d1621289af
                stepCounter: 70bd6ed5-e21b-440f-9079-7fe305bc4f30
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b6e1f81-57a2-4485-8674-4bb549cd4d1a
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6decebff-eb31-4277-aa08-3a795ec793df
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e931a4c-dc45-4504-a681-3fa375fd6ec9
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0018f473-59d0-4576-9d88-96374fcf8639
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e5546ef-231f-4a1c-8e1f-d65cdbafb73a
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_waitlist_diagnosis_procedure.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ceaa34a6-dd0b-40fb-bc61-9df93cc05e7b
                stepCounter: bef0768d-dddb-4d02-af8d-03160de42b62
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d5aa921-8b4c-4d6b-9d53-1aecfe47e3aa
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: WAITLIST_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dcc9fdaf-f0ec-45e0-a51f-9cc3935f3538
          stepCounter: cdfc8ab4-a40a-431c-a87a-fa14a4d1535c
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_WAITLIST_NBRS_PROCEDURE_ICD_CODE: 74cee5ef-711a-4220-9a8d-feaea60f1b01
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_DIAGNOSIS_PROCEDURES
          - locationName: TGT
            nodeName: S_WAITLIST_NBRS_PROCEDURE_ICD_CODE
        join:
          joinCondition: |-
            FROM ds_pims_waiting_list_entries
             INNER JOIN s_waitlist_09
                ON s_waitlist_09.wlist_refno= ds_pims_waiting_list_entries.wlist_refno
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_waiting_list_entries.wlist_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_diagnosis_procedures.mplev_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_diagnosis_procedures.cptyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.main_code = ds_pims_diagnosis_procedures.CCSXT_Code
               AND ds_pims_reference_values3.rfvdm_code = 'CCSXT'
              LEFT OUTER JOIN {{ ref('TGT','S_WAITLIST_NBRS_PROCEDURE_ICD_CODE') }}
                ON ds_pims_diagnosis_procedures.sorce_refno = s_waitlist_NBRS_procedure_ICD_code.wlist_refno
               AND ds_pims_diagnosis_procedures.code = [s_waitlist_NBRS_procedure_ICD_code].procedure_code
               AND IFNULL(mapping_sequence,1) = 1
             WHERE ds_pims_diagnosis_procedures.sorce_code = 'WLIST'
        name: S_WAITLIST_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_WAITLIST_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
