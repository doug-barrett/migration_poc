fileVersion: 1
id: aaab4c91-623b-4d9e-8a54-1db3d396fc34
name: S_EDS_DIAGNOSIS_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe3c8893-4c09-41f8-b892-26e55232c0f8
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIAGNOSIS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe3c6ebd-cc14-4df3-b3f3-d73108c802d8
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: NVARCHAR(20)
        defaultValue: ""
        description: ""
        name: TEMPLATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4d3635ef-d23f-42de-804d-2dd4527e22cb
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f31b68c9-a4b8-4f3a-b095-84801f403215
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: ""
        name: TEMPLATE_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87e37259-65d9-4d6b-9c12-3d0f141f35d7
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e806e379-731b-4d9e-8741-7a7b10a24cf9
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: DISCHARGE_EVENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 69bfbb56-a985-4540-ba5a-2a7b81db6aa9
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b07a3da9-7875-49a1-81d5-8c0ffa599858
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8cdc254-6f54-4020-9901-149ab15b7fd0
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: EVENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b07a3da9-7875-49a1-81d5-8c0ffa599858
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: |-
              CASE WHEN isnumeric(substring(ds_EDS_Document.extEventId,2,100)) = 1 THEN cast(substring(ds_EDS_Document.extEventId,2,100) AS int)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c818aa30-51b2-4e8f-94dd-bb5d4a01a14b
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_EDS_Document.extEventId ORDER BY ds_EDS_Diagnosis.isPrimary DESC ,IFNULL(ds_pims_odpcd_codes.code,tt.code) ,ds_EDS_Diagnosis.diagnosisId)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 594941a3-ede1-4586-87f8-2eb11a165536
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5c1d681d-fba6-4c9e-bfdf-cc4bbe97e046
                stepCounter: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa76ac58-9076-46bd-b1b8-65753b1871a7
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 329a6d1b-5b39-4dfd-82fa-2e762007a742
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5d68a5e-1e4a-4642-b5e1-c64c5e8cbdb3
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 14105a56-b26d-418b-8544-ced14941f238
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa675329-4f11-4313-be3f-08d57fdc5cdf
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCHARGE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 86611718-a6fb-4347-a7ab-74b06b508503
                stepCounter: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0575dd1b-74ce-4d9d-b6c3-27550780c971
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: ODPCD_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52236722-6d5f-49c3-b9a8-0b3e9a7b583f
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: IFNULL(ds_pims_odpcd_codes.odpcd_refno,tt.odpcd_refno)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 389717f0-9ea3-4e5f-acfa-32a203723262
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_odpcd_codes.code,tt.code)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c1aa195-c4de-4607-bd9a-adbdea0f8db6
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_EDS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 586e906e-620a-4d71-a2db-9172b3f3de15
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_IPM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce926fd2-6430-4eb3-b6ba-fb347c954088
                stepCounter: 314df606-ff6a-4436-bfb4-272353ca2b9e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40164967-ff4e-4f04-be8a-b8a44e55efcc
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_CODE_IPM_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e910687-29ee-4bdf-b1fc-70cc15574754
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0eaf53aa-2fb7-4d4f-a04a-fd63d09e49d5
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CODING_SYSTEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12cde880-628f-46c8-b994-6fc4ac468f7d
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: Y/N primary diagnosis indicator
        name: IS_PRIMARY_DIAGNOSIS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f32714e-6634-4fb3-9387-4a68280403a9
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c10f446-8171-4f90-aa5d-21b8ea8b0ba1
          stepCounter: aaab4c91-623b-4d9e-8a54-1db3d396fc34
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_EDS_DOCUMENT: af0d93b4-5c32-4e21-9a78-ad0b6557b0c1
          DS_PIMS_PATIENTS: 34c6fd4e-f463-4453-bad1-3a1d762d3caa
          L_REFERENCE_TESTPATIENTS: 7a88f4e3-512a-476a-a161-018aae5e8bff
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_EDS_DIAGNOSIS
          - locationName: UNKNOWN
            nodeName: DS_EDS_DIAGNOSIS
          - locationName: TGT
            nodeName: DS_EDS_DOCUMENT
          - locationName: TGT
            nodeName: DS_PIMS_PATIENTS
          - locationName: TGT
            nodeName: L_REFERENCE_TESTPATIENTS
        join:
          joinCondition: |-
            FROM {{ ref('UNKNOWN','DS_EDS_DIAGNOSIS') }}
              LEFT OUTER JOIN {{ ref('TGT','DS_EDS_DOCUMENT') }}
                ON ds_EDS_Diagnosis.dischargeEventId = ds_EDS_Document.dischargeEventId
              LEFT OUTER JOIN dbo.[ds_pims_odpcd_codes]
                ON ds_EDS_Diagnosis.code = ds_pims_odpcd_codes.code --and ds_EDS_Document.dischargeDate between [ds_pims_odpcd_codes].start_dttm and IFNULL([ds_pims_odpcd_codes].end_dttm,getdate())    and ds_pims_odpcd_codes.ccsxt_code = 'AEDIG'         LEFT OUTER JOIN dbo.[ds_pims_odpcd_codes] tt    ON ds_EDS_Diagnosis.code+'.' = tt.code and tt.ccsxt_code = 'AEDIG'      LEFT OUTER JOIN {{ ref('TGT','DS_PIMS_PATIENTS') }}  ON ds_EDS_Document.patientId = ds_pims_patients.pasid    LEFT OUTER JOIN {{ ref('TGT','L_REFERENCE_TESTPATIENTS') }}  ON ds_EDS_Document.patientId = l_Reference_testpatients.nmpi and l_Reference_testpatients.nmpi is null
        name: S_EDS_DIAGNOSIS_20
        noLinkRefs: []
  name: S_EDS_DIAGNOSIS_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
