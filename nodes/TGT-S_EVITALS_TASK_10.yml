fileVersion: 1
id: dbf723f8-7da4-4b3b-951d-d8678527a4e8
name: S_EVITALS_TASK_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Get details of tasks from Patientrack and link them to nearest observation set."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2de3582b-01c3-4972-bda4-6072352ec958
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADMISSION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f68edb3-1e8d-48b7-8850-2400c40ab4f7
                stepCounter: 6866bc35-1164-43e9-9ff9-15b44d426855
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60eda427-5515-4c04-948c-8148929c004b
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: FORM_INSTANCE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 10c31c9b-732b-4dbb-99d9-0b5a9d645da7
                stepCounter: e44bacd2-61b5-40f4-bf74-921aac5f3b29
            transform: COALESCE(NULLIF(ds_Patientrack_TASK.form_instance_id, 0), s_eVitals_task_08.form_instance_id)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb7a08b6-b11d-42d4-9aa1-aa117cbab044
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FORM_CREATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea0bf6ea-dbad-4d1b-918e-dfa0238e8bbc
                stepCounter: e44bacd2-61b5-40f4-bf74-921aac5f3b29
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a0aa8f2c-a3a1-490a-82dd-336f1c301511
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: TASK_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77816af4-aa7a-405c-aaee-cf1bf08ef86a
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e341e773-4a38-4474-ae5f-f3c9c63f2f78
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 358be7ab-ae47-4f66-8400-773a47d32093
                stepCounter: a8e499ca-300b-48a9-9045-922a42433271
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f408d13b-7207-4741-8bee-8ff5a4ce4754
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e31b1246-4b2b-4282-8f8f-b1731a705e9e
                stepCounter: 14a9733a-2051-4c6b-b9eb-02e1561188ee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a514ea1-0979-4be8-8628-3a55ddf1809a
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99ed499f-5378-4068-9e29-644db0980ef3
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: dbo.fn_convert_utc_datetime2(ds_Patientrack_TASK.due_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dee577fc-16e3-4fe2-94ca-e80ac8504c85
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ce57763-d693-4973-bd4d-0920905931bf
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: dbo.fn_convert_utc_datetime2(ds_Patientrack_TASK.create_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92fcaf91-4979-496d-8c05-d781e1427c44
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_COMPLETED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 97a504ff-ccbe-460d-a113-5d7942a4c661
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: dbo.fn_convert_utc_datetime2(ds_Patientrack_TASK.completed_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3bdb8ab-2fb1-49ae-8d78-11139fdad209
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: TASK_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f1074c1-f4fc-4c13-92dd-385728bcc156
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e3b85fd-2d8e-4051-8437-d3f50e74f4ef
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: SOURCE_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d2732ce-621f-45f0-8538-3a395653f1e6
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aff153bb-493c-41cd-ba5a-c5b98c2eb89d
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: SOURCE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 45e1e52a-bb62-4db9-ba05-6fd928d376ed
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49795d50-8ded-4e79-9841-8fd29f0c83f6
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: Integer ID that uniquely identifies the instance of the form holding the task.
        name: FORM_INSTANCE_ID_TASK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00bac0a7-ea03-479a-b4ff-3f602d244556
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: NULLIF(ds_Patientrack_TASK.form_instance_id, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88e26939-52a9-47e9-a43e-6739b9908b88
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: FORM_DEFINITION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88749bb7-ef36-4dd0-99b1-01b693f54246
                stepCounter: e984f273-ad66-4d24-a2be-8f366e99713d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45237cdc-5e6a-41a9-88cf-a319ac512e2c
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: TASK_DEFINITION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 30e306e2-1f54-4b73-b0cb-75684dddc1f0
                stepCounter: bfd92fa8-daa2-4b68-8e4d-01d3dd51ac86
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db7eb698-690f-4630-9351-57070173cfa7
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: PARENT_TASK_DEFINITION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea71ebde-4d50-4f78-a07a-18180929e973
                stepCounter: bfd92fa8-daa2-4b68-8e4d-01d3dd51ac86
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd43f38f-1681-4a7a-8808-f8dfe52312ff
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FORM_DEFINITION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 96e98712-2c32-48c2-8226-f72b328f5d6a
                stepCounter: bfd92fa8-daa2-4b68-8e4d-01d3dd51ac86
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 585006a2-d1a6-443b-800f-f7832d944e38
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: TASK_DEFINITION_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a99e7dda-ebeb-4c45-b4dc-b8e6787bc9dc
                stepCounter: bfd92fa8-daa2-4b68-8e4d-01d3dd51ac86
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b7ae48e-4bdc-434b-9bd8-669a74fdf98b
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(22)
        defaultValue: ""
        description: ""
        name: TASK_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 171241b3-099c-41f3-9ec6-52abf8e2d2d5
                stepCounter: c7ff147d-59b9-49a3-9161-13fdffa7db48
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9edf8b5-ad01-4441-8ba4-39a54b70dea0
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_MODIFIED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa75f432-387d-45b1-a698-92e14e92261f
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: dbo.fn_convert_utc_datetime2(ds_Patientrack_TASK.modif_dttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01290f3c-3a05-4944-8777-3b1532791b46
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: TASK_STATE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 57342037-c0c1-4384-9c37-e1d4940b9929
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f98ff13-0a09-4b1a-92e1-65f4180af5be
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PRIORITY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc1677e9-70e2-4154-bcee-f3a6bcb055d5
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50db86c3-f173-4614-b1dd-b15678fecdb0
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SENIORITY_LEVEL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e66ab243-80d9-4258-8f7a-5a0dfa0addcb
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19302b0c-8883-462f-8e06-651842fb1c79
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: VARCHAR(4000)
        defaultValue: ""
        description: ""
        name: TASK_NOTE_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a01f9d84-65e0-474b-88d6-23a52306aa6b
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26333dd8-4dd1-4154-b5d7-1481259aa865
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ACTIVITY_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ab10bc0c-7176-4fd9-b94f-989f65fc80b0
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79fa9a87-5c19-4500-811f-d8e3422ba1a2
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: BIT
        defaultValue: ""
        description: ""
        name: TASK_DELETED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3149ca16-c9e2-42d0-919f-0e1df0297b04
                stepCounter: 44b6390a-63b2-4e30-add9-7ccc20c1578c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84831c0d-4807-48c8-8f01-c9a146b2a5f9
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6818ba55-b9e3-45e7-9f66-6384e67ed169
                stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e015294c-af63-4558-87b4-953d25f3fdab
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: INT
        defaultValue: ""
        description: ID of the latest version for this observation set.
        name: CURRENT_OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01786d57-b405-4ff1-9a6a-32aa58a0ce5c
                stepCounter: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 804f0fcb-8c20-4d32-b684-62cbda967ee9
          stepCounter: dbf723f8-7da4-4b3b-951d-d8678527a4e8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_PATIENTRACK_TASK_DEFINITION: bfd92fa8-daa2-4b68-8e4d-01d3dd51ac86
          DS_PATIENTRACK_EPISODE: a8e499ca-300b-48a9-9045-922a42433271
          L_PATIENTRACK_FORM_DEFINITION: e984f273-ad66-4d24-a2be-8f366e99713d
          S_EVITALS_TASK_DEFINITION: c7ff147d-59b9-49a3-9161-13fdffa7db48
          S_EVITALS_TASK_05: 131a37f5-d923-4d5b-8cd2-23efa9ec5e3d
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_EVITALS_ADMISSION_CHANGES
          - locationName: TGT
            nodeName: L_PATIENTRACK_TASK_DEFINITION
          - locationName: TGT
            nodeName: DS_PATIENTRACK_EPISODE
          - locationName: TGT
            nodeName: L_PATIENTRACK_FORM_DEFINITION
          - locationName: TGT
            nodeName: S_EVITALS_TASK_DEFINITION
          - locationName: TGT
            nodeName: S_EVITALS_TASK_05
        join:
          joinCondition: |-
            FROM s_eVitals_admission_changes
              JOIN ds_Patientrack_TASK
                ON s_eVitals_admission_changes.admission_id = ds_Patientrack_TASK.ADMSN_PK
              LEFT JOIN {{ ref('TGT','L_PATIENTRACK_TASK_DEFINITION') }}
                ON l_Patientrack_TASK_DEFINITION.TASK_DEFINITION_PK = ds_Patientrack_TASK.TASK_DEFINITION_PK
              LEFT JOIN {{ ref('TGT','DS_PATIENTRACK_EPISODE') }}
                ON ds_Patientrack_TASK.ADMSN_PK = ds_Patientrack_episode.epsde_PK
              LEFT JOIN {{ ref('TGT','L_PATIENTRACK_FORM_DEFINITION') }}
                ON ds_Patientrack_TASK.FORM_DEFINITION_CODE = l_Patientrack_FORM_DEFINITION.CODE
              LEFT OUTER JOIN s_eVitals_patient
                ON ds_Patientrack_episode.patnt_pk = s_eVitals_patient.patnt_pk
              LEFT OUTER JOIN {{ ref('TGT','S_EVITALS_TASK_DEFINITION') }}
                ON l_Patientrack_TASK_DEFINITION.TASK_DEFINITION_PK = s_eVitals_task_definition.task_definition_id
               AND ds_Patientrack_TASK.task_description = s_eVitals_task_definition.task_description
              LEFT OUTER JOIN {{ ref('TGT','S_EVITALS_TASK_05') }}
                ON s_eVitals_task_05.task_id = ds_Patientrack_TASK.task_pk
               AND s_eVitals_task_05.observation_row_num = 1
              LEFT OUTER JOIN s_eVitals_task_08
                ON s_eVitals_task_08.task_id = ds_Patientrack_TASK.task_pk
               AND s_eVitals_task_08.form_row_num = 1
        name: S_EVITALS_TASK_10
        noLinkRefs: []
  name: S_EVITALS_TASK_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
