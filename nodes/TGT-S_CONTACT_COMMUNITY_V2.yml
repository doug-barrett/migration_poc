fileVersion: 1
id: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
name: S_CONTACT_COMMUNITY_V2
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3866a453-8108-4544-8369-cc3c630b274b
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12ae4884-e340-4968-b7c1-fbabb92c660f
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f92eaf4-7bb5-4fe6-be60-98eef5170438
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: ""
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1208f895-7868-40d1-b69e-60518eef185f
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 764ac10f-358f-4f49-bd06-2d7a227d11c0
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fcfaacf-cb2d-42f8-863b-a8212e085853
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9668f55c-c7a5-4a58-a248-a09453e77eaa
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 700f40fd-3034-4a75-b812-30c6dbe326e3
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: baa5e4d2-ba6a-42ff-95e3-8457d0f51e9f
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c53a333-6fee-48f6-9940-1bda222c2d6b
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02576480-0dcf-4b97-8d63-4cc3ce6a7eca
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: SEEN_BY_CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b8f3a79-f117-4171-adef-1c933c0a05b5
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: df7eb3da-29ec-48c2-b8c3-ed366f563bb3
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5de1023-9916-4569-ad46-d203d6bd8b59
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e74845a-29c9-47a9-b2b9-025c9517a3e2
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EPISODE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a61b1e4e-250d-4353-8a0b-699237cac645
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b89e1b5e-3386-4315-9543-b79517236bfa
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ae30d8d-1fe7-41a0-85a3-09fc8a33a307
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_COMPLETION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e062b704-8bee-4ebf-9f39-44e0732669e2
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9af36fd2-c162-493c-b7da-186417c25402
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLIENT_CATEGORY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a963e450-3376-48d1-bfbf-38c143f4ffb3
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CONTACT_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 046f150f-63d6-48d5-b34c-0ea3e555a3c0
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_PURPOSE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b148f047-4e45-4a05-8909-ccbd579ecefa
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRED_TO_CLINICIAN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8fe18130-d596-4ea0-9bff-421970b41ba0
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WOUND_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ea6febd-1abc-4169-9f73-59fcfec62837
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ACTIVE_ON_CASELIST_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3aab38a-c40d-40fe-b05c-988652905997
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: LOCATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb348210-12a2-45a3-8e73-71bf0534ada5
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NEXT_LOCATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3034c4d1-f10e-4cc6-b58b-86dcfc072ae0
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NEXT_CONTACT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 666b4ffe-cbb2-4f59-bc14-f421dfbc080a
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NEXT_CONTACT_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36dbd349-9764-4fa1-beb0-7c692daea895
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NEXT_VISIT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fe15502-72d1-4332-b73f-700591139023
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NEXT_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef36d283-aa03-4e55-89ee-90a4c972ce1f
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FUNDER_CONTRACT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e1458a11-3e38-4696-90fa-063b7f36848c
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: purchaser
        name: PURCHASER
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be1f936e-f3ef-4992-80b8-f45f28e1a830
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f2e33ef-8ae5-4e28-9dbc-6e3089022f15
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 612e529a-9df2-4f84-947e-f725c67621f2
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: COMMENTS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 262f6be2-2c3c-4c81-b8be-0c10991b8c54
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DURATION_MINS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8f06dba-8e10-4476-83fe-21fbdd8c5afc
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e11a0bad-b228-417a-b977-da23dcd925b4
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6660e7e-6351-44a9-b100-79471d02e1af
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 005077ef-2f46-49d9-8c15-62f319935a6e
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3d589c7-1a60-4192-b72a-8bae4196d3e2
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: Contact method FTF, virutal etc.
        name: CONTACT_METHOD
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9ab9cb2-eb76-4a20-b305-3db29d760348
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: notes
        name: NOTES
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a1bdea6-f9ca-4c07-9235-2522ef9194e1
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: contact
        name: CONTACT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e3739611-c7f8-4faf-aeef-94dd1c685fe4
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: referral_type
        name: REFERRAL_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c6e1ced-df45-43a7-a837-629d66b2a907
          stepCounter: 3b0a1409-38c4-4039-92b2-ff64164bc2cf
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: funding_source
        name: FUNDING_SOURCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT ds_cdsswe_task_request.taskrequest_id,
                   'CDS'+cast(ds_cdsswe_task_request.taskrequest_id AS varchar(20)) contact_encounter_id,
                   ds_cdsswe_patient_programme.patient_programme_id programme_id,
                   l_cdsswe_patient.NHI_number,
                   MAX(CASE WHEN LEFT (ds_cdsswe_task_request.stream_id,1) = '1' THEN 'R' + ds_cdsswe_task_request.stream_id ELSE ds_cdsswe_task_request.stream_id END) referral_encounter_id,
                   LEFT(MAX(l_cdsswe_programme_role.name),50) role_code,
                   LEFT(MAX(l_cdsswe_programme_dept.name),50) department_desc,
                   LEFT(MAX(l_cdsswe_programme_serv.name),50) service_desc,
                   MAX(ds_cdsswe_observation_report.provider_nzmc) seen_by_clinician_reference_no,
                   MAX(ds_cdsswe_task_request.request_date) task_request_date,
                   MAX(ds_cdsswe_patient_programme.episode_start_date) episode_start_date,
                   MAX(IFNULL(ds_cdsswe_observation_report.due_date,ds_cdsswe_task_request.due_date)) observation_report_due_date,
                   MAX(IFNULL(ds_cdsswe_atomic_observation.date_completed,ds_cdsswe_observation_report.date_completed)) observation_report_completion_date,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 5019075990348 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) client_category_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066693326077 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) contact_type_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1085954578031 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) contact_purpose_code,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 4978339593532 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) referred_to_clinician_name,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 5411110090724 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) wound_type_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 4465188462600 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) active_on_caselist_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066695054058 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) location_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066179613092 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) next_location_desc,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066179165546 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) next_contact_date,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066179477116 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) next_contact_time,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1087327983194 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) next_visit_reason,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 4809297583692 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) next_action,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066090503678 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) funder_contract_desc,
                   '35' purchaser,
                   MAX(CASE WHEN ds_cdsswe_observation_report.observation_report_status = 'F' THEN 'Completed' WHEN ds_cdsswe_observation_report.observation_report_status = 'A' THEN 'Finalised' WHEN ds_cdsswe_observation_report.observation_report_status = 's' THEN 'In Progress' WHEN ds_cdsswe_observation_report.observation_report_status = 'X' THEN 'Declined' ELSE 'Current' END) observation_report_status,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 4596795284048 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) comments,
                   MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066693382955 THEN CASE WHEN ISNUMERIC(ds_cdsswe_atomic_observation.value) = 1 THEN SUBSTRING(ds_cdsswe_atomic_observation.value,1,4) ELSE NULL END ELSE NULL END) duration_mins,
                   MAX(ds_cdsswe_observation_report.created_date) create_date,
                   REPLACE(MAX(ds_cdsswe_observation_report.created_by),' null','') create_user_login_name,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 6352123435676 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) contract_method ,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 1066178928090 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) notes ,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 6175152787920 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) contact ,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 6175151498296 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) referral_type ,
                   LEFT(MAX(CASE WHEN ds_cdsswe_atomic_observation.datatype_id = 6175152457920 THEN ds_cdsswe_atomic_observation.value ELSE NULL END),50) Funding_Source
              FROM ds_cdsswe_Observation_Report
             INNER JOIN dbo.ds_cdsswe_task_request
                ON dbo.ds_cdsswe_task_request.taskrequest_id = ds_cdsswe_Observation_Report.taskrequest_id
               AND ds_cdsswe_task_request.record_status = 'A'
             INNER JOIN l_cdsswe_Task_Type
                ON l_cdsswe_Task_Type.tasktype_id = ds_cdsswe_task_request.tasktype_id
               AND l_cdsswe_Task_Type.task_type_class = 'Contact'
             INNER JOIN l_cdsswe_patient
                ON l_cdsswe_patient.patient_id = ds_cdsswe_task_request.patient_id
             INNER JOIN ds_cdsswe_patient_programme
                ON ds_cdsswe_patient_programme.patient_programme_id = ds_cdsswe_task_request.patient_programme_id
             INNER JOIN ds_cdsswe_patient_programme ppp
                ON ppp.patient_programme_id = ds_cdsswe_patient_programme.parent_patient_programme_id --  inner join l_cdsswe_patient_programme_provider
             -- on l_cdsswe_patient_programme_provider.patient_programme_id = ds_cdsswe_patient_programme.patient_programme_id
             --  AND l_cdsswe_patient_programme_provider.record_status = 'A'
             --  AND l_cdsswe_patient_programme_provider.sequence_num = '1'
             --inner join l_cdsswe_clinic c on c.clinic_id = l_cdsswe_patient_programme_provider.clinic_id
             --  AND c.record_status = 'A'
             --  AND c.clinic_type = 'CASETEAM'

             INNER JOIN l_cdsswe_programme l_cdsswe_programme_role
                ON l_cdsswe_programme_role.programme_id = ds_cdsswe_patient_programme.programme_id
             INNER JOIN l_cdsswe_programme l_cdsswe_programme_dept
                ON l_cdsswe_programme_dept.programme_id = l_cdsswe_programme_role.parent_programme_id
             INNER JOIN l_cdsswe_programme l_cdsswe_programme_serv
                ON l_cdsswe_programme_serv.programme_id = l_cdsswe_programme_dept.parent_programme_id --inner JOIN l_pims_health_organisations  health_organisations01
             --            ON  heorg_refno  =  external_clinic_id

             INNER JOIN ds_cdsswe_atomic_observation
                ON ds_cdsswe_atomic_observation.observation_report_id = ds_cdsswe_observation_report.observation_report_id
             WHERE 1=1
               AND ((ds_cdsswe_observation_report.date_completed >= '01-Jun-2004' AND ppp.programme_id = 1065050429394) OR (ds_cdsswe_observation_report.date_completed >= '01-APR-2005' AND ppp.programme_id IN (4424329646224,4424329754656)) OR (ds_cdsswe_observation_report.date_completed >= '01-Aug-2005' AND ppp.programme_id IN (4412557328748,4412557403496,4412557439684,4412557533060,4412557487684 ,6124719609788)) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2006' AND ppp.programme_id = (1087533071110)) OR (ds_cdsswe_observation_report.date_completed >= '01-Sep-2004' AND ppp.programme_id = 1065050139306) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 5235128062548) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 5610091156464) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 5832026576332) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 5786341435716) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 6758635725012) OR (ds_cdsswe_observation_report.date_completed >= '01-Jul-2011' AND ppp.programme_id = 6758635994576))
               AND ds_cdsswe_Observation_Report.record_status = 'A'
               AND ds_cdsswe_Observation_Report.observation_report_status = 'F'
             GROUP BY ds_cdsswe_task_request.taskrequest_id ,
                      ds_cdsswe_patient_programme.patient_programme_id ,
                      l_cdsswe_patient.NHI_number
        dependencies:
          - locationName: TGT
            nodeName: DS_CDSSWE_TASK_REQUEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_CDSSWE_TASK_REQUEST') }}
        name: S_CONTACT_COMMUNITY_V2
        noLinkRefs: []
  name: S_CONTACT_COMMUNITY_V2
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
