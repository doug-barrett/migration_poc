fileVersion: 1
id: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
name: VIEW_JOYN_PRODVIEW_WELLINFO
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b498393-1c41-42fe-ae4c-66d0f5d8625e
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: WELL_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b498393-1c41-42fe-ae4c-66d0f5d8625e
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef082ca7-d01f-4925-9043-f1eb3b7e97da
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: LAST_PROD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ef082ca7-d01f-4925-9043-f1eb3b7e97da
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec57cba1-c93e-402a-840f-b9aca570e4da
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec57cba1-c93e-402a-840f-b9aca570e4da
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adeb9fef-c963-4ec6-a3e1-8554dee8371f
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: adeb9fef-c963-4ec6-a3e1-8554dee8371f
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03daefa4-dc4c-46fe-aeb0-7c1ba5658ebe
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 03daefa4-dc4c-46fe-aeb0-7c1ba5658ebe
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5a9da42-2962-47c1-9368-27d3d4123bd7
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5a9da42-2962-47c1-9368-27d3d4123bd7
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cdd95216-2766-42a2-bac9-703301932002
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cdd95216-2766-42a2-bac9-703301932002
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa3e1c25-703a-40af-94da-86b9aca85375
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aa3e1c25-703a-40af-94da-86b9aca85375
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e172e715-8396-48c2-a279-aff70b03124f
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FOREMAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e172e715-8396-48c2-a279-aff70b03124f
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54f17aae-83b3-4d1e-b3c9-ac1ced139d2f
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: RUN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54f17aae-83b3-4d1e-b3c9-ac1ced139d2f
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00c35c2b-5a4d-453c-94ac-46d98a1f8fc7
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00c35c2b-5a4d-453c-94ac-46d98a1f8fc7
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 514f13f7-cc66-429a-8a68-7060bf34fcaa
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LATITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 514f13f7-cc66-429a-8a68-7060bf34fcaa
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 836c5f80-a0f3-44d4-ad17-debdebe2b898
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LONGITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 836c5f80-a0f3-44d4-ad17-debdebe2b898
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb2db0e8-5259-446a-9e3c-36a461d48c15
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: SURFACE_LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb2db0e8-5259-446a-9e3c-36a461d48c15
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 335c31f2-4de3-44e4-8ead-223032d15404
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: WELL_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 335c31f2-4de3-44e4-8ead-223032d15404
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff203531-1bfb-496f-aea9-71e223bbc2c1
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ff203531-1bfb-496f-aea9-71e223bbc2c1
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8441062-0607-4bdf-9d59-9e1984a739a1
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b8441062-0607-4bdf-9d59-9e1984a739a1
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3e767fc-31d2-444c-9e4b-611b643cf70a
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f3e767fc-31d2-444c-9e4b-611b643cf70a
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f7e003f-efc9-4c84-b298-f134230ebbf6
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_HP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3f7e003f-efc9-4c84-b298-f134230ebbf6
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b7a7f95f-eeb6-4a08-8a7e-c2fe4f156a99
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: PUMP_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b7a7f95f-eeb6-4a08-8a7e-c2fe4f156a99
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2aef4945-8852-42d2-9fb6-5c2ec2853190
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: JTF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2aef4945-8852-42d2-9fb6-5c2ec2853190
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3b503fb-7f8c-41a7-ad6a-78d85d587d71
          stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: JIH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f3b503fb-7f8c-41a7-ad6a-78d85d587d71
                stepCounter: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_JOYN_PRODVIEW_WELLINFO: 76897ca9-64dd-4431-9294-8f4e2ef6ec07
          ODS_PVIEW_PVT_PVUNITEQUIP: 75af0565-954d-439b-9e43-9b99ffea4a1a
          ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY: b78e68df-21f7-427c-9ce7-426d1d304567
          ODS_PVIEW_PVT_PVUNIT: d554b1ad-15ef-40f5-8fff-8a730cc8b68e
          ODS_PVIEW_PVT_PVFLOWNETHEADER: bd388a52-3d72-4c70-833d-7de7c6a8abd1
          ODS_PVIEW_PVT_PVUNITCOMP: b2609f15-a93c-4c5d-b86e-0898ad7558d0
          ODS_PVIEW_PVT_PVROUTESETROUTE: 7c5021e0-ddd6-4b14-9b91-645b71f83303
          ODS_PVIEW_PVT_PVFACILITY: 2069364e-b829-44bc-90fd-46cb967ac2ee
          ODS_PVIEW_PVT_PVUNITCOMPMEASMETH: 56efdfd1-7a07-4ab6-917a-e20b72b23662
          ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL: 9e06fc76-3384-44e3-a094-eb3f74a386c0
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE SECURE VIEW {{ ref_no_link('TARGET','VIEW_JOYN_PRODVIEW_WELLINFO') }} AS WITH surf_equip AS (
                    SELECT e.make,
                           e.model,
                           e.typ,
                           e.exportid2 HP,
                           e.idrecparent
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITEQUIP') }} e
                     WHERE e.typ IN ('ESP', 'JACK', 'PCP')
                       AND e.DSS_CURRENT_FLAG = 'Y'
                       AND e.DSS_DELETE_FLAG != 'Y'
                   ),
                   last_prod AS (
                    SELECT MAX(d.dttm) AS lp_date,
                           MAX(u.idrec) AS idrec
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }} d
                     INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }} u
                        ON u.idrec = d.idrecunit
                       AND u.DSS_CURRENT_FLAG = 'Y'
                       AND u.DSS_DELETE_FLAG != 'Y'
                     INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }} h
                        ON h.idflownet = d.idflownet
                       AND h.DSS_CURRENT_FLAG = 'Y'
                       AND h.DSS_DELETE_FLAG != 'Y'
                     WHERE (d.volprodgathgas + d.volprodgathwater + d.volprodgathhcliq) > 0
                       AND h.usertxt1 = 'CANADA'
                       AND d.DSS_CURRENT_FLAG = 'Y'
                       AND d.DSS_DELETE_FLAG != 'Y'
                     GROUP BY u.idrec
                   ) SELECT DISTINCT u.idrec Well_IDREC ,
                   CAST(lp.lp_date AS date) AS Last_Prod_Date ,
                   c.wellname AS UWI ,
                   c.completionname AS Well_Name ,
                   u.costcenterida AS Cost_Center ,
                   u.area AS Core_Area ,
                   u.field AS Area ,
                   u.district AS Province ,
                   r.usertxt1 AS Foreman ,
                   r.name AS Run_Name ,
                   f.name AS Facility ,
                   u.latitude AS latitude ,
                   u.longitude AS longitude ,
                   u.legalsurfloc AS Surface_Location ,
                   CASE WHEN m.flowdirection = 'production' AND m.methodhcliq = 'unit balance with wellhead cut' THEN 'SWB'
                        WHEN m.flowdirection = 'production'                                                      THEN 'Producing'
                        WHEN m.flowdirection = 'injection'                                                       THEN 'Injecting'
                        ELSE NULL
                         END AS Well_Type ,
                   se.typ AS Surface_Equipment_Type ,
                   se.model AS Surface_Equipment_Model ,
                   se.make AS Surface_Equipment_Make ,
                   se.HP AS Surface_Equipment_HP ,
                   CASE WHEN a.idrecpumpentrytk = 'pvunitcomppumppcpentry' THEN 'PCP'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumpespentry' THEN 'ESP'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumprodentry' THEN 'Rod Pump'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumpjetentry' THEN 'Jet Pump'
                        ELSE NULL
                         END AS Pump_Type ,
                   fl.jointstofluid AS JTF ,
                   fl.jointsinhole AS JIH
              FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }} a
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }} c
                ON c.idrec = a.idreccomp
               AND c.DSS_CURRENT_FLAG='Y'
               AND c.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }} u
                ON u.idrec = a.idrecunit
               AND u.DSS_CURRENT_FLAG='Y'
               AND u.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVROUTESETROUTE') }} r
                ON r.idrec = u.idrecroutesetroutecalc
               AND r.DSS_CURRENT_FLAG='Y'
               AND r.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFACILITY') }} f
                ON f.idrec = a.idrecfacility
               AND f.DSS_CURRENT_FLAG='Y'
               AND f.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }} h
                ON h.idflownet = u.idflownet
               AND h.DSS_CURRENT_FLAG='Y'
               AND h.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPMEASMETH') }} m
                ON m.idrec = a.idrecmeasmeth
               AND m.DSS_CURRENT_FLAG='Y'
               AND m.DSS_DELETE_FLAG!='Y'
              LEFT JOIN surf_equip se
                ON se.idrecparent = u.idrec
              LEFT JOIN last_prod lp
                ON lp.idrec = u.idrec
              LEFT JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL') }} fl
                ON fl.idrec = a.idrecfluidlevel
               AND fl.DSS_CURRENT_FLAG='Y'
               AND fl.DSS_DELETE_FLAG!='Y'
             WHERE h.usertxt2 = 'SOUTHEAST SASKATCHEWAN'
               AND a.DSS_CURRENT_FLAG='Y'
               AND a.DSS_DELETE_FLAG!='Y'
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_JOYN_PRODVIEW_WELLINFO
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITEQUIP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVROUTESETROUTE
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFACILITY
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPMEASMETH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_JOYN_PRODVIEW_WELLINFO') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITEQUIP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVROUTESETROUTE') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFACILITY') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPMEASMETH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL') }}
        name: VIEW_JOYN_PRODVIEW_WELLINFO
        noLinkRefs: []
  name: VIEW_JOYN_PRODVIEW_WELLINFO
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
