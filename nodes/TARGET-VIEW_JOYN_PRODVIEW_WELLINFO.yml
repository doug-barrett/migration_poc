fileVersion: 1
id: e3f4380c-14fd-4876-a73c-f54251e9df42
name: VIEW_JOYN_PRODVIEW_WELLINFO
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e25e32ad-8751-48cf-841c-fcd468f9bc76
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: WELL_IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e25e32ad-8751-48cf-841c-fcd468f9bc76
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9e0b3a9-a908-46fd-b798-e14874164c0d
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: LAST_PROD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9e0b3a9-a908-46fd-b798-e14874164c0d
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: debc328d-ff38-4765-b5e2-71cec009270b
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: debc328d-ff38-4765-b5e2-71cec009270b
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90858f9e-ae01-49e4-87de-995bf22c24cc
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WELL_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 90858f9e-ae01-49e4-87de-995bf22c24cc
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5df8cc8-299f-472d-b3fc-660874ed1b2c
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5df8cc8-299f-472d-b3fc-660874ed1b2c
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 205b95d8-4101-41a6-a8da-cecfad68136e
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CORE_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 205b95d8-4101-41a6-a8da-cecfad68136e
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66d0b180-5ecd-4673-91fd-784e9829f424
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66d0b180-5ecd-4673-91fd-784e9829f424
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3d4fe37f-525d-4671-8dff-b0111b7c78c3
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d4fe37f-525d-4671-8dff-b0111b7c78c3
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0cd60621-9e1d-482e-8359-3347a1cae9ec
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: FOREMAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0cd60621-9e1d-482e-8359-3347a1cae9ec
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4528bd05-c93e-4c67-8511-7f21a8c40efd
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: RUN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4528bd05-c93e-4c67-8511-7f21a8c40efd
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 321f08be-35d7-4a44-9cd0-8f75f1b75db8
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: FACILITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 321f08be-35d7-4a44-9cd0-8f75f1b75db8
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6a0e5b2-b99f-4646-8d56-5cd87920a174
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LATITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6a0e5b2-b99f-4646-8d56-5cd87920a174
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01e22b5b-29b8-4163-9692-63b354ca61ff
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LONGITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01e22b5b-29b8-4163-9692-63b354ca61ff
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 454dd088-3141-4fad-aaac-cd4c8c960233
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: SURFACE_LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 454dd088-3141-4fad-aaac-cd4c8c960233
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0072c85a-5d79-455a-9c1e-d3b75e603b8e
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: WELL_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0072c85a-5d79-455a-9c1e-d3b75e603b8e
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3e770b6-05a7-41ba-971e-68c49cab3ad2
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3e770b6-05a7-41ba-971e-68c49cab3ad2
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99da29d0-917b-497b-8297-425ea259a16a
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_MODEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99da29d0-917b-497b-8297-425ea259a16a
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf9d4205-12c9-4a73-8b24-cb6d65bd6964
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_MAKE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf9d4205-12c9-4a73-8b24-cb6d65bd6964
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92347a2b-3ecb-49ee-aca5-54a4d6c9cf4a
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(2000)
        defaultValue: ""
        description: ""
        name: SURFACE_EQUIPMENT_HP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92347a2b-3ecb-49ee-aca5-54a4d6c9cf4a
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4c3a19d-6ef9-43ef-9b96-07b9963c5a13
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: PUMP_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4c3a19d-6ef9-43ef-9b96-07b9963c5a13
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e2c7492-62ae-49e7-bf40-ab05b050f8a9
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: JTF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e2c7492-62ae-49e7-bf40-ab05b050f8a9
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7eb39195-d01d-4755-8e2c-c48a71f9fbac
          stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: JIH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7eb39195-d01d-4755-8e2c-c48a71f9fbac
                stepCounter: e3f4380c-14fd-4876-a73c-f54251e9df42
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_JOYN_PRODVIEW_WELLINFO: e3f4380c-14fd-4876-a73c-f54251e9df42
          ODS_PVIEW_PVT_PVUNITEQUIP: 627d46a4-df01-44cb-b382-a289091c63cf
          ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY: d08539ff-37af-4c21-9836-963dca56c39d
          ODS_PVIEW_PVT_PVUNIT: e5728334-2b6e-40fb-ae5e-e78da1de0994
          ODS_PVIEW_PVT_PVFLOWNETHEADER: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
          ODS_PVIEW_PVT_PVUNITCOMP: 81e6b0b1-1728-45bf-932d-6356544cf13a
          ODS_PVIEW_PVT_PVROUTESETROUTE: 2a03885d-3ed3-40b8-8865-f822cd56a8aa
          ODS_PVIEW_PVT_PVFACILITY: 79f31973-c5e4-4ef7-b6f2-31ffbb792f36
          ODS_PVIEW_PVT_PVUNITCOMPMEASMETH: e3cf61ec-a4d6-45b6-8acb-b4ac8c3265d9
          ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL: b76e9fdd-13c2-4431-a7d7-a3691e2e7d6c
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE SECURE VIEW {{ ref_no_link('TARGET','VIEW_JOYN_PRODVIEW_WELLINFO') }} AS WITH surf_equip AS (
                    SELECT e.make,
                           e.model,
                           e.typ,
                           e.exportid2 HP,
                           e.idrecparent
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITEQUIP') }} e
                     WHERE e.typ IN ('ESP', 'JACK', 'PCP')
                       AND e.DSS_CURRENT_FLAG = 'Y'
                       AND e.DSS_DELETE_FLAG != 'Y'
                   ),
                   last_prod AS (
                    SELECT MAX(d.dttm) AS lp_date,
                           MAX(u.idrec) AS idrec
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }} d
                     INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }} u
                        ON u.idrec = d.idrecunit
                       AND u.DSS_CURRENT_FLAG = 'Y'
                       AND u.DSS_DELETE_FLAG != 'Y'
                     INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }} h
                        ON h.idflownet = d.idflownet
                       AND h.DSS_CURRENT_FLAG = 'Y'
                       AND h.DSS_DELETE_FLAG != 'Y'
                     WHERE (d.volprodgathgas + d.volprodgathwater + d.volprodgathhcliq) > 0
                       AND h.usertxt1 = 'CANADA'
                       AND d.DSS_CURRENT_FLAG = 'Y'
                       AND d.DSS_DELETE_FLAG != 'Y'
                     GROUP BY u.idrec
                   ) SELECT DISTINCT u.idrec Well_IDREC ,
                   CAST(lp.lp_date AS date) AS Last_Prod_Date ,
                   c.wellname AS UWI ,
                   c.completionname AS Well_Name ,
                   u.costcenterida AS Cost_Center ,
                   u.area AS Core_Area ,
                   u.field AS Area ,
                   u.district AS Province ,
                   r.usertxt1 AS Foreman ,
                   r.name AS Run_Name ,
                   f.name AS Facility ,
                   u.latitude AS latitude ,
                   u.longitude AS longitude ,
                   u.legalsurfloc AS Surface_Location ,
                   CASE WHEN m.flowdirection = 'production' AND m.methodhcliq = 'unit balance with wellhead cut' THEN 'SWB'
                        WHEN m.flowdirection = 'production'                                                      THEN 'Producing'
                        WHEN m.flowdirection = 'injection'                                                       THEN 'Injecting'
                        ELSE NULL
                         END AS Well_Type ,
                   se.typ AS Surface_Equipment_Type ,
                   se.model AS Surface_Equipment_Model ,
                   se.make AS Surface_Equipment_Make ,
                   se.HP AS Surface_Equipment_HP ,
                   CASE WHEN a.idrecpumpentrytk = 'pvunitcomppumppcpentry' THEN 'PCP'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumpespentry' THEN 'ESP'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumprodentry' THEN 'Rod Pump'
                        WHEN a.idrecpumpentrytk = 'pvunitcomppumpjetentry' THEN 'Jet Pump'
                        ELSE NULL
                         END AS Pump_Type ,
                   fl.jointstofluid AS JTF ,
                   fl.jointsinhole AS JIH
              FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }} a
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }} c
                ON c.idrec = a.idreccomp
               AND c.DSS_CURRENT_FLAG='Y'
               AND c.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }} u
                ON u.idrec = a.idrecunit
               AND u.DSS_CURRENT_FLAG='Y'
               AND u.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVROUTESETROUTE') }} r
                ON r.idrec = u.idrecroutesetroutecalc
               AND r.DSS_CURRENT_FLAG='Y'
               AND r.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFACILITY') }} f
                ON f.idrec = a.idrecfacility
               AND f.DSS_CURRENT_FLAG='Y'
               AND f.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }} h
                ON h.idflownet = u.idflownet
               AND h.DSS_CURRENT_FLAG='Y'
               AND h.DSS_DELETE_FLAG!='Y'
             INNER JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPMEASMETH') }} m
                ON m.idrec = a.idrecmeasmeth
               AND m.DSS_CURRENT_FLAG='Y'
               AND m.DSS_DELETE_FLAG!='Y'
              LEFT JOIN surf_equip se
                ON se.idrecparent = u.idrec
              LEFT JOIN last_prod lp
                ON lp.idrec = u.idrec
              LEFT JOIN {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL') }} fl
                ON fl.idrec = a.idrecfluidlevel
               AND fl.DSS_CURRENT_FLAG='Y'
               AND fl.DSS_DELETE_FLAG!='Y'
             WHERE h.usertxt2 = 'SOUTHEAST SASKATCHEWAN'
               AND a.DSS_CURRENT_FLAG='Y'
               AND a.DSS_DELETE_FLAG!='Y'
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_JOYN_PRODVIEW_WELLINFO
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITEQUIP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNIT
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVROUTESETROUTE
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFACILITY
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPMEASMETH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_JOYN_PRODVIEW_WELLINFO') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITEQUIP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTHDAY') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNIT') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVROUTESETROUTE') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFACILITY') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPMEASMETH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPFLUIDLEVEL') }}
        name: VIEW_JOYN_PRODVIEW_WELLINFO
        noLinkRefs: []
  name: VIEW_JOYN_PRODVIEW_WELLINFO
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
