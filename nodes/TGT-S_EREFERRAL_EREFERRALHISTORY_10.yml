fileVersion: 1
id: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
name: S_EREFERRAL_EREFERRALHISTORY_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Calculate the days between submission and updatetime when status changed first time from l_referralhistory"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f45c190-849b-4398-b549-ace4af617e37
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: COMPLETE_CYCLE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: datediff(dd,s_eReferral_patient_05.submissiondate,ds_referralhistory.updatedatetime)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 790b49c5-ddbd-4340-87dc-a681bd36c4ca
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EXTERNAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8afac337-1381-4495-a25c-02c1efb378c4
                stepCounter: 85b7be89-0863-4607-a138-a7cfd86a44e4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24966c04-dcd7-40bb-8ed5-7c378e28d4ab
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SUBMISSION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 564735d7-c1cd-4337-8030-1dd22642b64b
                stepCounter: 85b7be89-0863-4607-a138-a7cfd86a44e4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64a5294e-1463-4638-a949-55079ec5d12d
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              CASE WHEN statusid=12         THEN 'N'
                          WHEN statusid=9          THEN 'C'
                          WHEN statusid=15         THEN 'S'
                          WHEN statusid=16         THEN 'W'
                          WHEN statusid=17then 'X'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 43f2bdd6-f92f-4b85-a523-c2b9b22f2461
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: FIRST_STATUS_CHANGED
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER (PARTITION BY externalId, submissionDate ORDER BY updateDateTime)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a043224-b7af-4e85-9926-ef00ac55a719
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: PATIENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 10db5da5-43e8-424e-93f3-6652cff8b210
                stepCounter: 85b7be89-0863-4607-a138-a7cfd86a44e4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18bb720e-9e7d-42a1-b16a-fd2d3e422289
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d09001e6-61b9-40b6-960b-e4124d799931
                stepCounter: 85b7be89-0863-4607-a138-a7cfd86a44e4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6b7fe7b-72df-4e10-b27e-706670e4fe81
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f1b954f-1428-45fd-b40b-ddc577297b48
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a038dd7c-4cdd-4739-aa5f-6bfdac139b42
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: UPDATE_DATETIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4996a544-ecca-4e7d-94be-8e7a14b77e25
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96a55858-27d4-4327-8d44-75b234bdc13f
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: CHAR(1)
        defaultValue: ""
        description: ""
        name: HISTORY_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8ff3c10a-a00b-4e13-8810-2f927012d845
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86b8395a-730f-462f-ad3a-ef8a26b5b6e8
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SERVICE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c5998ac-fa67-40cf-b932-775ced51a4f5
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18d2ae4f-c37a-42d0-b30c-df29f269cde0
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: STATUS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d65b580c-b685-40bb-ba99-cd3123ba2756
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 715d2fe9-06da-4185-a389-dbb83a951963
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: REASON_FOR_ACTION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0a747ef-0aae-44e4-9fcb-9a252067240e
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5167a7c6-49b4-44dc-8bd1-6021bae086e6
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: SUBSERVICE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5943293-4183-4f53-b58a-94d06a3e0886
                stepCounter: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5994dff9-60b7-4a4e-906f-d8f6ff33a8d0
          stepCounter: dd5b66f7-3ac1-46a7-9c48-b1cb63d42993
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_EREFERRAL_PATIENT_05: 85b7be89-0863-4607-a138-a7cfd86a44e4
          DS_REFERRALHISTORY: 60ce7d5a-1652-46f8-b5a9-484bf1d44793
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_EREFERRAL_PATIENT_05
          - locationName: TGT
            nodeName: DS_REFERRALHISTORY
        join:
          joinCondition: |-
            FROM {{ ref('TGT','S_EREFERRAL_PATIENT_05') }} s_eReferral_patient_05
              LEFT JOIN {{ ref('TGT','DS_REFERRALHISTORY') }} ds_referralhistory
                ON s_eReferral_patient_05.id = ds_referralhistory.referralId
             WHERE statusid IN ('9','12','15','16','17')
               AND historyTypeCode IN ('S')
        name: S_EREFERRAL_EREFERRALHISTORY_10
        noLinkRefs: []
  name: S_EREFERRAL_EREFERRALHISTORY_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
