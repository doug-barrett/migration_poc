fileVersion: 1
id: c5730563-1787-48ff-9d61-110b04d0a2d8
name: VWLEADLIST
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2fe4e69-a4ef-4c96-8227-780aec16b110
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.ReportingCustomerId=Account.ForceId
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ACCOUNTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8e28e8d-3fa5-4608-bb5d-f58cfd2e3a9d
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db1e1ccb-474c-4f43-80d2-3b490505c7dc
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.ReportingCustomerId=AccountGeography.ForceId
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ACCOUNTGEOGRAPHYKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a6b4cb4-2c42-4bb9-93b4-55de6a0309de
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ac6845b-79e6-458e-956a-46843c91f243
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.Account.AccountTerritory=SalesTerritory.TerritoryName
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: SALESTERRITORYKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e71f6cf8-66b9-4722-afd5-7e27584d86f2
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cde4c00b-5245-4626-b8bc-9118ec67ab4b
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INT
        defaultValue: ""
        description: Unique identifier for an account. Commonly called the "Force Id"
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0960d547-e310-44ae-ad82-ccd1ee7d442a
                stepCounter: a594f58e-2240-453f-a570-12719830e3d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24c84886-f428-48f8-8392-7dafafe2b17d
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INT
        defaultValue: ""
        description: Parent Id for an account. Will be the same as ForceId if there is no parent or if this is the top-most account in a hierarchy
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: FORCEPARENTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ff29182e-d8f0-4d8e-a2f8-742db9ddce39
                stepCounter: a594f58e-2240-453f-a570-12719830e3d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 240eb8d7-f5e6-4c4f-8aa6-412beb7fabc1
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: "StageFactSalesMerge_1.SupplierId=Supplier.SupplierId\nStageFactSalesMerge_1.SupplierName=Supplier.SupplierName\nStageFactSalesMerge_1.ContractNumber=Supplier.ContractNumber"
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 442fb52b-5c4c-4c7d-a0a8-163c064b2ff6
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: COUNT (DISTINCT SalesAndRevenue.SupplierKey)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81d48f23-b773-44ae-bbf5-e038553de30a
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ROLLING12MONTHSALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4a71e14-54d2-4ee3-88da-c8c95b56c2c7
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: SUM(SalesAndRevenue.Sales)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86962cc4-fc81-4cd3-9150-96b5914522f2
          stepCounter: c5730563-1787-48ff-9d61-110b04d0a2d8
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ROLLING12MONTHREVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2098b7a3-a5c3-4180-b722-2fa84cd3e787
                stepCounter: 79e76231-b280-4362-a8fa-68215a84f788
            transform: SUM(SalesAndRevenue.Revenue)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE VIEW {{ this }}(AccountKey, AccountGeographyKey, SalesTerritoryKey, ForceId, ForceParentId, NumOfSuppliersUsed, Rolling12MonthSales, Rolling12MonthRevenue) AS SELECT SalesAndRevenue.AccountKey,
                   SalesAndRevenue.AccountGeographyKey, --SalesAndRevenue.AccountExternalIdKey,
             SalesAndRevenue.SalesTerritoryKey,
                   Account.ForceId,
                   Account.ForceParentId,
                   COUNT (DISTINCT SalesAndRevenue.SupplierKey), SUM(SalesAndRevenue.Sales),
                   SUM(SalesAndRevenue.Revenue)
              FROM Fact.SalesAndRevenue SalesAndRevenue
             INNER JOIN Dim.Account ACCOUNT
                ON Account.AccountKey = SalesAndRevenue.AccountKey
             WHERE DATEDIFF(MONTH,SalesAndRevenue.TransactionDate,SalesAndRevenue.MaxReceiptDate) <= 12
             GROUP BY SalesAndRevenue.AccountKey ,
                      SalesAndRevenue.AccountGeographyKey --  , SalesAndRevenue.AccountExternalIdKey
              ,
                      SalesAndRevenue.SalesTerritoryKey ,
                      Account.ForceId ,
                      Account.ForceParentId
        dependencies:
          - locationName: DIM
            nodeName: ACCOUNT
          - locationName: FACT
            nodeName: SALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','ACCOUNT') }}
            {{ ref('FACT','SALESANDREVENUE') }}
        name: VWLEADLIST
        noLinkRefs: []
  name: VWLEADLIST
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
