fileVersion: 1
id: 98b47933-6203-47de-93aa-373b634c90c9
name: VWLEADLIST
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b02e032-5f9b-47f4-b30f-f740e19282dc
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.ReportingCustomerId=Account.ForceId
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ACCOUNTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb8f6162-a2dd-47cd-82e2-4e62bf1c9d85
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cbadc237-dc05-4289-8336-e688abbd6b9b
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.ReportingCustomerId=AccountGeography.ForceId
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ACCOUNTGEOGRAPHYKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93a1c9dd-2a1e-4b33-8ec0-c490e261b94e
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 69fc861e-931b-4be2-aadc-aa93f2c66dcd
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: StageFactSalesMerge_1.Account.AccountTerritory=SalesTerritory.TerritoryName
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: SALESTERRITORYKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22d5604d-7b70-49bf-b044-64e84caecb62
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 398106d2-c953-4b90-b1a0-1a36096397ba
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INT
        defaultValue: ""
        description: Unique identifier for an account. Commonly called the "Force Id"
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: FORCEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 264325ce-e680-46a0-99e5-d80139b1ea05
                stepCounter: c278473c-12f0-41e1-b65b-faa4b3c2a978
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56e3132c-6126-4ad1-97c6-be5d1cb7d0de
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INT
        defaultValue: ""
        description: Parent Id for an account. Will be the same as ForceId if there is no parent or if this is the top-most account in a hierarchy
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: FORCEPARENTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52c93b64-c3ed-47ba-b2a5-369296bab49c
                stepCounter: c278473c-12f0-41e1-b65b-faa4b3c2a978
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45038e87-ea43-4ef5-8033-9c76312de4e0
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: "StageFactSalesMerge_1.SupplierId=Supplier.SupplierId\nStageFactSalesMerge_1.SupplierName=Supplier.SupplierName\nStageFactSalesMerge_1.ContractNumber=Supplier.ContractNumber"
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: NUMOFSUPPLIERSUSED
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cd922a2-3f16-4551-bfc2-5917a36b5bdf
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: COUNT (DISTINCT SalesAndRevenue.SupplierKey)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f8e1298-8b80-468e-80d6-28b91398349e
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ROLLING12MONTHSALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2410812-846e-49a6-8cf0-938dc4d0de17
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: SUM(SalesAndRevenue.Sales)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3905873-9332-44f6-afde-e24faea88aca
          stepCounter: 98b47933-6203-47de-93aa-373b634c90c9
        config: {}
        dataType: NUMERIC(18,4)
        defaultValue: ""
        description: ""
        hashDetails:
          hashAlgorithm: MD5
        hashedColumns:
          - column: "NULL"
        name: ROLLING12MONTHREVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c15a6239-54bc-439b-be0c-970122f29022
                stepCounter: a48d4109-5650-474d-a2f0-c43a0593bcac
            transform: SUM(SalesAndRevenue.Revenue)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE VIEW {{ this }}(AccountKey, AccountGeographyKey, SalesTerritoryKey, ForceId, ForceParentId, NumOfSuppliersUsed, Rolling12MonthSales, Rolling12MonthRevenue) AS SELECT SalesAndRevenue.AccountKey,
                   SalesAndRevenue.AccountGeographyKey, --SalesAndRevenue.AccountExternalIdKey,
             SalesAndRevenue.SalesTerritoryKey,
                   Account.ForceId,
                   Account.ForceParentId,
                   COUNT (DISTINCT SalesAndRevenue.SupplierKey), SUM(SalesAndRevenue.Sales),
                   SUM(SalesAndRevenue.Revenue)
              FROM Fact.SalesAndRevenue SalesAndRevenue
             INNER JOIN Dim.Account ACCOUNT
                ON Account.AccountKey = SalesAndRevenue.AccountKey
             WHERE DATEDIFF(MONTH,SalesAndRevenue.TransactionDate,SalesAndRevenue.MaxReceiptDate) <= 12
             GROUP BY SalesAndRevenue.AccountKey ,
                      SalesAndRevenue.AccountGeographyKey --  , SalesAndRevenue.AccountExternalIdKey
              ,
                      SalesAndRevenue.SalesTerritoryKey ,
                      Account.ForceId ,
                      Account.ForceParentId
        dependencies:
          - locationName: DIM
            nodeName: ACCOUNT
          - locationName: FACT
            nodeName: SALESANDREVENUE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','ACCOUNT') }}
            {{ ref('FACT','SALESANDREVENUE') }}
        name: VWLEADLIST
        noLinkRefs: []
  name: VWLEADLIST
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
