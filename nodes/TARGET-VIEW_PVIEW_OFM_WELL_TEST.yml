fileVersion: 1
id: 46fb3667-92b8-41d7-b8a2-e6e920d05349
name: VIEW_PVIEW_OFM_WELL_TEST
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4434bb2-2d48-4989-9d20-af3b2480f196
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85d6f749-a3a9-40f6-8bc0-862e4297d5ee
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d39d09fa-8829-4bc3-b1d6-2a299cf6030f
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f76be576-f021-42f1-a5bc-c6dfa35d25fb
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41428646-6006-463d-847b-3eb82613ed68
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295d169a-8764-40e9-9347-7e6746bb1d69
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2bca5878-7720-4f63-9a42-38cfa27fb785
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PROD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4af52595-84cb-4015-9b7d-71cd8287ad95
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5db709c4-175b-4ac3-88fe-7e959b9c6dcf
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TESTHOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84b5a54d-0ac8-4ef8-bd09-b6c7b1181d67
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4057ad4c-d5eb-44a4-a36b-4eb5783c21ad
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea474b0f-45c5-47bd-8c5b-2537fbaf02b4
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f870828e-ebfe-48eb-a49e-7572e1186de4
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31050273-976d-4a1e-964b-070566a81355
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9d0f17f4-7170-4f2d-97d7-c61683d11766
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5cf002de-623d-408b-a209-8288b82b2410
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b0ede20-0c87-4930-800e-0d52cdd1b501
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TESTEDBY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6401ae1e-e3e5-496d-8d07-ebfb2dea57a4
                stepCounter: c90d88ea-3fe2-4276-a045-9d96c5346b01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c5e36f7-c738-4c12-8862-6f139eaf5d10
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2461b3f-8900-4460-9da7-dc1b4d0593bc
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: edd9912b-3081-4112-aaaf-8a260657f0e0
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 225158ef-323f-4052-a5f5-8eec320d50ed
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b45a1b3e-14f2-4e1b-9933-8de1eb21aa6a
          stepCounter: 46fb3667-92b8-41d7-b8a2-e6e920d05349
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6224e306-c453-4e0c-b1bf-b5af6bdcf306
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_WELL_TEST: 46fb3667-92b8-41d7-b8a2-e6e920d05349
          ODS_PVIEW_PVT_PVFLOWNETHEADER: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
          ODS_PVIEW_PVT_PVUNITCOMP: 81e6b0b1-1728-45bf-932d-6356544cf13a
          ODS_PVIEW_PVT_PVUNITCOMPTEST: c90d88ea-3fe2-4276-a045-9d96c5346b01
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_WELL_TEST') }} (IDFLOWNET, IDREC, UWI, PROD_DATE, TESTHOURS, GAS, OIL, WATER, TESTEDBY, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   UC.IDREC ,
                   UC.WELLIDREGULATORY UWI ,
                   CT.DTTM AS PROD_DATE ,
                   CT.DURTEST * 24 AS TESTHOURS ,
                   NVL(CT.VOLGASCALC, CT.VOLGAS) / 1000 AS GAS ,
                   NVL(CT.VOLHCLIQCALC, CT.VOLHCLIQ) AS OIL ,
                   NVL(CT.VOLWATERCALC, CT.VOLWATER) AS WATER ,
                   CT.TESTEDBY ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU' ,'CORP') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW','') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) UC
                ON F.IDFLOWNET = UC.IDFLOWNET
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPTEST') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) CT
                ON UC.IDREC = CT.IDRECPARENT
               AND NVL(CT.DONTUSE,0) <> 1
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPTEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPTEST') }}
        name: VIEW_PVIEW_OFM_WELL_TEST
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_WELL_TEST
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
