fileVersion: 1
id: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
name: VIEW_PVIEW_OFM_WELL_TEST
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b956b5f-2c37-43b2-8be7-a2a366d6608c
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f00e8fc-6c61-4ba7-8bae-f81179d23da4
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 835c2328-2306-42d5-8a1c-8f49b469b972
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf6aa8f-2e96-43a3-8472-6ee102299445
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e0fb7d6-3fd0-4394-88f4-e2943295a640
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7014a46b-a09f-4d32-ae9a-66b516c1d8d6
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d4adb85-de8e-43e4-a77b-26a240b845ec
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PROD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f836d015-9378-425e-8356-2fad77845465
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8aaf58c6-86f0-4ae6-bc8c-426969ce15b3
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TESTHOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b488d42d-d4df-4e9a-a596-51cb3f74b49a
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2cfdb918-0026-468a-972d-5e4a25c94221
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1d2c080-d3d2-4020-83bc-8dd3b783c40c
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 098a78ca-d275-4222-b1fa-2cbea9197c6b
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b842e2d-95d8-403d-8dbb-2bc22b223661
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5a321cc1-6dc5-4da3-9d2b-adee0bb0a5a1
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8f67607-9f8b-4c76-84ef-5c5a1ff7cb25
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6b44092a-f8df-4c3b-ae55-3a58586a201a
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TESTEDBY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63f6624d-ead7-4901-9586-844a5c2d79d3
                stepCounter: 929b3978-fa1e-46f0-a399-b19f4cc78214
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff157e5a-fa76-4cf8-adb2-bda11d9c2c8e
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 31340fc6-5e9e-4b7e-a2f2-4eaad00cc09e
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f9f4997-d0a7-425e-97e1-0e015385db8f
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ef89fdc-cd81-42c3-9de8-c9007110798a
          stepCounter: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09e0bb5b-5e26-42fa-a0a4-c293c6f802d3
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_WELL_TEST: d8b2e1a9-392c-4c8d-9477-8aa7851153a3
          ODS_PVIEW_PVT_PVFLOWNETHEADER: bd388a52-3d72-4c70-833d-7de7c6a8abd1
          ODS_PVIEW_PVT_PVUNITCOMP: b2609f15-a93c-4c5d-b86e-0898ad7558d0
          ODS_PVIEW_PVT_PVUNITCOMPTEST: 929b3978-fa1e-46f0-a399-b19f4cc78214
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_WELL_TEST') }} (IDFLOWNET, IDREC, UWI, PROD_DATE, TESTHOURS, GAS, OIL, WATER, TESTEDBY, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   UC.IDREC ,
                   UC.WELLIDREGULATORY UWI ,
                   CT.DTTM AS PROD_DATE ,
                   CT.DURTEST * 24 AS TESTHOURS ,
                   NVL(CT.VOLGASCALC, CT.VOLGAS) / 1000 AS GAS ,
                   NVL(CT.VOLHCLIQCALC, CT.VOLHCLIQ) AS OIL ,
                   NVL(CT.VOLWATERCALC, CT.VOLWATER) AS WATER ,
                   CT.TESTEDBY ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU' ,'CORP') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW','') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) UC
                ON F.IDFLOWNET = UC.IDFLOWNET
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPTEST') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) CT
                ON UC.IDREC = CT.IDRECPARENT
               AND NVL(CT.DONTUSE,0) <> 1
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMPTEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMPTEST') }}
        name: VIEW_PVIEW_OFM_WELL_TEST
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_WELL_TEST
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
