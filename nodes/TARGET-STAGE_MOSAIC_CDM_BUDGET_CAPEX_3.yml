fileVersion: 1
id: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "-- CAPTIAL PROCESSING PASS 3 -- Expense Category to AFE Type - Excluding amounts already allocated by Capital Type --"
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 341833b9-9503-4c84-a2e3-473f44688b9e
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: R_VERSION_IDX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4c735b8-2dee-4583-bf2d-138bcacaebd0
                stepCounter: a3d102cb-2314-4d5c-97e1-7fd9a978f1c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0348fe3-8473-430e-859a-ab0f15e60c5b
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BUDGET_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1c283494-2ab3-49ed-a82c-65b3d65725de
                stepCounter: a3d102cb-2314-4d5c-97e1-7fd9a978f1c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02723a23-17b8-44fe-a9b4-c5d5af5bda7a
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: BUDGET_EFFECTIVE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3caeb72c-6bb3-49b2-b31b-9838911b8699
                stepCounter: a3d102cb-2314-4d5c-97e1-7fd9a978f1c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c9dddbe-b6ca-4ea4-9721-0503c567f332
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: R_SRC_IDX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3c776e94-1bb6-4531-b174-e81e12ee82be
                stepCounter: fbcf9530-e9fa-4ab2-9e8e-aec1fdcede50
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27f52289-1d26-44c2-8f68-0dfd6b9637ac
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: CASE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2e4566c-c66e-45cc-93cd-f880fe2665e6
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50eb77a4-43ec-480b-a8b2-12df671caa12
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CASE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44776883-0dcb-4f8b-8c01-620e1645beaa
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33f65ce2-35b2-4145-a89e-a41c91734ee4
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: VINTAGE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b1dea204-e7d4-46a7-87d9-b3be7b786410
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3d4852f-2f22-46b8-abe7-7808b9c6c737
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: VINTAGE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18fdfb84-ad7f-4c21-8dd5-1e2f9c6af191
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 875ba27c-238c-4c8a-8eed-a9fa5c10a741
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: ENTITY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e5a7a28-ed9a-43e2-a53e-f5e27497843c
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb4d190a-b482-49f0-b683-f63923966b25
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba16003b-0d28-4a4b-9b15-4e0e2c8bfb39
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb3d1d41-3655-467a-ba52-7b1930476887
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: ENTITY_UUID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74553b8a-4b82-462a-b8c0-f19082c17e8b
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55f9388a-0554-493d-8e2d-275225a7983f
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 90eed8b5-cee1-46b8-a385-b92aec371030
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f236107c-c8e6-4724-ae44-00280147bae7
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8b4813b-acca-4a41-b315-4e4c64031717
                stepCounter: 73a13c69-f416-41e9-a172-22ac82233721
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc1302a0-6a1e-49b7-8a04-d882e36f98a8
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38461a81-43fa-43ae-a258-9914bca5d8e8
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6a9affa-8d41-4771-8e5c-725f2245d4ca
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DEST_ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6b814369-16ac-425b-a2c8-1fa4d589e18e
                stepCounter: 50adea9f-04d8-4c68-b0fc-1fdd457a81ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ee2d63ef-a90e-4b7a-a651-3d47aa532480
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: "'N'"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9d93b56-0780-48ec-a3ed-ce9fe1c61362
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb7fe5f0-f359-4bce-b311-f919a5390f88
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d457e6b-688a-467e-9004-e89fb9339d11
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb7fe5f0-f359-4bce-b311-f919a5390f88
                stepCounter: 1fb8c891-66e1-4dd3-8e14-a2cc4fc8a83b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4af38c5b-533d-4e50-9bec-d0eda125e95b
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74851c48-a6d6-4d9d-b8bd-bed78360578b
                stepCounter: 50adea9f-04d8-4c68-b0fc-1fdd457a81ae
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d85f053-0b8b-4fd6-b2ff-1aae397e3c47
          stepCounter: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        config: {}
        dataType: NUMBER(14,10)
        defaultValue: ""
        description: ""
        name: OP_FX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6fa1e507-b5d7-4f1e-a169-f42c94664858
                stepCounter: be7a3a5f-199b-4588-a06a-4701f7a8b755
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_MOSAIC_CDM_BUDGET_CAPEX_3: 94eec8c2-f05b-49df-b668-0c3e2c3faa40
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_MOSAIC_CDM_BUDGET_CAPEX_3') }} AS SELECT R_VERSION_IDX,
                   BUDGET_NAME,
                   BUDGET_EFFECTIVE_DATE,
                   R_SRC_IDX,
                   CASE_ID,
                   CASE_NAME,
                   VINTAGE_ID,
                   VINTAGE_NAME,
                   ENTITY_ID,
                   ENTITY_NAME,
                   ENTITY_UUID,
                   ACCT_PER_DATE,
                   AFE_TYPE,
                   CC,
                   DEST_ORG_ID,
                   GROSS_OR_NET_CODE,
                   ROUND(CAD_AMT,2) "CAD_AMT",
                   ROUND((CAD_AMT * OP_FX),2) "OP_AMT",
                   OP_CURR_CODE,
                   OP_FX,
                   CREATE_DT
              FROM (
                    SELECT RV.IDX "R_VERSION_IDX",
                           RV.VERSION_NAME "BUDGET_NAME",
                           RV.EFFECTIVE_DATE "BUDGET_EFFECTIVE_DATE",
                           RS.IDX "R_SRC_IDX",
                           RV.ECON_CASE_ID "CASE_ID",
                           RV.ECON_CASE_NAME "CASE_NAME",
                           RV.ECON_VINTAGE_ID "VINTAGE_ID",
                           RV.ECON_VINTAGE_NAME "VINTAGE_NAME",
                           E.ENTITY_ID,
                           E.ENTITY_NAME,
                           E.ENTITY_UUID,
                           E.ACCT_PER_DATE,
                           XA.AFE_TYPE "AFE_TYPE",
                           E.CC,
                           XD.DEST_ORG_ID,
                           'N' "GROSS_OR_NET_CODE",
                           SUM(DECODE(XA.AFE_TYPE, 'CA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Acquisition',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'GA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Capitalized G&A',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'WO',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'WorkOver',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'LA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Land',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'FA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Facility',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'MF',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Facility Maintenance',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'DR',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Drilling',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'PL',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Pipelines',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'WA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Abandonment',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'OT',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Corp Capital',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'IT',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'Other',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'LE',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Lease Accounting',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'SS',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Seismic', (NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'Studies', (NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'SM',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Subsurface Maintenance',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), NULL) * 1000) "CAD_AMT",
                           XD.OP_CURR_CODE,
                           COALESCE(FX_DT.FX_RATE, FX_YR.FX_RATE, FX_VER.FX_RATE) "OP_FX",
                           SYSDATE() "CREATE_DT"
                      FROM (
                            SELECT *
                              FROM DS_BUDGET.VW_BDGT_CDM_ECONOMICS
                             WHERE ENTITY_STATE_ID = 4
                           ) E
                      JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION
                             WHERE NVL(FLG_ARCHIVE,'N') = 'N'
                           ) RV
                        ON E.CASE_ID = RV.ECON_CASE_ID
                       AND E.VINTAGE_ID = RV.ECON_VINTAGE_ID
                      JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_SRC
                             WHERE SRC_TYPE = 'EDW_CAP'
                               AND SRC_TABLE LIKE 'CAP_PASS3_%'
                           ) RS
                        ON RV.IDX = RS.FK_R_VERSION_IDX
                      LEFT JOIN DS_BUDGET.X_DISTRICT_ATTR XD
                        ON E.DISTRICT = XD.DISTRICT
                       AND E.BUSINESS_UNIT = XD.BUSINESS_UNIT
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NULL
                               AND ACCT_PER_DATE IS NULL
                           ) FX_VER
                        ON XD.OP_CURR_CODE = FX_VER.OP_CURR_CODE
                       AND RV.IDX = FX_VER.FK_R_VERSION_IDX
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NOT NULL
                               AND ACCT_PER_DATE IS NULL
                           ) FX_YR
                        ON XD.OP_CURR_CODE = FX_YR.OP_CURR_CODE
                       AND EXTRACT(YEAR FROM E.ACCT_PER_DATE) = FX_YR.ACCT_PER_YEAR
                       AND RV.IDX = FX_YR.FK_R_VERSION_IDX
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NOT NULL
                               AND ACCT_PER_DATE IS NOT NULL
                           ) FX_DT
                        ON XD.OP_CURR_CODE = FX_DT.OP_CURR_CODE
                       AND E.ACCT_PER_DATE = FX_DT.ACCT_PER_DATE
                       AND RV.IDX = FX_DT.FK_R_VERSION_IDX
                     CROSS JOIN (
                            SELECT DISTINCT AFE_TYPE
                              FROM DS_BUDGET.X_AFE_TYPE_ATTR
                             WHERE PROCESSING_PASS = '3'
                           ) XA
                     GROUP BY RV.IDX,
                              RV.VERSION_NAME,
                              RV.EFFECTIVE_DATE,
                              RS.IDX,
                              RV.ECON_CASE_ID,
                              RV.ECON_CASE_NAME,
                              RV.ECON_VINTAGE_ID,
                              RV.ECON_VINTAGE_NAME,
                              E.ENTITY_ID,
                              E.ENTITY_NAME,
                              E.ENTITY_UUID,
                              E.ACCT_PER_DATE,
                              E.CC,
                              XA.AFE_TYPE,
                              XD.DEST_ORG_ID,
                              XD.OP_CURR_CODE,
                              COALESCE(FX_DT.FX_RATE, FX_YR.FX_RATE, FX_VER.FX_RATE),
                              XA.AFE_TYPE
                   )
             WHERE NVL(CAD_AMT,0) <> 0
               AND NVL(OP_FX,0) <> 0
        dependencies:
          - locationName: TARGET
            nodeName: LOAD_BUDGET_R_VERSION
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','LOAD_BUDGET_R_VERSION') }}
        name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
        noLinkRefs: []
  name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
