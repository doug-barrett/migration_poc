fileVersion: 1
id: 2e084f92-31fb-4024-9ed6-378d92d03523
name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "-- CAPTIAL PROCESSING PASS 3 -- Expense Category to AFE Type - Excluding amounts already allocated by Capital Type --"
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a70652b4-a950-43b6-8c4e-e850855f1626
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: R_VERSION_IDX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28d9bac4-1ef4-46cc-8433-0420479411b4
                stepCounter: d876a688-7405-416c-a8d2-c320880c01c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1ecaf1a-3cce-4c23-ae6a-3501acdf2d00
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: BUDGET_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18c3f021-ced1-4959-b750-294bc1deaf91
                stepCounter: d876a688-7405-416c-a8d2-c320880c01c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b4949b6-4d4b-4767-ae54-529ef7fca7be
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: BUDGET_EFFECTIVE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7575e344-112e-4252-9812-186ac37d1d96
                stepCounter: d876a688-7405-416c-a8d2-c320880c01c1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61a54223-775d-4b9f-b826-80d7f7c4d102
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: ""
        name: R_SRC_IDX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4992d3d7-68d2-45e9-ab6f-be92f1cdea3c
                stepCounter: 472dfb51-dcd9-4e70-8b45-c83146f139ff
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93c19a38-d241-4ad8-a811-cbb856a6ee69
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: CASE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 74122c17-8577-429a-b662-c697352f1051
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41983f5d-f44e-4c22-9a93-b064c0ae26c6
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CASE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 665df339-4d9a-41c8-a722-8799afe9d841
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49323e18-aa2b-466a-8cb5-f858b80bdf3f
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: VINTAGE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0413ebe4-6614-4baa-8af3-80c0fc6db80c
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 774f1639-f226-4fd7-8611-6499a9e16627
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: VINTAGE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bef8c78-ea5d-433d-bb76-69e45ac005a5
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35235bbf-b7d5-4a7c-827b-03f469ef6f2b
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(9)
        defaultValue: ""
        description: ""
        name: ENTITY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 90aa5066-a41f-495f-9c36-975b1da1c8df
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2bd0fae-7ad8-4b55-bb7c-21037598da93
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: ENTITY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5614c8bc-c4df-4e1a-b250-ff07e7e6394c
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 197a0890-8c5f-49de-93d5-f6cfa996e554
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: ENTITY_UUID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f6faae1-8314-42ae-bc72-9de10dfbb53c
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91b97ce5-a27d-4290-9baf-cf6506577b51
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACCT_PER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6dd60173-6f7e-4730-814c-3ea403eaf854
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 210e4da7-0178-447e-898e-b0d4d9011e94
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d418b59c-db6b-40e2-91a0-30de781e66c6
                stepCounter: d504ada8-e89f-423c-8f13-21677b6585bb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 415a0c8d-e584-4347-a423-6c3ca60235be
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: CC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d005fabf-a586-4cce-a88a-a63baf82ab98
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3582cd46-7204-4eb2-b2fd-01c48aabcfb6
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DEST_ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29544ea6-46fa-4182-9487-43327e2364b3
                stepCounter: 65a06ea1-101f-4344-86f7-93fb1c592ebe
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d88ac5b2-eba3-4f6b-980b-521ab958fbd6
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: GROSS_OR_NET_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: "'N'"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9eae7a5-2ff2-4801-8c55-1453f9f735c3
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6a6e321-6981-458f-903e-6976f2163787
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5745fe69-fd82-4ba9-ba1d-fdde80d2fab2
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6a6e321-6981-458f-903e-6976f2163787
                stepCounter: 1626d0ef-5702-4cd3-b543-7391d69ffe8d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48e01868-f332-42b5-bdc2-5e0fc15d1340
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea986b28-f56e-47a5-a09f-5d6e67eccec9
                stepCounter: 65a06ea1-101f-4344-86f7-93fb1c592ebe
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f44f549-63b5-4960-a733-3ae5709d1c48
          stepCounter: 2e084f92-31fb-4024-9ed6-378d92d03523
        config: {}
        dataType: NUMBER(14,10)
        defaultValue: ""
        description: ""
        name: OP_FX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0849049c-c7c7-4849-b910-d873d05f9c2b
                stepCounter: 9bb59105-be11-44bf-8ca3-0f995e0fc39a
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_MOSAIC_CDM_BUDGET_CAPEX_3: 2e084f92-31fb-4024-9ed6-378d92d03523
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_MOSAIC_CDM_BUDGET_CAPEX_3') }} AS SELECT R_VERSION_IDX,
                   BUDGET_NAME,
                   BUDGET_EFFECTIVE_DATE,
                   R_SRC_IDX,
                   CASE_ID,
                   CASE_NAME,
                   VINTAGE_ID,
                   VINTAGE_NAME,
                   ENTITY_ID,
                   ENTITY_NAME,
                   ENTITY_UUID,
                   ACCT_PER_DATE,
                   AFE_TYPE,
                   CC,
                   DEST_ORG_ID,
                   GROSS_OR_NET_CODE,
                   ROUND(CAD_AMT,2) "CAD_AMT",
                   ROUND((CAD_AMT * OP_FX),2) "OP_AMT",
                   OP_CURR_CODE,
                   OP_FX,
                   CREATE_DT
              FROM (
                    SELECT RV.IDX "R_VERSION_IDX",
                           RV.VERSION_NAME "BUDGET_NAME",
                           RV.EFFECTIVE_DATE "BUDGET_EFFECTIVE_DATE",
                           RS.IDX "R_SRC_IDX",
                           RV.ECON_CASE_ID "CASE_ID",
                           RV.ECON_CASE_NAME "CASE_NAME",
                           RV.ECON_VINTAGE_ID "VINTAGE_ID",
                           RV.ECON_VINTAGE_NAME "VINTAGE_NAME",
                           E.ENTITY_ID,
                           E.ENTITY_NAME,
                           E.ENTITY_UUID,
                           E.ACCT_PER_DATE,
                           XA.AFE_TYPE "AFE_TYPE",
                           E.CC,
                           XD.DEST_ORG_ID,
                           'N' "GROSS_OR_NET_CODE",
                           SUM(DECODE(XA.AFE_TYPE, 'CA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Acquisition',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'GA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Capitalized G&A',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'WO',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'WorkOver',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'LA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Land',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'FA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Facility',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'MF',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Facility Maintenance',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'DR',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Drilling',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'PL',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Pipelines',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'WA',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Abandonment',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'OT',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Corp Capital',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'IT',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'Other',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'LE',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Lease Accounting',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'SS',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Seismic', (NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), 'Studies', (NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), 'SM',DECODE(E.CAPITAL_EXPENSE_CATEGORY, 'Subsurface Maintenance',(NVL(TOTAL_CAPITAL,0) - (NVL(E.DEV_COMPLETION,0) + NVL(E.EOR_COMPLETION,0) + NVL(E.EXP_COMPLETION,0) + NVL(E.CONTROLLABLE_INVENTORY,0) + NVL(E.OPTIMIZATION,0) + NVL(E.WORKOVER_RECOMPLETION,0) + NVL(E.EOR_EQUIPPING,0) + NVL(E.WELL_PAD_PIPELINE_TIE_IN,0) + NVL(E.WELL_EQUIPPING,0) + NVL(E.LAND,0) + NVL(FACILITIES_MAJOR_PP,0) + NVL(E.DEV_DRILLING,0) + NVL(E.EOR_DRILLING,0) + NVL(E.EXP_DRILLING,0) + NVL(SEISMIC_STUDIES_CAPITALIZED_OH,0) + NVL(E.SUBSURFACE_MAINTENANCE,0))), NULL), NULL) * 1000) "CAD_AMT",
                           XD.OP_CURR_CODE,
                           COALESCE(FX_DT.FX_RATE, FX_YR.FX_RATE, FX_VER.FX_RATE) "OP_FX",
                           SYSDATE() "CREATE_DT"
                      FROM (
                            SELECT *
                              FROM DS_BUDGET.VW_BDGT_CDM_ECONOMICS
                             WHERE ENTITY_STATE_ID = 4
                           ) E
                      JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION
                             WHERE NVL(FLG_ARCHIVE,'N') = 'N'
                           ) RV
                        ON E.CASE_ID = RV.ECON_CASE_ID
                       AND E.VINTAGE_ID = RV.ECON_VINTAGE_ID
                      JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_SRC
                             WHERE SRC_TYPE = 'EDW_CAP'
                               AND SRC_TABLE LIKE 'CAP_PASS3_%'
                           ) RS
                        ON RV.IDX = RS.FK_R_VERSION_IDX
                      LEFT JOIN DS_BUDGET.X_DISTRICT_ATTR XD
                        ON E.DISTRICT = XD.DISTRICT
                       AND E.BUSINESS_UNIT = XD.BUSINESS_UNIT
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NULL
                               AND ACCT_PER_DATE IS NULL
                           ) FX_VER
                        ON XD.OP_CURR_CODE = FX_VER.OP_CURR_CODE
                       AND RV.IDX = FX_VER.FK_R_VERSION_IDX
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NOT NULL
                               AND ACCT_PER_DATE IS NULL
                           ) FX_YR
                        ON XD.OP_CURR_CODE = FX_YR.OP_CURR_CODE
                       AND EXTRACT(YEAR FROM E.ACCT_PER_DATE) = FX_YR.ACCT_PER_YEAR
                       AND RV.IDX = FX_YR.FK_R_VERSION_IDX
                      LEFT JOIN (
                            SELECT *
                              FROM DS_BUDGET.R_VERSION_FX
                             WHERE ACCT_PER_YEAR IS NOT NULL
                               AND ACCT_PER_DATE IS NOT NULL
                           ) FX_DT
                        ON XD.OP_CURR_CODE = FX_DT.OP_CURR_CODE
                       AND E.ACCT_PER_DATE = FX_DT.ACCT_PER_DATE
                       AND RV.IDX = FX_DT.FK_R_VERSION_IDX
                     CROSS JOIN (
                            SELECT DISTINCT AFE_TYPE
                              FROM DS_BUDGET.X_AFE_TYPE_ATTR
                             WHERE PROCESSING_PASS = '3'
                           ) XA
                     GROUP BY RV.IDX,
                              RV.VERSION_NAME,
                              RV.EFFECTIVE_DATE,
                              RS.IDX,
                              RV.ECON_CASE_ID,
                              RV.ECON_CASE_NAME,
                              RV.ECON_VINTAGE_ID,
                              RV.ECON_VINTAGE_NAME,
                              E.ENTITY_ID,
                              E.ENTITY_NAME,
                              E.ENTITY_UUID,
                              E.ACCT_PER_DATE,
                              E.CC,
                              XA.AFE_TYPE,
                              XD.DEST_ORG_ID,
                              XD.OP_CURR_CODE,
                              COALESCE(FX_DT.FX_RATE, FX_YR.FX_RATE, FX_VER.FX_RATE),
                              XA.AFE_TYPE
                   )
             WHERE NVL(CAD_AMT,0) <> 0
               AND NVL(OP_FX,0) <> 0
        dependencies:
          - locationName: TARGET
            nodeName: LOAD_BUDGET_R_VERSION
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','LOAD_BUDGET_R_VERSION') }}
        name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
        noLinkRefs: []
  name: STAGE_MOSAIC_CDM_BUDGET_CAPEX_3
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
