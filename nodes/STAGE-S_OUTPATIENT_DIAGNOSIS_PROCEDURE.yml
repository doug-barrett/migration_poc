fileVersion: 1
id: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: false
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 951a9c56-0b3d-4924-8988-adb08d7cecdc
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: OUTPATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b867b12-aadb-40e2-8d49-81aa8ba06241
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: OUTPATIENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'T'+CONVERT(varchar,ds_pims_schedules.schdl_refno)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfdec1ac-c163-4c05-aac5-cf62efb41306
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: APPOINTMENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b310869-58aa-40b5-a369-c25a7d219266
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.CONVERT(date,ds_pims_schedules.start_dttm)=dim_appointment_start_date.appointment_start_calendar_date
        name: DIM_APPOINTMENT_START_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99326089-c83f-4fef-8170-682a4d5ff5f0
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 939fd1ef-a588-4d74-8e21-6138bfa3b64f
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25510819-6de0-45c7-90ca-1d80e8b2604f
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99a9fb90-fc0f-4e7d-8777-6c46dc5a3702
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.patient_reference_no=ds_pims_diagnosis_procedures.dgpro_refno
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03984d2d-ba94-4b9e-96ef-1be6bb34011e
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b13e034-f38c-47c7-a5c4-a35c4e994a7b
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dee01f4e-b042-40a3-b33f-bcdb29d55b6f
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_SUBTYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2ea3842-055a-46df-b5de-90d5a3f0019f
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1cdafb39-b3dd-47de-9ea1-00801161b823
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 822628a7-f7b0-4d8a-b664-25f70747b6b8
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 755fb567-95d4-41ce-b17e-ace48d617522
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 99436d17-d3e2-4dc1-86eb-a266a0029eef
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(250)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35f28524-ed4a-4ff5-bc50-7f4c75fc4686
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              -- CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN'  THEN
               --  ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --  (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END)
               --  ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
               --  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79ea8ebd-5402-47fb-83ac-2e707d839772
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              --CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN'  THEN
               --     COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --      (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
               --  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5798904-18fd-41f8-bf4a-50b829109562
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_PROCEDURE_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              --CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE'  THEN
               --    ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --  (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END)
               --  ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
               ----  ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36b6186a-c6e1-4de0-96c4-efd5d8c27c93
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: PATIENT_PROCEDURE_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: |-
              -- CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE'  THEN
               --        COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno,
               --        (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'PROCE' THEN 1 ELSE NULL END))
               --   ELSE NULL END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0cf522c7-37a6-4098-90ef-9dae275239cb
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: DIM_DIAGNOSIS_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 911684d2-ed18-4670-acee-58ebc1f5174d
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da8c22c0-5add-4542-89d6-238c668471bb
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68a2ffa3-4199-4782-a8c2-e9dfbd03ecf3
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.create_user_login_code=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c1a301b-4afd-4ef2-a192-0edae9ccf397
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d99a3262-e06e-4276-afcb-e7e4704b339a
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a70b5c5-4df7-45b4-8e2f-2bf44150d6fc
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_outpatient_diagnosis_procedure.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b6fc89f-7a36-4bf5-94fb-cd63679d962c
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_referral_30.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: OUTPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b164284-ba1b-4d82-a612-7359c728f27b
          stepCounter: 31e60bf2-bd3c-4fb6-bbfc-b8b0d4965fd8
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: UNKNOWN
            nodeName: DS_PIMS_SCHEDULES
        join:
          joinCondition: |-
            FROM ds_pims_schedules
             INNER JOIN s_outpatient_diagnosis_procedure_v
                ON s_outpatient_diagnosis_procedure_v.outpatient_reference_no = ds_pims_schedules.schdl_refno
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_schedules.schdl_refno
               AND ds_pims_diagnosis_procedures.sorce_code = 'SCHDL'
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_diagnosis_procedures.mplev_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_diagnosis_procedures.cptyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.main_code = ds_pims_diagnosis_procedures.CCSXT_Code
               AND ds_pims_reference_values3.rfvdm_code = 'CCSXT'
             WHERE ds_pims_schedules.sctyp_refno = 12186 --'OTPAT'    --and ds_pims_schedules.dss_update_time > @v_pa_outpatient_incremental    --and ds_pims_schedules.dss_update_time > getdate()-3
        name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_OUTPATIENT_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
