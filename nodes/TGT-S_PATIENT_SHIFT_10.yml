fileVersion: 1
id: c1b3f6f5-d921-4f6a-955f-82b950660b66
name: S_PATIENT_SHIFT_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79001a49-fdfe-46b0-b59c-6c9e7c22abde
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: INT
        defaultValue: ""
        description: Unique identifies each patient shift row.
        name: PATIENT_SHIFT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 599bdea6-43f8-4136-b802-b532ba118887
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8e65b06-9b61-429f-9e85-592a2c1a6066
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(9)
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c68d2f94-ed8b-49ec-8810-a4fba0c09ee8
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b77bd7a-4fcf-48ab-9cd3-ed4400fb8411
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: SHIFT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 278b0189-0511-4a58-b876-8772ccf60bcb
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41df6f60-0ac4-43f0-88f8-62e9698df41c
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(1)
        defaultValue: ""
        description: ""
        name: SHIFT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18c8003a-bc43-4b55-8fe3-e4f7da298f70
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40cbacaf-ed82-47c1-8f75-33176b0642ba
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(3)
        defaultValue: ""
        description: ""
        name: WARD_CODE_TRENDCARE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 081a254e-5f8e-461e-85f4-2a8a080e63e7
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 455de298-2147-4f65-b55a-4a330d15a809
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(5)
        defaultValue: ""
        description: ""
        name: BED_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 39655988-7cbf-47b3-ae73-67fd001afeea
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47d93530-fd85-4ee4-a28b-92c199d44bb5
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ACUITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 67548e89-f168-4e96-b44d-488caefa692e
                stepCounter: aeb82016-03e7-4b0e-a9b2-43b873613876
            transform: IFNULL(cast(floor(psRequiredHours) AS nvarchar(2)) + ':' + left(cast(cast(round((psRequiredHours * 60) - (floor(psRequiredHours) * 60),0) AS integer) AS nvarchar(2)) + '0',2) + ' (' + cast(floor(psCategoryCode) AS nvarchar(2)) + ')','')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74d026f5-2020-45bf-bbb7-c58adcb62444
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(12)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 60e77a64-3e45-452c-9cd7-f58261f11ed7
                stepCounter: ba1e8534-e88c-4199-bab2-196b8c8fa5a6
            transform: RTRIM(ds_tcare_InpatientEncounter.inpPatientNumber)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93140b7e-3f80-423a-868e-d33ce0420406
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NVARCHAR(12)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7bad03ad-026a-4188-bfbd-f02b26f581b2
                stepCounter: ba1e8534-e88c-4199-bab2-196b8c8fa5a6
            transform: RTRIM(ds_tcare_InpatientEncounter.inpLastEOCNumber)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7ada90d-bde1-4055-9e50-b1bce8e0ef43
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NUMERIC(10,5)
        defaultValue: ""
        description: ""
        name: SHIFT_START_TIME_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7a01b91c-bb06-443c-92cc-be691dc1a041
                stepCounter: f5dbfa9b-37fc-4018-a2aa-31c4a69831a1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57728431-08cb-48fd-bf99-7b7de84e3d2b
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: NUMERIC(10,5)
        defaultValue: ""
        description: ""
        name: SHIFT_LENGTH_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ca8b7ed1-7288-4f5c-928c-f48940cece8d
                stepCounter: f5dbfa9b-37fc-4018-a2aa-31c4a69831a1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0391c343-7d58-4831-ac16-ebd57b9f9faf
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: PIMS_WARD_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e0ef9ddb-0b61-487d-ab0d-ad159fdeed0e
                stepCounter: 1bd6e63a-9925-418b-9449-acaed616a7f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d31838a1-aaff-4b64-aeea-8897644a9063
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_WARD_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6aa5e7b8-4dc5-4b87-a4c2-5013db0e1dfc
                stepCounter: 50c31151-9204-4154-9caf-5d28244bde1a
            transform: IFNULL(dim_ward.dim_ward_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3139034a-3ac0-401c-87fc-055e03668046
          stepCounter: c1b3f6f5-d921-4f6a-955f-82b950660b66
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_TCARE_PATIENTSHIFT
        join:
          joinCondition: |-
            FROM ds_tcare_PatientShift
              LEFT OUTER JOIN ds_tcare_InpatientEncounter
                ON ds_tcare_PatientShift.psPatientReference = ds_tcare_InpatientEncounter.inpPatientReference
              LEFT OUTER JOIN ds_tcare_SummaryShift
                ON ds_tcare_PatientShift.psDate = ds_tcare_SummaryShift.tlDate
               AND ds_tcare_PatientShift.psWardCode = ds_tcare_SummaryShift.tlWardCode
               AND ds_tcare_PatientShift.psShiftCode = ds_tcare_SummaryShift.tlShiftCode
              LEFT OUTER JOIN l_mappings_wardstc
                ON l_mappings_WardsTC.wdwardcode = ds_tcare_PatientShift.pswardcode
               AND l_mappings_WardsTC.End_Date IS NULL -- Ignore ward 218 row with populated end_date    LEFT JOIN dim.dim_ward  ON l_mappings_wardstc.pimswardcode = dim_ward.ward_code  AND ds_tcare_PatientShift.psDate  >= dim_ward.ward_validity_start_date  AND ds_tcare_PatientShift.psDate  <  dim_ward.ward_validity_end_date  AND dim_ward.dss_current_flag = 'Y'    WHERE ds_tcare_PatientShift.psDate >= CONVERT(datetime, @v_pa_trendcare_Incremental, 120)
        name: S_PATIENT_SHIFT_10
        noLinkRefs: []
  name: S_PATIENT_SHIFT_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
