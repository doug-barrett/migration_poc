fileVersion: 1
id: 5fa5d712-cd84-49a2-a874-44ec8128404f
name: VIEW_GDC_RAW_PRODUCTION
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f290dc27-1aa1-4909-be59-1587d94832b3
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: BA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aba1fd9a-270e-4b28-b30e-3015403e9c27
                stepCounter: ee208fad-242f-468e-badf-834213d7891e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 896bed41-54ab-497d-9f52-97cab1addbb2
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f926259-f7f9-470c-8188-6e90bc456f1c
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2588e04-cba6-4bc0-8b88-068ca6c6de91
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACTIVITY_PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 760d8781-4b37-45d8-81be-65efd1168403
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb49cdca-7a14-4a4c-ade1-13dde7a5dafc
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: MONTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 760d8781-4b37-45d8-81be-65efd1168403
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c76ba859-75e1-4339-9198-c28fa4538262
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: NUMBER(4)
        defaultValue: ""
        description: ""
        name: YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 760d8781-4b37-45d8-81be-65efd1168403
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37328110-4626-44d7-a0f9-6238cc7eaa32
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9dec57d-7988-470d-b4a8-698e52310290
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9747e02-510e-4b9c-bc6f-473a8fcc4871
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9dec57d-7988-470d-b4a8-698e52310290
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64cdcff4-f98e-4a8d-96f5-d880a4477e12
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9dec57d-7988-470d-b4a8-698e52310290
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93454fbe-3088-43ac-83ea-ceed997d90d5
          stepCounter: 5fa5d712-cd84-49a2-a874-44ec8128404f
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: COND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d9dec57d-7988-470d-b4a8-698e52310290
                stepCounter: 8593b5b4-bf9e-4066-b36a-7b2f7aa4ed59
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_GDC_RAW_PRODUCTION: 5fa5d712-cd84-49a2-a874-44ec8128404f
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_GDC_RAW_PRODUCTION') }} AS SELECT BA_NAME ,
                   UWI ,
                   ACTIVITY_PERIOD ,

             MONTH ,
                   YEAR ,
                   "'WATER'" AS WATER ,
                   "'GAS'" AS GAS ,
                   "'OIL'" AS OIL ,
                   "'COND'" AS COND
              FROM (
                    SELECT BA_NAME ,
                           UWI ,
                           TO_DATE(YEAR || '-' || MONTH(TO_DATE(MONTH, 'MON')) || '-1') AS ACTIVITY_PERIOD ,

                     MONTH ,
                           YEAR ,
                           UPPER(PRODUCT_TYPE) AS PRODUCT_TYPE ,
                           AMOUNT
                      FROM (
                            SELECT PDEN.BA_NAME ,
                                   PDEN.GSL_UWI AS UWI ,
                                   CASE PRODUCT_TYPE
                                        WHEN 'OIL'   THEN 'OIL'
                                        WHEN 'CND'   THEN 'COND'
                                        WHEN 'GAS'   THEN 'GAS'
                                        WHEN 'WTR'   THEN 'WATER'
                                         END AS PRODUCT_TYPE ,
                                   YEAR ,
                                   JAN_VOLUME AS JAN ,
                                   FEB_VOLUME AS FEB ,
                                   MAR_VOLUME AS MAR ,
                                   APR_VOLUME AS APR ,
                                   MAY_VOLUME AS MAY ,
                                   JUN_VOLUME AS JUN ,
                                   JUL_VOLUME AS JUL ,
                                   AUG_VOLUME AS AUG ,
                                   SEP_VOLUME AS SEP ,
                                   OCT_VOLUME AS OCT ,
                                   NOV_VOLUME AS NOV ,
                                   DEC_VOLUME AS DEC
                              FROM (
                                    SELECT BA.BA_NAME ,
                                           V.GSL_UWI ,
                                           V.GSL_OLD_UWI ,
                                           V.PDEN_ID ,
                                           V.PDEN_TYPE ,
                                           V.PRODUCT_TYPE ,
                                           V.YEAR ,
                                           V.JAN_VOLUME ,
                                           V.FEB_VOLUME ,
                                           V.MAR_VOLUME ,
                                           V.APR_VOLUME ,
                                           V.MAY_VOLUME ,
                                           V.JUN_VOLUME ,
                                           V.JUL_VOLUME ,
                                           V.AUG_VOLUME ,
                                           V.SEP_VOLUME ,
                                           V.OCT_VOLUME ,
                                           V.NOV_VOLUME ,
                                           V.DEC_VOLUME
                                      FROM WS_DATA_STORE.ODS_GDC_PDEN_VOL_BY_MONTH V
                                      LEFT JOIN WS_DATA_STORE.ODS_GDC_PDEN PDEN
                                        ON V.PDEN_ID = PDEN.PDEN_ID
                                       AND PDEN.DSS_CURRENT_FLAG = 'Y'
                                       AND PDEN.DSS_DELETE_FLAG != 'Y'
                                      LEFT JOIN WS_DATA_STORE.ODS_GDC_BUSINESS_ASSOCIATE BA
                                        ON PDEN.CURRENT_OPERATOR = BA.BUSINESS_ASSOCIATE
                                       AND BA.DSS_CURRENT_FLAG = 'Y'
                                       AND BA.DSS_DELETE_FLAG !='Y'
                                     WHERE V.ACTIVITY_TYPE = 'PRODUCTION'
                                       AND V.PRODUCT_TYPE IN ('OIL' ,'CND' ,'GAS' ,'WTR')
                                       AND V.DSS_CURRENT_FLAG = 'Y'
                                       AND V.DSS_DELETE_FLAG != 'Y'
                                   ) PDEN
                           ) S UNPIVOT(AMOUNT FOR MONTH IN (JAN ,FEB ,MAR ,APR ,MAY ,JUN ,JUL ,AUG ,SEP ,OCT ,NOV ,DEC)) AMT
                   ) SD PIVOT(SUM(AMOUNT) FOR PRODUCT_TYPE IN ('WATER' ,'GAS' ,'OIL' ,'COND'));
        dependencies:
          - locationName: TARGET
            nodeName: ODS_GDC_BUSINESS_ASSOCIATE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_GDC_BUSINESS_ASSOCIATE') }}
        name: VIEW_GDC_RAW_PRODUCTION
        noLinkRefs: []
  name: VIEW_GDC_RAW_PRODUCTION
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
