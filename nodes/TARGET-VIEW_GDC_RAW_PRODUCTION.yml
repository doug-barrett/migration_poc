fileVersion: 1
id: ec48f19e-bef0-470c-9e0d-1c4720148b73
name: VIEW_GDC_RAW_PRODUCTION
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 47a8fd59-9008-48cc-a863-216c0f1df5f5
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: BA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0adb84e8-ec83-484a-989e-4fba02baadf9
                stepCounter: fe6ec0f0-ac0c-4049-9a73-0cd704b7e7e8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72a8a493-9662-4ca7-b67f-881245b720a4
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4ab19be-61bc-4c43-950a-0ec02ba56433
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d49fb3f9-fa18-41b6-91e4-edb0e44b46a7
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: ACTIVITY_PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 33a0f6c8-73bf-4124-a6d2-751a608e113a
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 866002ec-7014-4c86-a11e-4f9449df33a6
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: MONTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 33a0f6c8-73bf-4124-a6d2-751a608e113a
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 258c97dc-6db1-4f71-83ec-2a10a3641ab5
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: NUMBER(4)
        defaultValue: ""
        description: ""
        name: YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 33a0f6c8-73bf-4124-a6d2-751a608e113a
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0d82dea2-80ad-433b-952c-de7fb00ad135
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 260fda48-1261-466f-80fe-d6ffedeabdbd
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09295e12-3808-4677-84b3-8259e673c879
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 260fda48-1261-466f-80fe-d6ffedeabdbd
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 11bff052-84aa-4c41-a859-d4f79b30ab62
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 260fda48-1261-466f-80fe-d6ffedeabdbd
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1aa071df-04ad-4ea4-8653-3bb48816ed44
          stepCounter: ec48f19e-bef0-470c-9e0d-1c4720148b73
        config: {}
        dataType: NUMBER(26,4)
        defaultValue: ""
        description: ""
        name: COND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 260fda48-1261-466f-80fe-d6ffedeabdbd
                stepCounter: f43c2aee-b1f4-4347-84aa-b2e5f73c3bda
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_GDC_RAW_PRODUCTION: ec48f19e-bef0-470c-9e0d-1c4720148b73
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_GDC_RAW_PRODUCTION') }} AS SELECT BA_NAME ,
                   UWI ,
                   ACTIVITY_PERIOD ,

             MONTH ,
                   YEAR ,
                   "'WATER'" AS WATER ,
                   "'GAS'" AS GAS ,
                   "'OIL'" AS OIL ,
                   "'COND'" AS COND
              FROM (
                    SELECT BA_NAME ,
                           UWI ,
                           TO_DATE(YEAR || '-' || MONTH(TO_DATE(MONTH, 'MON')) || '-1') AS ACTIVITY_PERIOD ,

                     MONTH ,
                           YEAR ,
                           UPPER(PRODUCT_TYPE) AS PRODUCT_TYPE ,
                           AMOUNT
                      FROM (
                            SELECT PDEN.BA_NAME ,
                                   PDEN.GSL_UWI AS UWI ,
                                   CASE PRODUCT_TYPE
                                        WHEN 'OIL'   THEN 'OIL'
                                        WHEN 'CND'   THEN 'COND'
                                        WHEN 'GAS'   THEN 'GAS'
                                        WHEN 'WTR'   THEN 'WATER'
                                         END AS PRODUCT_TYPE ,
                                   YEAR ,
                                   JAN_VOLUME AS JAN ,
                                   FEB_VOLUME AS FEB ,
                                   MAR_VOLUME AS MAR ,
                                   APR_VOLUME AS APR ,
                                   MAY_VOLUME AS MAY ,
                                   JUN_VOLUME AS JUN ,
                                   JUL_VOLUME AS JUL ,
                                   AUG_VOLUME AS AUG ,
                                   SEP_VOLUME AS SEP ,
                                   OCT_VOLUME AS OCT ,
                                   NOV_VOLUME AS NOV ,
                                   DEC_VOLUME AS DEC
                              FROM (
                                    SELECT BA.BA_NAME ,
                                           V.GSL_UWI ,
                                           V.GSL_OLD_UWI ,
                                           V.PDEN_ID ,
                                           V.PDEN_TYPE ,
                                           V.PRODUCT_TYPE ,
                                           V.YEAR ,
                                           V.JAN_VOLUME ,
                                           V.FEB_VOLUME ,
                                           V.MAR_VOLUME ,
                                           V.APR_VOLUME ,
                                           V.MAY_VOLUME ,
                                           V.JUN_VOLUME ,
                                           V.JUL_VOLUME ,
                                           V.AUG_VOLUME ,
                                           V.SEP_VOLUME ,
                                           V.OCT_VOLUME ,
                                           V.NOV_VOLUME ,
                                           V.DEC_VOLUME
                                      FROM WS_DATA_STORE.ODS_GDC_PDEN_VOL_BY_MONTH V
                                      LEFT JOIN WS_DATA_STORE.ODS_GDC_PDEN PDEN
                                        ON V.PDEN_ID = PDEN.PDEN_ID
                                       AND PDEN.DSS_CURRENT_FLAG = 'Y'
                                       AND PDEN.DSS_DELETE_FLAG != 'Y'
                                      LEFT JOIN WS_DATA_STORE.ODS_GDC_BUSINESS_ASSOCIATE BA
                                        ON PDEN.CURRENT_OPERATOR = BA.BUSINESS_ASSOCIATE
                                       AND BA.DSS_CURRENT_FLAG = 'Y'
                                       AND BA.DSS_DELETE_FLAG !='Y'
                                     WHERE V.ACTIVITY_TYPE = 'PRODUCTION'
                                       AND V.PRODUCT_TYPE IN ('OIL' ,'CND' ,'GAS' ,'WTR')
                                       AND V.DSS_CURRENT_FLAG = 'Y'
                                       AND V.DSS_DELETE_FLAG != 'Y'
                                   ) PDEN
                           ) S UNPIVOT(AMOUNT FOR MONTH IN (JAN ,FEB ,MAR ,APR ,MAY ,JUN ,JUL ,AUG ,SEP ,OCT ,NOV ,DEC)) AMT
                   ) SD PIVOT(SUM(AMOUNT) FOR PRODUCT_TYPE IN ('WATER' ,'GAS' ,'OIL' ,'COND'));
        dependencies:
          - locationName: TARGET
            nodeName: ODS_GDC_BUSINESS_ASSOCIATE
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_GDC_BUSINESS_ASSOCIATE') }}
        name: VIEW_GDC_RAW_PRODUCTION
        noLinkRefs: []
  name: VIEW_GDC_RAW_PRODUCTION
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
