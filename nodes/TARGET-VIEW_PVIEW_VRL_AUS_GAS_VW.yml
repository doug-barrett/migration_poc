fileVersion: 1
id: c61b360f-05b4-401b-989f-d0f7616286c7
name: VIEW_PVIEW_VRL_AUS_GAS_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 868b81d6-997c-48bd-9d1c-10fe4b02f38d
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6a459e0-7710-4dc6-9339-514b931166b0
                stepCounter: b92f820a-e129-42b3-92d5-b7c581794c28
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 89104a4f-8f06-4387-b703-897e6e1bcd5d
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66e768d8-87b2-4701-ada8-0802ce80d484
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6c9ca222-5263-4cc6-a2b8-228ddfb8f534
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ef3344c-752c-42cf-b4f9-019a3d7e3bad
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LIFT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 860cab80-5eb8-4cfb-8823-46ecfce51ba9
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FORMATION_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 18b7dd9b-6590-4815-bf2a-a672e9ea3bbf
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dbc3f727-98c4-4b36-9449-02e15becaca6
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a45b248a-f7ad-455e-9d4f-f348d2cb0e34
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: THRUPUT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44b7f470-73a4-46ca-ab8b-2ba1f70dd48a
                stepCounter: f463aa47-4bc3-4601-8f44-729101e921f0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d285048e-c90f-4f95-8737-4cc7ae555ebd
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: B10_DOWN_HOLE_PRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 811c571a-ec9c-4d07-bfec-1a8cd20a8805
                stepCounter: e68d7a06-7c2f-41ad-8aee-fd942e57d617
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44f77b66-9459-4e47-a282-ab7510e6dfad
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PRESS_UOM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f70be30-cc1a-4639-9f03-3ffeef2a2ffc
                stepCounter: 83f902d8-fcf0-4412-ae1c-0a6bc1e0691b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77ebf309-e132-4e11-b069-48f0b634fe9e
          stepCounter: c61b360f-05b4-401b-989f-d0f7616286c7
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_AUS_GAS_VW: c61b360f-05b4-401b-989f-d0f7616286c7
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_AUS_GAS_VW') }} AS SELECT g.idflownet,
                   CAST(ge.dttm AS date) AS date,
                   round(sum(CASE WHEN lower(g.name) like '%inj%' THEN ge.volgascalc ELSE 0 END), 2) AS inj_gas,
                   round(sum(CASE WHEN lower(g.name) like '%wna lift%' OR lower(g.name) like '%wnb lift%' THEN ge.volgascalc ELSE 0 END), 2) AS lift_gas,
                   round(sum(CASE WHEN lower(g.name) like '%formation%' THEN ge.volgascalc ELSE 0 END), 2) AS formation_gas,
                   round(sum(CASE WHEN lower(g.name) like '%fuel%' THEN ge.volgascalc ELSE 0 END), 2) AS fuel_gas,
                   round(sum(CASE WHEN lower(g.name) like '%flare%' THEN ge.volgascalc ELSE 0 END), 2) AS flare_gas,
                   round(sum(CASE WHEN lower(g.name) like '%wna lift%' OR lower(g.name) like '%wnb lift%' OR lower(g.name) like '%formation%' THEN ge.volgascalc ELSE 0 END), 2) AS thruput_gas,
                   round(avg(pe.value), 2) AS b10_down_hole_press,
                   p.uomreading press_uom,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(h.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvunitmeterpdgas g
             INNER JOIN DS_PRODVIEW.PVT_pvunitmeterpdgasentry ge
                ON g.idrec = ge.idrecparent
              LEFT JOIN DS_PRODVIEW.PVT_pvunitmeaspt p
                ON p.idflownet = p.idflownet
               AND lower(p.name) like '%b10 down hole press%'
              LEFT JOIN DS_PRODVIEW.PVT_pvunitmeasptentry pe
                ON p.idrec = pe.idrecparent
               AND ge.dttm = pe.dttm
             INNER JOIN DS_PRODVIEW.PVT_pvflownetheader h
                ON h.idflownet = g.idflownet
             WHERE g.idflownet = '58877C62BE0F489EA5E5B14F1A3D3947'
             GROUP BY g.idflownet,
                      h.SYSSECURITYTYP,
                      ge.dttm,
                      p.uomreading
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITMETERPDGAS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITMETERPDGAS') }}
        name: VIEW_PVIEW_VRL_AUS_GAS_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_AUS_GAS_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
