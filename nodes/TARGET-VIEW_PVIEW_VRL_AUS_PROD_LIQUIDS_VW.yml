fileVersion: 1
id: 603cf73b-69be-44c6-ab4a-a4082b597d22
name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e881b782-de11-444e-8af2-83e72ee926b4
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9ea9e187-c6e7-4688-b8ea-19e5d98fea51
                stepCounter: 812fb704-930e-4c81-b4b9-b5b5a9c3007a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67371b29-f2d7-4bbc-be2d-0a14ebe398d8
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4db47ae5-8d01-4211-8123-f444134ff1c5
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13aa50d6-3998-4beb-afd6-931c2ab8f13c
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84d400a3-3f47-447a-9ef5-e9d59e3d3d1b
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0b837451-3ed4-4e45-b6b8-7036f3b53eaf
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_OIL_UNCORRECT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ecf648b-f629-4354-bcf1-57e4e945d81e
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af8941db-0b10-4fc8-85d7-379b8e107204
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b780a29d-25ac-4fd2-8077-5dcec6182aa5
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 938dc05d-9923-4da5-a322-046d0fdecd13
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_FLUIDS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ecf648b-f629-4354-bcf1-57e4e945d81e
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57ae8a3a-3abd-439a-bd6a-be1f8c761126
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: WATERCUT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ecf648b-f629-4354-bcf1-57e4e945d81e
                stepCounter: 1fc1f5e3-789a-4d7c-8f90-82afba0e441a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21fb4c69-1cd5-4d28-bd5e-d5e68b7050c8
          stepCounter: 603cf73b-69be-44c6-ab4a-a4082b597d22
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW: 603cf73b-69be-44c6-ab4a-a4082b597d22
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW') }} AS SELECT l.idflownet,
                   CAST(le.dttm AS date) AS date,
                   sum(CASE WHEN lower(l.name) like '%water%' THEN le.volwatercalc ELSE 0 END) AS prod_water,
                   sum(CASE WHEN lower(l.name) like '%oil%' THEN le.voltotalcalc ELSE 0 END) AS total_oil_uncorrect,
                   sum(CASE WHEN lower(l.name) like '%oil%' THEN le.volhcliqcalc ELSE 0 END) AS total_oil,
                   sum(le.voltotalcalc) AS total_fluids,
                   CASE WHEN round(sum(le.voltotalcalc), 1) = 0.0 THEN 0
                        ELSE sum(CASE WHEN lower(l.name) like '%water%' THEN le.volwatercalc ELSE 0 END) / sum(le.voltotalcalc) * 100
                         END AS watercut,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(h.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvunitmeterliquid l
             INNER JOIN DS_PRODVIEW.PVT_pvunitmeterliquidentry le
                ON l.idrec = le.idrecparent
               AND lower(l.name) like '%prod%'
             INNER JOIN DS_PRODVIEW.PVT_pvflownetheader h
                ON h.idflownet = l.idflownet
             GROUP BY l.idflownet,
                      le.dttm,
                      h.SYSSECURITYTYP
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITMETERLIQUID
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITMETERLIQUID') }}
        name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
