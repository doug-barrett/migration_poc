fileVersion: 1
id: fd0d58b5-1ec7-400f-8a9e-74dac316309a
name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7a531ea-8a74-4742-a2c7-369822683807
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b44d7acd-0c55-4f41-ad91-2b88516122af
                stepCounter: 54b3da7f-6580-4bdd-96f4-0f32512afc70
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33c05e5e-f420-4e95-8496-ef7912e6a836
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e45f2ea-a00d-4d23-b03d-225852c23145
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6572da1f-1006-49e1-9390-c1e8a0571373
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f92bfe50-d133-4fa2-a28e-a2e5042ec3b9
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f7813af-3f2a-4722-a32d-604ab97a5958
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_OIL_UNCORRECT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e81c703-ac3e-4de4-a6b8-8bf88e2451a0
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75a4331b-2d36-45b5-a8c0-8afbbfb5e532
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 875a6748-4391-4d32-8877-e15aaf480536
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d65e76b-c95a-495d-aa6a-c4aef8c5eaca
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TOTAL_FLUIDS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e81c703-ac3e-4de4-a6b8-8bf88e2451a0
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef3c49fb-88d6-4c50-bbbf-468d8fb87073
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: WATERCUT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e81c703-ac3e-4de4-a6b8-8bf88e2451a0
                stepCounter: a42bf1d3-9077-4deb-a421-72cf454785c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8fb21012-dbff-46ba-a7de-bf635fa770c5
          stepCounter: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW: fd0d58b5-1ec7-400f-8a9e-74dac316309a
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW') }} AS SELECT l.idflownet,
                   CAST(le.dttm AS date) AS date,
                   sum(CASE WHEN lower(l.name) like '%water%' THEN le.volwatercalc ELSE 0 END) AS prod_water,
                   sum(CASE WHEN lower(l.name) like '%oil%' THEN le.voltotalcalc ELSE 0 END) AS total_oil_uncorrect,
                   sum(CASE WHEN lower(l.name) like '%oil%' THEN le.volhcliqcalc ELSE 0 END) AS total_oil,
                   sum(le.voltotalcalc) AS total_fluids,
                   CASE WHEN round(sum(le.voltotalcalc), 1) = 0.0 THEN 0
                        ELSE sum(CASE WHEN lower(l.name) like '%water%' THEN le.volwatercalc ELSE 0 END) / sum(le.voltotalcalc) * 100
                         END AS watercut,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(h.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvunitmeterliquid l
             INNER JOIN DS_PRODVIEW.PVT_pvunitmeterliquidentry le
                ON l.idrec = le.idrecparent
               AND lower(l.name) like '%prod%'
             INNER JOIN DS_PRODVIEW.PVT_pvflownetheader h
                ON h.idflownet = l.idflownet
             GROUP BY l.idflownet,
                      le.dttm,
                      h.SYSSECURITYTYP
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITMETERLIQUID
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITMETERLIQUID') }}
        name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_AUS_PROD_LIQUIDS_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
