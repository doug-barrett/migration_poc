fileVersion: 1
id: 671786c5-8276-461c-8de7-aa94e9a2bfd3
name: S_CONTACT_DIAGNOSIS_PROCEDURE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a047297-09d0-4718-8500-d4369de678d9
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: CONTACT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e22d766-34a2-4766-bf15-9924813ccf08
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b5ab558-a34e-4fd8-9b8e-311c0d96346a
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: "'T'+CONVERT(varchar,ds_pims_schedules.schdl_refno)"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51a96c3c-634c-4de0-a7ee-79c9cb3fe918
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CONTACT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec8fa2c5-ca35-4bea-9290-bc50185e05e7
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2dca908-5cd8-4eac-ba68-ab8cae44ccaf
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_contact_diagnosis_procedure.CONVERT(date,ds_pims_schedules.start_dttm)=dim_contact_start_date.contact_start_calendar_date
        name: DIM_CONTACT_START_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbc411e6-4d21-4246-958a-c6d2a8d8cb15
                stepCounter: 3b87a325-7309-43b5-bf51-249fdaafa25b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e82f420-4245-4e91-ba67-59ed645c667e
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b587a98-015d-4a99-920e-98579b82b9a7
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 985f0ba0-97cf-4152-a49b-7e86cb71409e
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27611dd2-97d7-41c8-abb7-e2975ea46d2a
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_contact_diagnosis_procedure.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57dc36c1-4c7f-42a7-92c1-11b6a1a1bdad
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: MEDICAL_PROBLEM_LEVEL_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7dcad9a6-52b1-402a-a292-1118300823b9
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 531a4450-fdfa-413a-bf7d-3a595ec39d94
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: MEDICAL_PROBLEM_LEVEL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 531a5e03-5a26-456e-a8c2-ca3c90058367
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(5)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 271efe56-3d39-4d18-b5a7-7e1dcc80d250
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 492549da-c419-4d47-b453-d5e9b9f37b73
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_SUBTYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2fdabfa2-68c1-4935-8556-fbeb4dec8d0c
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecc036db-91d2-4737-b93c-f3e449aa298e
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42ba5036-5159-4362-80c6-c36c047d6ff9
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: CLINICAL_CLASSIFICATION_XREF_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 580814f4-52c3-4d5f-82a7-47785888d898
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ae1a398a-9c7b-4fad-b7e2-8e105705ec6f
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f8e7aae-a311-4792-84f8-4d0287e8b777
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIAGNOSIS_PROCEDURE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b4c372ad-7e3b-459a-89ad-ec53d1b8cb49
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a4f1d1f-a807-4b1c-b5d2-0826a0da37ad
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_contact_diagnosis_procedure.diagnosis_procedure_reference_no=dim_diagnosis_procedure.diagnosis_procedure_reference_no
        name: DIM_DIAGNOSIS_PROCEDURE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24cebf11-1bcf-4240-a364-9b0f51cffc73
                stepCounter: 5c3dba16-610b-4df4-a82e-a17b4d31bb68
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e59dd30d-d747-46df-8d81-d00a6a7cf3f0
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8bd6a31c-a67d-4eab-9ac4-2e02b45c6a5c
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_DIAGNOSIS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'DIAGN' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 451d6654-04cf-45f9-af50-643f6fd3bd61
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_TESTS_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'TESTS' THEN ROW_NUMBER() OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'TESTS' THEN 1 ELSE NULL END) ORDER BY ds_pims_diagnosis_procedures.sort_order,ds_pims_schedules.start_dttm)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45a2f74b-ca96-4f54-acb1-1fe5b06ae8a4
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: ""
        name: PATIENT_TESTS_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b97bdc6-cf45-46a3-b6b6-36dca9fe2232
                stepCounter: 91a0e39f-bf7f-4006-bd7b-65a534f637a9
            transform: |-
              CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'TESTS' THEN COUNT(1) OVER (PARTITION BY ds_pims_schedules.patnt_refno, (CASE WHEN ds_pims_diagnosis_procedures.dptyp_code = 'TESTS' THEN 1 ELSE NULL END))
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc7b49e4-ab60-4f4a-83ae-602d7d97d61d
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 614e95dd-dc83-4fb6-80e2-eae0b812a7b5
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 444059df-728f-48f5-a9de-13adb0130bc9
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f2de421-29ae-4da9-a753-3f3076972d72
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b5281088-9c0c-41bc-b996-a06d3931db2f
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_contact_diagnosis_procedure.create_user_login_code=dim_create_user_login.create_user_login_code
        name: DIM_CREATE_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dfe5e14-cc2f-4748-8352-a6d1621289af
                stepCounter: 70bd6ed5-e21b-440f-9079-7fe305bc4f30
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 89d00e7c-2ea2-45d2-b1e6-8b34976f5245
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: MODIFY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6decebff-eb31-4277-aa08-3a795ec793df
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a883dc87-c2a9-40d6-bfe1-e843e6c1cf08
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: MODIFY_USER_LOGIN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0018f473-59d0-4576-9d88-96374fcf8639
                stepCounter: 1b5b9711-ab0c-474a-a7f0-a18e233b291c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23d32cbd-4db8-4e6c-ad96-a7bc09f22d42
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: 'INTEGER '
        defaultValue: ""
        description: s_contact_diagnosis_procedure.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: DIM_MODIFY_USER_LOGIN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ceaa34a6-dd0b-40fb-bc61-9df93cc05e7b
                stepCounter: bef0768d-dddb-4d02-af8d-03160de42b62
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e2c3559-46f0-4711-aeac-fb5eda01910f
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_referral_30.modify_user_login_code=dim_modify_user_login.modify_user_login_code
        name: CONTACT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32bb62b8-7472-4d5f-93de-0b20037fe6a5
          stepCounter: 671786c5-8276-461c-8de7-aa94e9a2bfd3
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_SCHEDULES
        join:
          joinCondition: |-
            FROM ds_pims_schedules
             INNER JOIN ds_pims_diagnosis_procedures
                ON ds_pims_diagnosis_procedures.sorce_refno = ds_pims_schedules.schdl_refno
               AND ds_pims_diagnosis_procedures.sorce_code = 'CNTCT'
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_diagnosis_procedures.mplev_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_diagnosis_procedures.cptyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.main_code = ds_pims_diagnosis_procedures.CCSXT_Code
               AND ds_pims_reference_values3.rfvdm_code = 'CCSXT'
        name: S_CONTACT_DIAGNOSIS_PROCEDURE
        noLinkRefs: []
  name: S_CONTACT_DIAGNOSIS_PROCEDURE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
