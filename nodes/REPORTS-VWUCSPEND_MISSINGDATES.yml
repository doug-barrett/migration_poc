fileVersion: 1
id: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
name: VWUCSPEND_MISSINGDATES
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2299444-74b0-47b9-a3eb-c8914e8c2004
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CAMPUS=UCCAMPUS.UCCAMPUS
        name: UCCAMPUSKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c7881ec-7ab6-4ef6-9ad2-66e56e986b17
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05f56a27-1377-41c7-a22f-43c191cd9eae
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_1=UCCATEGORYLEVEL1.UCCATEGORY_LEVEL_1
        name: UCCATEGORYLEVEL1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 079704b6-d977-47be-9581-0f3349296fb6
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 792a4a45-785b-416b-bc8f-93f62d1aaace
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_2=UCCATEGORYLEVEL2.UCCATEGORY_LEVEL_2
        name: UCCATEGORYLEVEL2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: badea74f-8507-4bec-bac6-df696dc04b98
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f58266c1-231e-4f83-91ab-41c9e1ddba2b
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_3=UCCATEGORYLEVEL3.UCCATEGORY_LEVEL_3
        name: UCCATEGORYLEVEL3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e785372e-d4c8-446d-9f39-db0827ea090a
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1739bc6-2e4c-4a8a-a7d3-8ee8d166d837
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_4=UCCATEGORYLEVEL4.UCCATEGORY_LEVEL_4
        name: UCCATEGORYLEVEL4KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5cef450-584b-4076-a589-01daab8f71ab
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa797557-fa4b-4681-ab77-e1b69b51f08c
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.SUPPLIER=UCSUPPLIER.UCSUPPLIERNAME
        name: UCSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59230733-a5c5-42b9-a51a-1d9479c34b69
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f3851db-a1b7-46fe-8cfb-56002a5f5e60
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_1=UCTIER1.UC_TIER_1
        name: UCTIER1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c5331f6-0973-45dd-97b0-288f5a4b4e64
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8255fd5d-d431-48bf-8bbb-3e9e8d5f9e1c
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_2=UCTIER2.UC_TIER_2
        name: UCTIER2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64e208c8-120a-4856-b8a2-51713f4d3a87
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01554943-ec70-4910-8e52-790abe5ef3ec
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_3=UCTIER3.UC_TIER_3
        name: UCTIER3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 65ef5046-6ffc-4cb5-8af3-962ac4007b24
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a7e485dd-e9d6-46ac-b273-bc3eefb56838
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: UCCOMPONENTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 736264bc-27c5-4d73-9866-7533e5e0522b
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ded8a567-127d-4a36-809a-d8239178a730
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8059b52-7e21-4ea2-87b9-1baff7de1d94
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85861437-cf7a-45c3-a5e2-e959f0e58bba
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPSUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 346a1543-3248-4805-b667-4018c9fc4f39
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6dcfbe2b-877c-46a0-9311-eb90e91673aa
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPCONTRACTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78717194-4e31-4e89-8ffe-5b0447ce1a91
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 218c639d-aea6-4374-9cdd-24bb905898c7
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPCONTRACTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bce6370d-cc66-4230-b7d6-adb6e2cfda7a
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 988826ca-4c06-4bc2-995d-3aafce6e7ef5
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: OPCONTRACTMAPPINGSTATUSID
        name: OPCONTRACTMAPPINGSTATUSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bd070ba9-f025-466c-bd21-4b9e8c561b26
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5cb1510f-eb6e-40af-a710-6e78e3ec0403
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: UCSPEND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6bed501-3caf-4946-bc20-1ebc3426bd8a
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be94e7dc-dc6b-49e8-bfee-16f0122a2940
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: INT
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.TRANSACTIONDATE=DIMTRANSACTIONDATE.TRANSACTIONDATE
        name: TRANSACTIONDATEKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e924cde-9d00-45e9-af1e-10e3af0afa16
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e50d4d6-0c81-4aa7-82f1-2736900d3a2d
          stepCounter: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b570d47c-408b-42d6-a23b-9d7eb2c439cb
                stepCounter: 94680f47-580a-42b9-b5db-5b4d7f1e212f
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VWUCSPEND_MISSINGDATES: 8a374c0f-c3c4-4116-8cd9-51a72f054e15
          DIMTRANSACTIONDATE: 04420abb-9d56-4991-8545-87b244f17df0
          MAXRECEIPTDATE: 4380fe2a-61d0-4ea2-8c2c-da736f75b375
          UCCAMPUS: f4ed674a-1d0d-49f4-ad77-49e296514204
          AGGUCSPEND: 94680f47-580a-42b9-b5db-5b4d7f1e212f
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('REPORTS','VWUCSPEND_MISSINGDATES') }} (\NUCCAMPUSKEY,\NUCCATEGORYLEVEL1KEY,\NUCCATEGORYLEVEL2KEY,\NUCCATEGORYLEVEL3KEY,\NUCCATEGORYLEVEL4KEY,\NUCSUPPLIERKEY,\NUCTIER1KEY,\NUCTIER2KEY,\NUCTIER3KEY,\NUCCOMPONENTKEY,\NOPSUPPLIERKEY,\NOPSUPPLIERID,\NOPCONTRACTKEY,\NOPCONTRACTID,\NOPCONTRACTMAPPINGSTATUSID,\NUCSPEND,\NTRANSACTIONDATEKEY,\N TRANSACTIONDATE\N)\NAS\N WITH CTEALLTRANSDATES \N AS (
                    SELECT \N DTD.TRANSACTIONDATEKEY, \N DTD.TRANSACTIONDATE \N
                      FROM {{ ref('DIM','DIMTRANSACTIONDATE') }} AS DTD \N
                     WHERE DTD.TRANSACTIONDATEKEY BETWEEN 20180101 AND (
                            SELECT REPLACE(MAXRECEIPTDATE,'-','')
                              FROM {{ ref('FACT','MAXRECEIPTDATE') }}
                           ) \N
                       AND DTD.TRANSACTIONDATEKEY LIKE '%01'
                   ), \N CTEALLCAMPUSES \N AS (
                    SELECT \N UCCAMPUSKEY \N
                      FROM {{ ref('DIM','UCCAMPUS') }} AS U \N
                     WHERE U.UCCAMPUSKEY > 0
                   ), \N CTEALLUCROWSMINUSTRANSDATE \N AS (
                    SELECT DISTINCT \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID \N
                      FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU \N
                     WHERE AU.OPCONTRACTMAPPINGSTATUSID IN (1, 2)
                   ), \N CTEALLUCROWSALLDATESALLCAMPUSES \N AS (
                    SELECT \N * \N
                      FROM CTEALLUCROWSMINUSTRANSDATE AS CAAUMTD, \N CTEALLCAMPUSES AS CAC, --CROSS JOIN TO GENERATE ROWS FOR ALL CAMPUSES AND FOR ALL DATES
            \N CTEALLTRANSDATES AS CATD
                   ) \N --,
            \N --CTEALLOPROWS
            \N --AS (SELECT DISTINCT
            \N --		AOARBC.UCCAMPUSKEY AS UCCAMPUSKEY,
            \N --		--AOARBC.CONTRACTKEY AS OPCONTRACTKEY,
            \N --		AOARBC.TRANSACTIONDATEKEY
            \N -- FROM   OMNIAPARTNERSDW.REPORTS.AGGOPSALESANDREVENUEBYCONTRACT AS AOARBC
            \N --		INNER JOIN CTEALLTRANSDATES AS CATD ON AOARBC.TRANSACTIONDATEKEY = CATD.TRANSACTIONDATEKEY)
            \N --CTEALLOPROWSWITHUCCOLUMNS
            \N --AS (SELECT
            \N --		CTEUC.*
            \N -- FROM   CTEALLUCROWSALLDATESALLCAMPUSES AS CTEUC
            \N --		INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEUC.UCCAMPUSKEY
            \N --												AND CTEOP.OPCONTRACTKEY = CTEUC.OPCONTRACTKEY
            \N --												AND CTEOP.TRANSACTIONDATEKEY = CTEUC.TRANSACTIONDATEKEY
            \N -- WHERE  CTEUC.UCCATEGORYLEVEL1KEY IS NOT NULL),
            \N --SELECT * FROM CTEALLOPROWS
            \N SELECT \N CTEALLUC.UCCAMPUSKEY, \N CTEALLUC.UCCATEGORYLEVEL1KEY, \N CTEALLUC.UCCATEGORYLEVEL2KEY, \N CTEALLUC.UCCATEGORYLEVEL3KEY, \N CTEALLUC.UCCATEGORYLEVEL4KEY, \N CTEALLUC.UCSUPPLIERKEY, \N CTEALLUC.UCTIER1KEY, \N CTEALLUC.UCTIER2KEY, \N CTEALLUC.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N CTEALLUC.OPSUPPLIERKEY, \N CTEALLUC.OPSUPPLIERID, \N CTEALLUC.OPCONTRACTKEY, \N CTEALLUC.OPCONTRACTID, \N CTEALLUC.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N CTEALLUC.TRANSACTIONDATEKEY, \N CTEALLUC.TRANSACTIONDATE \N
              FROM CTEALLUCROWSALLDATESALLCAMPUSES AS CTEALLUC \N --INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEALLUC.UCCAMPUSKEY AND CTEOP.TRANSACTIONDATEKEY = CTEALLUC.TRANSACTIONDATEKEY
            \N
            EXCEPT \N SELECT DISTINCT \N AU.UCCAMPUSKEY, \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N AU.TRANSACTIONDATEKEY, \N AU.TRANSACTIONDATE \N
              FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU
        dependencies:
          - locationName: REPORTS
            nodeName: AGGUCSPEND
          - locationName: DIM
            nodeName: DIMTRANSACTIONDATE
          - locationName: FACT
            nodeName: MAXRECEIPTDATE
          - locationName: DIM
            nodeName: UCCAMPUS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('REPORTS','AGGUCSPEND') }}
            {{ ref('DIM','DIMTRANSACTIONDATE') }}
            {{ ref('FACT','MAXRECEIPTDATE') }}
            {{ ref('DIM','UCCAMPUS') }}
        name: VWUCSPEND_MISSINGDATES
        noLinkRefs: []
  name: VWUCSPEND_MISSINGDATES
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
