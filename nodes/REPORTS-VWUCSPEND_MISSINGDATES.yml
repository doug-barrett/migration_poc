fileVersion: 1
id: 55bedc08-49d7-4ecf-b475-037a9688c49d
name: VWUCSPEND_MISSINGDATES
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84db2a44-36e1-4922-a594-d799aafa667a
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CAMPUS=UCCAMPUS.UCCAMPUS
        name: UCCAMPUSKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf26403b-38ce-4e2a-9da0-8f60b64259ea
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d558f40-7482-4688-8b10-42d70f7f44eb
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_1=UCCATEGORYLEVEL1.UCCATEGORY_LEVEL_1
        name: UCCATEGORYLEVEL1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb93d577-9a17-461a-b9c8-07fa65618eeb
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f7112862-a23f-48c1-87cd-e6bc4c6f0970
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_2=UCCATEGORYLEVEL2.UCCATEGORY_LEVEL_2
        name: UCCATEGORYLEVEL2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 339d6530-7bfa-4fa3-8d3b-452b5417a224
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efb84cc3-d83f-4c5f-81c3-630a46a37869
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_3=UCCATEGORYLEVEL3.UCCATEGORY_LEVEL_3
        name: UCCATEGORYLEVEL3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c851b71c-0751-4b64-a737-53e2a2d28eeb
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09dd1ff8-38d3-4bba-88a8-20649e64d8af
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_4=UCCATEGORYLEVEL4.UCCATEGORY_LEVEL_4
        name: UCCATEGORYLEVEL4KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e9abcaf-8a6e-4daf-ba24-16feb0211c22
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5cde7b7-dc6d-455a-a84e-154355bd2af1
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.SUPPLIER=UCSUPPLIER.UCSUPPLIERNAME
        name: UCSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb0c845f-0fcd-4d37-b003-bb9456e0671d
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3718a5ea-1f24-429a-9d00-67e7df839751
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_1=UCTIER1.UC_TIER_1
        name: UCTIER1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02a63cb3-a340-4da0-8a30-20de951caeef
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19d47d25-e6dc-43e5-9a6b-d6a4be3ccd40
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_2=UCTIER2.UC_TIER_2
        name: UCTIER2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c860eae5-3cd2-4a3f-b331-65b3ed040f99
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b06b67e3-1466-45ea-a2e6-7aa908e6ad6c
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_3=UCTIER3.UC_TIER_3
        name: UCTIER3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 302b73d4-1b49-4ead-9bc8-2382698e4095
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5fdc16dd-1a47-452c-ab79-43c972ae9447
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: UCCOMPONENTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c627da10-7883-417c-964d-7d0c8614966c
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf3d7fe3-e07d-42b5-84d1-c7b6d5cdf6e5
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e82ad349-d082-4234-91bc-b3ead4e83526
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78768c86-880d-43c6-8034-334505cd89b4
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPSUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bfa21c90-6b7a-48a5-9c68-95fd99130101
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c69bb52-bb1f-4cb4-bd6d-233037faf23b
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPCONTRACTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 670ba192-4118-4170-965e-33fdebc7cf59
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7fedbd18-56ed-41b3-860a-df3e8e66fdba
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPCONTRACTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1b6c0303-5cf1-4e72-b274-ab22ec5f3ebb
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9e868bc9-3e9f-4c9a-b511-3e42ccb1412d
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: OPCONTRACTMAPPINGSTATUSID
        name: OPCONTRACTMAPPINGSTATUSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e924828-b5d8-4810-9895-864e152b9edb
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74bd7aa0-be7d-4591-882b-139316e866d9
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: UCSPEND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2cd6d094-9bac-43b8-b9ea-b53b288718b1
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36a022c2-d32e-4ad4-b2f9-3b306fa51aca
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: INT
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.TRANSACTIONDATE=DIMTRANSACTIONDATE.TRANSACTIONDATE
        name: TRANSACTIONDATEKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c64a131a-7d58-4e56-9bf7-4f96071191ea
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14f0c6ec-e195-4d54-af73-5eb594e054da
          stepCounter: 55bedc08-49d7-4ecf-b475-037a9688c49d
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0334d045-b41a-4eb0-a19a-89d144a7039c
                stepCounter: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VWUCSPEND_MISSINGDATES: 55bedc08-49d7-4ecf-b475-037a9688c49d
          DIMTRANSACTIONDATE: f559ddb9-6dc3-4412-9aa2-81bbce93de47
          MAXRECEIPTDATE: 4d7210b5-cb3e-4625-8e4a-a04160bc1710
          UCCAMPUS: 98a60354-5e68-47cb-92c8-afd3b94a93be
          AGGUCSPEND: b0bde1c0-2b67-49d3-a8f1-c4c80d36ad6e
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('REPORTS','VWUCSPEND_MISSINGDATES') }} (\NUCCAMPUSKEY,\NUCCATEGORYLEVEL1KEY,\NUCCATEGORYLEVEL2KEY,\NUCCATEGORYLEVEL3KEY,\NUCCATEGORYLEVEL4KEY,\NUCSUPPLIERKEY,\NUCTIER1KEY,\NUCTIER2KEY,\NUCTIER3KEY,\NUCCOMPONENTKEY,\NOPSUPPLIERKEY,\NOPSUPPLIERID,\NOPCONTRACTKEY,\NOPCONTRACTID,\NOPCONTRACTMAPPINGSTATUSID,\NUCSPEND,\NTRANSACTIONDATEKEY,\N TRANSACTIONDATE\N)\NAS\N WITH CTEALLTRANSDATES \N AS (
                    SELECT \N DTD.TRANSACTIONDATEKEY, \N DTD.TRANSACTIONDATE \N
                      FROM {{ ref('DIM','DIMTRANSACTIONDATE') }} AS DTD \N
                     WHERE DTD.TRANSACTIONDATEKEY BETWEEN 20180101 AND (
                            SELECT REPLACE(MAXRECEIPTDATE,'-','')
                              FROM {{ ref('FACT','MAXRECEIPTDATE') }}
                           ) \N
                       AND DTD.TRANSACTIONDATEKEY LIKE '%01'
                   ), \N CTEALLCAMPUSES \N AS (
                    SELECT \N UCCAMPUSKEY \N
                      FROM {{ ref('DIM','UCCAMPUS') }} AS U \N
                     WHERE U.UCCAMPUSKEY > 0
                   ), \N CTEALLUCROWSMINUSTRANSDATE \N AS (
                    SELECT DISTINCT \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID \N
                      FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU \N
                     WHERE AU.OPCONTRACTMAPPINGSTATUSID IN (1, 2)
                   ), \N CTEALLUCROWSALLDATESALLCAMPUSES \N AS (
                    SELECT \N * \N
                      FROM CTEALLUCROWSMINUSTRANSDATE AS CAAUMTD, \N CTEALLCAMPUSES AS CAC, --CROSS JOIN TO GENERATE ROWS FOR ALL CAMPUSES AND FOR ALL DATES
            \N CTEALLTRANSDATES AS CATD
                   ) \N --,
            \N --CTEALLOPROWS
            \N --AS (SELECT DISTINCT
            \N --		AOARBC.UCCAMPUSKEY AS UCCAMPUSKEY,
            \N --		--AOARBC.CONTRACTKEY AS OPCONTRACTKEY,
            \N --		AOARBC.TRANSACTIONDATEKEY
            \N -- FROM   OMNIAPARTNERSDW.REPORTS.AGGOPSALESANDREVENUEBYCONTRACT AS AOARBC
            \N --		INNER JOIN CTEALLTRANSDATES AS CATD ON AOARBC.TRANSACTIONDATEKEY = CATD.TRANSACTIONDATEKEY)
            \N --CTEALLOPROWSWITHUCCOLUMNS
            \N --AS (SELECT
            \N --		CTEUC.*
            \N -- FROM   CTEALLUCROWSALLDATESALLCAMPUSES AS CTEUC
            \N --		INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEUC.UCCAMPUSKEY
            \N --												AND CTEOP.OPCONTRACTKEY = CTEUC.OPCONTRACTKEY
            \N --												AND CTEOP.TRANSACTIONDATEKEY = CTEUC.TRANSACTIONDATEKEY
            \N -- WHERE  CTEUC.UCCATEGORYLEVEL1KEY IS NOT NULL),
            \N --SELECT * FROM CTEALLOPROWS
            \N SELECT \N CTEALLUC.UCCAMPUSKEY, \N CTEALLUC.UCCATEGORYLEVEL1KEY, \N CTEALLUC.UCCATEGORYLEVEL2KEY, \N CTEALLUC.UCCATEGORYLEVEL3KEY, \N CTEALLUC.UCCATEGORYLEVEL4KEY, \N CTEALLUC.UCSUPPLIERKEY, \N CTEALLUC.UCTIER1KEY, \N CTEALLUC.UCTIER2KEY, \N CTEALLUC.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N CTEALLUC.OPSUPPLIERKEY, \N CTEALLUC.OPSUPPLIERID, \N CTEALLUC.OPCONTRACTKEY, \N CTEALLUC.OPCONTRACTID, \N CTEALLUC.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N CTEALLUC.TRANSACTIONDATEKEY, \N CTEALLUC.TRANSACTIONDATE \N
              FROM CTEALLUCROWSALLDATESALLCAMPUSES AS CTEALLUC \N --INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEALLUC.UCCAMPUSKEY AND CTEOP.TRANSACTIONDATEKEY = CTEALLUC.TRANSACTIONDATEKEY
            \N
            EXCEPT \N SELECT DISTINCT \N AU.UCCAMPUSKEY, \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N AU.TRANSACTIONDATEKEY, \N AU.TRANSACTIONDATE \N
              FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU
        dependencies:
          - locationName: REPORTS
            nodeName: AGGUCSPEND
          - locationName: DIM
            nodeName: DIMTRANSACTIONDATE
          - locationName: FACT
            nodeName: MAXRECEIPTDATE
          - locationName: DIM
            nodeName: UCCAMPUS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('REPORTS','AGGUCSPEND') }}
            {{ ref('DIM','DIMTRANSACTIONDATE') }}
            {{ ref('FACT','MAXRECEIPTDATE') }}
            {{ ref('DIM','UCCAMPUS') }}
        name: VWUCSPEND_MISSINGDATES
        noLinkRefs: []
  name: VWUCSPEND_MISSINGDATES
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
