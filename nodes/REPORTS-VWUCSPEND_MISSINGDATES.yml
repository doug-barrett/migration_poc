fileVersion: 1
id: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
name: VWUCSPEND_MISSINGDATES
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: REPORTS
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08d62fec-8ca1-4c8d-89eb-a90b2e2fcdb1
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CAMPUS=UCCAMPUS.UCCAMPUS
        name: UCCAMPUSKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 287f714a-162b-4330-a32e-8df3e20495b2
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 128a2d0c-05b6-47a4-9b88-a567f68bd9b1
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_1=UCCATEGORYLEVEL1.UCCATEGORY_LEVEL_1
        name: UCCATEGORYLEVEL1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fda3f283-0270-40c2-b5e9-ca57bbf756e2
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64a3f324-7636-4418-a27b-cdd631b4b3ba
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_2=UCCATEGORYLEVEL2.UCCATEGORY_LEVEL_2
        name: UCCATEGORYLEVEL2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5476b2b3-48ae-446e-9838-81fbdd05f41a
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 777aafb8-06bf-414d-950a-0b90d37f13b6
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_3=UCCATEGORYLEVEL3.UCCATEGORY_LEVEL_3
        name: UCCATEGORYLEVEL3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 176def1b-a90c-4379-bb35-415debddbdcf
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a51e4be-f077-41d5-99b0-2a6367d47319
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.CATEGORY_LEVEL_4=UCCATEGORYLEVEL4.UCCATEGORY_LEVEL_4
        name: UCCATEGORYLEVEL4KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc857369-f7c4-4ee9-8ea0-420339f7b997
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8c1f7b1-06dc-47bb-aa43-5cc884512096
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.SUPPLIER=UCSUPPLIER.UCSUPPLIERNAME
        name: UCSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4578e6f-77fa-4fdb-a40f-5c4d5bda6c9f
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f516a11f-c54e-40fb-805b-7fb8a42f8162
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_1=UCTIER1.UC_TIER_1
        name: UCTIER1KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 908d5682-8664-46fb-8e7e-5dd3c47cc31a
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1376b832-f7da-4f67-9dd3-0bf11f4c6585
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_2=UCTIER2.UC_TIER_2
        name: UCTIER2KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b1e062a6-9b3d-4464-962d-f456f529794e
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ced9594-0c54-43b3-b971-8d9eefb746e7
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.UC_TIER_3=UCTIER3.UC_TIER_3
        name: UCTIER3KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5e41a86-590c-49ed-a9b5-0b7139112b9c
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85a39df1-c8a6-4fe9-bee3-93d30877c93b
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: UCCOMPONENTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e445a65f-7807-4952-b91f-0bdfdf5f584e
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6035ebe2-16b7-468d-9d2a-d755ffe0d318
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPSUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d16cb262-4a4e-4b08-9385-2eb378b74524
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ec400fb-86ca-4c79-a407-76fc9bf8ee91
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPSUPPLIERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d1cd8d92-f4a9-453e-8d79-6f91c97bfc3a
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a8370f9-f51b-4014-a2d1-33c0f4c6cbaa
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: GENERATED ARTIFICIAL KEY
        name: OPCONTRACTKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54fad846-53f6-4b8b-a5a6-76aae7a786de
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a7ae3bd-83e7-47d5-ab96-f8ececcfc36a
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: OPCONTRACTID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9203c87-6074-4f53-807c-20a05cd7ad95
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01ba74a4-4e5b-442d-9441-937d45d45d40
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: OPCONTRACTMAPPINGSTATUSID
        name: OPCONTRACTMAPPINGSTATUSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f83e38ce-8257-427b-8af2-d550d2e3bd5b
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c3cd808-0ab5-4669-8df8-9dc978ca829f
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: UCSPEND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a7e0eb96-fb90-4072-8dd7-0b1dcd6d278a
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dda93a95-1654-47b9-a136-a322328f0b69
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: INT
        defaultValue: ""
        description: STAGEUCSPENDREPORTINGLINEITEMS_ADDKEYS.TRANSACTIONDATE=DIMTRANSACTIONDATE.TRANSACTIONDATE
        name: TRANSACTIONDATEKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8c8a895-c03c-452b-8e2b-d1c9ffa376c2
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a6a3757-9972-4191-a64b-dc7d7ebacef3
          stepCounter: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: TRANSACTIONDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6e32598-d143-4f4c-8bef-d6e12b61523e
                stepCounter: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VWUCSPEND_MISSINGDATES: f7c86ee9-ccc1-4a04-b025-d757d1ae9a1c
          DIMTRANSACTIONDATE: b43141ad-1f70-41dc-81ac-ec349cfdff08
          MAXRECEIPTDATE: 35369902-488f-4928-acce-9d310fb82782
          UCCAMPUS: 02002e76-c472-42b5-8c80-ff22fa1598d9
          AGGUCSPEND: 7219669f-db8a-4c6e-9d76-e4f80cbf096e
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('REPORTS','VWUCSPEND_MISSINGDATES') }} (\NUCCAMPUSKEY,\NUCCATEGORYLEVEL1KEY,\NUCCATEGORYLEVEL2KEY,\NUCCATEGORYLEVEL3KEY,\NUCCATEGORYLEVEL4KEY,\NUCSUPPLIERKEY,\NUCTIER1KEY,\NUCTIER2KEY,\NUCTIER3KEY,\NUCCOMPONENTKEY,\NOPSUPPLIERKEY,\NOPSUPPLIERID,\NOPCONTRACTKEY,\NOPCONTRACTID,\NOPCONTRACTMAPPINGSTATUSID,\NUCSPEND,\NTRANSACTIONDATEKEY,\N TRANSACTIONDATE\N)\NAS\N WITH CTEALLTRANSDATES \N AS (
                    SELECT \N DTD.TRANSACTIONDATEKEY, \N DTD.TRANSACTIONDATE \N
                      FROM {{ ref('DIM','DIMTRANSACTIONDATE') }} AS DTD \N
                     WHERE DTD.TRANSACTIONDATEKEY BETWEEN 20180101 AND (
                            SELECT REPLACE(MAXRECEIPTDATE,'-','')
                              FROM {{ ref('FACT','MAXRECEIPTDATE') }}
                           ) \N
                       AND DTD.TRANSACTIONDATEKEY LIKE '%01'
                   ), \N CTEALLCAMPUSES \N AS (
                    SELECT \N UCCAMPUSKEY \N
                      FROM {{ ref('DIM','UCCAMPUS') }} AS U \N
                     WHERE U.UCCAMPUSKEY > 0
                   ), \N CTEALLUCROWSMINUSTRANSDATE \N AS (
                    SELECT DISTINCT \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID \N
                      FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU \N
                     WHERE AU.OPCONTRACTMAPPINGSTATUSID IN (1, 2)
                   ), \N CTEALLUCROWSALLDATESALLCAMPUSES \N AS (
                    SELECT \N * \N
                      FROM CTEALLUCROWSMINUSTRANSDATE AS CAAUMTD, \N CTEALLCAMPUSES AS CAC, --CROSS JOIN TO GENERATE ROWS FOR ALL CAMPUSES AND FOR ALL DATES
            \N CTEALLTRANSDATES AS CATD
                   ) \N --,
            \N --CTEALLOPROWS
            \N --AS (SELECT DISTINCT
            \N --		AOARBC.UCCAMPUSKEY AS UCCAMPUSKEY,
            \N --		--AOARBC.CONTRACTKEY AS OPCONTRACTKEY,
            \N --		AOARBC.TRANSACTIONDATEKEY
            \N -- FROM   OMNIAPARTNERSDW.REPORTS.AGGOPSALESANDREVENUEBYCONTRACT AS AOARBC
            \N --		INNER JOIN CTEALLTRANSDATES AS CATD ON AOARBC.TRANSACTIONDATEKEY = CATD.TRANSACTIONDATEKEY)
            \N --CTEALLOPROWSWITHUCCOLUMNS
            \N --AS (SELECT
            \N --		CTEUC.*
            \N -- FROM   CTEALLUCROWSALLDATESALLCAMPUSES AS CTEUC
            \N --		INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEUC.UCCAMPUSKEY
            \N --												AND CTEOP.OPCONTRACTKEY = CTEUC.OPCONTRACTKEY
            \N --												AND CTEOP.TRANSACTIONDATEKEY = CTEUC.TRANSACTIONDATEKEY
            \N -- WHERE  CTEUC.UCCATEGORYLEVEL1KEY IS NOT NULL),
            \N --SELECT * FROM CTEALLOPROWS
            \N SELECT \N CTEALLUC.UCCAMPUSKEY, \N CTEALLUC.UCCATEGORYLEVEL1KEY, \N CTEALLUC.UCCATEGORYLEVEL2KEY, \N CTEALLUC.UCCATEGORYLEVEL3KEY, \N CTEALLUC.UCCATEGORYLEVEL4KEY, \N CTEALLUC.UCSUPPLIERKEY, \N CTEALLUC.UCTIER1KEY, \N CTEALLUC.UCTIER2KEY, \N CTEALLUC.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N CTEALLUC.OPSUPPLIERKEY, \N CTEALLUC.OPSUPPLIERID, \N CTEALLUC.OPCONTRACTKEY, \N CTEALLUC.OPCONTRACTID, \N CTEALLUC.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N CTEALLUC.TRANSACTIONDATEKEY, \N CTEALLUC.TRANSACTIONDATE \N
              FROM CTEALLUCROWSALLDATESALLCAMPUSES AS CTEALLUC \N --INNER JOIN CTEALLOPROWS AS CTEOP ON CTEOP.UCCAMPUSKEY = CTEALLUC.UCCAMPUSKEY AND CTEOP.TRANSACTIONDATEKEY = CTEALLUC.TRANSACTIONDATEKEY
            \N
            EXCEPT \N SELECT DISTINCT \N AU.UCCAMPUSKEY, \N AU.UCCATEGORYLEVEL1KEY, \N AU.UCCATEGORYLEVEL2KEY, \N AU.UCCATEGORYLEVEL3KEY, \N AU.UCCATEGORYLEVEL4KEY, \N AU.UCSUPPLIERKEY, \N AU.UCTIER1KEY, \N AU.UCTIER2KEY, \N AU.UCTIER3KEY, \N NULL AS UCCOMPONENTKEY, \N AU.OPSUPPLIERKEY, \N AU.OPSUPPLIERID, \N AU.OPCONTRACTKEY, \N AU.OPCONTRACTID, \N AU.OPCONTRACTMAPPINGSTATUSID, \N 0 AS UCSPEND, \N AU.TRANSACTIONDATEKEY, \N AU.TRANSACTIONDATE \N
              FROM {{ ref('REPORTS','AGGUCSPEND') }} AS AU
        dependencies:
          - locationName: REPORTS
            nodeName: AGGUCSPEND
          - locationName: DIM
            nodeName: DIMTRANSACTIONDATE
          - locationName: FACT
            nodeName: MAXRECEIPTDATE
          - locationName: DIM
            nodeName: UCCAMPUS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('REPORTS','AGGUCSPEND') }}
            {{ ref('DIM','DIMTRANSACTIONDATE') }}
            {{ ref('FACT','MAXRECEIPTDATE') }}
            {{ ref('DIM','UCCAMPUS') }}
        name: VWUCSPEND_MISSINGDATES
        noLinkRefs: []
  name: VWUCSPEND_MISSINGDATES
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
