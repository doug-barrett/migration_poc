fileVersion: 1
id: b2d9422b-7753-46e6-81b3-8342ebbea48f
name: STAGE_BI_APP_CC_ATTRIBUTE_PICKLIST
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e40063ef-f7d9-46e6-b0f8-3f11e2afb927
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: VARCHAR(14)
        defaultValue: ""
        description: ""
        name: ATTRIBUTE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf4228cc-4736-4744-93a3-a6e3e0dbe053
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ATTRIBUTE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a230578-e846-42df-a8c1-c85f4aacfd92
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: VALUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64db6ffc-070f-48b5-869c-fd967e5ee109
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: COREAREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 296fef53-ca52-42bb-b17c-59d52b0901e2
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: ""
        name: AREA_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c3dd47e8-2071-456f-a9ef-09609c4d5a8e
          stepCounter: b2d9422b-7753-46e6-81b3-8342ebbea48f
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_BI_APP_CC_ATTRIBUTE_PICKLIST: b2d9422b-7753-46e6-81b3-8342ebbea48f
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_BI_APP_CC_ATTRIBUTE_PICKLIST') }} AS SELECT DISTINCT attribute,
                   attribute_key,
                   value,
                   corearea_name,
                   area_name,
                   CAST(current_timestamp() AS timestamp_ntz) AS DSS_LOAD_DATE
              FROM (
                    SELECT DISTINCT 'BATTERY' AS attribute,
                           u.usertxt2 AS attribute_key,
                           u.usertxt2 AS value,
                           u.costcenterida AS cc_num
                      FROM ds_prodview.pvt_pvunit u
                     WHERE u.usertxt2 IS NOT NULL --

                 UNION ALL --
             SELECT DISTINCT 'MANUAL_FOREMAN' AS attribute,
                           'MANUAL_FOREMAN' AS attribute_key,
                           MANUAL_FOREMAN AS value,
                           first_value(cc_num) OVER (PARTITION BY area_name ORDER BY cc_num) AS cc_num
                      FROM {{ ref('UNKNOWN','DIM_LO_COST_CENTER_HIER') }}
                     WHERE MANUAL_FOREMAN IS NOT NULL
                   ) v
              JOIN {{ ref('UNKNOWN','DIM_LO_COST_CENTER_HIER') }} cc
                ON v.cc_num = cc.cc_num
        dependencies:
          - locationName: UNKNOWN
            nodeName: DIM_LO_COST_CENTER_HIER
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('UNKNOWN','DIM_LO_COST_CENTER_HIER') }}
        name: STAGE_BI_APP_CC_ATTRIBUTE_PICKLIST
        noLinkRefs: []
  name: STAGE_BI_APP_CC_ATTRIBUTE_PICKLIST
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
