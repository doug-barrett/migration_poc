fileVersion: 1
id: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1a319df-39c9-45be-8061-d6c69e349a9a
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDWELL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 852699d9-f732-42f8-928e-59676bbeb793
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 212c66b5-a021-469b-a2ef-56cbd54449eb
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 18a842e4-1e18-43d0-9696-68a2ca4b631a
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 758208fb-f8bf-4e26-a598-49a4e6747eb4
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 952c1192-6d55-481c-be31-afa5d23d4366
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 157de0c9-3b8f-40ea-9d1a-8fd6853e1f94
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: CODE3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fc4ab247-4ee9-4b96-95e2-476dba0459cd
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d2710f6-92ba-44bf-b649-b8b8c07b5613
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 30164ec7-da3b-42c6-86f7-375ec13850e5
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61c4a357-6dd6-4848-844d-c5ba3632abe2
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: FINALINVOICEDTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38820459-db00-4c7a-91ff-0b9419ebd1db
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3d6d9b7e-e077-4714-a77f-a9e3c1fb5c9a
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: INVOICEREFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52ada326-e3cb-4cf6-a461-ce613d486289
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5815814e-39db-4e5c-8062-d81855fc55dc
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: VENDOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94fff3c6-bab4-4dc2-aa62-97a2d429dcf4
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15ee8964-e41d-4791-9e1a-614e351a873f
          stepCounter: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: VENDORCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78d1cdc0-7918-4425-b6a7-5ce2557bc293
                stepCounter: c6015070-b7c3-498f-9d21-f0fa8c01d392
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE: 575e4667-c2f3-40f5-82a9-8a7cf3a1dec9
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE') }} AS SELECT WELLHEADER_IDWELL AS "idwell",
                   JOBAFE_IDREC AS "idrecparent",
                   GL_ACCOUNT_DESC AS "des",
                   GL_ACCOUNT AS "code3",
                   sum(CAD_AMT_FLPD) AS "amount",
                   INVOICE_DATE AS "finalinvoicedttm",
                   INVOICE_NUM AS "invoicerefno",
                   BUSINESS_ASSOCIATE_NAME AS "vendor",
                   BUSINESS_ASSOCIATE_ID AS "vendorcode"
              FROM WS_EDW.VIEW_WVIEW_WBS_INVOICE_ACTUALS VWWIA
              LEFT JOIN MAT_LOAD.LOAD_WVIEW_WVJOBAFEFINALINVOICECOST_RTN LOAD
                ON VWWIA.WELLHEADER_IDWELL = load.idwell
               AND VWWIA.GL_ACCOUNT = load.code3
               AND VWWIA.INVOICE_NUM = load.invoicerefno
               AND coalesce(BUSINESS_ASSOCIATE_ID, 'UNKNOWN') = load.vendorcode
               AND VWWIA.JOBAFE_IDREC = load.idrecparent
             WHERE VWWIA.INVOICE_NUM IS NOT NULL
               AND load.idrec IS NULL
             GROUP BY VWWIA.WELLHEADER_IDWELL,
                      VWWIA.JOBAFE_IDREC,
                      VWWIA.GL_ACCOUNT_DESC,
                      VWWIA.GL_ACCOUNT,
                      VWWIA.INVOICE_DATE,
                      VWWIA.INVOICE_NUM,
                      VWWIA.BUSINESS_ASSOCIATE_NAME,
                      VWWIA.BUSINESS_ASSOCIATE_ID
             UNION SELECT WELLHEADER_IDWELL AS "idwell",
                   JOBAFE_IDREC AS "idrecparent",
                   GL_ACCOUNT_DESC AS "des",
                   GL_ACCOUNT AS "code3",
                   sum(CAD_AMT_FLPD) AS "amount",
                   INVOICE_DATE AS "finalinvoicedttm",
                   INVOICE_NUM AS "invoicerefno",
                   BUSINESS_ASSOCIATE_NAME AS "vendor",
                   BUSINESS_ASSOCIATE_ID AS "vendorcode"
              FROM WS_EDW.VIEW_WVIEW_WBS_INVOICE_ACTUALS VWWIA
              LEFT JOIN MAT_LOAD.LOAD_WVIEW_WVJOBAFEFINALINVOICECOST_RTN LOAD
                ON VWWIA.WELLHEADER_IDWELL = load.idwell
               AND VWWIA.GL_ACCOUNT = load.code3
               AND VWWIA.JOBAFE_IDREC = load.idrecparent
               AND coalesce(load.invoicerefno, 'UNKNOWN') = 'UNKNOWN'
             WHERE INVOICE_NUM IS NULL
               AND load.idrec IS NULL
             GROUP BY VWWIA.WELLHEADER_IDWELL,
                      VWWIA.JOBAFE_IDREC,
                      VWWIA.GL_ACCOUNT_DESC,
                      VWWIA.GL_ACCOUNT,
                      VWWIA.INVOICE_DATE,
                      VWWIA.INVOICE_NUM,
                      VWWIA.BUSINESS_ASSOCIATE_NAME,
                      VWWIA.BUSINESS_ASSOCIATE_ID ;
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_WVIEW_WBS_INVOICE_ACTUALS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_WVIEW_WBS_INVOICE_ACTUALS') }}
        name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
        noLinkRefs: []
  name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
