fileVersion: 1
id: 6748e0e3-f289-41f5-8039-f0246065d990
name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2af94f92-24cd-48eb-ad26-9e70cd118b09
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDWELL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 421c784a-ab83-44e7-a1f9-8a508736edc8
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00088b97-0e00-45df-8934-00ce4d056db8
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDRECPARENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 67ebcabc-05d6-478b-8d79-86264e0f4af2
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb83d51e-c880-4d07-8252-2ba8619d1c4a
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4e6374f2-9790-4ae5-bd5b-9b14b2ec1b92
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21c0432c-aa02-4898-bd92-c0b31f38c5c7
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: CODE3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5b9e0af4-c683-417a-a27e-ded67220d7a2
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc15f591-76a8-4312-affb-0b353ffbd86f
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f02f61c8-a52e-497f-963f-92a7a0aff259
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 23bd511f-5253-4a86-8a5f-5f9257d191ab
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: FINALINVOICEDTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8035281-2f4e-4686-b7b8-4c7d73433f7c
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 450095aa-7a17-473c-8d5f-7a3bd9d09c72
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: INVOICEREFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6a364bc-2302-492c-920f-ffcadd2985d4
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2bd0a7b9-85b7-4e97-89ab-2bfe40cdc551
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: VENDOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb0f62ad-d5ef-4e5c-b25b-e34d0b5b44f0
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9d3c199b-b71d-44a0-8829-a0dfacdc41ff
          stepCounter: 6748e0e3-f289-41f5-8039-f0246065d990
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: VENDORCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2f2de50-0ed0-4c3d-9285-5314bc822e3c
                stepCounter: 146829bc-2eb5-4e37-90ab-ca666a28f86a
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE: 6748e0e3-f289-41f5-8039-f0246065d990
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE') }} AS SELECT WELLHEADER_IDWELL AS "idwell",
                   JOBAFE_IDREC AS "idrecparent",
                   GL_ACCOUNT_DESC AS "des",
                   GL_ACCOUNT AS "code3",
                   sum(CAD_AMT_FLPD) AS "amount",
                   INVOICE_DATE AS "finalinvoicedttm",
                   INVOICE_NUM AS "invoicerefno",
                   BUSINESS_ASSOCIATE_NAME AS "vendor",
                   BUSINESS_ASSOCIATE_ID AS "vendorcode"
              FROM WS_EDW.VIEW_WVIEW_WBS_INVOICE_ACTUALS VWWIA
              LEFT JOIN MAT_LOAD.LOAD_WVIEW_WVJOBAFEFINALINVOICECOST_RTN LOAD
                ON VWWIA.WELLHEADER_IDWELL = load.idwell
               AND VWWIA.GL_ACCOUNT = load.code3
               AND VWWIA.INVOICE_NUM = load.invoicerefno
               AND coalesce(BUSINESS_ASSOCIATE_ID, 'UNKNOWN') = load.vendorcode
               AND VWWIA.JOBAFE_IDREC = load.idrecparent
             WHERE VWWIA.INVOICE_NUM IS NOT NULL
               AND load.idrec IS NULL
             GROUP BY VWWIA.WELLHEADER_IDWELL,
                      VWWIA.JOBAFE_IDREC,
                      VWWIA.GL_ACCOUNT_DESC,
                      VWWIA.GL_ACCOUNT,
                      VWWIA.INVOICE_DATE,
                      VWWIA.INVOICE_NUM,
                      VWWIA.BUSINESS_ASSOCIATE_NAME,
                      VWWIA.BUSINESS_ASSOCIATE_ID
             UNION SELECT WELLHEADER_IDWELL AS "idwell",
                   JOBAFE_IDREC AS "idrecparent",
                   GL_ACCOUNT_DESC AS "des",
                   GL_ACCOUNT AS "code3",
                   sum(CAD_AMT_FLPD) AS "amount",
                   INVOICE_DATE AS "finalinvoicedttm",
                   INVOICE_NUM AS "invoicerefno",
                   BUSINESS_ASSOCIATE_NAME AS "vendor",
                   BUSINESS_ASSOCIATE_ID AS "vendorcode"
              FROM WS_EDW.VIEW_WVIEW_WBS_INVOICE_ACTUALS VWWIA
              LEFT JOIN MAT_LOAD.LOAD_WVIEW_WVJOBAFEFINALINVOICECOST_RTN LOAD
                ON VWWIA.WELLHEADER_IDWELL = load.idwell
               AND VWWIA.GL_ACCOUNT = load.code3
               AND VWWIA.JOBAFE_IDREC = load.idrecparent
               AND coalesce(load.invoicerefno, 'UNKNOWN') = 'UNKNOWN'
             WHERE INVOICE_NUM IS NULL
               AND load.idrec IS NULL
             GROUP BY VWWIA.WELLHEADER_IDWELL,
                      VWWIA.JOBAFE_IDREC,
                      VWWIA.GL_ACCOUNT_DESC,
                      VWWIA.GL_ACCOUNT,
                      VWWIA.INVOICE_DATE,
                      VWWIA.INVOICE_NUM,
                      VWWIA.BUSINESS_ASSOCIATE_NAME,
                      VWWIA.BUSINESS_ASSOCIATE_ID ;
        dependencies:
          - locationName: TARGET
            nodeName: VIEW_WVIEW_WBS_INVOICE_ACTUALS
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','VIEW_WVIEW_WBS_INVOICE_ACTUALS') }}
        name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
        noLinkRefs: []
  name: STAGE_WVIEW_WELL_INVOICE_ACTUALS_POST_DATA_CTE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
