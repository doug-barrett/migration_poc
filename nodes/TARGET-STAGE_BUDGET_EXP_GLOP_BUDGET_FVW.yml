fileVersion: 1
id: 3fc8649b-0a9f-4375-a335-a5f94e35d760
name: STAGE_BUDGET_EXP_GLOP_BUDGET_FVW
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "Budget Export Staging table for direct load into BI_REPORT.GLOP_BUDGET_FVW@BIPR"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 341fbc0a-10bb-4add-870e-015b4d2ab482
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: VERSION_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85f4c017-52a6-4fcc-b8b6-811d76c609dd
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ACCT_DATE
        name: ACCT_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: TO_CHAR(FACT_LO_BUDGET.DIM_ACCT_PER_DATE,'YYYY-MM-DD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8d3b183-282d-4f3b-bdc6-d415ece3fe4b
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ACTVY_DATE
        name: ACTVY_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: TO_CHAR(FACT_LO_BUDGET.DIM_ACTVY_PER_DATE,'YYYY-MM-DD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a98c3ab-a8f7-4ece-8aba-d62dc9a7d73c
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,NULL,DIM_LO_GL_ACCOUNT.ACCOUNT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8dedfd6-1f4a-484f-bc93-b06f748650c7
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: MAJOR_ACCOUNT
        name: MAJOR_ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,NULL,DIM_LO_GL_ACCOUNT.MAJOR_ACCT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e56985dc-c1b5-4f69-96c8-8ce9d6f827f4
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: MINOR ACCOUNT
        name: MINOR_ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,NULL,DIM_LO_GL_ACCOUNT.MINOR_ACCT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3a298e4-7540-4c56-8bd1-19a722426eb0
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: AFE_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_AFE_TYPE.DIM_AFE_TYPE_KEY,0,NULL,DIM_LO_AFE_TYPE.AFE_TYPE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e30ed25-2130-46eb-a88a-29b03994c3db
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: VARIABLE_NAME
        name: VARIABLE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: INITCAP(DECODE(DIM_LO_AFE_TYPE.DIM_AFE_TYPE_KEY,0,DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,NULL,DIM_LO_GL_ACCOUNT.ACCT_DESC), DIM_LO_AFE_TYPE.AFE_TYPE_DESC))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61670f6d-3e3d-41ff-b318-abbe7223c1c0
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: VAR_MATCH_NAME
        name: VAR_MATCH_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_AFE_TYPE.DIM_AFE_TYPE_KEY,0,DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,NULL,DIM_LO_GL_ACCOUNT.ACCT_DESC), DIM_LO_AFE_TYPE.AFE_TYPE_DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76fa8652-b714-46a9-a172-7af7962061d4
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: Indicates amounts are gross or net.
        name: GROSS_OR_NET_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_GROSS_NET.DIM_GROSS_NET_KEY,0,NULL,DIM_LO_GROSS_NET.GROSS_OR_NET_CODE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b2e8dc13-8498-4620-bd0a-c52b13ac3ea5
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: COST_CENTRE
        name: COST_CENTRE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_COST_CENTER.DIM_COST_CENTER_KEY,0,NULL,DIM_LO_COST_CENTER.CC_NUM)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8231973d-2116-4f45-aea0-71cf48a6242e
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(4)
        defaultValue: ""
        description: ""
        name: ORG_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4816b9d9-fca3-403c-86dd-627581b75d8a
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(240)
        defaultValue: ""
        description: Organization Country
        name: COUNTRY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2460b368-d6a4-4499-8877-285bc5715ec5
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(14,2)
        defaultValue: ""
        description: CAD_AMOUNT
        name: CAD_AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.CAD_AMT,0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 686272ae-478d-4ada-84ff-f59db4d1997b
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ACCT_GROUP_CODE
        name: ACCT_GROUP_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: DECODE(DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY,0,'x',DIM_LO_GL_ACCOUNT.ACCT_GROUP_CODE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 03a9e16e-3693-4382-bf2c-b14d43a18993
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(1)
        defaultValue: ""
        description: 'FACT_LEASE_OPS FLIPSIGN '
        name: FLIPSIGN
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: NVL(DECODE(NVL(DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY,0),0,DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN,DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN),1)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 247b96d2-487e-4726-83c0-a5455f54c4e5
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(14,2)
        defaultValue: ""
        description: OPERATING_AMOUNT
        name: OPERATING_AMOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.OP_AMT,0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b44109a3-b0af-4037-a231-2e537e0d1027
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: METRIC_VOLUME
        name: METRIC_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.LI_VOL_M3,0)*NVL(DECODE(NVL(DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY,0),0,DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN,DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN),1))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93273b29-b8e9-4934-8539-f293722a0b5c
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: METRIC_NORMALIZED_VOLUME
        name: METRIC_NORMALIZED_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.LI_VOL_NM3,0)*NVL(DECODE(NVL(DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY,0),0,DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN,DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN),1))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6769258e-4992-458a-b947-5d5dd3051445
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: IMPERIAL_VOLUME
        name: IMPERIAL_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.LI_VOL_IMPERIAL,0)*NVL(DECODE(NVL(DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY,0),0,DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN,DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN),1))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96fa5e45-3cce-4fc4-b8fc-1d7d6d09dd40
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: BOE_VOLUME
        name: BOE_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: SUM(NVL(FACT_LO_BUDGET.LI_VOL_BOE,0)*NVL(DECODE(NVL(DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY,0),0,DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN,DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN),1))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2310b9d3-c138-4428-ba6e-2144e999fdd3
          stepCounter: 3fc8649b-0a9f-4375-a335-a5f94e35d760
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: OPERATING_CURRENCY
        name: OPERATING_CURRENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: DIM_LO_BUDGET_VERSION
          - locationName: UNKNOWN
            nodeName: FACT_LO_BUDGET
          - locationName: UNKNOWN
            nodeName: DIM_LO_BUDGET_VERSION
          - locationName: UNKNOWN
            nodeName: DIM_LO_AFE_TYPE
          - locationName: UNKNOWN
            nodeName: DIM_LO_COST_CENTER
          - locationName: UNKNOWN
            nodeName: DIM_LO_DEST_ORGANIZATION
          - locationName: UNKNOWN
            nodeName: DIM_LO_GL_ACCOUNT
          - locationName: UNKNOWN
            nodeName: DIM_LO_GROSS_NET
          - locationName: UNKNOWN
            nodeName: DIM_LO_LEASE_OPS_HIER
        join:
          joinCondition: |-
            FROM {{ ref('UNKNOWN','FACT_LO_BUDGET') }} FACT_LO_BUDGET
              JOIN {{ ref('UNKNOWN','DIM_LO_BUDGET_VERSION') }} DIM_LO_BUDGET_VERSION
                ON FACT_LO_BUDGET.DIM_BUDGET_VERSION_KEY = DIM_LO_BUDGET_VERSION.DIM_BUDGET_VERSION_KEY
              JOIN {{ ref('UNKNOWN','DIM_LO_AFE_TYPE') }} DIM_LO_AFE_TYPE
                ON FACT_LO_BUDGET.DIM_AFE_TYPE_KEY = DIM_LO_AFE_TYPE.DIM_AFE_TYPE_KEY
              JOIN {{ ref('UNKNOWN','DIM_LO_COST_CENTER') }} DIM_LO_COST_CENTER
                ON FACT_LO_BUDGET.DIM_COST_CENTER_KEY = DIM_LO_COST_CENTER.DIM_COST_CENTER_KEY
              JOIN {{ ref('UNKNOWN','DIM_LO_DEST_ORGANIZATION') }} DIM_LO_DEST_ORGANIZATION
                ON FACT_LO_BUDGET.DIM_DEST_ORGANIZATION_KEY = DIM_LO_DEST_ORGANIZATION.DIM_DEST_ORGANIZATION_KEY
              JOIN {{ ref('UNKNOWN','DIM_LO_GL_ACCOUNT') }} DIM_LO_GL_ACCOUNT
                ON FACT_LO_BUDGET.DIM_GL_ACCOUNT_KEY = DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY
              JOIN {{ ref('UNKNOWN','DIM_LO_GROSS_NET') }} DIM_LO_GROSS_NET
                ON FACT_LO_BUDGET.DIM_GROSS_NET_KEY = DIM_LO_GROSS_NET.DIM_GROSS_NET_KEY
              LEFT JOIN {{ ref('UNKNOWN','DIM_LO_LEASE_OPS_HIER') }} DIM_LO_LEASE_OPS_HIER_GL
                ON DIM_LO_GL_ACCOUNT.LINE_NO = DIM_LO_LEASE_OPS_HIER_GL.LINE_NO
              LEFT JOIN {{ ref('UNKNOWN','DIM_LO_LEASE_OPS_HIER') }} DIM_LO_LEASE_OPS_HIER_AFE
                ON DIM_LO_AFE_TYPE.LINE_NO = DIM_LO_LEASE_OPS_HIER_AFE.LINE_NO
             WHERE FACT_LO_BUDGET.DIM_COST_CENTER_KEY <> 0
               AND (NVL(FACT_LO_BUDGET.CAD_AMT,0)+NVL(FACT_LO_BUDGET.LI_VOL,0) <> 0)
             GROUP BY DIM_LO_BUDGET_VERSION.VERSION_NAME ,
                      FACT_LO_BUDGET.DIM_ACCT_PER_DATE ,
                      FACT_LO_BUDGET.DIM_ACTVY_PER_DATE ,
                      DIM_LO_GL_ACCOUNT.ACCOUNT ,
                      DIM_LO_GL_ACCOUNT.MAJOR_ACCT ,
                      DIM_LO_GL_ACCOUNT.MINOR_ACCT ,
                      DIM_LO_AFE_TYPE.AFE_TYPE ,
                      DIM_LO_GL_ACCOUNT.ACCT_DESC ,
                      DIM_LO_AFE_TYPE.AFE_TYPE_DESC ,
                      DIM_LO_COST_CENTER.CC_NUM ,
                      DIM_LO_DEST_ORGANIZATION.ORG_ID ,
                      DIM_LO_DEST_ORGANIZATION.COUNTRY ,
                      DIM_LO_GL_ACCOUNT.ACCT_GROUP_CODE ,
                      DIM_LO_GL_ACCOUNT.DIM_GL_ACCOUNT_KEY ,
                      DIM_LO_GROSS_NET.GROSS_OR_NET_CODE ,
                      DIM_LO_GROSS_NET.DIM_GROSS_NET_KEY ,
                      DIM_LO_AFE_TYPE.DIM_AFE_TYPE_KEY ,
                      DIM_LO_COST_CENTER.DIM_COST_CENTER_KEY ,
                      DIM_LO_LEASE_OPS_HIER_AFE.DIM_LEASE_OPS_HIER_KEY ,
                      DIM_LO_LEASE_OPS_HIER_GL.FLIPSIGN ,
                      DIM_LO_LEASE_OPS_HIER_AFE.FLIPSIGN ,
                      FACT_LO_BUDGET.OP_CURR_CODE
        name: STAGE_BUDGET_EXP_GLOP_BUDGET_FVW
        noLinkRefs: []
  name: STAGE_BUDGET_EXP_GLOP_BUDGET_FVW
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
