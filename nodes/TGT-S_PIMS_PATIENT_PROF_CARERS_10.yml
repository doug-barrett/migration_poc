fileVersion: 1
id: 657b685c-07a2-47a9-baab-b110ee2c4594
name: S_PIMS_PATIENT_PROF_CARERS_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb464fb9-cb2f-46bd-8d77-c537af0e3c42
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2a5633fb-77de-4296-9c31-ce6c99b07d32
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5ce5ba0-be78-43ef-8ebe-b6370e05d5d7
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0457991-2802-4bfd-9606-d0c5a5ff3cd4
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ba6a4e25-daf8-48d5-9083-d788bd5c7803
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: HEORG_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7713534a-306b-488f-b14a-c4c33c1f6b64
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0864a192-6b2c-4b13-8ff3-11f1a278b4ce
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: START_DTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64fa1410-2820-487a-ac19-3750ce9ddecd
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e71c056f-e29d-4d71-8469-cf44e14fffd5
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DATETIME2
        defaultValue: ""
        description: ""
        name: END_DTTM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c1b8fe02-99cb-4bcd-9288-5a87a8921870
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66278ef5-1dd6-4a85-9b00-5a730acdd811
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: PROF_CARER_ROLE_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 11e65410-7119-476d-902a-61d322e28641
                stepCounter: 279946dc-1b0f-4bb6-be97-82d8bff05bb0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e68dcfe-b1c1-4a26-9fc8-89b282ac512e
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: PRTYP_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b4c1c6f-a37e-4554-9eec-485cb3dd2cbb
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: PROF_CARER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8426cf1-0459-4808-8b52-d5e67911f1d8
          stepCounter: 657b685c-07a2-47a9-baab-b110ee2c4594
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PATIENT_PROF_CARERS
        join:
          joinCondition: |-
            FROM (
                    SELECT row_number() over(PARTITION BY proca_refno,patnt_refno,Start_Dttm ORDER BY IFNULL(end_dttm,getdate()) DESC) rncnt ,
                           proca_refno,
                           patnt_refno,
                           prtyp_refno,
                           heorg_refno,
                           start_dttm,
                           end_dttm
                      FROM ds_pims_patient_prof_carers
                     WHERE prtyp_refno <> 4054
                       AND archv_flag = 'N'
                   ) ds_pims_patient_prof_carers
              JOIN [dbo].[ds_pims_reference_values]
                ON ds_pims_patient_prof_carers.PRTYP_REFNO = ds_pims_reference_values.rfval_refno
             WHERE 1 = 1
               AND ds_pims_patient_prof_carers.rncnt = 1
        name: S_PIMS_PATIENT_PROF_CARERS_10
        noLinkRefs: []
  name: S_PIMS_PATIENT_PROF_CARERS_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
