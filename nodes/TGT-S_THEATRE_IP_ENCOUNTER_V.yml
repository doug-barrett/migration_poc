fileVersion: 1
id: 7087e09b-02da-461d-8d53-d191c657fed2
name: S_THEATRE_IP_ENCOUNTER_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48e0d7a7-70d7-49bd-8604-6c08d643c52f
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: rnth
        name: RNTH
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY s_in_patient_event_05.event_encounter_id ORDER BY COALESCE (s_schedule_05.into_theatre_date,s_schedule_05.start_date,s_schedule_05.end_date))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9ef6434-3c90-4512-a64e-35796b382005
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: THEATRE_VISIT_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 73522497-b3f9-4b96-9c59-36a707f27842
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6b32db7-f07e-4897-b01e-ababc0dfaca1
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IP_EVENT_ENCOUNTER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c2f06a6c-bc2b-4943-a499-b407228ccabd
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bed568fe-6d8f-4b06-8287-0f73e9083e11
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IP_STAY_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4fc97f3a-689a-4512-9dbe-6c82df8c8a8f
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6825eee5-05d1-4f53-8dfb-e90357cba8dc
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4fc97f3a-689a-4512-9dbe-6c82df8c8a8f
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f1fd47c-3232-4d7d-98e5-d814c309e3a7
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IP_WARD_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d472e0a-9450-43d9-8936-e9c7bcb46f38
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ae3cc14-fbbc-4ef7-b6f0-705963b943f0
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IP_ADMISSION_METHOD_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe88ae47-348e-4763-a51d-6f659c2307ee
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1f54d78-f295-4f31-8102-9f802977209c
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: IP_SPECIALTY_REFERENCE_NO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5a1e57d-a116-42f9-aeab-92b2bd78279c
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb996e8a-d5d9-4f5d-aaf2-4d9c144b51bd
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IP_STAY_START_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a81084e6-9d1e-4ba7-943e-da806b2afba1
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84bfc060-7e14-4456-8eb8-6d63a4ee5a96
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: IP_STAY_END_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acf1501d-b3bf-4770-a8eb-377c17b5bb68
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7838d04-e706-43cf-87d9-109b7a05c2dc
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: THEATRE_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94f1bef3-23d3-4719-9909-9fe059faed43
                stepCounter: ab7b9f91-81b3-4d0a-bd4c-90aa5d071bb9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c53b389-b74c-4621-bb6b-1e873ed5d317
          stepCounter: 7087e09b-02da-461d-8d53-d191c657fed2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ACC_CLAIM_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9799d00-15a5-4b26-800d-2df2ea777c0b
                stepCounter: 8df670f5-1ae7-4d72-aa3e-f032f348b011
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT row_number() over(PARTITION BY s_in_patient_event_05.event_encounter_id ORDER BY ds_shared_schedule.schedule_theatre_status_code, COALESCE (ds_shared_schedule.into_theatre_date,ds_shared_schedule.start_date,ds_shared_schedule.end_date)),
                   schedule_reference_no theatre_visit_reference_no,
                   s_in_patient_event_05.event_encounter_id IP_event_encounter_id,
                   IFNULL(stay_patnt_refno,s_in_patient_event_05.patnt_refno) patient_reference_no,
                   sstay_refno IP_stay_reference_no,
                   stay_spont_refno IP_ward_reference_no,
                   s_in_patient_event_05.admet_refno IP_admission_method_reference_no,
                   IFNULL(event_spect_refno,s_in_patient_event_05.spect_refno) IP_specialty_reference_no,
                   IFNULL(stay_start_date,s_in_patient_event_05.admit_date) IP_stay_start_date,
                   IFNULL(stay_end_date,s_in_patient_event_05.disch_date) IP_stay_end_date,
                   COALESCE (ds_shared_schedule.into_theatre_date,ds_shared_schedule.start_date,ds_shared_schedule.end_date) theatre_date ,
                   in_patient_stay_05.ACC_Claim_no
              FROM ds_shared_schedule
             INNER JOIN s_in_patient_event_05
                ON ds_shared_schedule.prvsp_refno = s_in_patient_event_05.prvsp_refno
              LEFT JOIN (
                    SELECT stay_patnt_refno,
                           event_encounter_id,
                           IFNULL(stay_spont_refno,event_spont_refno) stay_spont_refno,
                           sstay_refno,
                           admet_refno,
                           prvsp_refno,
                           stay_start_date,
                           stay_end_Date,
                           event_spect_refno ,
                           ACC_Claim_no
                      FROM s_in_patient_stay_05
                   ) in_patient_stay_05
                ON s_in_patient_event_05.prvsp_refno = in_patient_stay_05.prvsp_refno
               AND COALESCE(ds_shared_schedule.into_theatre_Date,ds_shared_schedule.arrived_date,ds_shared_schedule.start_date,ds_shared_schedule.departed_date,ds_shared_schedule.end_date) BETWEEN in_patient_stay_05.stay_start_date AND IFNULL(in_patient_stay_05.stay_end_date,GETDATE())
             WHERE 1 = 1
               AND ds_shared_schedule.schedule_type_code = 'THEAT' /*AND ds_shared_schedule.schedule_theatre_status_code = 'A'*/
        dependencies: []
        join:
          joinCondition: None
        name: S_THEATRE_IP_ENCOUNTER_V
        noLinkRefs: []
  name: S_THEATRE_IP_ENCOUNTER_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
