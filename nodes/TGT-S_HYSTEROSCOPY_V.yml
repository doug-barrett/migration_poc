fileVersion: 1
id: fb7dc215-cf5b-4db3-a85b-fe0d513dc822
name: S_HYSTEROSCOPY_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8d92f3a-520e-46e5-ab23-3aa8b87ee8ef
          stepCounter: fb7dc215-cf5b-4db3-a85b-fe0d513dc822
        config: {}
        dataType: NUMERIC(10)
        defaultValue: ""
        description: ""
        name: PRVSP_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b8d92f3a-520e-46e5-ab23-3aa8b87ee8ef
                stepCounter: fb7dc215-cf5b-4db3-a85b-fe0d513dc822
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f6ec790-b4fd-4995-a3b8-6d96820acd8b
          stepCounter: fb7dc215-cf5b-4db3-a85b-fe0d513dc822
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: HYSTEROSCOPY_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5f6ec790-b4fd-4995-a3b8-6d96820acd8b
                stepCounter: fb7dc215-cf5b-4db3-a85b-fe0d513dc822
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT prvsp_refno,
                   'Y' hysteroscopy_flag
              FROM s_consolidate_coding_summary Hysto
             INNER JOIN ds_consolidate_theatre
                ON ds_consolidate_theatre.theatre_visit_encounter_id = Hysto.theatre_visit_encounter_id
             INNER JOIN ds_pims_provider_spells
                ON ds_consolidate_theatre.ip_event_encounter_id = ds_pims_provider_spells.encounter_id
             INNER JOIN dim.dim_anaes_type dat
                ON ds_consolidate_theatre.dim_anaes_type_key = dat.dim_anaes_type_key -- 04-May-2023 Outer join commented out because table not referenced
            --LEFT JOIN  ds_plato_event_details   ON ds_plato_event_details.pimsencounter =  ds_pims_provider_spells.encounter_id

             WHERE 1=1
               AND (Hysto.diagnosis_procedure_code_01 = 'GGU57' OR Hysto.diagnosis_procedure_code_02 = 'GGU57' OR Hysto.diagnosis_procedure_code_03 = 'GGU57')
               AND Hysto.diagnosis_procedure_code_04 IS NULL
               AND datediff(DAY,admit_dttm,disch_dttm) = 0
               AND admet_refno = 200600 -- only elective WN

               AND ds_consolidate_theatre.procedure_codes NOT LIKE '%AXY01%'
               AND dat.anaesthetic_type_desc not like '%general%' -- no general anaethetic
        dependencies:
          - locationName: TGT
            nodeName: S_HYSTEROSCOPY_V
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','S_HYSTEROSCOPY_V') }}
        name: S_HYSTEROSCOPY_V
        noLinkRefs: []
  name: S_HYSTEROSCOPY_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
