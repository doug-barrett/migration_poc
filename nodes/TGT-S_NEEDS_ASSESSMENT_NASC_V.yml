fileVersion: 1
id: f41782da-6bde-4dc1-b387-af0a584341ab
name: S_NEEDS_ASSESSMENT_NASC_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a149b5d-d737-46c9-b129-229c5b8c76c6
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05b14e6d-26f3-4989-b72e-e48907ba86e7
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24058c0a-638c-4246-bc0d-451016425831
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75cc0136-6a2c-4dd6-b205-b957e8316762
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: patient_programme_id
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1dc01ac2-a10c-49ca-90eb-ed32df22cd74
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6cde09f1-6c33-4e0b-9d23-6cc5da60e86d
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: patient programme status
        name: PROGRAMME_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 68ae7343-6636-410f-8f54-d96cc55f2e09
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4ab537b-ea2b-46be-bf9d-f3ba961b7c6c
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: TASK_DESC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5353c2d-4a44-4e11-bc07-37f02a977a35
                stepCounter: 447055e4-f68c-4b9d-a35b-74f5502fcef1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f25bb093-4bfc-41f7-b25c-6809e6e2acae
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: HEALTH_ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c12f6696-6dfb-413d-a9e0-108fd7fdb031
                stepCounter: 05ed0e9e-67ad-49bf-b299-f8f341d6b3c4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 612b6a04-74f4-4049-84b9-d60a6d82db50
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SEEN_BY_CLINICIAN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b8f3a79-f117-4171-adef-1c933c0a05b5
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8759433-bf02-45aa-b26c-47ad563607ce
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9668f55c-c7a5-4a58-a248-a09453e77eaa
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a3bbb39-a719-4543-9ba5-dee5d1399447
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: HOSPITAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 980489a9-a2f2-4899-b808-e20222682081
                stepCounter: 0790fdf4-e815-4587-a9cd-954ea13f53c6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b9154fb-733b-4f41-8166-108792023234
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PROVIDER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b64f71a4-6818-4fe2-8f71-79ea2097bd8d
                stepCounter: 2a628fe0-7fea-4e78-95b1-e7104461d775
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a9af181-3dbb-4dca-95b0-561644d90393
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PROVIDER_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e54c5b96-c200-4dd7-85cc-9dc969de2264
                stepCounter: 2a628fe0-7fea-4e78-95b1-e7104461d775
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25050fee-46ce-4305-b450-7d1daff4bf65
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PROGRAMME_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6832bc7f-17b1-43bb-b663-6e83c97cff56
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e51b415-8b4a-48ec-91ff-18cfe3df6836
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 54108c29-a5a9-4889-99e2-b3ff042f4b65
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5de1023-9916-4569-ad46-d203d6bd8b59
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73d58f03-2872-49bf-8ce4-1db16a7b52b1
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EPISODE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a61b1e4e-250d-4353-8a0b-699237cac645
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 363704cf-f4d7-467e-b462-0e993f7d6992
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CSC_CARD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4e028a1b-fac2-42db-9ebd-e013ed1ee4e5
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: LIVING_SITUATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f313bcf1-66e3-486c-92a0-7dc440d3f300
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WHERE_THEY_LIVE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76976e19-2b4d-4e12-8b23-fa20ef6787a9
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SPA_BAND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc64ac9a-edda-49d1-8616-775572481ea4
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1462ca76-777c-4c27-ae1e-d37fa94ecab2
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: OUTCOME_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26c3f2ec-9e45-4db6-be72-de2f085cf854
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EXIT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb0123e1-80d4-4ae3-8ae6-2c5fbce00f72
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EXIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9a4da46-7158-4157-8e8d-2e6b57a6b356
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SCID_MIGRATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1288ad67-1e5f-4101-a115-5662452a6859
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: ASSESSMENT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4cc82399-70d7-446f-b535-5c9bb00af94e
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ASSESSMENT_COMPLETED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3a99752f-42c5-461f-a295-aa67be9da974
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_NASC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c3a71e83-b765-4f34-981e-3bb950a1db9a
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_DHB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ac25e05-93ec-49ff-b3a0-f7cacdbd5efd
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c6edd55-f2ff-46a1-9f3e-dfcb41150c72
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_OUT_RESIDENTIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70873ce4-64af-4992-bad7-846b7f5fcd82
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_OUT_DHB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 946b0735-da07-435f-9fb3-29a77cf7f68f
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00375d4d-ac65-428c-a6ed-107ee136ee44
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7bf9946-625b-4b72-ab07-66e0e72b22a7
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_COMPLETION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e062b704-8bee-4ebf-9f39-44e0732669e2
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ccf1cec-d6cf-45e4-8a02-6d8eaa6385eb
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f2e33ef-8ae5-4e28-9dbc-6e3089022f15
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7eea13ea-8666-4784-90ef-69c512515bd2
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e11a0bad-b228-417a-b977-da23dcd925b4
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9aef3f8-241b-4874-bd41-18f019452bee
          stepCounter: f41782da-6bde-4dc1-b387-af0a584341ab
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 005077ef-2f46-49d9-8c15-62f319935a6e
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT 'NA'+SUBSTRING(CONVERT(varchar,10000000000+tr.taskrequest_id),2,10) contact_encounter_id,
                   tr.taskrequest_id task_request_id,
                   pt.NHI_number,
                   pp.patient_programme_id programme_id,
                   MAX(pp.patient_programme_status) programme_status,
                   LEFT(MAX(tt.display_name),30) task_desc,
                   MAX(cl.external_clinic_id) health_org_id,
                   MAX(ob.provider_nzmc) seen_by_clinician_id,
                   MAX(CASE WHEN LEFT (tr.stream_id,1) = '1' THEN 'R' + tr.stream_id ELSE tr.stream_id END) referral_encounter_id,
                   MAX(CASE WHEN og.health_org_desc LIKE '%West%' THEN '3216' ELSE '3215' END) hospital_id,
                   MAX(pr.provider_id) provider_id,
                   MAX(pr.provider_role_code) provider_role_code,
                   LEFT(MAX(rl.name),50) programme_role_code,
                   LEFT(MAX(dp.name),50) department_desc,
                   LEFT(MAX(sv.name),50) service_desc,
                   MAX(tr.request_date) task_request_date,
                   MAX(pp.episode_start_date) episode_start_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4630359855812 THEN ov.value ELSE NULL END),50) CSC_card,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4496223265208 THEN ov.value ELSE NULL END),50) living_situation,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4707697956152 THEN ov.value ELSE NULL END),50) where_they_live,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4616116400556 THEN ov.value ELSE NULL END),50) SPA_band,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4496218393176 THEN ov.value ELSE NULL END),50) assessment_location,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4454085380000 THEN ov.value ELSE NULL END),50) outcome_action,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497265089308 THEN ov.value ELSE NULL END),50) exit_reason,
                   MAX(CASE WHEN ov.datatype_id = 4692589947576 THEN CONVERT(datetime,ov.value,103) ELSE NULL END) exit_date,
                   MAX(CASE WHEN ov.datatype_id = 4655176756812 THEN CONVERT(datetime,ov.value,103) ELSE NULL END) SCID_migrated_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4709212767240 THEN ov.value ELSE NULL END),50) assessment_type,
                   MAX(CASE WHEN ov.datatype_id = 4456224477596 THEN CONVERT(datetime,ov.value,103) ELSE NULL END) assessment_completed_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4693538724392 THEN ov.value ELSE NULL END),50) transfer_NASC,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4496219752980 THEN ov.value ELSE NULL END),50) transfer_DHB,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4496220111728 THEN ov.value ELSE NULL END),50) transfer_reason,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 5028509917560 THEN ov.value ELSE NULL END),50) transfer_out_residential,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 5028510230360 THEN ov.value ELSE NULL END),50) transfer_out_DHB,
                   MAX(IFNULL(ob.due_date,tr.due_date)) observation_report_due_date,
                   MAX(ob.date_completed) observation_report_completion_date,
                   MAX(CASE WHEN ob.observation_report_status ='A' THEN 'Finalised' WHEN ob.observation_report_status ='F' THEN 'Completed' WHEN ob.observation_report_status ='S' THEN 'In Progress' WHEN ob.observation_report_status ='X' THEN 'Declined' ELSE 'Current' END) observation_report_status,
                   MAX(ob.created_date) create_date,
                   REPLACE(MAX(ob.created_by),' null','') create_user_login_name
              FROM ds_cdsswe_task_request tr
             INNER JOIN l_cdsswe_Task_Type tt
                ON tr.tasktype_id = tt.tasktype_id
               AND tt.name IN ('Needs Assessment')
             INNER JOIN ds_cdsswe_patient_programme pp
                ON tr.patient_programme_id = pp.patient_programme_id
             INNER JOIN l_cdsswe_programme rl
                ON rl.programme_id = pp.programme_id --AND rl.programme_id = 4452666405396  --'Needs Assessors in NASC'

             INNER JOIN l_cdsswe_patient pt
                ON pp.patient_id = pt.patient_id
             INNER JOIN ds_cdsswe_observation_report ob
                ON tr.taskrequest_id = ob.taskrequest_id
               AND ob.record_status = 'A'
               AND ob.observation_report_status IN ('A','F','S')
              LEFT OUTER JOIN ds_cdsswe_atomic_observation ov
                ON ov.observation_report_id = ob.observation_report_id
              LEFT OUTER JOIN l_cdsswe_Patient_Programme_Provider pr
                ON pr.patient_programme_id = pp.patient_programme_id
               AND pr.record_status = 'A'
               AND pr.sequence_num = '1'
              LEFT OUTER JOIN l_cdsswe_clinic cl
                ON pr.clinic_id = cl.clinic_id
               AND cl.record_status = 'A'
               AND cl.clinic_type = 'CASETEAM'
              LEFT OUTER JOIN dim.dim_health_organisation og
                ON cl.external_clinic_id = og.health_org_reference_no
              LEFT OUTER JOIN l_cdsswe_programme dp
                ON dp.programme_id = rl.parent_programme_id
              LEFT OUTER JOIN l_cdsswe_programme sv
                ON sv.programme_id = dp.parent_programme_id
             GROUP BY tr.taskrequest_id,
                      pt.NHI_number,
                      pp.patient_programme_id
        dependencies:
          - locationName: TGT
            nodeName: DS_CDSSWE_TASK_REQUEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_CDSSWE_TASK_REQUEST') }}
        name: S_NEEDS_ASSESSMENT_NASC_V
        noLinkRefs: []
  name: S_NEEDS_ASSESSMENT_NASC_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
