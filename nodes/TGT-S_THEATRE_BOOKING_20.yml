fileVersion: 1
id: 19758f14-edc2-4471-8c3a-c682eddd8e07
name: S_THEATRE_BOOKING_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Add in details of the IP event related to each theatre booking."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6bb9c00b-8245-4d9d-9408-7dd94f17c29a
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1eda1e16-cacd-47f2-863f-25a78267b9eb
                stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a761c1a5-8e51-4098-85f4-8f9f1ca3fc5f
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PATIENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: afbdf457-abfa-430c-9936-9cec06d42993
                stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 652b26fd-3d9d-4ae9-bbb6-5bd035e4252e
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: BOOKING_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c95f2e2b-4320-4f26-a06c-fa9b8ddf3aa4
                stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab5cb152-d239-499d-8799-8ab232ce628f
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: BOOKING_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e34a6c5f-fac3-4dd0-bbab-8a22c6116a8f
                stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed3bb850-5db0-42b8-98d1-faa96ec2f114
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: BOOKING_SENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 57fea6b7-f878-4df3-92ad-957557db3a63
                stepCounter: 9d3cd9c4-6e6d-45a3-a066-4105d90bbaca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f02ccb48-dcc7-4989-a1e2-aa9320f6f93c
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IP_EVENT_ENCOUNTER_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98c9bdfa-1455-4c81-8336-1fc71694c387
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 387ee6c5-564a-4e89-bc42-769ec6be6b00
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: ADMIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a0d5a12-1979-4f2c-8064-624c175d8d47
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 103008a6-6941-4edc-a1f8-4e4f6134fa98
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DISCH_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00803c1f-550d-4585-a405-68dc2cd2130c
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 148e479d-792a-47eb-b99b-2c142a7b5bd9
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADMET_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1c9edf2-e55b-46f3-9464-4cbe977b3f01
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00bcd667-5dc3-48fa-a147-d6987fe6a072
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: ADMISSION_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cfd358e5-689e-4542-a972-0aba002b02cf
                stepCounter: 469bfd7a-0084-4352-8ef5-69fd15a77ed4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 870cad0b-859d-40e6-8941-32671e86fc97
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: BIT
        defaultValue: ""
        description: Set to 1 if the related IP event admission method is aAcute (ACC, ACUACC) or Acute Arranged (AA, AAACC)
        name: ACUTE_ARRANGED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4d8604d-145f-40fb-b595-c1aa8d4d5a06
                stepCounter: 469bfd7a-0084-4352-8ef5-69fd15a77ed4
            transform: |-
              CASE WHEN dim_admission_method.admission_type_code IN ('AA','AC') THEN 1
                          ELSE 0
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c38f52e1-e124-4097-8e9a-ce084c9d4bb3
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ROW_NUMBER() OVER(PARTITION BY s_theatre_booking_10.booking_id ORDER BY s_in_patient_event_05.admit_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3d53aa9-d588-44cf-be08-2eaf766e5682
          stepCounter: 19758f14-edc2-4471-8c3a-c682eddd8e07
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_THEATRE_BOOKING_10
        join:
          joinCondition: |-
            FROM s_theatre_booking_10
              JOIN s_in_patient_event_05
                ON s_theatre_booking_10.patient_reference_no = s_in_patient_event_05.patnt_refno
               AND s_theatre_booking_10.booking_sent_date > DATEADD(HH, -4, s_in_patient_event_05.admit_date)
               AND s_theatre_booking_10.booking_sent_date < IFNULL(s_in_patient_event_05.disch_date, GETDATE())
              LEFT OUTER JOIN dim.dim_admission_method
                ON dim_admission_method.admission_method_reference_no = s_in_patient_event_05.admet_refno
        name: S_THEATRE_BOOKING_20
        noLinkRefs: []
  name: S_THEATRE_BOOKING_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
