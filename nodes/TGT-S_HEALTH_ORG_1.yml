fileVersion: 1
id: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
name: S_HEALTH_ORG_1
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 692b90c3-f943-4091-ae70-4600f461e705
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Health_Org_Reference_Number
        name: HEALTH_ORG_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dfda9ddd-af08-478a-be33-9507da5d9582
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: baeb9213-ae7c-4ec0-a6b1-0c9c41eeabd3
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Health_Org_Code
        name: HEALTH_ORG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4ef5551-f136-424e-8175-4eda8e012f1e
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0bc9153e-1192-4655-b0e5-2a924c3dbf26
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Health_Org_Description
        name: HEALTH_ORG_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94cef180-84bd-4860-90c1-5c9f2654d5f0
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f38c65c-36f2-4c4e-b239-68d8b5d9526f
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Health_Org_Parent_Reference_Number
        name: HEALTH_ORG_PARENT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ab37c1a-f88b-48ef-ae88-1c1d716e903b
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: IFNULL(ds_pims_health_organisations.parnt_refno,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 080aa193-dcc9-44f1-bcc6-263c4f45fb52
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Health_Org_Type_Reference_Number
        name: HEALTH_ORG_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 07a44630-f416-4357-a479-6e4f93af1803
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be5d3f09-8b63-40e3-b164-337582428489
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Health_Org_Type_Code
        name: HEALTH_ORG_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fbb01e3b-4612-47c8-9a4a-5d6abddc60ef
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d83c4219-e62d-4b84-97b0-fc3e8b48355c
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Health_Org_Type_Description
        name: HEALTH_ORG_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36382c40-3b88-46a3-bc3c-d4c158538d5b
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Health_Org_Validity_Start_Date
        name: HEALTH_ORG_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 524cc26f-3278-4c5a-ab79-4234a1b52d7a
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ffef5b8-2b25-437a-a6c0-cf614d2f2db1
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Health_Org_Validity_End_Date
        name: HEALTH_ORG_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d556bcc-bed7-4ddd-ae79-d6b6d900f718
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d52e4f0d-cad8-4aa0-8878-76c657b86836
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: hospital_id (e.g 3215, 3216)
        name: HOSPITAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2228cf5e-1f6d-441f-930c-6a3e08c2877c
                stepCounter: 6b472a91-9805-4385-bd70-10bb0499745c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a431383-fbfe-42a8-9509-6fb26d3edc03
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: HPI_FACILITY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1677580b-f30d-45c4-a19e-8cc84627d504
                stepCounter: 4cb1ea3b-9be6-4245-a251-a1a15a980ddc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 972e439c-943d-4eaa-9bb6-34a6a8161032
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: HPI_FACILITY_ID_CHECK_DIGIT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 970ce39f-3deb-452d-a6fd-409576c00f52
                stepCounter: 4cb1ea3b-9be6-4245-a251-a1a15a980ddc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e149c5a3-b0a9-4656-9d33-ee7bd4ed3d6c
          stepCounter: a2da52e2-dc68-42f9-8257-2c0aa63e2e49
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_REFERENCE_MOH_FACILITY: 4cb1ea3b-9be6-4245-a251-a1a15a980ddc
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_HEALTH_ORGANISATIONS
          - locationName: TGT
            nodeName: L_REFERENCE_MOH_FACILITY
        join:
          joinCondition: |-
            FROM ds_pims_health_organisations
              LEFT OUTER JOIN ds_pims_reference_values
                ON ds_pims_health_organisations.hotyp_refno = ds_pims_reference_values.rfval_refno
              LEFT OUTER JOIN (
                    SELECT h2.heorg_refno,
                           h2.identifier
                      FROM ds_pims_health_organisation_ids h2
                     INNER JOIN ds_pims_reference_values r2
                        ON h2.hityp_refno = r2.rfval_refno
                       AND r2.main_code = 'NZNHI'
                   ) ds_pims_health_organisation_ids
                ON ds_pims_health_organisations.heorg_refno = ds_pims_health_organisation_ids.heorg_refno --OR ds_pims_health_organisations.parnt_refno = ds_pims_health_organisation_ids.heorg_refno  LEFT OUTER JOIN {{ ref('TGT','L_REFERENCE_MOH_FACILITY') }}  ON ds_pims_health_organisation_ids.identifier = l_reference_MOH_Facility.healthfacilitycode  AND l_reference_MOH_Facility.currentversion = 0
        name: S_HEALTH_ORG_1
        noLinkRefs: []
  name: S_HEALTH_ORG_1
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
