fileVersion: 1
id: bea07b23-406c-4212-ab5a-421435aef0dc
name: S_PIMS_LDDI_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d0c8bb6-fc83-4650-8a16-7a8ffaaa3610
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: USSCR_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f425ea80-eec6-47dc-88c6-e4da6c71a95d
                stepCounter: 4cb1aabb-3db5-4093-8698-3c7d4b015e5e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6ef5203-e138-494c-914d-5e74e3422c7e
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SCREENNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5a7412be-1122-4e9f-9e90-aea59aa9cbcf
                stepCounter: 4cb1aabb-3db5-4093-8698-3c7d4b015e5e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 608e1501-7af6-4fde-a204-7d65d5009331
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: LCLDS_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba843687-6ab5-44fb-8e11-e6e6daa8c313
                stepCounter: f45ce8ff-3533-4c7d-9e81-3df114715d7e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 006c0e43-712b-4cdf-95fb-3fc3e2760263
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DATASETNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8755b49-bc86-4ebd-84b9-1ca1bddae350
                stepCounter: f45ce8ff-3533-4c7d-9e81-3df114715d7e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a51c51d-9e99-45bf-8c9d-fb94d2e0952f
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: DATASETCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3f94cd8-ebab-4f49-9fba-f7f6a10243e4
                stepCounter: f45ce8ff-3533-4c7d-9e81-3df114715d7e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 62c7b224-f5c2-4733-a691-37e092137edb
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: MAPPED_COLUMN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7eebb2e-f4dc-402f-85a7-ef8065204e17
                stepCounter: 839fe17e-aeb2-478f-9d4c-30dbdc6d99b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc4384d3-0ad6-4171-8a52-26a05b9976b0
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: ""
        name: SORT_ORDER
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: Row_number() over(PARTITION BY l_pims_user_screens.USSCR_REFNO ORDER BY l_pims_local_dataset_items.LCLDI_REFNO)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8cf3069-25a5-4cec-a3d1-648b7a520a10
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ITEMNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f9aca2f-1f58-432f-942c-fd4c70ae57d2
                stepCounter: 210fad3f-e037-4396-b287-37fae51d3d44
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 529241b6-0960-49d5-aeac-efbbd3c54e52
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: ITEMCODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ee3e13b-b344-42cb-8c93-482f9a790578
                stepCounter: 210fad3f-e037-4396-b287-37fae51d3d44
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 209a3b11-bc12-42d0-bc88-4b52937182f7
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: ""
        name: COLUMNTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 551f483d-a948-4558-87f8-d3e65fffac3c
                stepCounter: 06fa4241-360c-43d0-8e4a-8b860f92fc09
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8fb18cd5-88d8-4bf5-b789-c3589efd2cbe
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: RFVDM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83ba880d-57ec-42fc-bd8a-cfe77972cd0b
                stepCounter: 210fad3f-e037-4396-b287-37fae51d3d44
            transform: |-
              CASE WHEN charindex(':',DT_INFO) <> 0 THEN substring(DT_INFO,1,charindex(':',DT_INFO)-1)
                          ELSE NULL
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5f06c60-83fa-4298-90fc-e68f21ffc309
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: VARCHAR(11)
        defaultValue: ""
        description: EventType
        name: EVENTTYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ldd.eventtype,'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4538acc-c995-4f00-a4c3-506e1093b89a
          stepCounter: bea07b23-406c-4212-ab5a-421435aef0dc
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_PIMS_USER_SCREENS: 4cb1aabb-3db5-4093-8698-3c7d4b015e5e
          L_PIMS_LOCAL_DATASETS: f45ce8ff-3533-4c7d-9e81-3df114715d7e
          L_PIMS_LOCAL_DATASET_ITEMS: 839fe17e-aeb2-478f-9d4c-30dbdc6d99b4
          L_PIMS_LOCAL_DATAITEMS: 210fad3f-e037-4396-b287-37fae51d3d44
          DS_PIMS_REFERENCE_VALUES: 06fa4241-360c-43d0-8e4a-8b860f92fc09
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_PIMS_USER_SCREENS
          - locationName: TGT
            nodeName: L_PIMS_LOCAL_DATASETS
          - locationName: TGT
            nodeName: L_PIMS_LOCAL_DATASET_ITEMS
          - locationName: TGT
            nodeName: L_PIMS_LOCAL_DATAITEMS
          - locationName: TGT
            nodeName: DS_PIMS_REFERENCE_VALUES
        join:
          joinCondition: |-
            FROM {{ ref('TGT','L_PIMS_USER_SCREENS') }}
              JOIN {{ ref('TGT','L_PIMS_LOCAL_DATASETS') }}
                ON l_pims_user_screens.LCLDS_REFNO = l_pims_local_datasets.LCLDS_REFNO
              JOIN {{ ref('TGT','L_PIMS_LOCAL_DATASET_ITEMS') }}
                ON l_pims_local_datasets.LCLDS_REFNO = l_pims_local_dataset_items.LCLDS_REFNO
              JOIN {{ ref('TGT','L_PIMS_LOCAL_DATAITEMS') }}
                ON l_pims_local_dataset_items.LCLDI_REFNO = l_pims_local_dataitems.LCLDI_REFNO
              JOIN {{ ref('TGT','DS_PIMS_REFERENCE_VALUES') }}
                ON l_pims_local_dataitems.LCLDT_REFNO = ds_pims_reference_values.rfval_refno
              LEFT JOIN (
                    SELECT DISTINCT usscr_refno ,
                           CASE WHEN sorce_code = 'REFRL'            THEN 'refrl_refno'
                                WHEN sorce_code = 'WLIST'            THEN 'wlist_refno'
                                WHEN sorce_Code = 'AEATT'            THEN 'aeatt_refno'
                                WHEN sorce_Code = 'SCHDL'            THEN 'schdl_refno'
                                WHEN sorce_code IN('PATNT','PATRG') THEN 'patnt_refno'
                                ELSE sorce_Code
                                 END Eventtype
                      FROM dbo.ds_pims_ldd_local_datavalues b
                     WHERE 1 = 1
                       AND archv_flag = 'N'
                   ) ldd
                ON l_pims_user_screens.USSCR_REFNO = ldd.usscr_refno
             WHERE 1 = 1
               AND [l_pims_user_screens].Archv_Flag = 'N'
               AND [l_pims_local_datasets].Archv_Flag = 'N'
               AND [l_pims_local_dataset_items].Archv_Flag = 'N'
               AND [l_pims_local_dataitems].Archv_Flag = 'N'
        name: S_PIMS_LDDI_10
        noLinkRefs: []
  name: S_PIMS_LDDI_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
