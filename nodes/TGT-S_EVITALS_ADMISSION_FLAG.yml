fileVersion: 1
id: fcc59e57-4f82-4e02-b0ac-ea661778dc63
name: S_EVITALS_ADMISSION_FLAG
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Dimension key look up."
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af23d0b0-2603-40ff-bd33-323f9e3cb19e
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADMISSION_FLAG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 39536ea1-552f-404a-8e1e-e2b24710f652
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6452eea8-ac77-4a9a-9fdd-43dcd6d3849a
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADMISSION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ff35560-ab8b-449a-afc8-0d1c35c28b18
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7089298-5d11-4258-a442-7a5a3934d990
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient NHI number.
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 339a840f-5e2a-4733-a07e-5285472de6e9
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9cc70b70-3d4b-4a65-81d2-49c449325c54
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FLAG_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6278e4b6-c3f6-486e-befd-fd5de295d0fe
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c4af30b-a722-4542-bea8-917517abd630
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FLAG_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ff3ed8a-1282-4f3e-9974-861065e10053
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6033bab-5e36-4a6b-9af0-b23665920480
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: ""
        name: FLAG_SEQ_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ff35560-ab8b-449a-afc8-0d1c35c28b18
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ROW_NUMBER() OVER(PARTITION BY admission_id ORDER BY flag_start_date)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a03dea8-9dc9-4683-a4ec-6bf16baba2e0
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: ""
        name: FLAG_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ff35560-ab8b-449a-afc8-0d1c35c28b18
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: COUNT(1) OVER(PARTITION BY admission_id)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 979904c6-77d5-4fdc-bd31-229057feed01
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: FLAG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d803749-39a8-49c4-ba46-56b834decf8e
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14200e44-8d68-4758-8ab6-4c257f4b3cb9
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FLAG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd1791ec-1ede-4348-8122-078326105873
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9d6e4882-ee00-4a3d-9681-7821433c948a
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: VARCHAR(200)
        defaultValue: ""
        description: Part of the admission note prior to the first pipe character.
        name: FIRST_ADMISSION_NOTE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3bb0d27-f4cd-47c8-bdf8-568616748ed5
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 34d4bcfc-7798-40fe-8b95-da354ed2eefd
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: VARCHAR(200)
        defaultValue: ""
        description: Part of the admission note after the last pipe character. Will be null if no pipes found.
        name: LAST_ADMISSION_NOTE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a7459177-d7e8-4297-a7e7-fab2f0a10e7d
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7250b70c-afce-47fb-ae19-cee212e352e2
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INT
        defaultValue: ""
        description: Integer ID that uniquely identifies an observation set in Patientrack. Sourced from obset_pk.
        name: OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 88da7a8c-a58e-4f0f-861a-17545213b9e3
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8db927d-9c92-4981-8fa9-baa1daa6c8ad
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INT
        defaultValue: ""
        description: Integer ID that uniquely identifies an observation set in Patientrack. Sourced from obset_pk.
        name: CURRENT_OBSERVATION_SET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6d4db691-1d35-4b55-ba75-33a8604cd707
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d7b1a17-0d51-4e55-a2db-4d59db296da0
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Look up to Patient Management System to match Inpatient or ED event associated with the observation set for the patient as PatienTrack version becomes unreliable under certain conditions
        name: MATCHED_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6995e13-aa8c-47c2-b2c3-3e6f1f8190e6
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9cdb6f0-dc14-462d-af6b-d7a3140711aa
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FLAG_CREATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e7f2440-ffd7-4df3-8f56-283e551841e3
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 83f4a5bd-bfdb-412b-a527-a46c3b93b670
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: FLAG_MODFIED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 541292e4-ec87-4435-aec2-501ca6429a73
                stepCounter: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e0307d6-fb4d-46a0-acbd-38b9945cea81
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_EVITALS_ADMISSION_NOTE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9471ce5b-e7c8-41bd-92ca-4c6b7e998503
                stepCounter: 7eab49a2-2a0f-43d9-9989-c479f1292577
            transform: IFNULL(dim_eVitals_admission_note.dim_eVitals_admission_note_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a9ad05d-15c4-4298-8b38-7422a1c40b3b
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_eVitals_admission_flag.flag_id=dim_eVitals_reference_values.reference_value_id
        name: DIM_EVITALS_REFERENCE_VALUES_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ba95cebe-a8ec-42d2-8b94-cae92b901536
                stepCounter: 71e6b90e-13e6-4b69-863c-4872fce8d69b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2573dac3-3e65-41e3-ae3e-a24c8b7e4dca
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0dd0976e-c442-464f-9be6-ce9d4d5c17be
          stepCounter: fcc59e57-4f82-4e02-b0ac-ea661778dc63
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_EVITALS_ADMISSION_FLAG_30: 432d1ae0-8bf7-472d-b6d2-54366c14d4ea
          DIM_EVITALS_ADMISSION_NOTE: 7eab49a2-2a0f-43d9-9989-c479f1292577
          DIM_PATIENT: d52dd438-7899-4242-9e38-539d2a1447df
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_EVITALS_ADMISSION_FLAG_30
          - locationName: TGT
            nodeName: DIM_EVITALS_ADMISSION_NOTE
          - locationName: TGT
            nodeName: DIM_PATIENT
        join:
          joinCondition: |-
            FROM {{ ref('TGT','S_EVITALS_ADMISSION_FLAG_30') }}
              LEFT OUTER JOIN {{ ref('TGT','DIM_EVITALS_ADMISSION_NOTE') }}
                ON s_eVitals_admission_flag_30.first_admission_note = dim_eVitals_admission_note.first_admission_note
               AND s_eVitals_admission_flag_30.last_admission_note = dim_eVitals_admission_note.last_admission_note
              LEFT OUTER JOIN {{ ref('TGT','DIM_PATIENT') }}
                ON s_eVitals_admission_flag_30.patient_nhi = dim_patient.patient_NHI
               AND dim_patient.NHI_sequence = 1
        name: S_EVITALS_ADMISSION_FLAG
        noLinkRefs: []
  name: S_EVITALS_ADMISSION_FLAG
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
