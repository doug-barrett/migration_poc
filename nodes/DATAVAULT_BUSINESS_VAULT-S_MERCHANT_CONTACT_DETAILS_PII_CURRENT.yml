fileVersion: 1
id: bf91003b-739e-40f0-8cd7-4b7f971ec758
name: S_MERCHANT_CONTACT_DETAILS_PII_CURRENT
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: "This entity holds the contact details for a given institution. The entity is effective dated so the contact details can be different for different time periods."
  isMultisource: false
  locationName: DATAVAULT_BUSINESS_VAULT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97d736ac-469a-4fca-9455-8e5aa8337416
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: ""
        name: HK_H_MERCHANT_CONTACT_DETAILS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a71d0d4-7df6-442e-936e-c8824612c009
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6d63cbd-c1b4-47b4-b75d-0a7e5c88b9e5
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: contact identificaton number
        isBusinessKey: true
        name: CONTACT_IDENTIFICATION_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebae3d65-e331-4d90-901b-b2c29ac8efac
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48d63133-9aa1-4ddf-8187-a65e88fb0eea
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        isBusinessKey: true
        name: SEQUENCE_NUMBER_BK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c545cbfe-0705-4ddf-88a3-d4e46d331409
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db3ed733-e674-45ca-95dc-44afa5d8323c
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the forenames of the Contact for the Institution.
        name: CONTACT_NAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e24676b-7c67-4b81-98bf-83e82666f59f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab01382e-1c6e-45d6-a5ec-564d9e14512e
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the surname of the Contact for the Institution.
        name: CONTACT_SURNAME_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a53dca6a-b653-41f4-a7d4-4e9a2c0d835d
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67cd2278-06ad-4199-8c77-1462100d69e6
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 70b77f60-bea3-4998-be03-7b2e31e08100
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5d711dee-24ab-48a4-9349-ac1be2f1080e
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5e450e7-5cbf-4bd5-ae3f-6080114e1e29
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67933916-94e7-4f1a-aaf4-4984a81a840a
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the postal address by which the institution contact can be contacted.
        name: ADDRESS_LINE_3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 689bf4f2-2d64-42e4-b342-452f95a198f1
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5cffc2a7-620d-4f01-8c08-be4e2a0759b1
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: Identifies the postal code of the Institution.
        name: ADDRESS_POSTAL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d0e6546-3c41-441a-8c87-96d8480d44bc
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b04c61a0-a0e7-4096-9e62-0aa4a2bf89f0
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the city in which the Institution is in.
        name: ADDRESS_CITY_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 616ab3dc-344e-4994-b944-7173d3416696
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a89ec629-1a40-4e6d-b983-e3192b75e4b7
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Identifies the state in which the Institution is in.
        name: ADDRESS_STATE_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f722cf5-b0ea-403c-af30-f19b6ebf37b2
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2fd46f2-8b81-4ff4-879d-adeb5d8a7b81
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: Identifies the country in which the Institution is in.
        name: ADDRESS_COUNTRY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 716d1ad3-7646-4c86-b367-eed074a5f067
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a49b2d2-0f59-4242-9bf7-b216796d6b1a
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Email address by which the Institution can be contacted.
        name: CONTACT_EMAIL_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d4e084f-d882-4885-94aa-df80952d5ad9
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b28e9695-4366-4c03-b871-37d39cea2dc2
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: Identifies the Internet address by which the Institution can be contacted.
        name: CONTACT_INTERNET_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 292c88e8-7630-47e3-a2f2-5efaeb871b1e
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f51edaa7-da4f-45d0-991c-bf557de6e175
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the first phone number by which an Institution can be contacted.
        name: PRINCIPAL_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 96b922c8-8756-4f94-a95e-36b8590ce277
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 198b04f1-045c-4fa5-9b5f-a24366d795d7
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies an alternative phone number by which the Institution can be contacted.
        name: ALTERNATIVE_CONTACT_PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd849366-3424-49ca-b32e-6dc3ee353a60
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b62123e-314d-4fc3-98ef-a58138a52017
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Identifies the fax number by which the institution can be contacted.
        name: CONTACT_FAX_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29f1c1b4-f581-4350-a307-9ceb11fde476
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2787fa5c-9a68-4a1c-9f56-bdf6eb2432ae
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_AREA_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50c5685a-ee90-4769-be73-dbea3f4601e3
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e98e50a-b327-4c29-a7a5-d17a55418683
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(8)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_USER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78f9ea8c-40a0-43ef-9ec1-a48123e419af
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc3fd265-46d7-44ba-8c9e-8c0929fe41cd
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: ""
        name: LAST_UPDATE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48d371e4-fb60-4d70-9fb8-499a62627f7f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: edfc5f21-0167-4538-8bcb-a98a87d8784d
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: The Area code for this address
        name: ADDRESS_STATE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3838c08d-630f-4d0b-956e-255365cc038f
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 355bd8fb-9d2a-41d6-9f7b-89a8b5a76af5
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Holds the Tax ID or Social Security Number for the contact.
        name: CONTACT_SOCIAL_INSURANCE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1266c521-dc38-4ac9-b75c-d6d72fde8e94
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: be1d714f-5bfd-4cb8-ba93-cb40d44af6db
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: TIMESTAMP(9)
        defaultValue: ""
        description: ""
        name: DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 27c28dde-3b2a-42d5-b5be-6247e231ff58
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49a117f9-c895-4f93-979f-1ec6f7a0dced
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: DECIMAL(38,0)
        defaultValue: ""
        description: The sequence number is part of the physical key together with Institution ID, Institution Contact Number. The currently effective instance is identified by the sequence number zero.
        name: SEQUENCE_NUMBER_PII
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: aacc58e9-9689-4979-a730-60b886c060b6
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98b7881d-7dcd-4f35-9e0f-52eb4bdc8a04
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: BINARY(16)
        defaultValue: ""
        description: The changing hash
        name: DSS_CHANGE_HASH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c672be7-48ef-4611-8dca-e2ee94c1dc37
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16ff9e24-9b1f-4c07-ae19-15940ecac318
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: be65e074-83ee-4f48-8951-f11963f90085
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb461586-e597-4dd0-bb76-c3687029795e
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was loaded in the data vault
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d69ffba8-b7dc-4b31-9e61-d235bb32824d
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8366784f-d535-4938-bdaa-672f685a234d
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row started in the data vault
        isSystemStartDate: true
        name: DSS_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0cd71af4-9668-4bff-91f4-f4a1f05663e0
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49a7cbbe-d452-4997-a509-7300617dd2fa
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: NUMBER(38)
        defaultValue: ""
        description: Version number of a business key in the data vault
        isSurrogateKey: true
        isSystemVersion: true
        name: DSS_VERSION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8ff41bee-2a09-4ec9-8b7c-dda2c41f95ce
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 20e1b6b0-8884-4423-b648-5e1480cab3b6
          stepCounter: bf91003b-739e-40f0-8cd7-4b7f971ec758
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was inserted in the data vault
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d90747b-1cf4-4f54-ac99-f14e74c9e854
                stepCounter: d511a896-8d61-4b3f-9891-303506eda9cf
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          S_MERCHANT_CONTACT_DETAILS_PII: d511a896-8d61-4b3f-9891-303506eda9cf
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATAVAULT_RAW_VAULT
            nodeName: S_MERCHANT_CONTACT_DETAILS_PII
        join:
          joinCondition: |-
            FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_CONTACT_DETAILS_PII') }} s_merchant_contact_details_pii
             INNER JOIN (
                    SELECT hk_h_merchant_contact_details,
                           MAX(dss_start_date) AS dss_start_date
                      FROM {{ ref('DATAVAULT_RAW_VAULT','S_MERCHANT_CONTACT_DETAILS_PII') }}
                     GROUP BY hk_h_merchant_contact_details
                   ) curr
                ON curr.hk_h_merchant_contact_details = s_merchant_contact_details_pii.hk_h_merchant_contact_details
               AND curr.dss_start_date = s_merchant_contact_details_pii.dss_start_date
        name: S_MERCHANT_CONTACT_DETAILS_PII_CURRENT
        noLinkRefs: []
  name: S_MERCHANT_CONTACT_DETAILS_PII_CURRENT
  overrideSQL: false
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
