fileVersion: 1
id: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
name: S_OPTO_CLINIC_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4bf00e89-6f06-4de6-8b98-20af693f85b9
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINIC_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4dd09cc7-57f7-454c-b549-36349130a7d8
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 550939e9-8a73-4d2d-a266-48b51134f55a
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINIC_PLAN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 06cb2009-bf2d-4a5a-be1b-0fd1515f57da
                stepCounter: a3c03cbf-0bbc-4d93-9ddb-a56fa512d9c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06b86816-0ced-4c9c-a3d7-0280875fdce6
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(25)
        defaultValue: ""
        description: ""
        name: CLINIC_PLAN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb18c4f5-3cf0-456a-847f-9a4211dc84c4
                stepCounter: a3c03cbf-0bbc-4d93-9ddb-a56fa512d9c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0fdeacf5-12bd-4215-b110-f1b898d852d8
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(250)
        defaultValue: ""
        description: ""
        name: CLINIC_PLAN_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2dd5d2d8-6820-4fb9-ba1d-ac4493ef615b
                stepCounter: a3c03cbf-0bbc-4d93-9ddb-a56fa512d9c3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fccd4b23-8701-4c97-83c8-59e219222001
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINICAL_LOCATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 917f3ef1-15b6-4392-8a5c-f542b1301ea9
                stepCounter: d139446d-0543-44a5-aab6-a6bfec82032b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1835cfe0-43d9-4a80-a26c-5d8ed29533e1
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: CLINICAL_LOCATION_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e136c1fd-8651-44dd-9e98-ccbfc145926f
                stepCounter: d139446d-0543-44a5-aab6-a6bfec82032b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe2fb032-026c-4d2a-b057-d5762402971c
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: EMAIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b518c23d-116d-4b3d-87cb-b85c65f8ff9e
                stepCounter: d139446d-0543-44a5-aab6-a6bfec82032b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81b45647-d5ee-46ef-96bd-6b638db750e1
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ADDRESSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7417c35f-438a-49af-a581-ae8086aa4577
                stepCounter: d139446d-0543-44a5-aab6-a6bfec82032b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66a578e1-57b6-45da-8124-89382abf736f
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: ADDRESSLINE1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cab3f3d8-dd8a-40aa-9e82-674b283343ce
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4aa24057-8c0d-4e41-b41a-17999f25b678
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: ADDRESSLINE2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0cc0131-09d8-4b5e-b278-94e8242aad4a
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bddfc8b1-1570-4075-8921-86db37614d50
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 917f3ef1-15b6-4392-8a5c-f542b1301ea9
                stepCounter: d139446d-0543-44a5-aab6-a6bfec82032b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4849b69a-c758-42f8-a42b-812d9297ee08
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PARENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59a56974-392b-4192-b129-4101fdbc9692
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: PARENT_ORGANISATION_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fbfb4eb9-343f-4384-b638-cb46c60c6c7f
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(35)
        defaultValue: ""
        description: ""
        name: TOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 29832a03-7eda-42d7-9794-8f53b346979c
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 277cdf92-9213-4236-b3f0-69f259216cce
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(35)
        defaultValue: ""
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5a0d2eb-c1b8-4248-9ace-74d48ff1e82a
                stepCounter: 12b262ef-f328-4dae-9484-556736065537
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c8e628a9-a8b7-4cc3-bf3c-be037acd6952
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 05b52a53-a33d-437e-92aa-3a595cf498b4
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a3b2562-68e6-46ea-935c-a2d3fae6054e
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: CHAR(36)
        defaultValue: ""
        description: ""
        name: UNIQUEID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ae441a18-b529-4223-bd09-56c1a92d160f
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 736d20a5-de6b-4ea4-b0b8-41e482957d79
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: 'VARCHAR(1) '
        defaultValue: ""
        description: Those organisations that are funded by the Waitemata Funding Arm and counted in the M20007 purchase unit
        name: WAITEMATA_DHB_FUNDED_FLAG
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4dd09cc7-57f7-454c-b549-36349130a7d8
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: |-
              CASE WHEN parentid IN ('9044','9046','9300','9302','9323','9331','9198','9341','9344','9346','9301','9303','9332','9216','9342','9345','9347','9045') THEN 'Y'
                          ELSE'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e1b9275a-1756-482a-8c6b-719914a9f162
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: NVARCHAR(50)
        defaultValue: ""
        description: ""
        name: CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 36860dbe-a085-4a6b-baa4-785233c25b6b
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fe01f89-397e-4248-8765-699bb2fa6467
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95d80a83-2afc-4f85-9884-82f88ee5f388
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6fcd6e9-74c5-4b92-b8ce-da729d99f381
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20dacf2d-8232-45e9-8766-f4f91c39254a
                stepCounter: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d55bcb18-0d8e-4fca-8d45-50afd060af17
          stepCounter: 18cf370d-2f30-4752-b73e-5e6b0ef70b18
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_OPTO_CLINIC: 19c0d3b4-93c3-4010-9c3f-73cf7dfa1e52
          L_OPTO_CLINIC_PLAN: a3c03cbf-0bbc-4d93-9ddb-a56fa512d9c3
          L_OPTO_CLINICALLOCATION: d139446d-0543-44a5-aab6-a6bfec82032b
          L_OPTO_ADDRESS: 12b262ef-f328-4dae-9484-556736065537
          L_OPTO_CLINICALLOCATION_CLINICALLOCATION: df0b254e-5bce-495a-9e94-90fe511732a9
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_OPTO_CLINIC
          - locationName: TGT
            nodeName: L_OPTO_CLINIC_PLAN
          - locationName: TGT
            nodeName: L_OPTO_CLINICALLOCATION
          - locationName: TGT
            nodeName: L_OPTO_ADDRESS
          - locationName: TGT
            nodeName: L_OPTO_CLINICALLOCATION_CLINICALLOCATION
        join:
          joinCondition: |-
            FROM {{ ref('TGT','L_OPTO_CLINIC') }} l_opto_clinic
              JOIN {{ ref('TGT','L_OPTO_CLINIC_PLAN') }} l_opto_clinic_plan
                ON l_opto_clinic.clinicplanid = l_opto_clinic_plan.id
              JOIN {{ ref('TGT','L_OPTO_CLINICALLOCATION') }} l_opto_clinicallocation
                ON l_opto_clinic_plan.clinicallocationid = l_opto_clinicallocation.id
               AND l_opto_clinicallocation.validto > getdate()
              JOIN {{ ref('TGT','L_OPTO_ADDRESS') }} l_opto_address
                ON l_opto_clinicallocation.addressid = l_opto_address.id
               AND l_opto_address.validto > getdate()
              LEFT JOIN {{ ref('TGT','L_OPTO_CLINICALLOCATION_CLINICALLOCATION') }} opto_parent_bridge
                ON l_opto_clinicallocation.id = opto_parent_bridge.childid
               AND opto_parent_bridge.validto > getdate()
              LEFT JOIN {{ ref('TGT','L_OPTO_CLINICALLOCATION') }} opto_parent_organisation
                ON opto_parent_organisation.ID = opto_parent_bridge.parentid
        name: S_OPTO_CLINIC_10
        noLinkRefs: []
  name: S_OPTO_CLINIC_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
