fileVersion: 1
id: 32621a78-1219-4994-9668-071ca5be80d1
name: VIEW_PVIEW_OFM_MONTHLY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5dc88589-db00-4e60-9f9a-cfafaf10baba
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85d6f749-a3a9-40f6-8bc0-862e4297d5ee
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f80a688c-43e6-412a-b651-de517aa7bd89
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f76be576-f021-42f1-a5bc-c6dfa35d25fb
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d35b48e9-71bb-476d-a79c-e53919492f84
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295d169a-8764-40e9-9347-7e6746bb1d69
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca50f598-5004-4c84-94a4-30feec4d467b
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8b96ba6-fa62-4c0f-b013-fdbeffce9ce2
                stepCounter: 81e6b0b1-1728-45bf-932d-6356544cf13a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c42521cc-3897-4207-b840-c94ad6d7141e
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54f45ce5-97fb-4903-b912-cd7f56f5e45d
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19b4f977-4bd7-4bff-acc3-087bedeb14a1
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c68e8dd3-3a7d-42b0-875a-5d7a041a2d83
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ba9d465-43b4-471f-a2f8-5ed26a2bfb85
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d2074750-19de-4f74-8818-8d81f35001aa
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82795a44-41a8-4dd7-976e-e6c643c46a2f
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 368ff2b0-ce2d-47dc-89f2-3d0078fd2ef2
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5d3db40-c5e2-4861-a96c-c548eee014cd
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e25e36ae-5169-4693-ae59-397c12371253
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24b73453-8149-4ccb-8809-bf17832825df
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fb707390-1a91-4e9c-b183-9443a5b8015b
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b07aaf69-6175-45c3-9e38-37af9a296a98
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 75825876-26fe-4d1e-a0f2-150ccc500e54
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b51c979-2d32-462e-9919-1b53bdc93e78
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bdc9ff99-2ae1-4699-8927-8326c247f718
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39403bc1-e14d-448f-a6a5-707b30c21e9d
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c050bca-b399-4cdf-be8e-a94b81ffca8b
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f3854fa-4200-46bc-9f81-481a10c4da33
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5e29de8-88de-4480-b7f2-1f03e5297ca1
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a1cb21fe-a6f4-4240-802a-f899fd8a86fb
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 13be86aa-3343-4ab1-828b-4e30da168800
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f36c615-20b5-4329-bb0a-d65a73600bdf
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ba4cd4a-8e15-49d5-9a44-90cbc942ca7b
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe9afce0-6cfb-42ac-ae67-3362fe7fadb9
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e11ca12e-5231-47ac-8c05-884bdae039f9
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d7fc1d8-0f1c-432c-bf2d-6249db8a365d
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e28adde3-4615-45a7-87e8-355a0fa941c8
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9db5bb4c-43ae-444f-bda9-77b5346aaaf1
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f773e625-ac2c-4d01-a83e-b817525780a2
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4af9c966-51fe-4f41-aea8-5e40a2f4d63d
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d505693-3a1d-484b-abe5-5345ff33443a
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae634a18-b191-43c7-95b4-39d6c3b352b4
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f9141e9-8642-40e3-a747-46e0f31f50ba
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4c3a821-88b8-4b8e-a974-e1acd9781b8d
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d75d250-d818-4696-8c86-fb64328fd03b
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 613d8296-58a9-49b6-aac6-184923ce75b2
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 07573552-38e7-4d95-9360-21864a4d2739
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d58a0d20-5618-4239-bbf8-3f90b3867e48
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 75825876-26fe-4d1e-a0f2-150ccc500e54
                stepCounter: acfa00f8-2a04-428b-95fe-92ae401c3e38
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 29861cda-4cef-4e7d-8533-9fdf90cd5ba3
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2461b3f-8900-4460-9da7-dc1b4d0593bc
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb4835d6-a4ab-4e1e-af3b-1348bba5619a
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 225158ef-323f-4052-a5f5-8eec320d50ed
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d744af12-8104-4998-9e1c-5980c3f93059
          stepCounter: 32621a78-1219-4994-9668-071ca5be80d1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6224e306-c453-4e0c-b1bf-b5af6bdcf306
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_MONTHLY: 32621a78-1219-4994-9668-071ca5be80d1
          ODS_PVIEW_PVT_PVFLOWNETHEADER: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
          ODS_PVIEW_PVT_PVUNITALLOCMONTH: acfa00f8-2a04-428b-95fe-92ae401c3e38
          ODS_PVIEW_PVT_PVUNITCOMP: 81e6b0b1-1728-45bf-932d-6356544cf13a
          ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY: 5a4c5ce9-0301-4bda-8283-5d58a3ca2351
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_MONTHLY') }} (IDFLOWNET, IDREC, UWI, NAME, PERIOD, HOURS_DOWN, HOURS_ON, PROD_OIL, PROD_GAS, PROD_WATER, ALLOC_OIL, ALLOC_GAS, ALLOC_WATER, LOST_OIL, LOST_GAS, LOST_WATER, INJ_GAS, INJ_OIL, INJ_WATER, SALES_GAS, FUEL_GAS, FLARE_GAS, VENT_GAS, TONS_OIL, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   C.IDREC ,
                   C.WELLIDREGULATORY AS UWI ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   P.VOLPRODGATHHCLIQ AS PROD_OIL ,
                   P.VOLPRODGATHGAS AS PROD_GAS ,
                   P.VOLPRODGATHWATER AS PROD_WATER ,
                   P.VOLNEWPRODALLOCHCLIQ AS ALLOC_OIL ,
                   P.VOLNEWPRODALLOCGAS AS ALLOC_GAS ,
                   P.VOLNEWPRODALLOCWATER AS ALLOC_WATER ,
                   P.VOLLOSTHCLIQ AS LOST_OIL ,
                   P.VOLLOSTGAS AS LOST_GAS ,
                   P.VOLLOSTWATER AS LOST_WATER ,
                   P.VOLINJECTRECOVGAS AS INJ_GAS ,
                   P.VOLINJECTRECOVHCLIQ AS INJ_OIL ,
                   P.VOLINJECTRECOVWATER AS INJ_WATER ,
                   P.VOLDISPSALEGAS AS SALES_GAS ,
                   P.VOLDISPFUELGAS AS FUEL_GAS ,
                   P.VOLDISPFLAREGAS AS FLARE_GAS ,
                   P.VOLDISPVENTGAS AS VENT_GAS ,
                   ROUND(P.VOLNEWPRODALLOCHCLIQ * D.DENSITYHCLIQ / 1000,2) TONS_OIL ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW', '') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) P
                ON F.IDFLOWNET = P.IDFLOWNET
               AND P.DTTMSTART < DATEADD(DAY, 1, LAST_DAY(DATEADD(MONTH, -1, CURRENT_DATE)))
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) C
                ON P.IDRECCOMP = C.IDREC
              LEFT JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) D
                ON C.IDRECPARENT = D.IDRECPARENT
               AND D.DTTM = (
                    SELECT MAX(DTTM)
                      FROM (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           )
                     WHERE IDRECPARENT = C.IDRECPARENT
                       AND DTTM <= P.DTTMEND
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
        name: VIEW_PVIEW_OFM_MONTHLY
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_MONTHLY
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
