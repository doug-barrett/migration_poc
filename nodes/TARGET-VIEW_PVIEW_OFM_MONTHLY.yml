fileVersion: 1
id: b76b0190-2911-4a45-8bcd-e0b031f4b3de
name: VIEW_PVIEW_OFM_MONTHLY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dbdb40f3-1545-442e-b70f-ece11fd4c447
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDFLOWNET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f00e8fc-6c61-4ba7-8bae-f81179d23da4
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 090e8138-d450-4742-b1f7-a1617443b7c5
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: VARCHAR(32)
        defaultValue: ""
        description: ""
        name: IDREC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9cf6aa8f-2e96-43a3-8472-6ee102299445
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 757add17-3711-4bb4-a67c-5d6dba4925a2
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7014a46b-a09f-4d32-ae9a-66b516c1d8d6
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a202736-60be-4736-845b-f73c0acef4a8
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47f8a18b-1555-41b2-9a09-2de136944f7f
                stepCounter: b2609f15-a93c-4c5d-b86e-0898ad7558d0
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74e888ba-0a5d-44ef-83cf-4e5cca37a11c
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c67e8513-144b-4749-9eba-8643711e5c64
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4c3bfac-3322-470f-9ab4-a2b718af9224
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c9f4ba22-dfbc-43dc-a443-213326ffa15a
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8fac4aa-e5f1-45f0-a51a-907a3040577c
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a392e2cf-c86e-4c61-baa9-c3d127bfac71
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eae378dc-7d18-4cea-b7c7-bc882c7b1012
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1c6584b0-6fc2-4a42-8099-20f049cc7fa8
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 983d2963-3f0f-4ea7-9572-ea7c1540811a
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50eb211d-0dfa-4502-be95-7075647dd850
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f594a8a7-6adf-4492-83fb-ea5e930f660e
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd78f4f2-082c-4c45-9533-cee9b79a3c68
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 53b38ce1-61c3-4e3d-ba18-1a5c9ce42d74
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9059c589-5724-46f3-b8fa-b033e93bc313
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35a0988a-7aca-4241-b2a3-b99b618f1775
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4412f92a-ebe1-4607-8c9e-8439b94fd0a0
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24347454-7abd-47fa-8a32-62a9febd6df0
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dad01c04-ad7b-4039-84c1-65f69cff93af
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0b34d526-6680-44bb-a0a9-38ed4d6bc840
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3518b8f9-a3c3-402c-bb1d-90dce5165404
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c79e2728-16bc-4f13-b649-5ec7557b5bd5
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9998b6fb-108e-470c-beb7-755dbe30b8be
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8801b132-6579-486e-a66f-ba6138c094e9
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: abe0883f-1957-4215-aab0-562fa2be1c43
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78fdd8a6-72d7-4ca9-9b5c-3520720e5892
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a74afe10-5126-46b1-9606-655c970809fa
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 941f6f86-f0d5-48a5-9940-f2bd57f045f0
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2798dc0d-215c-41c9-9fc5-f46d99236898
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 52b8fb6a-0407-4a53-a6e6-38fb058de639
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ce4661d-04e8-4074-9d4e-4d8589d884e3
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f318133-afce-425b-a2cd-770468b7b319
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ff4ba575-6874-4917-a296-f9b27f69a631
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9ab32de4-6a04-4df9-90fe-574beaa94ec7
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 984c9c2e-a62b-4d3c-9b8a-a45546f1726e
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd80543e-26bf-4e98-a61e-7472199c87b8
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 637e252b-d60f-494b-afcd-5067d6a23c6a
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 408448d8-6b3c-432a-a3e9-399c330456d0
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 80ba09d9-32a8-471f-8d51-cebf3071faaa
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c33e75f-ff1a-4984-b2e1-9866eb053a0d
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9059c589-5724-46f3-b8fa-b033e93bc313
                stepCounter: 2b7597c9-141d-4225-b959-04fb950e44fb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec661f44-1fd0-4223-9852-75ef8bd3aed5
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1efb3740-3aba-488c-9462-195e2533752f
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was created in the data warehouse.
        isSystemCreateDate: true
        name: DSS_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f9f4997-d0a7-425e-97e1-0e015385db8f
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 53d90baa-5a90-43e8-9fa9-af476f0a30a7
          stepCounter: b76b0190-2911-4a45-8bcd-e0b031f4b3de
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09e0bb5b-5e26-42fa-a0a4-c293c6f802d3
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_OFM_MONTHLY: b76b0190-2911-4a45-8bcd-e0b031f4b3de
          ODS_PVIEW_PVT_PVFLOWNETHEADER: bd388a52-3d72-4c70-833d-7de7c6a8abd1
          ODS_PVIEW_PVT_PVUNITALLOCMONTH: 2b7597c9-141d-4225-b959-04fb950e44fb
          ODS_PVIEW_PVT_PVUNITCOMP: b2609f15-a93c-4c5d-b86e-0898ad7558d0
          ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY: 4f2511c5-ac6c-46f1-86c8-eebf5d9b4e75
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_OFM_MONTHLY') }} (IDFLOWNET, IDREC, UWI, NAME, PERIOD, HOURS_DOWN, HOURS_ON, PROD_OIL, PROD_GAS, PROD_WATER, ALLOC_OIL, ALLOC_GAS, ALLOC_WATER, LOST_OIL, LOST_GAS, LOST_WATER, INJ_GAS, INJ_OIL, INJ_WATER, SALES_GAS, FUEL_GAS, FLARE_GAS, VENT_GAS, TONS_OIL, BU_SF_ROLE, DSS_CREATE_TIME, DSS_UPDATE_TIME) AS SELECT F.IDFLOWNET ,
                   C.IDREC ,
                   C.WELLIDREGULATORY AS UWI ,
                   C.COMPLETIONNAME AS NAME ,
                   P.DTTMSTART AS PERIOD ,
                   P.DURDOWN * 24 AS HOURS_DOWN ,
                   P.DUROP * 24 AS HOURS_ON ,
                   P.VOLPRODGATHHCLIQ AS PROD_OIL ,
                   P.VOLPRODGATHGAS AS PROD_GAS ,
                   P.VOLPRODGATHWATER AS PROD_WATER ,
                   P.VOLNEWPRODALLOCHCLIQ AS ALLOC_OIL ,
                   P.VOLNEWPRODALLOCGAS AS ALLOC_GAS ,
                   P.VOLNEWPRODALLOCWATER AS ALLOC_WATER ,
                   P.VOLLOSTHCLIQ AS LOST_OIL ,
                   P.VOLLOSTGAS AS LOST_GAS ,
                   P.VOLLOSTWATER AS LOST_WATER ,
                   P.VOLINJECTRECOVGAS AS INJ_GAS ,
                   P.VOLINJECTRECOVHCLIQ AS INJ_OIL ,
                   P.VOLINJECTRECOVWATER AS INJ_WATER ,
                   P.VOLDISPSALEGAS AS SALES_GAS ,
                   P.VOLDISPFUELGAS AS FUEL_GAS ,
                   P.VOLDISPFLAREGAS AS FLARE_GAS ,
                   P.VOLDISPVENTGAS AS VENT_GAS ,
                   ROUND(P.VOLNEWPRODALLOCHCLIQ * D.DENSITYHCLIQ / 1000,2) TONS_OIL ,
                   'BI_BU_'|| DECODE (UPPER(F.SYSSECURITYTYP) ,'FRANCE','FBU' ,'CANADA','CBU' ,'NETHERLANDS','NBU' ,'GERMANY','GBU' ,'IRELAND','IBU' ,'AUSTRALIA','ABU' ,'UNITED_STATES','USBU' ,'CENTRAL AND EASTERN EUROPE','CEEBU' ,'USBU','USBU' ,'SOUTHERN PLAINS', 'CBU' ,'SOUTHERN FOOTHILLS', 'CBU' ,'SOUTHEAST SASKATCHEWAN', 'CBU' ,'NORTHERN', 'CBU') || DECODE(CURRENT_DATABASE() ,'EDW_TST', '_TEST' ,'EDW_DEV', '_DEV' ,'EDW', '') AS BU_SF_ROLE ,
                   F.DSS_CREATE_TIME ,
                   F.DSS_UPDATE_TIME
              FROM (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) F
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) P
                ON F.IDFLOWNET = P.IDFLOWNET
               AND P.DTTMSTART < DATEADD(DAY, 1, LAST_DAY(DATEADD(MONTH, -1, CURRENT_DATE)))
             INNER JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) C
                ON P.IDRECCOMP = C.IDREC
              LEFT JOIN (
                    SELECT *
                      FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
                     WHERE DSS_CURRENT_FLAG = 'Y'
                       AND DSS_DELETE_FLAG != 'Y'
                   ) D
                ON C.IDRECPARENT = D.IDRECPARENT
               AND D.DTTM = (
                    SELECT MAX(DTTM)
                      FROM (
                            SELECT *
                              FROM {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
                             WHERE DSS_CURRENT_FLAG = 'Y'
                               AND DSS_DELETE_FLAG != 'Y'
                           )
                     WHERE IDRECPARENT = C.IDRECPARENT
                       AND DTTM <= P.DTTMEND
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVFLOWNETHEADER
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITALLOCMONTH
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVFLOWNETHEADER') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITALLOCMONTH') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITLIQUIDDENSITY') }}
        name: VIEW_PVIEW_OFM_MONTHLY
        noLinkRefs: []
  name: VIEW_PVIEW_OFM_MONTHLY
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
