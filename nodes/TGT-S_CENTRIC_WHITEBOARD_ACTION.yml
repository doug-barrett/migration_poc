fileVersion: 1
id: 19f0f96c-e43a-4042-85cb-705a024aed20
name: S_CENTRIC_WHITEBOARD_ACTION
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fe59842f-97f9-45e9-9b99-69a14d99f6b5
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: whiteboard unique id from l_centric_patient_clinician
        isBusinessKey: true
        name: WHITEBOARD_ACTION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9fe1daa9-9d45-412c-afc2-9ccdb84eb882
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: 260000000+ds_centric_Patient_Clinician.id
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8b7fc48-c893-4cda-8f8a-55a8a95a9661
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM encounter number
        name: ATTENDANCE_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 689fcdbf-c459-4faf-95ae-35ac1e3d1548
                stepCounter: 3780b6ae-de68-49c7-aff3-0a34c07e229f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c68619f6-0f73-417e-a9eb-ca2a33405ac3
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: 'stay_reference_no '
        name: STAY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b35850f1-588a-4a0a-afb8-add22820d99c
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33fb88e0-a616-4125-93a7-2a65db26df2c
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_specialty_code=dim_ED_WB_action_specialty.ED_WB_action_specialty_code
        name: DIM_ED_WB_ACTION_SPECIALTY_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 79aee918-ff6f-4b0a-a656-000827899f3e
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: IFNULL(dim_specialty.dim_specialty_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9f9527a-e143-4787-8a3a-1eb0fe994c6c
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM specialty under which the action was performed
        name: WB_ACTION_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acf7c8b3-5813-4be7-a8ca-91b0073451b4
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c864a1c5-ca5f-42ae-88d1-04a0a720344b
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: 'iPM specialty group EMMED or other as they are managed independently '
        name: SPECIALTY_CODE_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acf7c8b3-5813-4be7-a8ca-91b0073451b4
                stepCounter: 4182a75e-d07b-4637-97fa-4c01e2878360
            transform: |-
              CASE WHEN dim_specialty.specialty_code ='EMMED' THEN 'EMMED'
                          ELSE 'OTHER'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b42e868-a087-473b-8621-19fab6e8e8e5
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_performed=dim_ED_WB_action.WB_action_performed
        name: DIM_ED_WB_ACTION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a3fdd58-1c7e-499c-8aec-dc1826f5fb93
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: IFNULL(dim_ED_WB_action.dim_ED_WB_action_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98124df3-5931-4489-afb9-725c789cba56
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WB_ACTION_PERFORMED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1bf21d18-9872-4a32-b3b4-d66653a8331a
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6105212d-a630-4693-ae46-71b3532043a8
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: datetime at which the action was performed
        name: WB_ACTION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ede0d04-0bf6-483b-bd60-2976ca28c3a2
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 64c9b1e1-d80a-43a0-97f4-2ce92a2fb87d
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_seenby_doctor=dim_ED_WB_action_seenby_clinician.WB_action_seenby_clinician_user_code
        name: DIM_ED_WB_ACTION_SEENBY_CLINICIAN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e74f203f-76e7-45a2-9d8e-653c8675d1f9
                stepCounter: 66e32778-075f-4c08-af0d-cb1de97de284
            transform: IFNULL(dim_ED_WB_action_seenby_clinician.dim_ED_WB_action_seenby_clinician_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0671b755-c3df-4a5f-9d26-ccec15cb92c4
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_seenby_doctor=dim_centric_first_seenby_clinician.WB_action_seenby_clinician_user_code
        name: DIM_CENTRIC_SEENBY_CLINICIAN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 49d06b24-a461-451c-9665-8dd59b4821ed
                stepCounter: 150d67fe-6f3e-4546-9cd2-7fdb5d005ff0
            transform: IFNULL(dim_centric_seenby_clinician.dim_centric_seenby_clinician_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2d5b67cf-a235-4e58-acf7-b4bce41e1712
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.WB_action_assigned_consultant=dim_WB_action_assigned_consultant.WB_action_assigned_consultant_type_code
        name: DIM_WB_ACTION_ASSIGNED_CONSULTANT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(dim_WB_action_assigned_consultant.dim_WB_action_assigned_consultant_key, 0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44b8c057-3357-4e78-b51f-535c0730bd10
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: WB_ACTION_SEENBY_DOCTOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3e1be18-263f-4596-b2c1-6c6c805d437e
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b724885-52d1-4055-a39d-be0c3210c1d3
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: iPM assigned consultant at time of action
        name: WB_ACTION_ASSIGNED_CONSULTANT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf7cb395-d12e-4f04-acd3-784289e6c1d1
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d1d2ef98-e95e-4942-99dc-26a2563d9ed8
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: datetime the record was crated
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ce9a5e6-1c7a-43f5-a4d2-36afdf9f5b43
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e43d3d53-5bf8-4486-93e2-8dea12ca4a32
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9962a01b-5f3d-4c1a-b371-997edef38d0f
                stepCounter: d52dd438-7899-4242-9e38-539d2a1447df
            transform: IFNULL(dim_patient.dim_patient_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd786a64-1453-48ce-a960-4de28034d785
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce08e6ee-6507-4273-91b6-68d491666b56
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5519c59-00bd-4297-a92b-d51e4a3fbe49
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d3e1be18-263f-4596-b2c1-6c6c805d437e
                stepCounter: 60ab9d33-92b5-415b-8c36-69df6265898d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b71f9f1c-89ba-4af7-a12e-b5f399030060
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_ed_whiteboard_action.service_point_code=dim_ED_location.ED_location_reference_no
        name: DIM_ED_LOCATION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bab06ecd-8e25-475a-8a41-940ce0a7b207
                stepCounter: 795c21ea-1da9-4519-8c1b-1e9f6f1a9458
            transform: IFNULL(dim_ED_location.dim_ED_location_key,0)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5580149-a349-4ff3-b537-d95afb52e25d
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence tof action within encounter
        name: ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2394b16-ad90-4e7d-aabb-77c1fa485ade
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SERVICE_POINT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d7d76436-b475-413f-ae45-6728c9e008ca
                stepCounter: 795c21ea-1da9-4519-8c1b-1e9f6f1a9458
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 53bfdc5f-c0cc-4912-8fd6-18a98233f17a
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence of seen by action within encounter
        name: SEEN_BY_ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d59775bb-3016-47c4-aef0-053a47edade9
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence withing an encounter grouping removal actions with thier corresponding actions
        name: REMOVAL_ACTION_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09b4ede5-69e3-4484-a8a0-cfc5494c479d
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: 'Sequence or seen bys within an specialty grouping '
        name: SPECIALTY_GROUP_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7918f8df-b30a-431f-97bd-cbbfdc16defb
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: 'Reverse Sequence for seen bys within an specialty grouping '
        name: SPECIALTY_GROUP_SEQUENCE_REV
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aba0570c-32b9-440f-a990-6d469a36b582
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Grouping removal actions with thier corresponding actions
        name: REMOVAL_GROUPING
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e24339a-f251-4a59-9677-03ac72f09843
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Was the action performed to remove a previous action? 1 = yes
        name: REMOVE_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecef48d8-bac8-45a8-bf9f-e0ffbe8fe477
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2cbc5971-79ac-427e-a182-6976b296a150
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Is the action deleted by a removal action
        name: REMOVED_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1617bc02-aecc-4ec3-8f99-863310a7e76a
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Was the action performed a seenby action? 1 = yes
        name: SEEN_BY_ACTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0007808c-7ef7-490d-985c-0f427fa67dc9
                stepCounter: 0900c632-b973-4ce8-84b8-0de6a9f4f2b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b89ccf01-3dc5-4850-a599-339450ea1620
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Action type sequence within an event
        name: EVENT_ACTION_TYPE_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_Centric_patient_clinician.id ORDER BY seendttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7769e130-98fc-4379-9a96-6dfd0c714512
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: INT
        defaultValue: ""
        description: Sequence to handle non unique concerto user ids
        name: AUDIT_SEQUENCE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: row_number() over(PARTITION BY ds_centric_patient_clinician.encounter ORDER BY seendttm)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e9a5403-d0b8-4580-ac3a-176042673c74
          stepCounter: 19f0f96c-e43a-4042-85cb-705a024aed20
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_CENTRIC_PATIENT_CLINICIAN
          - locationName: UNKNOWN
            nodeName: DIM_WB_ACTION_ASSIGNED_CONSULTANT
        join:
          joinCondition: |-
            FROM s_centric_encounter_changes
              JOIN dbo.[ds_Centric_patient_clinician]
                ON s_centric_encounter_changes.encounter = ds_Centric_patient_clinician.encounter
              JOIN ds_pims_ae_stays aesty
                ON ds_Centric_patient_clinician.aesty_refno = aesty.aesty_refno
              JOIN ds_pims_ae_attendances
                ON ds_Centric_patient_clinician.encounter = ds_pims_ae_attendances.identifier
              LEFT JOIN dim.[dim_patient]
                ON ds_centric_patient_clinician.nhi = dim_patient.patient_NHI
               AND dim_patient.NHI_sequence = 1
              LEFT JOIN dim.[dim_ED_WB_action_seenby_clinician]
                ON dim_ED_WB_action_seenby_clinician.WB_action_seenby_clinician_user_code = ds_Centric_patient_clinician.clinicianuserid
               AND ds_Centric_patient_clinician.seenDTTM BETWEEN dim_ED_WB_action_seenby_clinician.validity_start_date AND dim_ED_WB_action_seenby_clinician.validity_end_date
              LEFT JOIN dim.[dim_centric_seenby_clinician]
                ON dim_centric_seenby_clinician.user_name = ds_Centric_patient_clinician.clinicianuserid
               AND ds_Centric_patient_clinician.seenDTTM BETWEEN dim_centric_seenby_clinician.validity_start_date AND dim_centric_seenby_clinician.validity_end_date --left outer join (select  distinct status,case when status=4 then 'Discharge'   -- when status=1 then 'Doctor Seen By'   -- when status=2 then 'Specialty Transfer'   -- when status=6 then 'Nurse Seen By'   -- when status=3 then 'Admit Patient'   -- when status=5 then 'Update Location' end   -- WB_action_performed ,encounter, statusDTTM  from ds_centric_Patient_Status   -- --where encounter = 'A1412498105'   -- ) ds_centric_Patient_Status   -- on ds_centric_Patient_Status.encounter=ds_Centric_patient_clinician.encounter   -- and ds_centric_Patient_Status.statusDTTM= ds_centric_Patient_Clinician.seenDTTM            LEFT JOIN dim.[dim_ED_WB_action]        ON dim_ED_WB_action.WB_action_performed = case when ds_Centric_patient_clinician.nurseseenby=1 then 'Nurse seen by' else 'Doctor Seen By' end     left join dim.dim_ED_location on dim_ED_location.ED_location_reference_no = aesty.spont_refno and dim_ED_location.dss_current_flag = 'Y'      left join dim.dim_specialty on dim_specialty.specialty_reference_no = aesty.spect_refno and dim_specialty.dss_current_flag = 'Y'        LEFT OUTER JOIN {{ ref('UNKNOWN','DIM_WB_ACTION_ASSIGNED_CONSULTANT') }}         ON ds_centric_Patient_Clinician.ipmConsultantCode = dim_WB_action_assigned_consultant.WB_action_assigned_consultant_code       AND dim_WB_action_assigned_consultant.dss_current_flag = @v_dss_current_flag    Where ds_centric_Patient_Clinician.deletedBy is null
        name: S_CENTRIC_WHITEBOARD_ACTION
        noLinkRefs: []
  name: S_CENTRIC_WHITEBOARD_ACTION
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
