fileVersion: 1
id: c6eda385-77f0-4367-8c20-e93f9206de3a
name: OPC_SUPPLIER_PUBLICORPRIVATE
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: OMNIACONNECT.OPC
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c726103-939a-4ff6-ab36-5cb1955265f5
          stepCounter: c6eda385-77f0-4367-8c20-e93f9206de3a
        config: {}
        dataType: INT
        defaultValue: ""
        description: SUPPLIER KEY
        name: SUPPLIERKEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9413a045-b4a9-4f1c-ba16-9b40f8665929
                stepCounter: ab16115a-f5c7-4d24-bca6-41c596634f50
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7efed2f4-3cca-4661-ad7e-07306e0aa3cd
          stepCounter: c6eda385-77f0-4367-8c20-e93f9206de3a
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: CONTRACT PUBLIC OR PRIVATE BY SOURCE ENTITY
        name: CONTRACTPUBLICORPRIVATEBYSOURCEENTITY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e507b7d-0e88-4db6-9061-de17d6c24f69
                stepCounter: ab16115a-f5c7-4d24-bca6-41c596634f50
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          CONTRACT: ab16115a-f5c7-4d24-bca6-41c596634f50
          OPC_SUPPLIER_PUBLICORPRIVATE: c6eda385-77f0-4367-8c20-e93f9206de3a
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            \NCREATE
                OR REPLACE VIEW {{ ref_no_link('OMNIACONNECT.OPC','OPC_SUPPLIER_PUBLICORPRIVATE') }} (\NSUPPLIERKEY, \NCONTRACTPUBLICORPRIVATEBYSOURCEENTITY\N)\NAS\NWITH CTETEMP \N AS (
                    SELECT DISTINCT SUPPLIERKEY, \N CASE SOURCEENTITYNAME \N --PUBLIC
            \N
                                WHEN 'OMNIA PUBLIC SECTOR'       THEN 'PUBLIC' \N
                                WHEN 'US COMMUNITIES'            THEN 'PUBLIC' \N
                                WHEN 'NATIONAL IPA'              THEN 'PUBLIC' \N
                                WHEN 'VIZIENT'                   THEN 'PUBLIC' \N
                                WHEN 'TCPN'                      THEN 'PUBLIC' \N
                                WHEN 'NCPA'                      THEN 'PUBLIC' \N --PRIVATE
            \N
                                WHEN 'OMNIA PRIVATE SECTOR'      THEN 'PRIVATE' \N
                                WHEN 'CORPORATE UNITED'          THEN 'PRIVATE' \N
                                WHEN 'PRIME ADVANTAGE'           THEN 'PRIVATE' \N
                                WHEN 'INSIGHT GPO'               THEN 'PRIVATE' \N
                                WHEN 'OP PPE'                    THEN 'PRIVATE' \N --OTHER
            \N
                                ELSE 'UNKNOWN' \N
                                 END AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
                      FROM {{ ref('DIM','CONTRACT') }} \N
                     GROUP BY \N SUPPLIERKEY, \N SOURCEENTITYNAME
                   ) \N SELECT \N SUPPLIERKEY, \N LISTAGG(DISTINCT CONTRACTPUBLICORPRIVATEBYSOURCEENTITY, ',') WITHIN GROUP (ORDER BY CONTRACTPUBLICORPRIVATEBYSOURCEENTITY DESC) AS CONTRACTPUBLICORPRIVATEBYSOURCEENTITY \N
              FROM CTETEMP \N
             GROUP BY SUPPLIERKEY \N;\N\N
        dependencies:
          - locationName: DIM
            nodeName: CONTRACT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('DIM','CONTRACT') }}
        name: OPC_SUPPLIER_PUBLICORPRIVATE
        noLinkRefs: []
  name: OPC_SUPPLIER_PUBLICORPRIVATE
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
