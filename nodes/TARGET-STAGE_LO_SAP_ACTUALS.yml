fileVersion: 1
id: c2a13082-4cea-4c49-a7ab-339f183bc702
name: STAGE_LO_SAP_ACTUALS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "First Pass on FACT_ACTUALS to extract Lease Ops data. Contains any source specific transformations to values (ie normalized volumes)"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2a8108b-396c-4413-afed-2be76da0cfc4
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_LEDGER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee7439c2-bace-492e-9493-a208503e3c6d
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dec70e97-cc81-48b7-b857-3f05ff48b330
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: date as integer
        isBusinessKey: true
        name: DIM_ACTVY_PER_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9ce251f-1d1a-4c57-b32d-0e79bccf3ec3
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 17fb3516-81f9-4d8b-a2f1-cc0433635a07
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: date as integer
        isBusinessKey: true
        name: DIM_ACCT_PER_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bd68d168-b787-488b-819d-a9110544131b
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9b03065f-874d-40e1-b2e9-053d88be45da
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_COST_CENTER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9db44fec-94a9-4a5a-a4fe-cc8235b8a7f1
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 901a947b-b62c-4075-9e18-c2aac2cd03b3
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_AFE_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b810e4ed-26d8-40e4-bde8-e4eb9140c044
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3c0b34ea-5129-45ac-b028-6ca5beb98b86
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_DEST_ORGANIZATION_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc3dee9f-1bab-47e9-9691-384256be16cd
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b53698fb-943f-4271-a060-0df4052c34a4
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_GL_ACCOUNT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d684dae-ecd8-4b2e-964d-e5e868f585f6
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 598f9a1a-3b39-4254-bd29-1c5bf3f8d3a8
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_GROSS_NET_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ef838df0-9391-4140-9054-4608124f4d7e
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b064092e-93cd-4b1a-9902-7b9624c3d08e
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LEASE_OPS_HIER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 03094dcc-28c0-4fee-b106-8de0eba3539c
                stepCounter: e0b535c4-f94e-4ac1-b685-dfdff6293176
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 991434a4-585f-4889-96e4-614f6d05bd95
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LEASE_OPS_VERSION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a1f4fcd-7833-411a-9397-f334eb729f13
                stepCounter: 5f11ba91-fb8d-4d07-bc17-616726032eee
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dba5f0b5-5c79-448d-a5a3-d4479edce662
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LINE_ITEM_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebb273a7-5c02-468d-b30d-1750c783e9d8
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ca88f8fb-0bc0-45b3-b6ff-d0df7b0cf7c6
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_VOUCHER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9c6bc425-da3d-4042-93a6-e9eb8eadbbcb
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: af0a2c84-0539-4e8c-bbf4-b64a9b3e2ba9
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_AFE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44a4cddd-b819-4b52-8223-7000cb28b82f
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3aad5c50-497b-4e69-aaab-c0249339e5d5
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_INVOICE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9fe6e226-d6bf-4803-b846-59aa125c2b3d
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2221aebe-fc78-44f8-8bd7-65853d7d0962
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_PRODUCT_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 41c0b4fb-4d42-487f-a576-988c7e5859f8
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8613388-d10b-42a7-8b8e-3d0134108751
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: LINE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 08c886fc-b484-4556-8efa-bc522b44d39b
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d7882a36-e952-4127-98c9-3cbadc28cff2
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 11aae765-db83-479d-8c9d-a2eaeec11486
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(FACT_LO_SAP_ACTUALS.OP_AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9832f767-3962-425d-be30-359fea45418a
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 38b72415-d536-417b-80da-f6236300c5cf
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(DECODE(FACT_LO_SAP_ACTUALS.GROSS_OR_NET_CODE, 'G', FACT_LO_SAP_ACTUALS.CAD_AMT,FACT_LO_SAP_ACTUALS.GLOP_CAD_AMT))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bbacc6d4-20a0-4322-a574-daf8c8b86db0
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: 'Gross Line Item Net Op Amount '
        name: NET_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd659b15-7e79-4542-93a3-836a75bdaf23
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(FACT_LO_SAP_ACTUALS.NET_OP_AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b98664ab-56d1-4fb8-bea6-a1dd5e4b9bec
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7cf83eb-0256-4f0f-9d7e-6e63f4d3ac83
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 74024ec6-33df-4c06-8713-4e2e1be38cb8
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: EXCHANGE_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dcbde35d-e3cc-4711-971d-0632027d418d
                stepCounter: 10610c79-961d-496a-bfe6-69c8014bf2b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 441249d2-c8de-4645-933b-6ad9ea336d11
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line Item Volume in native UOM
        name: LI_VOL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5cf2841-efde-4411-a27d-ff5a92b10378
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4c8d4de8-6949-4b2c-8cd9-3595a3c3389e
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: LI_VOL_UOM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6737751-8407-4d70-a51b-ee6c8e327b37
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f78c36b4-16f4-4b71-a095-001f83895c45
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in cubic meters (m3)
        name: LI_VOL_M3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bead6c26-3e20-4012-888e-2acddaa46c1d
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL_M3)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e93a8d81-4483-41f6-bafe-8023f8da1371
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in imperial measurement
        name: LI_VOL_IMPERIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a157ebb9-990e-441d-9094-78ef3b9223a5
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(CASE WHEN FACT_LO_SAP_ACTUALS.GLOP_LINE_NO='20.4' AND DIM_LO_SAP_PRODUCT_TYPE.PROD_CODE='NGAS' THEN FACT_LO_SAP_ACTUALS.LI_VOL_IMPERIAL/1000 ELSE FACT_LO_SAP_ACTUALS.LI_VOL_IMPERIAL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96f20da2-5c9f-4f4f-b83f-e334421558a2
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in BOE (Barrel of Oil Equivalent)
        name: LI_VOL_BOE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d494bc73-2901-48ad-9895-5611fe6678c4
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(CASE WHEN FACT_LO_SAP_ACTUALS.GLOP_LINE_NO='20.4' AND DIM_LO_SAP_PRODUCT_TYPE.PROD_CODE='NGAS' THEN FACT_LO_SAP_ACTUALS.LI_VOL_BOE/1000 ELSE FACT_LO_SAP_ACTUALS.LI_VOL_BOE END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45a6cfc7-4f96-4d96-afaa-173e40fb1972
          stepCounter: c2a13082-4cea-4c49-a7ab-339f183bc702
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in normalized cubic meters (nm3)
        name: LI_VOL_NM3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8cb5e7d7-bb76-42ee-aff8-b39ed167912d
                stepCounter: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL_NM3)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          FACT_LO_SAP_ACTUALS: a12e113e-c1e1-48ab-9f81-fdc5cfa0e26c
          DIM_LO_SAP_LINE_ITEM: d0ab4a94-a909-487b-8651-345f5baff59d
          DIM_LO_SAP_LEASE_OPS_HIER: e0b535c4-f94e-4ac1-b685-dfdff6293176
          DIM_LO_SAP_PRODUCT_TYPE: e14ab72e-3f25-44f0-b70c-6a0192afcc50
          STAGE_LO_SAP_ACTUALS_AVG_FX: 10610c79-961d-496a-bfe6-69c8014bf2b1
          DIM_LO_SAP_LEASE_OPS_VERSION: 5f11ba91-fb8d-4d07-bc17-616726032eee
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: FACT_LO_SAP_ACTUALS
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LINE_ITEM
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEASE_OPS_HIER
          - locationName: TARGET
            nodeName: DIM_LO_SAP_PRODUCT_TYPE
          - locationName: TARGET
            nodeName: STAGE_LO_SAP_ACTUALS_AVG_FX
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEASE_OPS_VERSION
        join:
          joinCondition: |-
            FROM {{ ref('TARGET','FACT_LO_SAP_ACTUALS') }} FACT_LO_SAP_ACTUALS
              JOIN {{ ref('TARGET','DIM_LO_SAP_LINE_ITEM') }} DIM_LO_SAP_LINE_ITEM
                ON FACT_LO_SAP_ACTUALS.LI_ID = DIM_LO_SAP_LINE_ITEM.LI_ID
              JOIN {{ ref('TARGET','DIM_LO_SAP_LEASE_OPS_HIER') }} DIM_LO_SAP_LEASE_OPS_HIER
                ON FACT_LO_SAP_ACTUALS.GLOP_LINE_NO= DIM_LO_SAP_LEASE_OPS_HIER.LINE_NO
              JOIN {{ ref('TARGET','DIM_LO_SAP_PRODUCT_TYPE') }} DIM_LO_SAP_PRODUCT_TYPE
                ON FACT_LO_SAP_ACTUALS.DIM_PRODUCT_TYPE_KEY = DIM_LO_SAP_PRODUCT_TYPE.DIM_PRODUCT_TYPE_KEY
              JOIN {{ ref('TARGET','STAGE_LO_SAP_ACTUALS_AVG_FX') }} STAGE_LO_SAP_ACTUALS_AVG_FX
                ON FACT_LO_SAP_ACTUALS.DIM_ACTVY_PER_DATE_KEY = STAGE_LO_SAP_ACTUALS_AVG_FX.DIM_ACTVY_PER_DATE_KEY
               AND FACT_LO_SAP_ACTUALS.OP_CURR_CODE = STAGE_LO_SAP_ACTUALS_AVG_FX.OP_CURR_CODE
             CROSS JOIN (
                    SELECT MAX(DIM_LEASE_OPS_VERSION_KEY) DIM_LEASE_OPS_VERSION_KEY
                      FROM {{ ref('TARGET','DIM_LO_SAP_LEASE_OPS_VERSION') }}
                     WHERE upper(VERSION_NAME)='ACTUALS'
                   ) DIM_LO_SAP_LEASE_OPS_VERSION
             WHERE FACT_LO_SAP_ACTUALS.GLOP_LINE_NO IS NOT NULL
             GROUP BY FACT_LO_SAP_ACTUALS.DIM_LEDGER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_ACTVY_PER_DATE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_ACCT_PER_DATE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_COST_CENTER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_AFE_TYPE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_DEST_ORGANIZATION_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_GL_ACCOUNT_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_GROSS_NET_KEY,
                      DIM_LO_SAP_LEASE_OPS_HIER.DIM_LEASE_OPS_HIER_KEY,
                      DIM_LO_SAP_LEASE_OPS_VERSION.DIM_LEASE_OPS_VERSION_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_LINE_ITEM_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_VOUCHER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_AFE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_INVOICE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_PRODUCT_TYPE_KEY,
                      FACT_LO_SAP_ACTUALS.GLOP_LINE_NO,
                      FACT_LO_SAP_ACTUALS.LI_VOL_UOM,
                      FACT_LO_SAP_ACTUALS.OP_CURR_CODE,
                      STAGE_LO_SAP_ACTUALS_AVG_FX.AVG_EXCHANGE_RATE
        name: STAGE_LO_SAP_ACTUALS
        noLinkRefs: []
  name: STAGE_LO_SAP_ACTUALS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
