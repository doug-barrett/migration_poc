fileVersion: 1
id: 6673255b-ba65-426a-b66d-13b87cd43f61
name: STAGE_LO_SAP_ACTUALS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "First Pass on FACT_ACTUALS to extract Lease Ops data. Contains any source specific transformations to values (ie normalized volumes)"
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b0749e4-4dda-40cb-803a-273814a1dcd6
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: DIM_LEDGER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ddc0f431-d5c5-48c4-9a2a-2d355a89dbe6
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a271720-9137-4b83-899e-692a8ed39552
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: date as integer
        isBusinessKey: true
        name: DIM_ACTVY_PER_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 642d0209-2dbf-442c-b0d9-58bdea330196
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80bf4f50-aa8c-4d95-91de-4b5e21683e78
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: date as integer
        isBusinessKey: true
        name: DIM_ACCT_PER_DATE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6b17c5f5-b645-471d-a01b-95443c011ddf
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0129c8f3-6b54-412c-aa2a-1c5f786e263b
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_COST_CENTER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d43470f3-5cc1-4a08-9396-9d50afad3f53
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39840e6c-60d9-4480-906e-988ae90a7f07
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_AFE_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4526fea9-87ac-4365-aece-0ede09abb434
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ae5803b-837f-4067-a653-5bc41f5f8baa
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_DEST_ORGANIZATION_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a67a6f77-9d0b-4bad-8bd2-5c67d378cf78
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79f2c475-e95c-4715-9190-2be74b29c99e
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_GL_ACCOUNT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af0166d5-1a72-4a9e-8eaa-02fa6e49cd83
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aedcbb49-79b1-438b-ab06-f3eb70e5639c
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_GROSS_NET_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 32c051db-aedc-4aa8-8b18-d60fd72e9142
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4249d02a-fb30-4eb6-937d-6cdc7cbb6959
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LEASE_OPS_HIER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 21fac97a-151e-4cc2-8783-56a1148d309b
                stepCounter: 82938641-7c51-4aff-ad3a-c7a56af30c01
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5383dc6b-379d-4e6e-89d5-6c6bb515afee
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LEASE_OPS_VERSION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 229d76c5-e976-46d2-84ce-8623a3e8d9c3
                stepCounter: e575d1a1-f47c-47ec-b457-d837fc9a6b39
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a2beb575-04e6-4fa4-b4c3-7c91b390b556
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_LINE_ITEM_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a2c13a4d-b6db-4c98-84ae-cd143e998b05
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b86c81f5-eefe-4043-808a-f586693de869
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_VOUCHER_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f19f580b-e800-4ba1-870b-dd1ef9854025
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85e8c41c-4ef7-4b12-92e6-539bc510905b
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_AFE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c12a78a9-d564-4b77-a3c4-db73ff0f6c4c
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48590fd3-bde0-4570-b442-3f29597ddd0c
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_INVOICE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9043d823-660d-4832-b966-c44753c5def2
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2196f41-8f09-4bdd-b968-37fe3da8c840
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        isBusinessKey: true
        name: DIM_PRODUCT_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 013502ed-6e16-4edc-b649-d4e30788b27f
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3318432-5692-43ee-8e06-5dfbeebae673
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: LINE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6ffb902-1d8d-4d6b-8c17-24445250c525
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8681ee55-a901-48c9-9c37-a0c73dab200e
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 286885c9-b04f-40a9-97c8-e6716194854d
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(FACT_LO_SAP_ACTUALS.OP_AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66e8814f-0aca-47e4-a674-d19d9f05ccc7
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        name: CAD_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bcac5a84-c5d7-47d5-9e8a-38440c5a1090
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(DECODE(FACT_LO_SAP_ACTUALS.GROSS_OR_NET_CODE, 'G', FACT_LO_SAP_ACTUALS.CAD_AMT,FACT_LO_SAP_ACTUALS.GLOP_CAD_AMT))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a6673b3-82ea-44c2-a132-b28db7195cf9
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: 'Gross Line Item Net Op Amount '
        name: NET_OP_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 04b4957d-47de-4f6b-9a2d-5f35272bf96a
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(FACT_LO_SAP_ACTUALS.NET_OP_AMT)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8988c5cc-d3c8-4ee7-b6a7-d7458b01dbf4
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: OP_CURR_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2f14caff-f556-4ed1-9a4a-942bbe4aff82
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a47393a6-8e18-40bf-8b93-d6e44cc82075
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(23,2)
        defaultValue: ""
        description: ""
        name: EXCHANGE_RATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4f38f7d2-6111-4e38-8186-fc60c18212a7
                stepCounter: 0894a36a-bf05-401a-8b9e-739b9795bb1a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adbb94ee-b55e-4a1b-ab2a-f59912d8c3c9
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line Item Volume in native UOM
        name: LI_VOL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cbf44aee-5761-4a35-88e1-dd70dc7e4015
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51de383e-4856-48cb-93b5-1bbc85e32b3e
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: ""
        name: LI_VOL_UOM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2525671-3abf-446a-9f91-0fd743176fae
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d7f0101-d186-4a06-8ceb-01bb71c12105
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in cubic meters (m3)
        name: LI_VOL_M3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e20da0af-402c-49cb-9dd5-7c723b2b9d82
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL_M3)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9276f40-e606-4421-8582-184a8d842610
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in imperial measurement
        name: LI_VOL_IMPERIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 781b2c28-0ba2-4cdf-bb4d-671d8b72ab05
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(CASE WHEN FACT_LO_SAP_ACTUALS.GLOP_LINE_NO='20.4' AND DIM_LO_SAP_PRODUCT_TYPE.PROD_CODE='NGAS' THEN FACT_LO_SAP_ACTUALS.LI_VOL_IMPERIAL/1000 ELSE FACT_LO_SAP_ACTUALS.LI_VOL_IMPERIAL END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ab61d25-793d-4a21-bde9-ac977dff4ceb
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in BOE (Barrel of Oil Equivalent)
        name: LI_VOL_BOE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd9a5005-018a-470a-808d-58b7200bda4e
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(CASE WHEN FACT_LO_SAP_ACTUALS.GLOP_LINE_NO='20.4' AND DIM_LO_SAP_PRODUCT_TYPE.PROD_CODE='NGAS' THEN FACT_LO_SAP_ACTUALS.LI_VOL_BOE/1000 ELSE FACT_LO_SAP_ACTUALS.LI_VOL_BOE END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 477130f4-2717-4ccb-826c-12c23a99708b
          stepCounter: 6673255b-ba65-426a-b66d-13b87cd43f61
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: Line item Volume in normalized cubic meters (nm3)
        name: LI_VOL_NM3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b440392-a39c-4376-b5e2-4c50fb9ec1e5
                stepCounter: d5af52cd-460f-4473-aea6-9d6cb06937f3
            transform: SUM(FACT_LO_SAP_ACTUALS.LI_VOL_NM3)
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          FACT_LO_SAP_ACTUALS: d5af52cd-460f-4473-aea6-9d6cb06937f3
          DIM_LO_SAP_LINE_ITEM: 6d556ec5-1a14-4fec-b7c2-d8beb2ab5abd
          DIM_LO_SAP_LEASE_OPS_HIER: 82938641-7c51-4aff-ad3a-c7a56af30c01
          DIM_LO_SAP_PRODUCT_TYPE: af796a63-3184-4858-86cc-362cb792e537
          STAGE_LO_SAP_ACTUALS_AVG_FX: 0894a36a-bf05-401a-8b9e-739b9795bb1a
          DIM_LO_SAP_LEASE_OPS_VERSION: e575d1a1-f47c-47ec-b457-d837fc9a6b39
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: FACT_LO_SAP_ACTUALS
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LINE_ITEM
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEASE_OPS_HIER
          - locationName: TARGET
            nodeName: DIM_LO_SAP_PRODUCT_TYPE
          - locationName: TARGET
            nodeName: STAGE_LO_SAP_ACTUALS_AVG_FX
          - locationName: TARGET
            nodeName: DIM_LO_SAP_LEASE_OPS_VERSION
        join:
          joinCondition: |-
            FROM {{ ref('TARGET','FACT_LO_SAP_ACTUALS') }} FACT_LO_SAP_ACTUALS
              JOIN {{ ref('TARGET','DIM_LO_SAP_LINE_ITEM') }} DIM_LO_SAP_LINE_ITEM
                ON FACT_LO_SAP_ACTUALS.LI_ID = DIM_LO_SAP_LINE_ITEM.LI_ID
              JOIN {{ ref('TARGET','DIM_LO_SAP_LEASE_OPS_HIER') }} DIM_LO_SAP_LEASE_OPS_HIER
                ON FACT_LO_SAP_ACTUALS.GLOP_LINE_NO= DIM_LO_SAP_LEASE_OPS_HIER.LINE_NO
              JOIN {{ ref('TARGET','DIM_LO_SAP_PRODUCT_TYPE') }} DIM_LO_SAP_PRODUCT_TYPE
                ON FACT_LO_SAP_ACTUALS.DIM_PRODUCT_TYPE_KEY = DIM_LO_SAP_PRODUCT_TYPE.DIM_PRODUCT_TYPE_KEY
              JOIN {{ ref('TARGET','STAGE_LO_SAP_ACTUALS_AVG_FX') }} STAGE_LO_SAP_ACTUALS_AVG_FX
                ON FACT_LO_SAP_ACTUALS.DIM_ACTVY_PER_DATE_KEY = STAGE_LO_SAP_ACTUALS_AVG_FX.DIM_ACTVY_PER_DATE_KEY
               AND FACT_LO_SAP_ACTUALS.OP_CURR_CODE = STAGE_LO_SAP_ACTUALS_AVG_FX.OP_CURR_CODE
             CROSS JOIN (
                    SELECT MAX(DIM_LEASE_OPS_VERSION_KEY) DIM_LEASE_OPS_VERSION_KEY
                      FROM {{ ref('TARGET','DIM_LO_SAP_LEASE_OPS_VERSION') }}
                     WHERE upper(VERSION_NAME)='ACTUALS'
                   ) DIM_LO_SAP_LEASE_OPS_VERSION
             WHERE FACT_LO_SAP_ACTUALS.GLOP_LINE_NO IS NOT NULL
             GROUP BY FACT_LO_SAP_ACTUALS.DIM_LEDGER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_ACTVY_PER_DATE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_ACCT_PER_DATE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_COST_CENTER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_AFE_TYPE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_DEST_ORGANIZATION_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_GL_ACCOUNT_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_GROSS_NET_KEY,
                      DIM_LO_SAP_LEASE_OPS_HIER.DIM_LEASE_OPS_HIER_KEY,
                      DIM_LO_SAP_LEASE_OPS_VERSION.DIM_LEASE_OPS_VERSION_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_LINE_ITEM_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_VOUCHER_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_AFE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_INVOICE_KEY,
                      FACT_LO_SAP_ACTUALS.DIM_PRODUCT_TYPE_KEY,
                      FACT_LO_SAP_ACTUALS.GLOP_LINE_NO,
                      FACT_LO_SAP_ACTUALS.LI_VOL_UOM,
                      FACT_LO_SAP_ACTUALS.OP_CURR_CODE,
                      STAGE_LO_SAP_ACTUALS_AVG_FX.AVG_EXCHANGE_RATE
        name: STAGE_LO_SAP_ACTUALS
        noLinkRefs: []
  name: STAGE_LO_SAP_ACTUALS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
