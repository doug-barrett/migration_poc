fileVersion: 1
id: 7b87b310-d61e-46b0-9602-2119fa33d742
name: S_OUTPATIENT_SLOT_20
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: "Summarise the time slot information into one row per time slot with counts for each visit type."
  isMultisource: false
  locationName: STAGE
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb3a3e53-d08c-4ad3-a049-ff2a625e37b7
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the slot within an outpatient session.
        name: OUTPATIENT_SLOT_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51047391-f6d5-4467-b2d4-819240a08a28
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f0adc73-08b8-4ad1-b1a7-79648c9de2ab
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier for the outpatient session.
        name: OUTPATIENT_SESSION_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec902f67-1d57-4eb6-a7b0-a2611833aeb3
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05867f84-370d-48b7-889b-5757a6f73039
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Unique identifier of the outpatient clinic.
        name: OUTPATIENT_CLINIC_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59680a34-7369-40f7-967e-820ea5e0b8c3
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aaca4bae-fba2-4ff6-9d54-aced9e48af92
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Start date and time of the session slot.
        name: SLOT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ccacd003-a411-4f29-b036-5ac14c38c06c
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 794fe9ff-8656-4d25-bb25-a0caf138c201
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: End date and time of the session slot.
        name: SLOT_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5cdab7f9-ea8d-41be-82cc-8c1177092e6d
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b29a2b3-1170-4c0b-af6f-7a308e350621
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Possible values include AVAIL (Available), NOLAV (No longer available), BUKED (Booked), RESRV (Reserved).
        name: SLOT_STATUS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fa7ca481-efba-488c-8686-6c762a7ce70c
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42ff6c0a-4709-4835-8a43-00c507e7c555
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: SMALLINT
        defaultValue: ""
        description: Duration of a session slot in minutes.
        name: SLOT_DURATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 802125ca-657c-4c93-983c-68a759051e22
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9e5ee11-90e7-4203-984a-45841d276e0d
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the session slot has been cancelled
        name: SLOT_CANCELLED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec0e52f6-c154-481a-852c-e5008f803b41
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fbd3853e-083c-4996-87b7-ea6aa8796842
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: 'Set to 1 if the slot is booked and so no longer available.  '
        name: SLOT_BOOKED_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1d84fee-f727-4f6e-a980-4d61c85245d0
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 757815bd-e964-4949-8b6d-0af289e7b3f7
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Set to 1 if the slot has a forced booking i.e. slot not normally available but has been booked anyway. Such bookings have no visit type.
        name: FORCED_BOOKING_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 55ac7456-252c-4602-a7bf-c2245b6fc371
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ef84bca-57a0-4847-a901-9bfc1bafa8d3
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments booked in the slot.
        name: SLOT_BOOKING_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b7603b98-a30f-42a5-b839-ed5d1a9bf7e8
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12a6258a-3f2c-4129-896b-e0b09696f2ad
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FSA appointments available in the slot.
        name: SLOT_FSA_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code = 'N' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6db4c124-5e26-4ba8-a3a6-393d77f5a550
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of FUP appointments available in the slot.
        name: SLOT_FUP_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code = 'O' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8022c1a7-11df-47a2-8692-3b828ed92ed1
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of Inpatient appointments available in the slot.
        name: SLOT_INPATIENT_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code = 'INPAT' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 51bcf028-3b7c-420b-89fb-13eddee6d325
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of PAC appointments available in the slot.
        name: SLOT_PAC_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code = 'PAC' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30643bd2-0eae-4344-8015-c22b70efb792
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of SOSFU appointments available in the slot.
        name: SLOT_SOSFU_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code = 'SOSFU' THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 69eb0def-3c68-4a75-a359-1ab2d4a83beb
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: TINYINT
        defaultValue: ""
        description: Number of appointments available in the slot that are not FSA, FUP, Inpatient, PAC or SOSFU.
        name: SLOT_OTHER_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20de0c6a-5043-413a-b8d3-5d74516fd5d7
                stepCounter: 78162b60-7087-4372-abbd-d6cb06ade5b1
            transform: SUM(CASE WHEN visit_code NOT IN ('N','O','INPAT','PAC','SOSFU') THEN slot_available_count ELSE 0 END)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c4a4df7-de23-4db2-9c47-3b4b480ae21c
          stepCounter: 7b87b310-d61e-46b0-9602-2119fa33d742
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: STAGE
            nodeName: S_OUTPATIENT_SLOT_10
        join:
          joinCondition: |-
            FROM s_outpatient_slot_10
             GROUP BY outpatient_slot_reference_no,
                      outpatient_session_reference_no,
                      outpatient_clinic_reference_no,
                      slot_start_date,
                      slot_end_date,
                      slot_status_code,
                      slot_duration,
                      slot_cancelled_flag,
                      slot_booked_flag,
                      forced_booking_flag,
                      slot_booking_count
        name: S_OUTPATIENT_SLOT_20
        noLinkRefs: []
  name: S_OUTPATIENT_SLOT_20
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
