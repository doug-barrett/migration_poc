fileVersion: 1
id: adc780a1-aeaf-471c-8eb5-a2407e4da337
name: S_SUPPORT_PLAN_NASC_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 858f817e-b65b-40cb-a92e-371d91100641
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: CONTACT_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8281d50f-9f5d-4a1b-bd23-f4a290899a34
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96e151fb-69b9-40dd-a9d7-aa2e702edcda
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a0bd06e-5434-419e-90c7-fb5ec8d66ee2
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: patient_programme_id
        name: PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1dc01ac2-a10c-49ca-90eb-ed32df22cd74
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7ac8a1cf-1a95-4eb6-8780-75de64bc9181
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PROGRAMME_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 68ae7343-6636-410f-8f54-d96cc55f2e09
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 940189ed-ed59-4bca-a915-8cbe83479d78
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: TASK_DESC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5353c2d-4a44-4e11-bc07-37f02a977a35
                stepCounter: 447055e4-f68c-4b9d-a35b-74f5502fcef1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5533bdf-3f02-4cbb-99bf-7576696c9645
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: HEALTH_ORG_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c12f6696-6dfb-413d-a9e0-108fd7fdb031
                stepCounter: 05ed0e9e-67ad-49bf-b299-f8f341d6b3c4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5c1a5872-83f2-4d46-a933-9076843955fe
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: ""
        name: SEEN_BY_CLINICIAN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b8f3a79-f117-4171-adef-1c933c0a05b5
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87d0e5ac-2af1-4bdb-8f80-4339433cc305
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REFERRAL_ENCOUNTER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9668f55c-c7a5-4a58-a248-a09453e77eaa
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1620d22-c9c7-4cdd-bf00-744982e3f606
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: HOSPITAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 980489a9-a2f2-4899-b808-e20222682081
                stepCounter: 0790fdf4-e815-4587-a9cd-954ea13f53c6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8bbcda8-64a5-4d45-9cba-707986a4fb8a
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: PROVIDER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b64f71a4-6818-4fe2-8f71-79ea2097bd8d
                stepCounter: 2a628fe0-7fea-4e78-95b1-e7104461d775
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4334673d-e220-4c06-bb10-726981b5f97a
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PROVIDER_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e54c5b96-c200-4dd7-85cc-9dc969de2264
                stepCounter: 2a628fe0-7fea-4e78-95b1-e7104461d775
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a0b3f703-4e4d-4b0f-bf3b-811af4c61ce4
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PROGRAMME_ROLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d788f13-a646-4910-9c25-9a645fe4a4f6
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: DEPARTMENT_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 159e34a9-2c35-4dd6-82d9-9ad52fbe3912
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b6aad72b-4994-4140-add1-d6872ea6d326
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5de1023-9916-4569-ad46-d203d6bd8b59
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 31cf76c1-6482-473a-abf2-4778ebfa3c0c
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EPISODE_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a61b1e4e-250d-4353-8a0b-699237cac645
                stepCounter: 2ecdd3a6-b52d-4166-90dd-2155a6b785ca
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a84a47f-b164-45da-9031-d49b074a5616
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NASC_SERVICE_ATO_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff974243-b13b-4ef2-beaa-bf773a79965c
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: SERVICE_GAPS_ATO_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4011bf7f-b1b7-4b13-b88f-3b6c41159178
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: RESIDENTIAL_PLACEMENT_IND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7605c915-9250-475d-9629-39822e8d391d
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: RESIDENTIAL_PLACEMENT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49e02eb6-681e-4532-a2b4-a45e8a4c3207
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PLACEMENT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8e7162e6-f882-46d4-99ab-8bc318ea51e9
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: PLACEMENT_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a44cad6d-34d2-478b-87b9-565d2edd69a2
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: OUTCOME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: edbb232a-f22b-4b2a-b62e-144637271f4b
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: PLAN_COMPLETED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 147a6af9-4fa8-4908-986e-f04c3f2e6c17
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: REVIEW_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f7abbc9f-ad41-48f2-8544-043065b9898d
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: REVIEW_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9a292f1-f13b-478a-a482-c350fb879840
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: EXIT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdbae57f-cdee-4812-ac10-f4981ee4ac2e
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: EXIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e63529ff-80e0-4aa1-ac32-2d97288e1b90
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: SCID_MIGRATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dfcda69a-a0ae-4111-974a-3ab656fce470
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_OUT_RESIDENTIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35971b9d-ded4-4852-8d29-a2aee2b12c32
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_OUT_DHB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1715b31c-df66-4ff5-9139-0d72ec9a1776
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: TRANSFER_INTERNAL_NASC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4320daae-e1ac-4138-92af-3202ebdad5c4
                stepCounter: 75174d9c-78ab-4e2d-b1fc-fa89ec3f8d67
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ca5a6a9-5f73-49d8-acb2-05c7e8425587
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 00375d4d-ac65-428c-a6ed-107ee136ee44
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec61cdef-ebd2-47c1-b49d-f1be4223bb66
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_COMPLETION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e062b704-8bee-4ebf-9f39-44e0732669e2
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5461f04-1a3e-4aaf-80e3-c20c0f7c9592
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0f2e33ef-8ae5-4e28-9dbc-6e3089022f15
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5030852-3379-45f1-a795-1918217a26f5
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: CREATE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e11a0bad-b228-417a-b977-da23dcd925b4
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb40091c-92d3-491e-b690-527477363577
          stepCounter: adc780a1-aeaf-471c-8eb5-a2407e4da337
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: CREATE_USER_LOGIN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 005077ef-2f46-49d9-8c15-62f319935a6e
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT 'NA'+SUBSTRING(CONVERT(varchar,10000000000+tr.taskrequest_id),2,10) contact_encounter_id,
                   tr.taskrequest_id task_request_id,
                   pt.NHI_number,
                   pp.patient_programme_id programme_id,
                   MAX(pp.patient_programme_status) programme_status,
                   LEFT(MAX(tt.display_name),30) task_desc,
                   MAX(cl.external_clinic_id) health_org_id,
                   MAX(ob.provider_nzmc) seen_by_clinician_id,
                   MAX(CASE WHEN LEFT (tr.stream_id,1) = '1' THEN 'R' + tr.stream_id ELSE tr.stream_id END) referral_encounter_id,
                   MAX(CASE WHEN og.health_org_desc LIKE '%West%' THEN '3216' ELSE '3215' END) hospital_id,
                   MAX(pr.provider_id) provider_id,
                   MAX(pr.provider_role_code) provider_role_code,
                   LEFT(MAX(rl.name),50) programme_role_code,
                   LEFT(MAX(dp.name),50) department_desc,
                   LEFT(MAX(sv.name),50) service_desc,
                   MAX(tr.request_date) task_request_date,
                   MAX(pp.episode_start_date) episode_start_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4454086681000 THEN ov.value ELSE NULL END),50) NASC_service_ATO_id,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497254589248 THEN ov.value ELSE NULL END),50) service_gaps_ATO_id,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4765150784084 THEN ov.value ELSE NULL END),50) residential_placement_ind,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497256170240 THEN ov.value ELSE NULL END),50) residential_placement_reason,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497256170240 THEN ov.value ELSE NULL END),50) placement_type,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497257196796 THEN ov.value ELSE NULL END),50) placement_source,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4454095715376 THEN ov.value ELSE NULL END),50) outcome,
                   MAX(CASE WHEN ov.datatype_id = 4454094663560 THEN try_CONVERT(datetime,ov.value,103) ELSE NULL END) plan_completed_date,
                   MAX(CASE WHEN ov.datatype_id = 4462680096716 THEN ov.value ELSE NULL END) review_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4568844972108 THEN ov.value ELSE NULL END),50) review_type,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 4497265089308 THEN ov.value ELSE NULL END),50) exit_reason,
                   MAX(CASE WHEN ov.datatype_id = 4692589947576 THEN try_CONVERT(datetime,ov.value,103) ELSE NULL END) exit_date,
                   MAX(CASE WHEN ov.datatype_id = 4655176756812 THEN try_CONVERT(datetime,ov.value,103) ELSE NULL END) SCID_migrated_date,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 5028509917560 THEN ov.value ELSE NULL END),50) transfer_out_residential,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 5028510230360 THEN ov.value ELSE NULL END),50) transfer_out_DHB,
                   LEFT(MAX(CASE WHEN ov.datatype_id = 5028508750096 THEN ov.value ELSE NULL END),50) transfer_internal_NASC,
                   MAX(IFNULL(ob.due_date,tr.due_date)) observation_report_due_date,
                   MAX(ob.date_completed) observation_report_completion_date,
                   MAX(CASE WHEN ob.observation_report_status ='A' THEN 'Finalised' WHEN ob.observation_report_status ='F' THEN 'Completed' WHEN ob.observation_report_status ='S' THEN 'In Progress' WHEN ob.observation_report_status ='X' THEN 'Declined' ELSE 'Current' END) observation_report_status,
                   MAX(ob.created_date) create_date,
                   REPLACE(MAX(ob.created_by),' null','') create_user_login_name
              FROM ds_cdsswe_task_request tr
             INNER JOIN l_cdsswe_Task_Type tt
                ON tr.tasktype_id = tt.tasktype_id
               AND tt.name IN ('Support Plan')
             INNER JOIN ds_cdsswe_patient_programme pp
                ON tr.patient_programme_id = pp.patient_programme_id
             INNER JOIN l_cdsswe_programme rl
                ON rl.programme_id = pp.programme_id --AND rl.programme_id = 4452666405396  --'Needs Assessors in NASC'

             INNER JOIN l_cdsswe_patient pt
                ON pp.patient_id = pt.patient_id
             INNER JOIN ds_cdsswe_observation_report ob
                ON tr.taskrequest_id = ob.taskrequest_id
               AND ob.record_status = 'A'
               AND ob.observation_report_status IN ('A','F','X','S')
              LEFT OUTER JOIN ds_cdsswe_atomic_observation ov
                ON ov.observation_report_id = ob.observation_report_id
              LEFT OUTER JOIN l_cdsswe_Patient_Programme_Provider pr
                ON pr.patient_programme_id = pp.patient_programme_id
               AND pr.record_status = 'A'
               AND pr.sequence_num = '1'
              LEFT OUTER JOIN l_cdsswe_clinic cl
                ON pr.clinic_id = cl.clinic_id
               AND cl.record_status = 'A'
               AND cl.clinic_type = 'CASETEAM'
              LEFT OUTER JOIN dim.dim_health_organisation og
                ON cl.external_clinic_id = og.health_org_reference_no
              LEFT OUTER JOIN l_cdsswe_programme dp
                ON dp.programme_id = rl.parent_programme_id
              LEFT OUTER JOIN l_cdsswe_programme sv
                ON sv.programme_id = dp.parent_programme_id
             GROUP BY tr.taskrequest_id,
                      pt.NHI_number,
                      pp.patient_programme_id
        dependencies:
          - locationName: TGT
            nodeName: DS_CDSSWE_TASK_REQUEST
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','DS_CDSSWE_TASK_REQUEST') }}
        name: S_SUPPORT_PLAN_NASC_V
        noLinkRefs: []
  name: S_SUPPORT_PLAN_NASC_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
