fileVersion: 1
id: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
name: S_MOH_PATIENT
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1289ee09-41aa-46f0-b640-3d9df79e8d0d
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fa66211-849b-4be9-a204-a2bce15f9160
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f649fe3-62e7-4986-9273-385f84553763
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: EVENT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d7765b1-9cdd-4a9e-bb40-aa5bf45b5557
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f439ba02-0b50-4450-8d65-4ebae0366a7b
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1fa66211-849b-4be9-a204-a2bce15f9160
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ROW_NUMBER() OVER(PARTITION BY master_hcu_id ORDER BY event_start_date DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9c2906e8-4d96-4b54-b2fb-4503206c2f61
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SECONDARY_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a65c9aa1-43a2-4186-b34f-de33c4d2ca89
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0728ff0-79dc-42f8-b93a-82628ef7197e
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: GENDER_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c2ba624a-c7ed-489e-981a-7402fb1b4ce3
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a803eb6-52eb-4862-94d0-079028311449
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: DATE_OF_BIRTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a960626e-01bd-40f2-8b37-1522bd9a3722
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: CONVERT(date, date_of_birth)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c2a92cda-5c8b-46c1-95d0-4b40408fe530
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: NZ_RESIDENT_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ab6d726-61b5-4ab4-89ed-9f1fabd77b93
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1f565a97-86b2-4e14-80c4-a8893d16f1af
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: ETHNIC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4528bfd5-7784-49f9-85ce-44023b79d8bc
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7da44e0-dcdf-4492-b425-8add3505fdec
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: ETHNIC_CODE_2
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17ead1b0-bf20-49ec-a7ff-59b9a42dd7b3
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6562007c-c2b1-4fae-b547-b13dc0d25936
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(2)
        defaultValue: ""
        description: ""
        name: ETHNIC_CODE_3
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c9ba7d8d-ea86-4ab8-a931-779a87a3af3a
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3216709d-7096-4379-8244-41e15564cea6
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: PRIORITISED_ETHNIC_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66065613-21fb-4ff6-b402-92a94d07059f
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf76d779-2a90-4bd0-b013-b8d9854bdaac
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: OCCUPATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b1631dbb-0d44-40f6-b29e-8493f684bdbb
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: |-
              CASE WHEN occupation_code = '999999' THEN ''
                          ELSE occupation_code
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf2acc58-06bf-4a5c-aeef-56a0d151bc7b
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: OCCUPATION_FREE_TEXT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77bf3825-211b-4121-8c62-403d6c3f7ecc
                stepCounter: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
            transform: |-
              CASE WHEN occupation_free_text IN ('Not Stated','Not Specified','null') THEN ''
                          ELSE occupation_free_Text
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aee3d34b-4dba-482c-af5e-6abbba79396d
          stepCounter: 0d806481-eb0f-4fe5-b0ca-cda5c87eeda2
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_NMDS_DHB_EVENTS_ALL: aa5b5f9e-6c4c-42f3-9b07-2ebe14b90a78
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_NMDS_DHB_EVENTS_ALL
        join:
          joinCondition: FROM {{ ref('TGT','L_NMDS_DHB_EVENTS_ALL') }}
        name: S_MOH_PATIENT
        noLinkRefs: []
  name: S_MOH_PATIENT
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
