fileVersion: 1
id: 615199fd-bd70-435c-a964-70ba73476522
name: S_CONTRACT_ACTIVITY_INPATIENT_NNPAC_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5555649-003f-486d-ada7-90e64d20f029
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Generated column used to join to correct Price Volume Schdule Line
        name: PROVIDER_FUNDER_SPLIT
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: "'Provider'"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e1d2b710-9127-4100-b1aa-c02297f6f3e9
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Identifier for mapping rule that allocates the purchase unit
        name: PUC_MAP_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ce43525-4831-462c-990c-000ae6ec9f76
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7b2632cd-2491-467f-b2b9-0eaea67d6139
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: RESPONSIBILITY_CENTRE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28a2ff3b-5729-4ac7-adac-fa3742fadb5f
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 826bd0d2-7ba9-44b5-8549-0c668eda8d29
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(3)
        defaultValue: ""
        description: s_in_patient_event_05.discharge_specialty_reference_no=dim_discharge_specialty.discharge_specialty_reference_no
        name: HEALTH_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52835f9f-4af2-4514-8cbf-e79f91a677f1
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fffe7ad0-3c72-4c13-b81f-9ad54231c1b8
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: FACILITY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58a79f9-b36f-4d77-96b1-8522082fb8f7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 957ddcf4-7503-4320-a3c6-4019a838e97a
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: REPORTING_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16dc0aad-1ea6-4d7a-b055-9cdaa6d56a10
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: SOURCE_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98c9bdfa-1455-4c81-8336-1fc71694c387
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5273a3f-898d-4664-b71a-08efe08819ec
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: FUNDED_EVENT_ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98c9bdfa-1455-4c81-8336-1fc71694c387
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6b96527-67d3-4933-9ea4-5015e0ef4a09
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: EVENT_ENCOUNTER_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7fcf5f43-b303-4c9d-a7b1-7e649a7116f2
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db64010d-24c4-4fef-97fa-4dbd288f22e7
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Patient National Health Index (NMPI)
        name: NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 01c61f5c-21f8-498c-8a9a-3bf9fc714db7
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30c58c01-45ca-4f63-9e0b-1667e2036b51
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_05.patient_reference_no=dim_patient.patient_reference_no
        name: DIM_PATIENT_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2690c1e2-0c8f-4db2-922d-c7269b52431d
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a31c22e0-3145-42d7-b70a-9109465e07c1
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: ADMIN_CATEGORY_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09e37554-14e7-4bb2-a32b-80424b9bed75
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: CONTRACT_ADMIT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d98142f0-f261-4055-ad8c-581c6636e853
                stepCounter: 04c42cb2-f015-4d9e-ae6d-9feed9f13b97
            transform: "'OTHER'"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80085be9-64da-40b4-932e-ea3adbbe814d
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: ADMISSION_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d98142f0-f261-4055-ad8c-581c6636e853
                stepCounter: 04c42cb2-f015-4d9e-ae6d-9feed9f13b97
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e0fb23-b7bf-46e7-ab9b-8e9c11e66622
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: IDF_CLASS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b013aae2-00f1-4e2e-89ce-cac5b973a1bd
                stepCounter: 330ad0aa-b8b1-4da9-ab37-b4fe8f889452
            transform: |-
              CASE WHEN dim_domicile.IDF_class = 'Unknown' THEN 'Non-IDF'
                          ELSE dim_domicile.IDF_class
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f08cdcf6-cac4-4cdf-ac7e-8a308d920466
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: NVARCHAR(30)
        defaultValue: ""
        description: ""
        name: DOMICILE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3978b2dc-2299-422d-a614-f8a65504fa1f
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3f76e39-a1f3-4a3c-a44b-6ba1a19f7e14
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b113a0ee-c39c-4645-b322-d6fc9e8e91db
                stepCounter: f0fafd40-0f27-49a1-9550-5ecbe8b1e50f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fa78c130-8b53-472f-b438-38aefb8024eb
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: NUMERIC(19,5)
        defaultValue: ""
        description: ""
        name: PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: '1'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9f3e493-1696-490d-9199-a014993e2ee9
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: NUMERIC(19,5)
        defaultValue: ""
        description: ""
        name: ESTIMATED_PURCHASE_UNIT_VOLUME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: '0'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2da95eb6-c423-49b7-842d-b0dad0d64cb5
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_in_patient_event_05.patient_age_on_arrival_years=dim_age_group.age_years
        name: DIM_AGE_GROUP_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 91011d16-439c-4ea3-a96d-0a6e6798c1fe
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Generated artificial key
        name: DIM_PLANNED_CARE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: '0'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6d87411-5a8f-4b40-9a1f-88742a9c9918
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: DRG_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: 'NULL'
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9fa3da0d-f73a-4c19-8cd9-52edd9d14172
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: CLINICIAN_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9408ed27-1a76-41c8-851e-98ece900d25a
          stepCounter: 615199fd-bd70-435c-a964-70ba73476522
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: source_system
        name: SOURCE_SYSTEM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'iPM-IP-NNPAC'"
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT 'Provider' provider_funder_split,
                   s_in_patient_event_05.PUC_map_id,
                   s_in_patient_event_05.responsibility_centre_code,
                   s_in_patient_event_05.discharge_health_specialty_code,
                   s_in_patient_event_05.hospital_id,
                   s_in_patient_event_05.disch_date,
                   s_in_patient_event_05.event_encounter_id,
                   s_in_patient_event_05.event_encounter_id,
                   s_in_patient_event_05.event_encounter_type_code,
                   s_in_patient_event_05.patient_NHI,
                   s_in_patient_event_05.dim_patient_key,
                   s_in_patient_event_05.adcat_refno,
                   'OTHER' contract_admit_type,
                   s_in_patient_event_05.admission_type_code,
                   IIF(NULLIF(dim_domicile.IDF_class, 'Unknown') IS NULL, 'Non-IDF', dim_domicile.IDF_class) IDF_class,
                   s_in_patient_event_05.domicile_code,
                   s_in_patient_event_05.purchase_unit_code,
                   1 purchase_unit_volume,
                   0 estimated_purchase_unit_volume,
                   IFNULL(dim_age_group.dim_age_group_key, 0) dim_age_group_key,
                   0 dim_planned_care_key,
                   convert(varchar(4), NULL) DRG_Code,
                   COALESCE(s_in_patient_stay_05.episode_proca_refno, s_in_patient_stay_05.stay_proca_refno) clinician_reference_no,
                   'iPM-IP-NNPAC' source_system
              FROM s_in_patient_event_05
              LEFT OUTER JOIN s_in_patient_stay_05
                ON s_in_patient_stay_05.event_encounter_id = s_in_patient_event_05.event_encounter_id
               AND s_in_patient_stay_05.event_stay_seq_num = s_in_patient_stay_05.event_stay_count
              LEFT OUTER JOIN dim.dim_domicile
                ON s_in_patient_event_05.domicile_code = dim_domicile.domicile_code
               AND s_in_patient_event_05.admit_date BETWEEN dim_domicile.dss_start_date AND dim_domicile.dss_end_date
               AND s_in_patient_event_05.disch_date <= CAST(GETDATE() AS date)
             INNER JOIN dim.dim_intended_management_type
                ON s_in_patient_event_05.inmgt_refno = dim_intended_management_type.intended_management_type_reference_no
               AND s_in_patient_event_05.disch_date <= CAST(GETDATE() AS date)
              LEFT OUTER JOIN dim.dim_age_group
                ON s_in_patient_event_05.patient_age_on_arrival_years = dim_age_group.age_years
             WHERE [intended_management_type_code] = 'OP'
        dependencies: []
        join:
          joinCondition: None
        name: S_CONTRACT_ACTIVITY_INPATIENT_NNPAC_V
        noLinkRefs: []
  name: S_CONTRACT_ACTIVITY_INPATIENT_NNPAC_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
