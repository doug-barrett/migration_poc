fileVersion: 1
id: 03b9dcc8-43a3-47b0-a031-c44629a076bb
name: S_ED_STAY_18
operation:
  config:
    distinct: true
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: "New method of getting the data required in s_ed_stay_20"
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e667e32-f343-43cc-850d-52edb3cbc672
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Encounter unique identifier
        name: ENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8e08a28e-93fc-4605-85e2-0b787c491aed
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4f7fee8-6c1c-42b2-96f5-b0cf41a47022
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DECIMAL(10)
        defaultValue: ""
        description: Attendance ref no.
        name: AEATT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 32dc32a8-527a-4d9f-b8e6-ec44f2b05158
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8ed5535d-532c-4125-81f6-827878fe2ef5
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Patient ref no.
        name: PATNT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7113259e-4bae-4f9c-a4c1-8ed052dc0cad
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 706583c9-7572-4bd9-9b86-f53897785f4e
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient arrived
        name: ARRIVED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02eb4fe2-4949-45a6-86c1-4de3140e4edb
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f297664-dcb5-4608-b214-a8c9c9659629
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient departed
        name: DEPARTED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 51367620-44f1-4bf8-a7fc-6c0899ca03c5
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7470df70-ff29-4f8e-874b-2f7c7ee325ba
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: NUMERIC(10)
        defaultValue: ""
        description: PIMS ward stay ref no
        isBusinessKey: true
        name: AESTY_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2722b90-f540-46bd-b666-4a3cb8529eb7
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c8ba470-105e-45fc-861c-30b32fc5bbf9
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Set start_date to arrived_date because only attendances with a single stay are loaded via the Red generated update proc.
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02eb4fe2-4949-45a6-86c1-4de3140e4edb
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dee1f6dd-d790-4ae6-b294-c86c234fb483
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Location stay end date and time
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7721f11-dc9c-496f-9636-7ce59845acbc
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: IIF(ROW_COUNT = 1, departed_date, NULL)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 86d4fd48-46bb-41b7-bb17-280792873c6e
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time seen by professional carer
        name: SEEN_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c2d6e64-4cc1-42f4-bbbd-5755d8d12751
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ef5d0d2-9134-4084-a9cf-edfc35c3228e
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS service point ref no
        name: SPONT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e87be8c-bd7a-45d5-96ab-c92e21e8899d
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c738b8d4-48fa-4658-b833-61777fd28dfd
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Location of stay.
        name: LOCATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ca8d71f4-865e-45f6-9768-f9c48ae9e76f
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aeb13464-5183-418f-acab-854e8778d3f6
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: PIMS specialty ref no
        name: SPECT_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb1d8428-1260-4e99-8e19-b0d1a17a5dbe
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a577478e-ce33-4f96-999f-a5dc986d2ffb
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Specialty of the ward.
        name: SPECIALTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 99b3ffe5-93d9-4d27-8c6e-2e1248abbee1
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd7a4de4-8724-42ab-a12f-d0e70a55fb39
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time patient transferred to a new specialty
        name: SPECT_XFER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 54dbb55c-20e5-41e3-abf2-20c15b7f49a4
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 288d5420-22cf-4051-8638-faf052309c60
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Reference_Number
        name: PROCA_REFNO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4b2ad75-4e84-459f-9b29-ccfa952f14a6
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eebfdf3f-b1b5-4ca2-ac0f-cde02a3e3d05
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Clinician associated with the stay
        name: CLINICIAN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3925589-33a6-4b42-82d0-7f3098aab469
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 480d0c12-f553-4643-a272-480440a78c0e
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Number of events for the encounter
        name: ROW_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6aa02f9b-4d1a-465d-9e60-d34435da3b62
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77e3d1e9-cff3-48a7-801c-b56f99ed982a
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Updated by custom_update_s_ed_stay_20 and varies with sort run number
        name: ROW_NUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 79ee5087-00eb-4d77-9132-5d1885716404
                stepCounter: 19f97281-8cc4-4660-83be-6049689bc9c9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d70e06f9-29b9-4834-8f4d-09a2503bdc25
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Which sort sequence (1-7) used when calculating stay start/end dates for the encounter. Can be set to 1 if there is only 1 ED stay row.
        name: SORT_REF
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: IIF(ROW_COUNT = 1, 1, NULL)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25846090-6611-4655-80f6-a86bacb0fa00
          stepCounter: 03b9dcc8-43a3-47b0-a031-c44629a076bb
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: S_ED_STAY_10
        join:
          joinCondition: |-
            FROM s_ed_stay_10
             WHERE ROW_COUNT = 1
        name: S_ED_STAY_18
        noLinkRefs: []
  name: S_ED_STAY_18
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
