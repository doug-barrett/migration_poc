fileVersion: 1
id: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 20855136-788f-4d50-9926-c30c52b91ec6
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 07f9a1dd-1617-4994-b730-bf384d2c8bb9
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a65d1a61-6715-4f55-a95e-67631c33bc25
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f81f82d5-0d7e-4d99-945d-982d63d2e236
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f6eb1416-15c7-49f6-8ac8-891bcf4aa920
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3c5f25b2-67df-4dc9-89a4-ad2548787fcb
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c3d341a3-fa37-4551-ad81-57692400e28a
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0db02bd-1d90-4c6f-8c17-39264d5b28b0
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98ae85b2-2264-429e-9e0c-2811005d50bf
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1471ae3-5ecf-40ef-b1dc-eb43b9c90e77
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: adb958fe-74b4-4b57-9470-cae650c877da
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06d14702-b0c6-437f-bbbf-67c46504787d
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1057471b-68d7-4523-942b-83deb6fe3c22
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e5cc25fa-3817-4a8d-b222-f13046708020
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd14fa10-d67f-4a02-b88d-7bac667c1816
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16b56dd1-3624-4130-9dd3-6ea4914c9da9
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a6f2217c-d84e-477a-b23f-774a01b3c27f
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dca90348-5ffd-47ea-91da-0afe1fb86af5
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e8b4da52-36de-4a52-b71b-4c0f7ec6ec19
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a83c28c-c85e-4362-ad5d-fb6fa6d5ee06
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: efe6c73b-b0c4-4560-bc49-469e74f81968
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78f8dcb1-96c7-4541-b3a1-4e0ac20c1e68
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6215b810-61ca-4f5d-8053-12fab3f8080c
          stepCounter: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e2461b3f-8900-4460-9da7-dc1b4d0593bc
                stepCounter: a23239e4-617a-4ab9-a42c-1fd9220b7fb3
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW: 139d0abb-dc4c-4046-b0ef-0bab931ed5b1
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW') }} AS SELECT c.wellidb AS uwi,
                   c.completionname AS name ,
                   p.dttmstart AS period ,
                   p.durdown * 24 AS hours_down ,
                   p.durop * 24 AS hours_on ,
                   p.volprodgathhcliq AS prod_oil ,
                   p.volprodgathgas AS prod_gas ,
                   p.volprodgathwater AS prod_water ,
                   p.volnewprodallochcliq AS alloc_oil ,
                   p.volnewprodallocgas AS alloc_gas ,
                   p.volnewprodallocwater AS alloc_water ,
                   p.vollosthcliq AS lost_oil ,
                   p.vollostgas AS lost_gas ,
                   p.vollostwater AS lost_water ,
                   p.volinjectrecovgas AS inj_gas ,
                   p.volinjectrecovhcliq AS inj_oil ,
                   p.volinjectrecovwater AS inj_water ,
                   p.voldispsalegas AS sales_gas ,
                   p.voldispfuelgas AS fuel_gas ,
                   p.voldispflaregas AS flare_gas ,
                   p.voldispventgas AS vent_gas ,
                   round(p.volnewprodallochcliq * d.densityhcliq / 1000,2) tons_oil ,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(f.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvflownetheader f
             INNER JOIN DS_PRODVIEW.PVT_pvunitallocmonth p
                ON f.idflownet = p.idflownet
               AND f.syssecuritytyp = 'Germany'
               AND p.dttmstart < DATE_TRUNC('MONTH',CURRENT_TIMESTAMP)
             INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                ON p.idreccomp = c.idrec
              LEFT JOIN DS_PRODVIEW.PVT_pvunitliquiddensity d
                ON c.idrecparent = d.idrecparent
               AND d.dttm = (
                    SELECT MAX(dttm)
                      FROM DS_PRODVIEW.PVT_pvunitliquiddensity
                     WHERE idrecparent = c.idrecparent
                       AND dttm <= p.dttmend
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
        name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
