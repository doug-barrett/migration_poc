fileVersion: 1
id: 11d0f359-3400-4b2d-82e6-555a8a89f313
name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30db9f13-c338-4bc8-9435-5efe14ba2361
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: UWI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 24425677-fc6d-4134-a0cd-863dc6082117
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6485812-388c-4dd6-ac87-76ade7afc5bb
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3adaa0eb-633d-4bf3-bf05-f30154305879
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_DOWN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f8709c9-4b45-4a1e-baba-66e043f53861
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: HOURS_ON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b59e55d3-0123-444a-8c6d-78323c84b073
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c495d7b9-a5f4-4d1c-ad7a-fb4a4388726d
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32acead9-5f68-4cdf-9f80-4b274a2e1219
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: PROD_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02502c2d-1c39-440c-aa9c-b65329445326
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0299d9e-8a2f-423d-9537-a904b9a919ea
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a2c054f-f4e4-4176-9b6f-f7d54194f229
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: ALLOC_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4386546c-f011-4224-8340-98419185585b
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a44703c-b607-469e-b6b8-593ec8b72ec5
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 66be2a60-c8a8-4f50-9ac7-b3f74b86f99e
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: LOST_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5095ff06-1e8f-4ba8-980c-702f191916c6
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8b91db7-509a-42d8-9b06-369c523d7287
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc03b606-f977-4029-8227-d7a02afa7b19
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: INJ_WATER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc815231-7ae9-4c02-b5f0-30b7e22b3d3d
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: SALES_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a87d30b-5b44-4d93-8408-a26e1fb115f8
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FUEL_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25de4d10-35c2-4cec-b6cf-e49bc77b55ec
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: FLARE_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0466e554-c422-4848-aa90-e77ca401ac77
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: VENT_GAS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1d1edad-f7ae-4a99-9988-7ba6633bf6ed
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: DOUBLE(38)
        defaultValue: ""
        description: ""
        name: TONS_OIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f176397e-d8d6-4767-acb4-465a96dbb47c
          stepCounter: 11d0f359-3400-4b2d-82e6-555a8a89f313
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        name: BU_SF_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 748cdf05-5750-44bd-bb7a-77b0769f897d
                stepCounter: bd388a52-3d72-4c70-833d-7de7c6a8abd1
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW: 11d0f359-3400-4b2d-82e6-555a8a89f313
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW') }} AS SELECT c.wellidb AS uwi,
                   c.completionname AS name ,
                   p.dttmstart AS period ,
                   p.durdown * 24 AS hours_down ,
                   p.durop * 24 AS hours_on ,
                   p.volprodgathhcliq AS prod_oil ,
                   p.volprodgathgas AS prod_gas ,
                   p.volprodgathwater AS prod_water ,
                   p.volnewprodallochcliq AS alloc_oil ,
                   p.volnewprodallocgas AS alloc_gas ,
                   p.volnewprodallocwater AS alloc_water ,
                   p.vollosthcliq AS lost_oil ,
                   p.vollostgas AS lost_gas ,
                   p.vollostwater AS lost_water ,
                   p.volinjectrecovgas AS inj_gas ,
                   p.volinjectrecovhcliq AS inj_oil ,
                   p.volinjectrecovwater AS inj_water ,
                   p.voldispsalegas AS sales_gas ,
                   p.voldispfuelgas AS fuel_gas ,
                   p.voldispflaregas AS flare_gas ,
                   p.voldispventgas AS vent_gas ,
                   round(p.volnewprodallochcliq * d.densityhcliq / 1000,2) tons_oil ,
                   WS_EDW.PVIEW_SYSSECURITYTYP_VET_BU_ROLE(f.SYSSECURITYTYP) AS BU_SF_ROLE
              FROM DS_PRODVIEW.PVT_pvflownetheader f
             INNER JOIN DS_PRODVIEW.PVT_pvunitallocmonth p
                ON f.idflownet = p.idflownet
               AND f.syssecuritytyp = 'Germany'
               AND p.dttmstart < DATE_TRUNC('MONTH',CURRENT_TIMESTAMP)
             INNER JOIN DS_PRODVIEW.PVT_pvunitcomp c
                ON p.idreccomp = c.idrec
              LEFT JOIN DS_PRODVIEW.PVT_pvunitliquiddensity d
                ON c.idrecparent = d.idrecparent
               AND d.dttm = (
                    SELECT MAX(dttm)
                      FROM DS_PRODVIEW.PVT_pvunitliquiddensity
                     WHERE idrecparent = c.idrecparent
                       AND dttm <= p.dttmend
                   )
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PVIEW_PVT_PVUNITCOMP
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PVIEW_PVT_PVUNITCOMP') }}
        name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
        noLinkRefs: []
  name: VIEW_PVIEW_VRL_OFM_MONTHLY_GERMANY_VW
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
