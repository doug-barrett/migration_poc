fileVersion: 1
id: 907e85ce-895f-4e32-a9c4-01ec8aeed4db
name: VWSALESANDREVENUEUNMATCHEDKEYS
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70224e72-97e2-4cfd-b379-b8bf028033a4
          stepCounter: 907e85ce-895f-4e32-a9c4-01ec8aeed4db
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: LOADDATE
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90804914-fd75-4b38-b45f-3dc34affc1a5
          stepCounter: 907e85ce-895f-4e32-a9c4-01ec8aeed4db
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        name: KEYNAME
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 419d64dd-59f2-45b2-abb3-4e644f9f54f2
          stepCounter: 907e85ce-895f-4e32-a9c4-01ec8aeed4db
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: KEYCOUNT
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VWSALESANDREVENUEUNMATCHEDKEYS: 907e85ce-895f-4e32-a9c4-01ec8aeed4db
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('STAGE','VWSALESANDREVENUEUNMATCHEDKEYS') }}(\NLOADDATE, \NKEYNAME, \NKEYCOUNT \N) \NAS \NWITH CTE \N AS (
                    SELECT SUM(CASE WHEN ACCOUNTGEOGRAPHYKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTGEOGRAPHYKEY, \N SUM(CASE WHEN ACCOUNTHIERARCHYKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTHIERARCHYKEY, \N SUM(CASE WHEN ACCOUNTKEY = 0 THEN 1 ELSE 0 END) AS ACCOUNTKEY, \N SUM(CASE WHEN CONTRACTKEY = 0 THEN 1 ELSE 0 END) AS CONTRACTKEY, \N SUM(CASE WHEN DIRECTSALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS DIRECTSALESTERRITORYKEY, \N SUM(CASE WHEN FINANCIALSALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS FINANCIALSALESTERRITORYKEY , \N SUM(CASE WHEN ORGANIZATIONKEY = 0 THEN 1 ELSE 0 END) AS ORGANIZATIONKEY, \N SUM(CASE WHEN RECEIPTDATEKEY = 0 THEN 1 ELSE 0 END) AS RECEIPTDATEKEY, \N SUM(CASE WHEN REVENUEBUDGETFORCEIDDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETFORCEIDDETAILKEY, \N SUM(CASE WHEN REVENUEBUDGETFORCEIDDIRECTDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETFORCEIDDIRECTDETAILKEY, \N SUM(CASE WHEN REVENUEBUDGETPDDETAILKEY = 0 THEN 1 ELSE 0 END) AS REVENUEBUDGETPDDETAILKEY, \N SUM(CASE WHEN SALESTERRITORYKEY = 0 THEN 1 ELSE 0 END) AS SALESTERRITORYKEY, \N SUM(CASE WHEN SUPPLIERKEY = 0 THEN 1 ELSE 0 END) AS SUPPLIERKEY, \N SUM(CASE WHEN TRANSACTIONDATEKEY = 0 THEN 1 ELSE 0 END) AS TRANSACTIONDATEKEY, \N MAX(DSS_LOAD_DATE) AS LOADDATE \N \N
                      FROM STAGE.STAGESALESMERGE_ADDKEYS AS SMAK \N
                     WHERE ACCOUNTGEOGRAPHYKEY = 0 \N
                        OR ACCOUNTHIERARCHYKEY = 0 \N
                        OR ACCOUNTKEY = 0 \N
                        OR CONTRACTKEY = 0 \N
                        OR DIRECTSALESTERRITORYKEY = 0 \N
                        OR FINANCIALSALESTERRITORYKEY = 0 \N
                        OR ORGANIZATIONKEY = 0 \N
                        OR RECEIPTDATEKEY = 0 \N
                        OR REVENUEBUDGETFORCEIDDETAILKEY = 0 \N
                        OR REVENUEBUDGETFORCEIDDIRECTDETAILKEY = 0 \N
                        OR REVENUEBUDGETPDDETAILKEY = 0 \N
                        OR SALESTERRITORYKEY = 0 \N
                        OR SUPPLIERKEY = 0 \N
                        OR TRANSACTIONDATEKEY = 0
                   ) \N SELECT LOADDATE, \N KEYNAME, \N KEYCOUNT \N
              FROM CTE UNPIVOT(KEYCOUNT FOR KEYNAME IN(\N ACCOUNTGEOGRAPHYKEY , \N ACCOUNTHIERARCHYKEY , \N ACCOUNTKEY , \N CONTRACTKEY , \N DIRECTSALESTERRITORYKEY , \N FINANCIALSALESTERRITORYKEY, \N ORGANIZATIONKEY , \N RECEIPTDATEKEY , \N REVENUEBUDGETFORCEIDDETAILKEY, \N REVENUEBUDGETFORCEIDDIRECTDETAILKEY, \N REVENUEBUDGETPDDETAILKEY , \N SALESTERRITORYKEY , \N SUPPLIERKEY)) AS UNPVT \N
             ORDER BY KEYNAME
        dependencies: []
        join:
          joinCondition: '-- Nodes used in the SQL override:'
        name: VWSALESANDREVENUEUNMATCHEDKEYS
        noLinkRefs: []
  name: VWSALESANDREVENUEUNMATCHEDKEYS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
