fileVersion: 1
id: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
name: S_HEALTHCARE_PROFESSIONAL
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bf589f0-2b15-49cf-8520-ff40306e8cc7
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17ee3590-ed47-4b73-b22e-a6494f78e113
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef7a8f1d-075d-4ed6-b44e-d4ba5a7eb429
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Healthcare_Professional_Code
        name: HEALTHCARE_PROFESSIONAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02370e0f-eb58-45d0-a9a5-c2b7ac3886a1
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e48d69e-531c-4db0-8c7a-509091eec7fb
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Professional_Description
        name: HEALTHCARE_PROFESSIONAL_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6296d9fd-2174-4735-9a64-91716a27333a
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8223b546-c160-4f95-b810-574fd6291dbf
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Type_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_TYPE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 936205e4-1cfa-49f2-99c4-11ad4b46e80b
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e05298e3-d231-4691-82d5-c6521e439072
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Professional_Type_Code
        name: HEALTHCARE_PROFESSIONAL_TYPE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values1.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a10ed3b8-e76d-4864-8410-a24bdbb19683
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Professional_Type_Description
        name: HEALTHCARE_PROFESSIONAL_TYPE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values1.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50c955d5-8b12-42cf-9a02-e75f79f2109a
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Title_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_TITLE_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: acf469f5-4927-42f1-8073-5d44252dc9cd
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b373b924-55bb-4c29-bc17-c6e5aaacd346
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Professional_Title_Code
        name: HEALTHCARE_PROFESSIONAL_TITLE_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values2.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49e9ee36-7c12-4dc9-967f-0eb193231f1f
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Professional_Title_Description
        name: HEALTHCARE_PROFESSIONAL_TITLE_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values2.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d2e0694-e160-4467-83cc-e00483db7660
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Healthcare_Professional_Forename
        name: HEALTHCARE_PROFESSIONAL_FORENAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc6c938c-a71b-499a-9c59-c8a0d4f294b6
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1e8148e-f4b3-42f6-aaec-c9a42638b7ff
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(30)
        defaultValue: ""
        description: Healthcare_Professional_Surname
        name: HEALTHCARE_PROFESSIONAL_SURNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a82855bb-aaf9-4f64-b3dd-7bd7905c1405
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78328a71-48c3-410b-87a8-0d699a5b6b9a
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: healthcare_professional_fullname
        name: HEALTHCARE_PROFESSIONAL_FULLNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a82855bb-aaf9-4f64-b3dd-7bd7905c1405
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: IFNULL(surname,'') + (CASE WHEN surname IS NULL OR forename IS NULL THEN '' ELSE ', ' END) + IFNULL(forename,'')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ff0f58e-b3c9-485a-96d2-2be7dab147e1
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: Healthcare_Professional_Gender_Reference_Number
        name: HEALTHCARE_PROFESSIONAL_GENDER_REFERENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 59065181-c468-4565-ad47-a577c6a3f673
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72441d5e-c50a-4215-804a-1ebf14c1abf0
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Professional_Gender_Code
        name: HEALTHCARE_PROFESSIONAL_GENDER_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values3.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e43f187-0f0b-41ae-a3e8-786d8d25808d
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Professional_Gender_Description
        name: HEALTHCARE_PROFESSIONAL_GENDER_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values3.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb6687f3-bef6-4a4b-acb3-2808be66520d
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare__Qualifications
        name: HEALTHCARE_QUALIFICATIONS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2462ee0-f3e4-4746-97ed-6e22ba5a46ca
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: IFNULL(ds_pims_prof_carers.qualifications,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42801ffd-7381-4644-89ec-e9e8b4a015d1
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Registration_Code
        name: HEALTHCARE_REGISTRATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values4.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 301b9146-d09f-4ebc-a335-037da7dd7eb9
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Registration_Description
        name: HEALTHCARE_REGISTRATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values4.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5699da5d-982c-44b1-bbbc-ed398c775d97
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: Healthcare_Specialty_Code
        name: HEALTHCARE_SPECIALTY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values5.main_code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56f1ed5c-7be3-49ec-a230-15a7618d2d76
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(80)
        defaultValue: ""
        description: Healthcare_Specialty_Description
        name: HEALTHCARE_SPECIALTY_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: IFNULL(ds_pims_reference_values5.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f18bbf2-1bca-4721-bdac-b19582366bfa
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Healthcare_Organisation_Code
        name: HEALTHCARE_ORGANISATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c4ef5551-f136-424e-8175-4eda8e012f1e
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: IFNULL(ds_pims_health_organisations.main_ident,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3e8b461-00e5-4e75-a9d6-9259e74913cc
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Healthcare_Organisation_Description
        name: HEALTHCARE_ORGANISATION_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94cef180-84bd-4860-90c1-5c9f2654d5f0
                stepCounter: 4f45d370-f46b-4d30-8837-83a353835394
            transform: IFNULL(ds_pims_health_organisations.description,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 14aff225-1536-46e5-8221-0eacafbad012
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: Healthcare_Team_Code
        name: HEALTHCARE_TEAM_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24376428-5a3b-4af4-a1bb-b4296f57b95b
                stepCounter: 64dbb92c-5b21-4d0f-9709-89050a8e1d72
            transform: IFNULL(ds_pims_staff_teams.code,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d474b2af-5551-4649-8443-9f6c81fabf68
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(20)
        defaultValue: ""
        description: Healthcare_Team_Name
        name: HEALTHCARE_TEAM_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31e6883c-851a-451b-b17d-95aa4b5c02a4
                stepCounter: 64dbb92c-5b21-4d0f-9709-89050a8e1d72
            transform: IFNULL(ds_pims_staff_teams.name,'N/A')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5a8530a5-3f91-415b-8b6a-7595c73d154d
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Healthcare_Professional_Validity_Start_Date
        name: HEALTHCARE_PROFESSIONAL_VALIDITY_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 50c92409-129a-410f-bc57-0bc7cdf88a2c
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 43fe6ce3-4f71-408a-8484-64d57c7033e0
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Healthcare_Professional_Validity_End_Date
        name: HEALTHCARE_PROFESSIONAL_VALIDITY_END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e56334e6-d0fc-4df4-b667-7331b9bd27c8
                stepCounter: d42ee6db-29e1-4d7b-88a3-e45c058528e1
            transform: IFNULL(ds_pims_prof_carers.end_dttm,CONVERT(datetime,'20440630'))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e889c67f-0428-4963-aeda-a2a6065e70dc
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Date and time the row was updated in the data warehouse.
        isSystemUpdateDate: true
        name: DSS_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f32b1e43-aee9-4e4c-88e4-ef7ef180abdd
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: MAIN_EMPLOYEE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7d78ce30-8cba-49fb-b061-88c9a3bc94ea
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: HPI_PROFESSIONAL_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c942f10-bf6d-4ab5-ad51-8eabf3127be5
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: ""
        name: HPI_COMMON_PERSON_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b9eff32-3ce3-4fa9-94de-549cd1212e6d
          stepCounter: 9d52c255-1f5a-4b34-8751-f9bf5bad2246
        config: {}
        dataType: VARCHAR(25)
        defaultValue: ""
        description: clinical_portal_username
        name: CLINICAL_PORTAL_USERNAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: DS_PIMS_PROF_CARERS
        join:
          joinCondition: |-
            FROM ds_pims_prof_carers
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values1
                ON ds_pims_reference_values1.rfval_refno = ds_pims_prof_carers.prtyp_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values2
                ON ds_pims_reference_values2.rfval_refno = ds_pims_prof_carers.title_refno
              LEFT OUTER JOIN ds_pims_reference_values ds_pims_reference_values3
                ON ds_pims_reference_values3.rfval_refno = ds_pims_prof_carers.sexxx_refno
              LEFT OUTER JOIN (
                    SELECT proca.proca_refno,
                           rfval.main_code,
                           rfval.description
                      FROM (
                            SELECT proca_refno,
                                   cityp_refno,
                                   ROW_NUMBER() OVER (PARTITION BY proca_refno ORDER BY modif_dttm DESC) AS rownum
                              FROM ds_pims_prof_carer_ids
                           ) proca
                     INNER JOIN ds_pims_reference_values rfval
                        ON rfval.rfval_refno = proca.cityp_refno
                       AND rfval.rfvdm_code = 'CITYP'
                       AND proca.rownum = 1
                   ) ds_pims_reference_values4
                ON ds_pims_reference_values4.proca_refno = ds_pims_prof_carers.proca_refno
              LEFT OUTER JOIN (
                    SELECT proca.proca_refno,
                           rfval.main_code,
                           rfval.description
                      FROM (
                            SELECT proca_refno,
                                   cstyp_refno,
                                   ROW_NUMBER() OVER (PARTITION BY proca_refno ORDER BY modif_dttm DESC) AS rownum
                              FROM ds_pims_prof_carer_specialties
                           ) proca
                     INNER JOIN ds_pims_reference_values rfval
                        ON rfval.rfval_refno = proca.cstyp_refno
                       AND rfval.rfvdm_code = 'CSTYP'
                       AND proca.rownum = 1
                   ) ds_pims_reference_values5
                ON ds_pims_reference_values5.proca_refno = ds_pims_prof_carers.proca_refno
              LEFT OUTER JOIN (
                    SELECT proca.proca_refno,
                           heorg.main_ident,
                           heorg.description
                      FROM (
                            SELECT proca_refno,
                                   heorg_refno,
                                   ROW_NUMBER() OVER (PARTITION BY proca_refno ORDER BY modif_dttm DESC) AS rownum
                              FROM ds_pims_prof_carer_health_orgs
                           ) proca
                     INNER JOIN ds_pims_health_organisations heorg
                        ON proca.heorg_refno = heorg.heorg_refno
                       AND proca.rownum = 1
                   ) ds_pims_health_organisations
                ON ds_pims_health_organisations.proca_refno = ds_pims_prof_carers.proca_refno
              LEFT OUTER JOIN (
                    SELECT proca.proca_refno,
                           steam.code,
                           steam.name
                      FROM (
                            SELECT proca_refno,
                                   steam_refno,
                                   ROW_NUMBER() OVER (PARTITION BY proca_refno ORDER BY modif_dttm DESC) AS rownum
                              FROM ds_pims_prof_carer_staff_teams
                           ) proca
                     INNER JOIN ds_pims_staff_teams steam
                        ON proca.steam_refno = steam.steam_refno
                       AND proca.rownum = 1
                   ) ds_pims_staff_teams
                ON ds_pims_staff_teams.proca_refno = ds_pims_prof_carers.proca_refno
        name: S_HEALTHCARE_PROFESSIONAL
        noLinkRefs: []
  name: S_HEALTHCARE_PROFESSIONAL
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
