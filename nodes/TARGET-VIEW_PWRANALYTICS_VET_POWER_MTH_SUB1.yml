fileVersion: 1
id: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 38b9455e-ba79-4d9d-89ad-78386468e3a3
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(13)
        defaultValue: ""
        description: ""
        name: COUNTRY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f89d9679-6223-41dd-8fea-535b66574748
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a9272e7-3605-4dfb-aeed-d41f3b152b84
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(14)
        defaultValue: ""
        description: ""
        name: LANGUAGE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0876fdb3-22db-4e6e-a169-89bf29b6f980
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CURRENCY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 185190b9-7a26-4b18-afd9-756415e898c5
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: UTILITY_PROVIDER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e36bb627-ed76-4729-843c-9dbc873bc1d5
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: INVOICE_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 36d64c74-395e-4075-b86c-96498e166764
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ACCOUNT_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1177199-abeb-41e9-aaf1-367a0ec11d54
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DELIVERY_POINT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 695b9b05-9f23-4f75-b651-e4f4a1c0fcf4
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: CONSUMPTION_MONTH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e35b211e-e61b-452f-b44a-5f92213fc329
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: METER_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c390954-c084-42d3-bca5-2a2a4f4543f4
                stepCounter: 94be6238-6ff6-49a5-82af-e790548c593d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1d2246db-5ae7-4ce1-b8ad-05443341e9b5
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10d3b102-8084-4e24-8d56-fd3f39b3ba02
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13bb4546-c277-4520-99a3-e91f5c7d8639
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15d21888-7a70-45c5-b829-31e98df6a850
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 450409a2-8c83-4826-a802-1f1d98e68341
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67be0f3b-b4ff-4bc8-91db-9ad44b3c6d56
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REGISTERED_DEMAND_KVA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b6ce237-027a-47b2-8656-1e5a9e4859e6
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILLED_DEMAND_KVA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9321601-fe5c-4268-9b06-a8d4c8ca5ef6
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15e358c1-19be-4ecf-a9ab-632ce2e42d87
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5face2d9-3dd5-4164-b5b2-1825f945451f
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 772fa2fa-d358-425e-b9bc-0d7c2947e72c
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a1c9352-7a79-4902-9450-86e926623804
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_AMOUNT_DUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5dfec7bc-5eb4-41f5-8cf8-e7cb02e1da62
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SUBTOTAL
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2008a4ec-a19d-4359-b811-9f0d7c2e111e
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a1a455a-9c15-43ae-92c3-8ddb296af56a
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a80379e-0aad-4787-ab53-1afd309e8bda
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2336c218-a008-4ccc-a83a-6a43d1b75662
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BASIC_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72ffce4e-837c-4e9f-bd17-77a89b15fcd8
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DEMAND_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b63a2b0b-9327-436b-805e-18cb652960b8
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REACTIVE_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 04a1489d-c158-4b34-b778-c1952d74cb12
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TRANSMISSION_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8910b38d-1eee-4428-9a5b-1fe34827a550
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OTHER_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08e70b30-7fae-4da0-b410-ce641c0e32f6
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SERVICE_ADDRESS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81824638-48d8-4de1-992e-d4ca912b0c55
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5bf2633-77c0-47fa-82d7-714f78c63f04
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX_GST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68ea2d26-e811-42d8-bb85-264d40f06dd0
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEDERAL_TAX_GST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9609e4a-1b78-42ee-b315-1b6db359acf4
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b650244a-35b1-43ab-9b25-40302e80c2b3
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: MST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3d13195f-3c32-40d2-bcb0-6db55b19527e
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VAT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a75db683-4686-4501-8e98-86464fec8e30
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: METER_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5a94d871-6284-4b19-a1fd-ff5c86c3a9bc
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_MULTIPLIER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2139df3f-61bb-4f35-b953-b661cd8cd0db
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84949c0f-7807-411b-9ef2-f65090c40832
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: POWER_FACTOR
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 50e7173c-7bd5-4037-b039-3c8d53d59744
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_DEMAND
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 627d5a9e-929d-4b97-8150-0400cd324cfe
          stepCounter: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_DAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1: c47b3f2d-2046-48e5-ba01-bf9596e10fd6
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1') }} AS WITH PW1 AS (
                    SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Transalta' AS Utility_Provider ,
                           CAST(CUST_NUMBER AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS nvarchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS nvarchar(225)) AS Delivery_Point ,
                           cast(SETTLEMENT_PERIOD AS date) AS Consumption_Month ,
                           cast(REPLACE(LTRIM(REPLACE(METER_NUMBER, '0', ' ')), ' ', '0') AS nvarchar(50)) AS Meter_Number ,
                           cast(COST_CENTRE AS nvarchar(255)) AS Cost_Center ,
                           cast(HIERARCHY_AREA AS nvarchar(50)) AS Area ,
                           cast(ENERGY_TOTAL AS float) AS Total_Consumption_kWh ,
                           cast(ENERGY_TOTAL AS float) AS Peak_Consumption_kWh ,
                           cast(UNACCOUNTED_ENERGY_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(REGISTERED_DEMAND AS float) AS Registered_Demand_kVA ,
                           cast(BILL_DEMAND AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(SUBTOTAL+TOTAL_ENERGY_COSTS+TRANSALTA_FEE+LOCAL_ACCESS_FEE +LINE_LOSSES_COST +TRADING_CHARGE+DELIVERY_CHARGES+PRIOR_PERIOD_OTHER+ GOA_UTILITY_COMMODITY_REBATE AS float) AS Total_Amount_Due ,
                           cast(SUBTOTAL AS float) AS Subtotal ,
                           cast(TOTAL_ENERGY_COSTS AS float) AS Energy_Cost ,
                           cast(ENERGY_FIXED_PRICE_COST AS float) AS Peak_Energy_Cost ,
                           cast(UNACCOUNTED_ENERGY_COST AS float) AS Off_Peak_Energy_Cost ,
                           cast(LOCAL_ACCESS_FEE AS float) AS Basic_Cost ,
                           cast(0 AS float) AS Demand_Cost ,
                           cast(TRADING_CHARGE AS float) AS Reactive_Cost ,
                           cast(LINE_LOSSES_COST AS float) AS Transmission_Cost ,
                           cast(PRIOR_PERIOD_OTHER AS float) AS Other_Cost ,
                           cast(SITE_LOCATION AS nvarchar(50)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('Smart' AS nvarchar(50)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast('' AS nvarchar(50)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(REGISTERED_DEMAND AS float) AS Peak_Demand ,
                           cast(30 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_TRANSALTA
                 UNION ALL SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Translata' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(REPLACE(LTRIM(REPLACE(METER_NUMBER, '0', ' ')), ' ', '0') AS varchar(100)) AS Meter_Number ,
                           cast(COST_CENTRE AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(TOTAL_KWH AS float) AS Total_Consumption_kWh ,
                           cast(FLOATING_KWH AS float) AS Peak_Consumption_kWh ,
                           cast(OTHER_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(METERED_DEMAND_KW AS float) AS Registered_Demand_kVA ,
                           cast(BILLING_DEMAND_KW AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(TOTAL_AMOUNT AS float) AS Total_Amount_Due ,
                           cast(TOTAL_AMOUNT AS float) AS Subtotal ,
                           cast(0 AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           cast(ADMIN_FEE_AMOUNT AS float) AS Basic_Cost ,
                           cast(TARIFF_AMOUNT AS float) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(0 AS float) AS Transmission_Cost ,
                           cast(OTHER_AMOUNT AS float) AS Other_Cost ,
                           cast(LOCATION AS varchar(100)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('' AS varchar(100)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast(RATE_CODE AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(METERED_DEMAND_KW AS float) AS Peak_Demand ,
                           cast(30 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_CAMPUS_ENMAX
                 UNION ALL SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'ENMAX' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(0 AS varchar(100)) AS Meter_Number ,
                           cast('' AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(TOTAL_KWH AS float) AS Total_Consumption_kWh ,
                           cast(FLOATING_KWH AS float) AS Peak_Consumption_kWh ,
                           cast(OTHER_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(METERED_DEMAND_KVA AS float) AS Registered_Demand_kVA ,
                           cast(BILLING_DEMAND_KVA AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(TOTAL_COST AS float) AS Total_Amount_Due ,
                           cast(TOTAL_COST AS float) AS Subtotal ,
                           cast(FLOATING_COST AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(FIXED_COST AS float) AS Off_Peak_Energy_Cost ,
                           cast(ADMIN_FEE_COST AS float) AS Basic_Cost ,
                           cast(TARIFF_COST AS float) AS Demand_Cost ,
                           cast(MISC_COST AS float) AS Reactive_Cost ,
                           cast(GENERATION_COST AS float) AS Transmission_Cost ,
                           cast(OTHER_COST AS float) AS Other_Cost ,
                           cast(LOCATION AS varchar(100)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('BASIC' AS varchar(100)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast('' AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(METERED_DEMAND AS float) AS Peak_Demand ,
                           cast(0 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_ENMAX
                 UNION ALL SELECT 'Canada' AS Country ,
                           'SASKATCHEWAN' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Manitoba Hydro' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           right(cast(REPLACE(ACCOUNT_NUMBER, ' ', '') AS varchar(225)),7) AS Account_Number ,
                           right(cast(REPLACE(ACCOUNT_NUMBER, ' ', '') AS varchar(225)),7) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(cast(METER_NUMBER AS bigint) AS varchar(100)) AS Meter_Number ,
                           cast('' AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(CONSUMPTION_KWH AS float) AS Total_Consumption_kWh ,
                           cast(0 AS float) AS Peak_Consumption_kWh ,
                           cast(0 AS float) AS Off_Peak_Consumption_kWh ,
                           cast(REGISTERED_DEMAND AS float) AS Registered_Demand_kVA ,
                           cast(BILLED_KVA AS float) AS Billed_Demand_kVA ,
                           DATE_FROM_PARTS(nullif(cast(left(cast(cast(CURRENT_READDATE AS int) AS varchar),4) AS int),0) ,nullif(cast(right(left(cast(cast(CURRENT_READDATE AS int) AS varchar),6),2) AS int),0) ,nullif(cast(right(cast(cast(CURRENT_READDATE AS int) AS varchar),2) AS int),0)) AS Current_Meter_Read_Date ,
                           cast(METER_READING AS int) AS Current_Meter_Read ,
                           DATE_FROM_PARTS(nullif(cast(left(cast(cast(PREVIOUS_READDATE AS int) AS varchar),4) AS int),0) ,nullif(cast(right(left(cast(cast(PREVIOUS_READDATE AS int) AS varchar),6),2) AS int),0) ,nullif(cast(right(cast(cast(PREVIOUS_READDATE AS int) AS varchar),2) AS int),0)) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(AMOUNT_DUE AS float) AS Total_Amount_Due ,
                           cast(ENERGY_COST AS float)+cast(ENERGY_COST AS float)+cast(BASIC_COST AS float)+cast(DEMAND_COST AS float)+cast(DISTRIBUTION_COST AS float) +cast(TRANSPORTATION_COST AS float)+cast(GST AS float)+cast(CARBON_GTAX AS float)+ cast(PROVINCIAL_TAX AS float) AS Subtotal ,
                           cast(ENERGY_COST AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           cast(BASIC_COST AS float) AS Basic_Cost ,
                           cast(DEMAND_COST AS float) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(TRANSPORTATION_COST AS float) AS Tranmission_Cost ,
                           cast(DISTRIBUTION_COST AS float) AS Other_Cost ,
                           cast(SERVICE_ADDRESS AS varchar(100)) AS Service_Address ,
                           cast(CARBON_GTAX AS float) AS Carbon_Tax ,
                           cast(GST_CARBONTAX AS float)AS Carbon_Tax_GST ,
                           cast(GST AS float) AS Federal_Tax_GST ,
                           cast(PROVINCIAL_TAX AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(GST AS float) AS VAT ,
                           cast(TYPE AS varchar(100)) AS Meter_Type ,
                           cast(MULTIPLIER AS float) AS Bill_Multiplier ,
                           cast(RATE AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(PEAK_DEMAND AS float) AS Peak_Demand ,
                           cast(DAYS AS float) AS Bill_Days
                      FROM DS_POWER.CBU_MANITOBA_HYDRO
                 UNION ALL SELECT 'Canada' AS Country ,
                           'SASKATCHEWAN' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'SaskPower' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           CASE WHEN SKPB.CONTRACT_ACCOUNT = '510008584946' THEN '510004891535'
                                ELSE CAST(SKPB.CONTRACT_ACCOUNT AS VARCHAR(255))
                                 END AS Account_Number ,
                           CASE WHEN SKPB.CONTRACT_ACCOUNT = '510008584946' THEN '510004891535'
                                ELSE CAST(SKPB.CONTRACT_ACCOUNT AS VARCHAR(255))
                                 END AS Delivery_Point ,
                           CASE WHEN DATEDIFF(MONTH, SKPB.PREVIOUS_READ_DATE, SKPB.CURRENT_READ_DATE) = 1 THEN CASE WHEN DATEDIFF(DAY, SKPB.PREVIOUS_READ_DATE, DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE)) > DATEDIFF(DAY, DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE), SKPB.CURRENT_READ_DATE) + 1 THEN DATE_TRUNC('MONTH', SKPB.PREVIOUS_READ_DATE) ELSE DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE) END
                                ELSE DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE)
                                 END AS CONSUMPTION_MONTH ,
                           cast(Device AS varchar(100)) AS Meter_Number ,
                           max(cast('' AS varchar(100))) AS Cost_Center ,
                           max(cast('' AS varchar(100))) AS Area ,
                           sum(TOTAL_CONSUMPTION) AS Total_Consumption_kWh ,
                           cast(0 AS float) AS Peak_Consumption_kWh ,
                           cast(0 AS float) AS Off_Peak_Consumption_kWh ,
                           sum(IFNULL(REGISTER_DEMAND,0)) AS Registered_Demand_kVA ,
                           sum(IFNULL(BILLED_DEMAND,0)) AS Billed_Demand_kVA ,
                           max(CURRENT_READ_DATE) AS Current_Meter_Read_Date ,
                           max(CURRENT_METER_READ) AS Current_Meter_Read ,
                           max(PREVIOUS_READ_DATE) AS Previous_Meter_Read_Date ,
                           sum(PREVIOUS_METER_READ) AS Previous_Meter_Read ,
                           sum(IFNULL(TOTAL_AMOUNT_DUE,0)/100) AS Total_Amount_Due ,
                           sum(IFNULL(TOTAL_CURRENT_CHARGES,0)/100) AS Subtotal ,
                           sum(IFNULL(ENERGY_CHARGE,0)/100) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           sum(IFNULL(BASIC_CHARGE,0)/100) AS Basic_Cost ,
                           sum(IFNULL(DEMAND_CHARGE,0)/100) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(0 AS float) AS Transmission_Cost ,
                           cast(0 AS float) AS Other_Cost ,
                           max(CASE WHEN Device ='1676559' THEN '14-14-010-01W2' WHEN LEN(SERVICE_ADDRESS) = 8 THEN CONCAT('0', LEFT(SERVICE_ADDRESS,1), '-', SUBSTRING(SERVICE_ADDRESS,2,2), '-0', SUBSTRING(SERVICE_ADDRESS,4,2), '-', SUBSTRING(SERVICE_ADDRESS,6,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN(SERVICE_ADDRESS) = 9 THEN CONCAT(LEFT(SERVICE_ADDRESS,2), '-', SUBSTRING(SERVICE_ADDRESS,3,2), '-0', SUBSTRING(SERVICE_ADDRESS,5,2), '-', SUBSTRING(SERVICE_ADDRESS,7,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN (SERVICE_ADDRESS) = 10 THEN CONCAT(SUBSTRING(SERVICE_ADDRESS,2,2), '-', SUBSTRING(SERVICE_ADDRESS,4,2), '-0', SUBSTRING(SERVICE_ADDRESS,6,2), '-', SUBSTRING(SERVICE_ADDRESS,8,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN (SERVICE_ADDRESS) = 11 THEN CONCAT(SUBSTRING(SERVICE_ADDRESS,3,2), '-', SUBSTRING(SERVICE_ADDRESS,5,2), '-0', SUBSTRING(SERVICE_ADDRESS,7,2), '-', SUBSTRING(SERVICE_ADDRESS,9,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN(SERVICE_ADDRESS) = 12 THEN CONCAT(LEFT(SERVICE_ADDRESS,2), '-', SUBSTRING(SERVICE_ADDRESS,3,2), '-0', SUBSTRING(SERVICE_ADDRESS,5,2), '-', SUBSTRING(SERVICE_ADDRESS,7,2), 'W',SUBSTRING(SERVICE_ADDRESS,9,1)) WHEN SERVICE_ADDRESS IN ('MTR#2 092610022', 'MTR#3 092610022', 'MTR#4 092610022') THEN '09-26-010-02W2' WHEN SERVICE_ADDRESS = 'A163501052 CU' THEN '16-35-001-05W2' ELSE SERVICE_ADDRESS END) AS Service_Address ,
                           sum(IFNULL(OTHER_CHARGES_1,0)/100) AS Carbon_Tax ,
                           sum(IFNULL(OTHER_CHARGES_2,0)/100) AS Carbon_Tax_GST ,
                           sum(IFNULL(GST_AMOUNT,0)/100) AS Federal_Tax_GST ,
                           sum(IFNULL(PST_AMOUNT,0)/100) AS PST ,
                           sum(IFNULL(MST_AMOUNT,0)/100) AS MST ,
                           0 AS VAT ,
                           max(CASE WHEN CURRENT_METER_READING_TYPE = '1' AND PREVIOUS_METER_READING_TYPE = '1' THEN 'Smart' ELSE 'Manual' END) AS Meter_Type ,
                           max(BILLING_MULTIPLIER) AS Bill_Multiplier ,
                           max(cast(RATE_CODE AS varchar(100))) AS Rate ,
                           max(cast(0 AS float)) AS Power_Factor ,
                           max(BILLED_DEMAND) AS Peak_Demand ,
                           max(BILL_DAYS) AS Bill_Days
                      FROM DS_POWER.POWERBILL_SASKPOWER SKPB
                      LEFT OUTER JOIN DS_POWER.CBU_AMI_METER_MAPPING A
                        ON A.DEVICE_METER_SHEET = SKPB.DEVICE
                     WHERE SKPB.CONTRACT_ACCOUNT <> '500008148644'
                     GROUP BY SKPB.CONTRACT_ACCOUNT,
                              PREVIOUS_READ_DATE,
                              CURRENT_READ_DATE,
                              DEVICE,
                              TYPE_OF_BILLING
                   ) SELECT *
              FROM PW1
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PWRANALYTICS_CBU_CAMPUS_ENERGY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PWRANALYTICS_CBU_CAMPUS_ENERGY') }}
        name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
        noLinkRefs: []
  name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
