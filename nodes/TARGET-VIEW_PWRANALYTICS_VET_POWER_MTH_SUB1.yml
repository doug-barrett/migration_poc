fileVersion: 1
id: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd67181f-4ba1-4a3f-8502-a96ed7155f77
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(13)
        defaultValue: ""
        description: ""
        name: COUNTRY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f17b93c9-2e5b-4e38-a812-69ff806731eb
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: PROVINCE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 776a5aad-e9dc-4537-8e73-c02d304e0c7c
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(14)
        defaultValue: ""
        description: ""
        name: LANGUAGE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48730919-077a-4e17-b76d-9e1679aff375
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: CURRENCY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a007c5e-786e-4cb4-a373-a3523300c9c6
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(24)
        defaultValue: ""
        description: ""
        name: UTILITY_PROVIDER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3bddb6f8-fe62-4ae7-b498-4957361fe798
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        name: INVOICE_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1a34aba1-e166-4b88-a273-91432d3add4b
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: ACCOUNT_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f3c47e5-1360-414d-9984-02d587c8b31c
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: DELIVERY_POINT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 92df864c-a1f8-427e-bcb8-521cf30c0d78
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: CONSUMPTION_MONTH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0435dcca-422a-4d7e-8c1f-b1178ed125fd
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: METER_NUMBER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bf6ba9b-6e43-44f0-81d4-16f02f60742e
                stepCounter: e8753feb-955f-4be5-8095-9c0c01845e51
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4dc5ffae-58c0-4e46-807b-f45b3f125fda
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: COST_CENTER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a4166cfd-fdb8-41f1-a92a-2cb93ca2d9ab
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: AREA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c477c669-50bc-4e86-89a1-1e2c118720c9
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e42a8f83-e165-4411-9f06-50b63303bf7f
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1be3c8ba-5027-47d7-be21-93ef3e25e403
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_CONSUMPTION_KWH
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bdddcffc-3c39-429e-a74f-033c19048164
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REGISTERED_DEMAND_KVA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4e8969d-6bca-4301-86d3-44a9408b0ccc
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILLED_DEMAND_KVA
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0ca3ac71-f336-45de-8163-a08a42d66121
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6c1bf44-15f5-46b7-9cc6-c04ef4084250
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CURRENT_METER_READ
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 672b269d-124e-44e2-a88c-d11a4d4a8989
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: TIMESTAMP
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4199f799-8c1a-4e77-980d-1e1266ded3e8
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PREVIOUS_METER_READ
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e3f8270-add8-4018-b78d-1c1b41b0f54a
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TOTAL_AMOUNT_DUE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f870404f-536a-435e-ac52-2d77166687a0
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: SUBTOTAL
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9169fe57-4a1d-454f-8fb2-954706ba505c
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42332292-1cc4-44a1-ac50-14063eb1fdbb
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 913d10d8-d1ef-43b1-a0f9-43c460f8cd67
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OFF_PEAK_ENERGY_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40561338-b72c-4a6f-a8e1-feec8f997af2
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BASIC_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd87f9d7-59df-457e-97b8-ede9c04ae7c5
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: DEMAND_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88b3fa68-a853-4a1c-8b09-94393faa307f
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: REACTIVE_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b43f5f24-0c3b-4357-a11d-bae2269d24b9
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: TRANSMISSION_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc34b1c6-7a18-46ed-9094-a9e7a25fb96a
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: OTHER_COST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f4e7ef44-d54f-4427-a2ff-ab30be5c12f6
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: SERVICE_ADDRESS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 83799ea8-a910-477a-93b6-fb96cbfbfd9d
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ab1bf587-989b-4dad-88f4-5f84504558bd
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: CARBON_TAX_GST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a92b330-e901-4158-874a-7c2259c199fb
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: FEDERAL_TAX_GST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9ef7433-2130-4064-8db5-c82f3ce46b4a
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 570f8fae-298e-45fd-bf57-4ff0098b469b
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: MST
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68774c9a-0005-4924-b6b1-e58eadfb3091
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: VAT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8deb181-4b08-49e2-84ba-22b4d6c2b7f5
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: METER_TYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 29f5de53-3b2b-4f3c-9c8d-260e28d7ae36
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_MULTIPLIER
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b41fb31-4e42-4780-a7a4-a79a97736512
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: ""
        name: RATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eac49cde-757b-4994-9f31-6f41605132e0
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: POWER_FACTOR
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b6ef2c7-ec39-4da5-ae8f-e18ac97ab474
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: PEAK_DEMAND
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd271d87-491c-41ca-804a-0cd84bd16741
          stepCounter: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        name: BILL_DAYS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1: ac9b95fb-99ec-48ef-afd6-1ac6bed54d87
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            CREATE OR REPLACE VIEW {{ ref_no_link('TARGET','VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1') }} AS WITH PW1 AS (
                    SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Transalta' AS Utility_Provider ,
                           CAST(CUST_NUMBER AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS nvarchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS nvarchar(225)) AS Delivery_Point ,
                           cast(SETTLEMENT_PERIOD AS date) AS Consumption_Month ,
                           cast(REPLACE(LTRIM(REPLACE(METER_NUMBER, '0', ' ')), ' ', '0') AS nvarchar(50)) AS Meter_Number ,
                           cast(COST_CENTRE AS nvarchar(255)) AS Cost_Center ,
                           cast(HIERARCHY_AREA AS nvarchar(50)) AS Area ,
                           cast(ENERGY_TOTAL AS float) AS Total_Consumption_kWh ,
                           cast(ENERGY_TOTAL AS float) AS Peak_Consumption_kWh ,
                           cast(UNACCOUNTED_ENERGY_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(REGISTERED_DEMAND AS float) AS Registered_Demand_kVA ,
                           cast(BILL_DEMAND AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(SUBTOTAL+TOTAL_ENERGY_COSTS+TRANSALTA_FEE+LOCAL_ACCESS_FEE +LINE_LOSSES_COST +TRADING_CHARGE+DELIVERY_CHARGES+PRIOR_PERIOD_OTHER+ GOA_UTILITY_COMMODITY_REBATE AS float) AS Total_Amount_Due ,
                           cast(SUBTOTAL AS float) AS Subtotal ,
                           cast(TOTAL_ENERGY_COSTS AS float) AS Energy_Cost ,
                           cast(ENERGY_FIXED_PRICE_COST AS float) AS Peak_Energy_Cost ,
                           cast(UNACCOUNTED_ENERGY_COST AS float) AS Off_Peak_Energy_Cost ,
                           cast(LOCAL_ACCESS_FEE AS float) AS Basic_Cost ,
                           cast(0 AS float) AS Demand_Cost ,
                           cast(TRADING_CHARGE AS float) AS Reactive_Cost ,
                           cast(LINE_LOSSES_COST AS float) AS Transmission_Cost ,
                           cast(PRIOR_PERIOD_OTHER AS float) AS Other_Cost ,
                           cast(SITE_LOCATION AS nvarchar(50)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('Smart' AS nvarchar(50)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast('' AS nvarchar(50)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(REGISTERED_DEMAND AS float) AS Peak_Demand ,
                           cast(30 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_TRANSALTA
                 UNION ALL SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Translata' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(REPLACE(LTRIM(REPLACE(METER_NUMBER, '0', ' ')), ' ', '0') AS varchar(100)) AS Meter_Number ,
                           cast(COST_CENTRE AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(TOTAL_KWH AS float) AS Total_Consumption_kWh ,
                           cast(FLOATING_KWH AS float) AS Peak_Consumption_kWh ,
                           cast(OTHER_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(METERED_DEMAND_KW AS float) AS Registered_Demand_kVA ,
                           cast(BILLING_DEMAND_KW AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(TOTAL_AMOUNT AS float) AS Total_Amount_Due ,
                           cast(TOTAL_AMOUNT AS float) AS Subtotal ,
                           cast(0 AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           cast(ADMIN_FEE_AMOUNT AS float) AS Basic_Cost ,
                           cast(TARIFF_AMOUNT AS float) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(0 AS float) AS Transmission_Cost ,
                           cast(OTHER_AMOUNT AS float) AS Other_Cost ,
                           cast(LOCATION AS varchar(100)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('' AS varchar(100)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast(RATE_CODE AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(METERED_DEMAND_KW AS float) AS Peak_Demand ,
                           cast(30 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_CAMPUS_ENMAX
                 UNION ALL SELECT 'Canada' AS Country ,
                           'ALBERTA' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'ENMAX' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Account_Number ,
                           cast(cast(SITE_ID AS bigint) AS varchar(225)) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(0 AS varchar(100)) AS Meter_Number ,
                           cast('' AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(TOTAL_KWH AS float) AS Total_Consumption_kWh ,
                           cast(FLOATING_KWH AS float) AS Peak_Consumption_kWh ,
                           cast(OTHER_KWH AS float) AS Off_Peak_Consumption_kWh ,
                           cast(METERED_DEMAND_KVA AS float) AS Registered_Demand_kVA ,
                           cast(BILLING_DEMAND_KVA AS float) AS Billed_Demand_kVA ,
                           cast(NULL AS datetime) AS Current_Meter_Read_Date ,
                           cast(0 AS int) AS Current_Meter_Read ,
                           cast(NULL AS datetime) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(TOTAL_COST AS float) AS Total_Amount_Due ,
                           cast(TOTAL_COST AS float) AS Subtotal ,
                           cast(FLOATING_COST AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(FIXED_COST AS float) AS Off_Peak_Energy_Cost ,
                           cast(ADMIN_FEE_COST AS float) AS Basic_Cost ,
                           cast(TARIFF_COST AS float) AS Demand_Cost ,
                           cast(MISC_COST AS float) AS Reactive_Cost ,
                           cast(GENERATION_COST AS float) AS Transmission_Cost ,
                           cast(OTHER_COST AS float) AS Other_Cost ,
                           cast(LOCATION AS varchar(100)) AS Service_Address ,
                           cast(0 AS float)AS Carbon_Tax ,
                           cast(0 AS float)AS Carbon_Tax_GST ,
                           cast(0 AS float) AS Federal_Tax_GST ,
                           cast(0 AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(0 AS float) AS VAT ,
                           cast('BASIC' AS varchar(100)) AS Meter_Type ,
                           cast(0 AS int) AS Bill_Multiplier ,
                           cast('' AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(METERED_DEMAND AS float) AS Peak_Demand ,
                           cast(0 AS int) AS Bill_Days
                      FROM DS_POWER.CBU_ENMAX
                 UNION ALL SELECT 'Canada' AS Country ,
                           'SASKATCHEWAN' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'Manitoba Hydro' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           right(cast(REPLACE(ACCOUNT_NUMBER, ' ', '') AS varchar(225)),7) AS Account_Number ,
                           right(cast(REPLACE(ACCOUNT_NUMBER, ' ', '') AS varchar(225)),7) AS Delivery_Point ,
                           cast(CONSUMPTION_MONTH AS date) AS Consumption_Month ,
                           cast(cast(METER_NUMBER AS bigint) AS varchar(100)) AS Meter_Number ,
                           cast('' AS varchar(100)) AS Cost_Center ,
                           cast('' AS varchar(100)) AS Area ,
                           cast(CONSUMPTION_KWH AS float) AS Total_Consumption_kWh ,
                           cast(0 AS float) AS Peak_Consumption_kWh ,
                           cast(0 AS float) AS Off_Peak_Consumption_kWh ,
                           cast(REGISTERED_DEMAND AS float) AS Registered_Demand_kVA ,
                           cast(BILLED_KVA AS float) AS Billed_Demand_kVA ,
                           DATE_FROM_PARTS(nullif(cast(left(cast(cast(CURRENT_READDATE AS int) AS varchar),4) AS int),0) ,nullif(cast(right(left(cast(cast(CURRENT_READDATE AS int) AS varchar),6),2) AS int),0) ,nullif(cast(right(cast(cast(CURRENT_READDATE AS int) AS varchar),2) AS int),0)) AS Current_Meter_Read_Date ,
                           cast(METER_READING AS int) AS Current_Meter_Read ,
                           DATE_FROM_PARTS(nullif(cast(left(cast(cast(PREVIOUS_READDATE AS int) AS varchar),4) AS int),0) ,nullif(cast(right(left(cast(cast(PREVIOUS_READDATE AS int) AS varchar),6),2) AS int),0) ,nullif(cast(right(cast(cast(PREVIOUS_READDATE AS int) AS varchar),2) AS int),0)) AS Previous_Meter_Read_Date ,
                           cast(0 AS int) AS Previous_Meter_Read ,
                           cast(AMOUNT_DUE AS float) AS Total_Amount_Due ,
                           cast(ENERGY_COST AS float)+cast(ENERGY_COST AS float)+cast(BASIC_COST AS float)+cast(DEMAND_COST AS float)+cast(DISTRIBUTION_COST AS float) +cast(TRANSPORTATION_COST AS float)+cast(GST AS float)+cast(CARBON_GTAX AS float)+ cast(PROVINCIAL_TAX AS float) AS Subtotal ,
                           cast(ENERGY_COST AS float) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           cast(BASIC_COST AS float) AS Basic_Cost ,
                           cast(DEMAND_COST AS float) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(TRANSPORTATION_COST AS float) AS Tranmission_Cost ,
                           cast(DISTRIBUTION_COST AS float) AS Other_Cost ,
                           cast(SERVICE_ADDRESS AS varchar(100)) AS Service_Address ,
                           cast(CARBON_GTAX AS float) AS Carbon_Tax ,
                           cast(GST_CARBONTAX AS float)AS Carbon_Tax_GST ,
                           cast(GST AS float) AS Federal_Tax_GST ,
                           cast(PROVINCIAL_TAX AS float) AS PST ,
                           cast(0 AS float) AS MST ,
                           cast(GST AS float) AS VAT ,
                           cast(TYPE AS varchar(100)) AS Meter_Type ,
                           cast(MULTIPLIER AS float) AS Bill_Multiplier ,
                           cast(RATE AS varchar(100)) AS Rate ,
                           cast(0 AS float) AS Power_Factor ,
                           cast(PEAK_DEMAND AS float) AS Peak_Demand ,
                           cast(DAYS AS float) AS Bill_Days
                      FROM DS_POWER.CBU_MANITOBA_HYDRO
                 UNION ALL SELECT 'Canada' AS Country ,
                           'SASKATCHEWAN' AS Province ,
                           'English' AS LANGUAGE ,
                           'CAD' AS Currency ,
                           'SaskPower' AS Utility_Provider ,
                           cast(0 AS VARCHAR(255)) AS Invoice_Number ,
                           CASE WHEN SKPB.CONTRACT_ACCOUNT = '510008584946' THEN '510004891535'
                                ELSE CAST(SKPB.CONTRACT_ACCOUNT AS VARCHAR(255))
                                 END AS Account_Number ,
                           CASE WHEN SKPB.CONTRACT_ACCOUNT = '510008584946' THEN '510004891535'
                                ELSE CAST(SKPB.CONTRACT_ACCOUNT AS VARCHAR(255))
                                 END AS Delivery_Point ,
                           CASE WHEN DATEDIFF(MONTH, SKPB.PREVIOUS_READ_DATE, SKPB.CURRENT_READ_DATE) = 1 THEN CASE WHEN DATEDIFF(DAY, SKPB.PREVIOUS_READ_DATE, DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE)) > DATEDIFF(DAY, DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE), SKPB.CURRENT_READ_DATE) + 1 THEN DATE_TRUNC('MONTH', SKPB.PREVIOUS_READ_DATE) ELSE DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE) END
                                ELSE DATE_TRUNC('MONTH', SKPB.CURRENT_READ_DATE)
                                 END AS CONSUMPTION_MONTH ,
                           cast(Device AS varchar(100)) AS Meter_Number ,
                           max(cast('' AS varchar(100))) AS Cost_Center ,
                           max(cast('' AS varchar(100))) AS Area ,
                           sum(TOTAL_CONSUMPTION) AS Total_Consumption_kWh ,
                           cast(0 AS float) AS Peak_Consumption_kWh ,
                           cast(0 AS float) AS Off_Peak_Consumption_kWh ,
                           sum(IFNULL(REGISTER_DEMAND,0)) AS Registered_Demand_kVA ,
                           sum(IFNULL(BILLED_DEMAND,0)) AS Billed_Demand_kVA ,
                           max(CURRENT_READ_DATE) AS Current_Meter_Read_Date ,
                           max(CURRENT_METER_READ) AS Current_Meter_Read ,
                           max(PREVIOUS_READ_DATE) AS Previous_Meter_Read_Date ,
                           sum(PREVIOUS_METER_READ) AS Previous_Meter_Read ,
                           sum(IFNULL(TOTAL_AMOUNT_DUE,0)/100) AS Total_Amount_Due ,
                           sum(IFNULL(TOTAL_CURRENT_CHARGES,0)/100) AS Subtotal ,
                           sum(IFNULL(ENERGY_CHARGE,0)/100) AS Energy_Cost ,
                           cast(0 AS float) AS Peak_Energy_Cost ,
                           cast(0 AS float) AS Off_Peak_Energy_Cost ,
                           sum(IFNULL(BASIC_CHARGE,0)/100) AS Basic_Cost ,
                           sum(IFNULL(DEMAND_CHARGE,0)/100) AS Demand_Cost ,
                           cast(0 AS float) AS Reactive_Cost ,
                           cast(0 AS float) AS Transmission_Cost ,
                           cast(0 AS float) AS Other_Cost ,
                           max(CASE WHEN Device ='1676559' THEN '14-14-010-01W2' WHEN LEN(SERVICE_ADDRESS) = 8 THEN CONCAT('0', LEFT(SERVICE_ADDRESS,1), '-', SUBSTRING(SERVICE_ADDRESS,2,2), '-0', SUBSTRING(SERVICE_ADDRESS,4,2), '-', SUBSTRING(SERVICE_ADDRESS,6,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN(SERVICE_ADDRESS) = 9 THEN CONCAT(LEFT(SERVICE_ADDRESS,2), '-', SUBSTRING(SERVICE_ADDRESS,3,2), '-0', SUBSTRING(SERVICE_ADDRESS,5,2), '-', SUBSTRING(SERVICE_ADDRESS,7,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN (SERVICE_ADDRESS) = 10 THEN CONCAT(SUBSTRING(SERVICE_ADDRESS,2,2), '-', SUBSTRING(SERVICE_ADDRESS,4,2), '-0', SUBSTRING(SERVICE_ADDRESS,6,2), '-', SUBSTRING(SERVICE_ADDRESS,8,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN (SERVICE_ADDRESS) = 11 THEN CONCAT(SUBSTRING(SERVICE_ADDRESS,3,2), '-', SUBSTRING(SERVICE_ADDRESS,5,2), '-0', SUBSTRING(SERVICE_ADDRESS,7,2), '-', SUBSTRING(SERVICE_ADDRESS,9,2), 'W', RIGHT(SERVICE_ADDRESS,1)) WHEN LEN(SERVICE_ADDRESS) = 12 THEN CONCAT(LEFT(SERVICE_ADDRESS,2), '-', SUBSTRING(SERVICE_ADDRESS,3,2), '-0', SUBSTRING(SERVICE_ADDRESS,5,2), '-', SUBSTRING(SERVICE_ADDRESS,7,2), 'W',SUBSTRING(SERVICE_ADDRESS,9,1)) WHEN SERVICE_ADDRESS IN ('MTR#2 092610022', 'MTR#3 092610022', 'MTR#4 092610022') THEN '09-26-010-02W2' WHEN SERVICE_ADDRESS = 'A163501052 CU' THEN '16-35-001-05W2' ELSE SERVICE_ADDRESS END) AS Service_Address ,
                           sum(IFNULL(OTHER_CHARGES_1,0)/100) AS Carbon_Tax ,
                           sum(IFNULL(OTHER_CHARGES_2,0)/100) AS Carbon_Tax_GST ,
                           sum(IFNULL(GST_AMOUNT,0)/100) AS Federal_Tax_GST ,
                           sum(IFNULL(PST_AMOUNT,0)/100) AS PST ,
                           sum(IFNULL(MST_AMOUNT,0)/100) AS MST ,
                           0 AS VAT ,
                           max(CASE WHEN CURRENT_METER_READING_TYPE = '1' AND PREVIOUS_METER_READING_TYPE = '1' THEN 'Smart' ELSE 'Manual' END) AS Meter_Type ,
                           max(BILLING_MULTIPLIER) AS Bill_Multiplier ,
                           max(cast(RATE_CODE AS varchar(100))) AS Rate ,
                           max(cast(0 AS float)) AS Power_Factor ,
                           max(BILLED_DEMAND) AS Peak_Demand ,
                           max(BILL_DAYS) AS Bill_Days
                      FROM DS_POWER.POWERBILL_SASKPOWER SKPB
                      LEFT OUTER JOIN DS_POWER.CBU_AMI_METER_MAPPING A
                        ON A.DEVICE_METER_SHEET = SKPB.DEVICE
                     WHERE SKPB.CONTRACT_ACCOUNT <> '500008148644'
                     GROUP BY SKPB.CONTRACT_ACCOUNT,
                              PREVIOUS_READ_DATE,
                              CURRENT_READ_DATE,
                              DEVICE,
                              TYPE_OF_BILLING
                   ) SELECT *
              FROM PW1
        dependencies:
          - locationName: TARGET
            nodeName: ODS_PWRANALYTICS_CBU_CAMPUS_ENERGY
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TARGET','ODS_PWRANALYTICS_CBU_CAMPUS_ENERGY') }}
        name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
        noLinkRefs: []
  name: VIEW_PWRANALYTICS_VET_POWER_MTH_SUB1
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
