fileVersion: 1
id: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
name: S_CONTACT_NASC_PRIORITISATION_FORM_V
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  customOverride: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d3013a7d-b6c8-4d5d-9a8d-7aaf3e78488f
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bc6297d-00ed-48bb-952b-24c3544e139e
                stepCounter: 289da868-88f5-4e61-a975-de3b30517956
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05ef0eef-9e1f-405b-9c0c-f2b79365df3d
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: ""
        name: TASK_REQUEST_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ad789b0-1af1-49e5-b06b-e698b88f786b
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39bf125b-f866-4e1a-a2b9-3d4761296105
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_REPORT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2873ec7c-2c60-4c9b-8393-65dd1f9c1075
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5dfb4521-955c-4ab0-bd38-71e41a469bb2
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(100)
        defaultValue: ""
        description: ""
        name: STREAM_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66a6b1b1-d5e0-450e-8c39-901f8824d137
                stepCounter: 1647b613-d9ed-46b3-ab99-a71274b0cb51
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7fafef55-1238-4f1c-8d0c-b8f00a43dce0
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(101)
        defaultValue: ""
        description: ""
        name: REFERRALENCOUNTER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66a6b1b1-d5e0-450e-8c39-901f8824d137
                stepCounter: 1647b613-d9ed-46b3-ab99-a71274b0cb51
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b3b0c1a-4a86-4ffb-a900-b6366b693696
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: BIGINT
        defaultValue: ""
        description: patient_programme_id
        name: PATIENT_PROGRAMME_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ecbb2a5d-a3b9-4778-9fab-c0af67d98338
                stepCounter: 1647b613-d9ed-46b3-ab99-a71274b0cb51
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12dfcc95-26ec-49b6-bf6a-b21dd6db0e77
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DUE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6dbfa34-4f2b-45e0-ace5-6fb47a23f0db
                stepCounter: 7b4c3eab-6eaf-440f-890b-2660daed8357
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c5f892b5-3edb-4bb0-9c5b-616e20c43df8
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: NVARCHAR(200)
        defaultValue: ""
        description: ""
        name: DISPLAY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e5353c2d-4a44-4e11-bc07-37f02a977a35
                stepCounter: 447055e4-f68c-4b9d-a35b-74f5502fcef1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02cdc537-4d21-49f1-a618-510459f95557
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: DATE_COMPLETED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e062b704-8bee-4ebf-9f39-44e0732669e2
                stepCounter: 118925c3-58c5-4511-b154-1b1a31b2082e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdb1fcc3-6fab-4a58-b0dd-6dd13a1c7124
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(11)
        defaultValue: ""
        description: ""
        name: STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a914fcca-3d6a-4e93-b4a5-163fe4eb68b2
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(56)
        defaultValue: ""
        description: ""
        name: PROF_CARER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aed14678-9d10-456d-9185-aa8cef9d0cf2
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: ALLOCATED_HCP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b10a3b4-293e-4bdc-bc44-71c2ba639bbe
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: CLASSIFICATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4420644e-e7ad-41fd-8d43-da331d476373
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: EXIT_REASON_COMMENTS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f695a8f-0deb-4bec-a284-26769633af0e
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: EXIT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ad54a1ce-0e84-4ba4-998f-b5223a9f223c
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: EXIT_REASON
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dd62f22c-db4b-4e03-af15-f5515450e79c
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: HCPCLINIC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 193f0dc0-3c74-4c1a-b6f1-6cba6c697f77
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: HCPPROVIDER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e9eebea-138c-4beb-95d7-2778cf5daaec
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: HCPPROVIDERROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f25af0fd-c948-4b4a-84ec-27a042b615e4
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: TRANSFEROUTRESIDENTIAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9ed69c5c-67ef-4fcb-81f4-7f669e77eda3
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: MIGRATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 066955da-d51f-48c7-8aa1-2be4225569b4
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: WL_NOTE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7a86d18a-3840-4040-90ee-0494715af0d8
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: NOTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3023d11b-d807-4167-86a1-041c987a86ec
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: WL_URGENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22384f66-83cc-4441-adb6-8d77ca5eb924
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: REFERRAL_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 935324e6-e71b-45ec-8a7d-b10841003db8
          stepCounter: 8c3d68b8-5c9a-46a7-bd2c-20664814dfab
        config: {}
        dataType: VARCHAR(7000)
        defaultValue: ""
        description: ""
        name: TRANSFEROUTDHB
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('SQL Override') }}
            SELECT pat.NHI_number,
                   tr.taskrequest_id,
                   obs.observation_report_id,
                   pp.stream_id,
                   'R' + pp.stream_id AS referralencounter,
                   pp.patient_programme_id,
                   tr.due_date,
                   tt.display_name,
                   obs.date_completed,
                   CASE WHEN obs.observation_report_status = 'F' THEN 'Completed'
                        WHEN obs.observation_report_status = 'S' THEN 'In Progress'
                        WHEN obs.observation_report_status = 'X' THEN 'Declined'
                        WHEN obs.observation_report_status = 'A' THEN 'Finalised'
                         END AS status,
                   obs.provider_given_name + ' ' + obs.provider_family_name AS prof_carer ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4496216084004
                   ) AS [Allocated HCP] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 6332723233436
                   ) AS [Classification] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4497265944364
                   ) AS [Exit_Reason_Comments] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4692589947576
                   ) AS [Exit_Date] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4497265089308
                   ) AS [Exit_Reason] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4618249200200
                   ) AS [HCPclinic] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4618249410328
                   ) AS [HCPprovider] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4618249500516
                   ) AS [HCPproviderRole] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 5028509917560
                   ) AS [TransferOutResidential] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4655176756812
                   ) AS [Migrated_Date] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4454082674748
                   ) AS [WL_Note] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 1066178928090
                   ) AS [Notes] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 4454082941436
                   ) AS [WL_Urgency] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 5762862391008
                   ) AS [Referral_source] ,
                   (
                    SELECT ato.value
                      FROM ds_cdsswe_atomic_observation ato
                     WHERE obs.observation_report_id = ato.observation_report_id
                       AND ato.datatype_id = 5028510230360
                   ) AS [TransferOutDHB] --into t2

              FROM ds_cdsswe_Task_Request tr,
                   ds_cdsswe_patient_programme pp,
                   l_cdsswe_patient pat,
                   l_cdsswe_task_type tt,
                   ds_cdsswe_Observation_Report obs
             WHERE tr.patient_programme_id = pp.patient_programme_id
               AND pp.patient_id = pat.patient_id
               AND tr.tasktype_id = tt.tasktype_id
               AND tr.taskrequest_id = obs.taskrequest_id
               AND obs.record_status = 'A'
               AND obs.observation_report_status IN ('A','F','S','X')
               AND tt.tasktype_id = 4454040246876
        dependencies:
          - locationName: TGT
            nodeName: L_CDSSWE_PATIENT
        join:
          joinCondition: |-
            -- Nodes used in the SQL override:
            {{ ref('TGT','L_CDSSWE_PATIENT') }}
        name: S_CONTACT_NASC_PRIORITISATION_FORM_V
        noLinkRefs: []
  name: S_CONTACT_NASC_PRIORITISATION_FORM_V
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
