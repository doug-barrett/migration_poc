fileVersion: 1
id: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
name: S_OPTO_OBSERVATION_10
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4c8fa64-3733-426d-9f58-848fdf140a07
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_OBSERVATION_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28203761-4f87-47a0-b261-1b55af0771d1
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5811ff44-5c8d-47e3-9f55-28d9f1d91f7f
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: PATIENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8007843-fa24-4957-9502-2a7a6fcc3c66
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10b9cb2e-d220-4ed8-ada6-444386dc808a
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: NVARCHAR(40)
        defaultValue: ""
        description: ""
        name: PATIENT_NHI
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 25e0890d-32a4-417b-8c18-e6798a0089ee
                stepCounter: 687e8b78-238c-4482-942c-cfcefb43673b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 33d21bdc-0bf8-426b-ad92-f16b63f57018
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: NVARCHAR(200)
        defaultValue: ""
        description: ""
        name: OBSERVATION_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ffe0337-7a83-418f-8326-11fa952c3b76
                stepCounter: 700f719e-e860-40c2-ba53-77ddb3e2e8c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 75be59a9-d93a-44d9-86cf-4b04bf50232c
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_DATATYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 557b4c84-5230-460f-a72e-58c438b20f62
                stepCounter: 700f719e-e860-40c2-ba53-77ddb3e2e8c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3854415d-01e6-4c7d-af48-f903330896e4
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: NVARCHAR(25)
        defaultValue: ""
        description: ""
        name: OBSERVATION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a58caa74-3b7e-4235-ba3e-406a9422dea1
                stepCounter: 700f719e-e860-40c2-ba53-77ddb3e2e8c2
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dbc6d66a-ea04-4444-b93b-d61f473fa4e0
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: NVARCHAR(100)
        defaultValue: ""
        description: ""
        name: DATA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c8c79633-970a-4140-b800-05fec116a49b
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bb45f509-92fa-466e-a1a3-fdf84de329f3
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: NVARCHAR(MAX)
        defaultValue: ""
        description: ""
        name: NOTE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d11d2acf-d2f6-4992-b4ea-8ab9f31188c6
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4bec148-ff4b-47de-bfd3-182dec0120c7
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_KIND_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 940a5953-af8f-4cac-a5a5-6288b9988fa0
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0886af63-3baf-46d6-8b9f-2234f329f6ee
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_KIND_SEQUENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 940a5953-af8f-4cac-a5a5-6288b9988fa0
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ROW_NUMBER() over(PARTITION BY s_opto_patient_10.patient_id,l_opto_patient_observation.kindid ORDER BY l_opto_patient_observation.datemade DESC)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 32060626-a55c-446a-89bd-b74ff1e4f496
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: OBSERVATION_KIND_REVERSE_SEQUENCE_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 940a5953-af8f-4cac-a5a5-6288b9988fa0
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ROW_NUMBER() over(PARTITION BY s_opto_patient_10.patient_id,l_opto_patient_observation.kindid ORDER BY l_opto_patient_observation.datemade)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 152bd260-eb34-4b1f-b846-5d5451531c6a
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: EARLIEST_OBSERVATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 940a5953-af8f-4cac-a5a5-6288b9988fa0
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: |-
              CASE WHEN ROW_NUMBER() over(PARTITION BY s_opto_patient_10.patient_id,l_opto_patient_observation.kindid ORDER BY l_opto_patient_observation.datemade DESC) = 1 THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 544c5e17-3507-4250-b451-ad790d8c9bcf
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: VARCHAR(1)
        defaultValue: ""
        description: ""
        name: LATEST_OBSERVATION_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 940a5953-af8f-4cac-a5a5-6288b9988fa0
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: |-
              CASE WHEN ROW_NUMBER() over(PARTITION BY s_opto_patient_10.patient_id,l_opto_patient_observation.kindid ORDER BY l_opto_patient_observation.datemade) = 1 THEN 'Y'
                          ELSE 'N'
                           END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 873e56a1-85cc-4d8b-94a0-1fcb7fabcc4d
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: OBSERVATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2385b9d8-d837-4697-b76a-f09e9c6cccac
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ad8168d-9a59-48c7-b460-85fac0950ceb
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: ""
        name: CLINICIAN_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 242f4535-7dd4-42b6-8046-e417ee4d761f
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6be0297-2215-45c4-9c4a-0c9051e5c62a
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_opto_observation_10.clinician_id=dim_opto_clinician.clinician_id
        name: DIM_OPTO_CLINICIAN_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 96907c23-a9b3-4cf6-8fff-68341bcf5e5a
                stepCounter: 12ae5165-0f59-4c57-97bb-2fcaaf94baa8
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 25b93557-9312-49e9-a833-4bca68daf5e7
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_opto_observation_10.observation_kind_id=dim_opto_observation.id
        name: DIM_OPTO_OBSERVATION_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1398703e-5508-47e1-b40b-44080e25b484
                stepCounter: f308ddb8-5cd0-4d0b-b37e-c5af608aa86b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 080a0d00-bc62-43d8-8844-da9feca579a7
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INT
        defaultValue: ""
        description: s_opto_observation_10.cast(s_opto_observation.date_made as date)=dim_opto_observation_date.calendar_date
        name: DIM_OPTO_OBSERVATION_DATE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc7a73fc-7505-4595-8163-6617e0952f74
                stepCounter: 6adf6602-3ca7-4df0-b3f5-3b15b21ed2b7
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0b9bed43-de0e-4ba6-b031-cabba82c10d6
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: INTEGER
        defaultValue: ""
        description: s_opto_observation_10.patient_id=dim_opto_patient.patient_id
        name: DIM_OPTO_PATIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eb17b158-9495-46e9-bead-d77e96e21d26
                stepCounter: 7c7954d2-24cc-478d-99e0-03985ea2a42e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2cd98dd5-63f1-457f-884f-26424a959a25
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: VALID_FROM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92becaba-7e60-4384-a075-5ead19ec7df1
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ffa82271-e623-4109-8d76-3b4d3ad7883e
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: ""
        name: VALID_TO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c7e44d42-5694-4f07-a767-f931a8c5a49c
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5555645d-f704-4d93-ad48-b9ee6c627fc9
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: BIT
        defaultValue: ""
        description: ""
        name: ISVALID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 881f24ef-dc29-4f3e-8392-ce74c8f36331
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d62cf8ab-bf02-4ff6-8026-682f0df6e10a
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: CHAR(36)
        defaultValue: ""
        description: ""
        name: UNIQUE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a45707a8-58ed-4e3b-beb5-bed31ea12f74
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb306e54-6160-41ab-a2b0-accbf5bba741
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: VARCHAR(255)
        defaultValue: ""
        description: Record source.
        name: DSS_RECORD_SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8db2056b-f2a1-437f-8f44-a33a697f2749
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0496426a-dfd2-42a3-b430-bb46f782619e
          stepCounter: 78565230-48d3-4580-bcd2-ee9e5ce6e55b
        config: {}
        dataType: DATETIME
        defaultValue: ""
        description: Load date.
        name: DSS_LOAD_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0506b06-3463-4e6e-9dc1-4bc24db59e5b
                stepCounter: fe2892e4-f788-420d-822b-238e732f76eb
            transform: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          L_OPTO_PATIENT_OBSERVATION: fe2892e4-f788-420d-822b-238e732f76eb
          S_OPTO_PATIENT_10: 687e8b78-238c-4482-942c-cfcefb43673b
          L_OPTO_OBSERVATION_KIND: 700f719e-e860-40c2-ba53-77ddb3e2e8c2
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TGT
            nodeName: L_OPTO_PATIENT_OBSERVATION
          - locationName: TGT
            nodeName: S_OPTO_PATIENT_10
          - locationName: TGT
            nodeName: L_OPTO_OBSERVATION_KIND
        join:
          joinCondition: |-
            FROM {{ ref('TGT','L_OPTO_PATIENT_OBSERVATION') }} l_opto_patient_observation
              JOIN {{ ref('TGT','S_OPTO_PATIENT_10') }} s_opto_patient_10
                ON l_opto_patient_observation.patientid = s_opto_patient_10.patient_id
              JOIN {{ ref('TGT','L_OPTO_OBSERVATION_KIND') }} l_opto_observation_kind
                ON l_opto_patient_observation.kindid = l_opto_observation_kind.id
              JOIN [dim].dim_opto_observation_date
                ON dim_opto_observation_date.calendar_date = cast(l_opto_patient_observation.datemade AS date)
             WHERE l_opto_patient_observation.isValid =1
        name: S_OPTO_OBSERVATION_10
        noLinkRefs: []
  name: S_OPTO_OBSERVATION_10
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
